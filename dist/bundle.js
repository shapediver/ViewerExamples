/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e={9521:(e,t,n)=>{"use strict";function i(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function r(e){return Math.min(1,Math.max(0,e))}function s(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function a(e){return e<=1?100*Number(e)+"%":e}function o(e){return 1===e.length?"0"+e:String(e)}function l(e,t,n){return{r:255*i(e,255),g:255*i(t,255),b:255*i(n,255)}}function c(e,t,n){e=i(e,255),t=i(t,255),n=i(n,255);var r=Math.max(e,t,n),s=Math.min(e,t,n),a=0,o=0,l=(r+s)/2;if(r===s)o=0,a=0;else{var c=r-s;switch(o=l>.5?c/(2-r-s):c/(r+s),r){case e:a=(t-n)/c+(t<n?6:0);break;case t:a=(n-e)/c+2;break;case n:a=(e-t)/c+4}a/=6}return{h:a,s:o,l}}function h(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function u(e,t,n){var r,s,a;if(e=i(e,360),t=i(t,100),n=i(n,100),0===t)s=n,a=n,r=n;else{var o=n<.5?n*(1+t):n+t-n*t,l=2*n-o;r=h(l,o,e+1/3),s=h(l,o,e),a=h(l,o,e-1/3)}return{r:255*r,g:255*s,b:255*a}}function d(e,t,n){e=i(e,255),t=i(t,255),n=i(n,255);var r=Math.max(e,t,n),s=Math.min(e,t,n),a=0,o=r,l=r-s,c=0===r?0:l/r;if(r===s)a=0;else{switch(r){case e:a=(t-n)/l+(t<n?6:0);break;case t:a=(n-e)/l+2;break;case n:a=(e-t)/l+4}a/=6}return{h:a,s:c,v:o}}function p(e,t,n){e=6*i(e,360),t=i(t,100),n=i(n,100);var r=Math.floor(e),s=e-r,a=n*(1-t),o=n*(1-s*t),l=n*(1-(1-s)*t),c=r%6;return{r:255*[n,o,a,a,l,n][c],g:255*[l,n,n,o,a,a][c],b:255*[a,a,l,n,n,o][c]}}function f(e,t,n,i){var r=[o(Math.round(e).toString(16)),o(Math.round(t).toString(16)),o(Math.round(n).toString(16))];return i&&r[0].startsWith(r[0].charAt(1))&&r[1].startsWith(r[1].charAt(1))&&r[2].startsWith(r[2].charAt(1))?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function m(e,t,n,i,r){var s=[o(Math.round(e).toString(16)),o(Math.round(t).toString(16)),o(Math.round(n).toString(16)),o(v(i))];return r&&s[0].startsWith(s[0].charAt(1))&&s[1].startsWith(s[1].charAt(1))&&s[2].startsWith(s[2].charAt(1))&&s[3].startsWith(s[3].charAt(1))?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function g(e,t,n,i){return[o(v(i)),o(Math.round(e).toString(16)),o(Math.round(t).toString(16)),o(Math.round(n).toString(16))].join("")}function v(e){return Math.round(255*parseFloat(e)).toString(16)}function _(e){return y(e)/255}function y(e){return parseInt(e,16)}function b(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}n.r(t),n.d(t,{TinyColor:()=>C,bounds:()=>V,convertDecimalToHex:()=>v,convertHexToDecimal:()=>_,default:()=>F,fromRatio:()=>N,hslToRgb:()=>u,hsvToRgb:()=>p,inputToRGB:()=>x,isReadable:()=>I,isValidCSSUnit:()=>R,legacyRandom:()=>B,mostReadable:()=>D,names:()=>w,numberInputToObject:()=>b,parseIntFromHex:()=>y,random:()=>z,readability:()=>L,rgbToHex:()=>f,rgbToHsl:()=>c,rgbToHsv:()=>d,rgbToRgb:()=>l,rgbaToArgbHex:()=>g,rgbaToHex:()=>m,stringInputToObject:()=>A,tinycolor:()=>P,toMsFilter:()=>O});var w={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function x(e){var t={r:0,g:0,b:0},n=1,i=null,r=null,o=null,c=!1,h=!1;return"string"==typeof e&&(e=A(e)),"object"==typeof e&&(R(e.r)&&R(e.g)&&R(e.b)?(t=l(e.r,e.g,e.b),c=!0,h="%"===String(e.r).substr(-1)?"prgb":"rgb"):R(e.h)&&R(e.s)&&R(e.v)?(i=a(e.s),r=a(e.v),t=p(e.h,i,r),c=!0,h="hsv"):R(e.h)&&R(e.s)&&R(e.l)&&(i=a(e.s),o=a(e.l),t=u(e.h,i,o),c=!0,h="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(n=e.a)),n=s(n),{ok:c,format:e.format||h,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}var M="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",E="[\\s|\\(]+("+M+")[,|\\s]+("+M+")[,|\\s]+("+M+")\\s*\\)?",S="[\\s|\\(]+("+M+")[,|\\s]+("+M+")[,|\\s]+("+M+")[,|\\s]+("+M+")\\s*\\)?",T={CSS_UNIT:new RegExp(M),rgb:new RegExp("rgb"+E),rgba:new RegExp("rgba"+S),hsl:new RegExp("hsl"+E),hsla:new RegExp("hsla"+S),hsv:new RegExp("hsv"+E),hsva:new RegExp("hsva"+S),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function A(e){if(0===(e=e.trim().toLowerCase()).length)return!1;var t=!1;if(w[e])e=w[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var n=T.rgb.exec(e);return n?{r:n[1],g:n[2],b:n[3]}:(n=T.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=T.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=T.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=T.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=T.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=T.hex8.exec(e))?{r:y(n[1]),g:y(n[2]),b:y(n[3]),a:_(n[4]),format:t?"name":"hex8"}:(n=T.hex6.exec(e))?{r:y(n[1]),g:y(n[2]),b:y(n[3]),format:t?"name":"hex"}:(n=T.hex4.exec(e))?{r:y(n[1]+n[1]),g:y(n[2]+n[2]),b:y(n[3]+n[3]),a:_(n[4]+n[4]),format:t?"name":"hex8"}:!!(n=T.hex3.exec(e))&&{r:y(n[1]+n[1]),g:y(n[2]+n[2]),b:y(n[3]+n[3]),format:t?"name":"hex"}}function R(e){return Boolean(T.CSS_UNIT.exec(String(e)))}var C=function(){function e(t,n){var i;if(void 0===t&&(t=""),void 0===n&&(n={}),t instanceof e)return t;"number"==typeof t&&(t=b(t)),this.originalInput=t;var r=x(t);this.originalInput=t,this.r=r.r,this.g=r.g,this.b=r.b,this.a=r.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(i=n.format)&&void 0!==i?i:r.format,this.gradientType=n.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=r.ok}return e.prototype.isDark=function(){return this.getBrightness()<128},e.prototype.isLight=function(){return!this.isDark()},e.prototype.getBrightness=function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},e.prototype.getLuminance=function(){var e=this.toRgb(),t=e.r/255,n=e.g/255,i=e.b/255;return.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.0722*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))},e.prototype.getAlpha=function(){return this.a},e.prototype.setAlpha=function(e){return this.a=s(e),this.roundA=Math.round(100*this.a)/100,this},e.prototype.toHsv=function(){var e=d(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}},e.prototype.toHsvString=function(){var e=d(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),i=Math.round(100*e.v);return 1===this.a?"hsv("+t+", "+n+"%, "+i+"%)":"hsva("+t+", "+n+"%, "+i+"%, "+this.roundA+")"},e.prototype.toHsl=function(){var e=c(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}},e.prototype.toHslString=function(){var e=c(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),i=Math.round(100*e.l);return 1===this.a?"hsl("+t+", "+n+"%, "+i+"%)":"hsla("+t+", "+n+"%, "+i+"%, "+this.roundA+")"},e.prototype.toHex=function(e){return void 0===e&&(e=!1),f(this.r,this.g,this.b,e)},e.prototype.toHexString=function(e){return void 0===e&&(e=!1),"#"+this.toHex(e)},e.prototype.toHex8=function(e){return void 0===e&&(e=!1),m(this.r,this.g,this.b,this.a,e)},e.prototype.toHex8String=function(e){return void 0===e&&(e=!1),"#"+this.toHex8(e)},e.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},e.prototype.toRgbString=function(){var e=Math.round(this.r),t=Math.round(this.g),n=Math.round(this.b);return 1===this.a?"rgb("+e+", "+t+", "+n+")":"rgba("+e+", "+t+", "+n+", "+this.roundA+")"},e.prototype.toPercentageRgb=function(){var e=function(e){return Math.round(100*i(e,255))+"%"};return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}},e.prototype.toPercentageRgbString=function(){var e=function(e){return Math.round(100*i(e,255))};return 1===this.a?"rgb("+e(this.r)+"%, "+e(this.g)+"%, "+e(this.b)+"%)":"rgba("+e(this.r)+"%, "+e(this.g)+"%, "+e(this.b)+"%, "+this.roundA+")"},e.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var e="#"+f(this.r,this.g,this.b,!1),t=0,n=Object.entries(w);t<n.length;t++){var i=n[t],r=i[0];if(e===i[1])return r}return!1},e.prototype.toString=function(e){var t=Boolean(e);e=null!=e?e:this.format;var n=!1,i=this.a<1&&this.a>=0;return t||!i||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()},e.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},e.prototype.clone=function(){return new e(this.toString())},e.prototype.lighten=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l+=t/100,n.l=r(n.l),new e(n)},e.prototype.brighten=function(t){void 0===t&&(t=10);var n=this.toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-t/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-t/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-t/100*255))),new e(n)},e.prototype.darken=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l-=t/100,n.l=r(n.l),new e(n)},e.prototype.tint=function(e){return void 0===e&&(e=10),this.mix("white",e)},e.prototype.shade=function(e){return void 0===e&&(e=10),this.mix("black",e)},e.prototype.desaturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s-=t/100,n.s=r(n.s),new e(n)},e.prototype.saturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s+=t/100,n.s=r(n.s),new e(n)},e.prototype.greyscale=function(){return this.desaturate(100)},e.prototype.spin=function(t){var n=this.toHsl(),i=(n.h+t)%360;return n.h=i<0?360+i:i,new e(n)},e.prototype.mix=function(t,n){void 0===n&&(n=50);var i=this.toRgb(),r=new e(t).toRgb(),s=n/100;return new e({r:(r.r-i.r)*s+i.r,g:(r.g-i.g)*s+i.g,b:(r.b-i.b)*s+i.b,a:(r.a-i.a)*s+i.a})},e.prototype.analogous=function(t,n){void 0===t&&(t=6),void 0===n&&(n=30);var i=this.toHsl(),r=360/n,s=[this];for(i.h=(i.h-(r*t>>1)+720)%360;--t;)i.h=(i.h+r)%360,s.push(new e(i));return s},e.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new e(t)},e.prototype.monochromatic=function(t){void 0===t&&(t=6);for(var n=this.toHsv(),i=n.h,r=n.s,s=n.v,a=[],o=1/t;t--;)a.push(new e({h:i,s:r,v:s})),s=(s+o)%1;return a},e.prototype.splitcomplement=function(){var t=this.toHsl(),n=t.h;return[this,new e({h:(n+72)%360,s:t.s,l:t.l}),new e({h:(n+216)%360,s:t.s,l:t.l})]},e.prototype.onBackground=function(t){var n=this.toRgb(),i=new e(t).toRgb();return new e({r:i.r+(n.r-i.r)*n.a,g:i.g+(n.g-i.g)*n.a,b:i.b+(n.b-i.b)*n.a})},e.prototype.triad=function(){return this.polyad(3)},e.prototype.tetrad=function(){return this.polyad(4)},e.prototype.polyad=function(t){for(var n=this.toHsl(),i=n.h,r=[this],s=360/t,a=1;a<t;a++)r.push(new e({h:(i+a*s)%360,s:n.s,l:n.l}));return r},e.prototype.equals=function(t){return this.toRgbString()===new e(t).toRgbString()},e}();function P(e,t){return void 0===e&&(e=""),void 0===t&&(t={}),new C(e,t)}function L(e,t){var n=new C(e),i=new C(t);return(Math.max(n.getLuminance(),i.getLuminance())+.05)/(Math.min(n.getLuminance(),i.getLuminance())+.05)}function I(e,t,n){var i,r;void 0===n&&(n={level:"AA",size:"small"});var s=L(e,t);switch((null!==(i=n.level)&&void 0!==i?i:"AA")+(null!==(r=n.size)&&void 0!==r?r:"small")){case"AAsmall":case"AAAlarge":return s>=4.5;case"AAlarge":return s>=3;case"AAAsmall":return s>=7;default:return!1}}function D(e,t,n){void 0===n&&(n={includeFallbackColors:!1,level:"AA",size:"small"});for(var i=null,r=0,s=n.includeFallbackColors,a=n.level,o=n.size,l=0,c=t;l<c.length;l++){var h=c[l],u=L(e,h);u>r&&(r=u,i=new C(h))}return I(e,i,{level:a,size:o})||!s?i:(n.includeFallbackColors=!1,D(e,["#fff","#000"],n))}function O(e,t){var n=new C(e),i="#"+g(n.r,n.g,n.b,n.a),r=i,s=n.gradientType?"GradientType = 1, ":"";if(t){var a=new C(t);r="#"+g(a.r,a.g,a.b,a.a)}return"progid:DXImageTransform.Microsoft.gradient("+s+"startColorstr="+i+",endColorstr="+r+")"}function N(e,t){var n={r:a(e.r),g:a(e.g),b:a(e.b)};return void 0!==e.a&&(n.a=Number(e.a)),new C(n,t)}function B(){return new C({r:Math.random(),g:Math.random(),b:Math.random()})}function z(e){if(void 0===e&&(e={}),void 0!==e.count&&null!==e.count){var t=e.count,n=[];for(e.count=void 0;t>n.length;)e.count=null,e.seed&&(e.seed+=1),n.push(z(e));return e.count=t,n}var i=function(e,t){var n=k(function(e){var t=parseInt(e,10);if(!Number.isNaN(t)&&t<360&&t>0)return[t,t];if("string"==typeof e){var n=V.find((function(t){return t.name===e}));if(n){var i=H(n);if(i.hueRange)return i.hueRange}var r=new C(e);if(r.isValid){var s=r.toHsv().h;return[s,s]}}return[0,360]}(e),t);return n<0&&(n=360+n),n}(e.hue,e.seed),r=function(e,t){if("monochrome"===t.hue)return 0;if("random"===t.luminosity)return k([0,100],t.seed);var n=U(e).saturationRange,i=n[0],r=n[1];switch(t.luminosity){case"bright":i=55;break;case"dark":i=r-10;break;case"light":r=55}return k([i,r],t.seed)}(i,e),s={h:i,s:r,v:function(e,t,n){var i=function(e,t){for(var n=U(e).lowerBounds,i=0;i<n.length-1;i++){var r=n[i][0],s=n[i][1],a=n[i+1][0],o=n[i+1][1];if(t>=r&&t<=a){var l=(o-s)/(a-r);return l*t+(s-l*r)}}return 0}(e,t),r=100;switch(n.luminosity){case"dark":r=i+20;break;case"light":i=(r+i)/2;break;case"random":i=0,r=100}return k([i,r],n.seed)}(i,r,e)};return void 0!==e.alpha&&(s.a=e.alpha),new C(s)}function U(e){e>=334&&e<=360&&(e-=360);for(var t=0,n=V;t<n.length;t++){var i=H(n[t]);if(i.hueRange&&e>=i.hueRange[0]&&e<=i.hueRange[1])return i}throw Error("Color not found")}function k(e,t){if(void 0===t)return Math.floor(e[0]+Math.random()*(e[1]+1-e[0]));var n=e[1]||1,i=e[0]||0,r=(t=(9301*t+49297)%233280)/233280;return Math.floor(i+r*(n-i))}function H(e){var t=e.lowerBounds[0][0],n=e.lowerBounds[e.lowerBounds.length-1][0],i=e.lowerBounds[e.lowerBounds.length-1][1],r=e.lowerBounds[0][1];return{name:e.name,hueRange:e.hueRange,lowerBounds:e.lowerBounds,saturationRange:[t,n],brightnessRange:[i,r]}}var V=[{name:"monochrome",hueRange:null,lowerBounds:[[0,0],[100,0]]},{name:"red",hueRange:[-26,18],lowerBounds:[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]},{name:"orange",hueRange:[19,46],lowerBounds:[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]},{name:"yellow",hueRange:[47,62],lowerBounds:[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]},{name:"green",hueRange:[63,178],lowerBounds:[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]},{name:"blue",hueRange:[179,257],lowerBounds:[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]},{name:"purple",hueRange:[258,282],lowerBounds:[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]},{name:"pink",hueRange:[283,334],lowerBounds:[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]]}];const F=P},9044:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(4536),t),r(n(9428),t),r(n(3565),t),r(n(6846),t),r(n(2979),t),r(n(8466),t),r(n(1340),t),r(n(8981),t),r(n(3125),t)},4536:(e,t)=>{"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeDiverRequestLogMessageLevel=t.ShapeDiverRequestTicketType=void 0,(i=t.ShapeDiverRequestTicketType||(t.ShapeDiverRequestTicketType={})).BACKEND="backend",i.NONE="",(n=t.ShapeDiverRequestLogMessageLevel||(t.ShapeDiverRequestLogMessageLevel={}))[n.INFO=0]="INFO",n[n.WARNING=1]="WARNING",n[n.ERROR=2]="ERROR"},9428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3565:(e,t)=>{"use strict";var n,i,r;Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeDiverRequestModelTrustlevel=t.ShapeDiverRequestModelFiletype=t.ShapeDiverRequestModelTemplateDataName=void 0,(r=t.ShapeDiverRequestModelTemplateDataName||(t.ShapeDiverRequestModelTemplateDataName={})).ACCESSDOMAINS="accessdomains",r.AUTH_GROUPS="auth_groups",r.BACKENDACCESS="backendaccess",r.FILENAME="filename",r.FTYPE="ftype",r.ID2="id2",r.INITIAL_WARMUP="initial_warmup",r.MAX_COMP_TIME="max_comp_time",r.MAX_EXPORT_SIZE="max_export_size",r.MAX_IDLE_MINUTES="max_idle_minutes",r.MAX_MODEL_SIZE="max_model_size",r.MAX_OUTPUT_SIZE="max_output_size",r.MAX_WAIT_TIME="max_wait_time",r.NAME="name",r.NUM_LOADED_MAX="num_loaded_max",r.NUM_LOADED_MIN="num_loaded_min",r.NUM_PRELOADED_MIN="num_preloaded_min",r.PREV_ID="prev_id",r.PUB="pub",r.REQUIRE_TOKEN="require_token",r.SESSION_RATE_LIMIT="session_rate_limit",r.TRUST="trust",r.WEBHOOK_TOKEN="webhook_token",r.WEBHOOK_URL="webhook_url",(i=t.ShapeDiverRequestModelFiletype||(t.ShapeDiverRequestModelFiletype={})).UNKNOWN="unknown",i.GRASSHOPPER_BINARY="gh",i.GRASSHOPPER_XML="ghx",(n=t.ShapeDiverRequestModelTrustlevel||(t.ShapeDiverRequestModelTrustlevel={})).UNDEFINED="",n.NONE="none",n.FULL="full"},6846:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeDiverRequestSdtfUploadPartType=void 0,(t.ShapeDiverRequestSdtfUploadPartType||(t.ShapeDiverRequestSdtfUploadPartType={})).MODEL_SDTF="model/vnd.sdtf"},2979:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeDiverResponseParameterStructure=void 0,(n=t.ShapeDiverResponseParameterStructure||(t.ShapeDiverResponseParameterStructure={})).ITEM="item",n.LIST="list",n.TREE="tree"},8466:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeDiverResponseExportDefinitionType=void 0,(n=t.ShapeDiverResponseExportDefinitionType||(t.ShapeDiverResponseExportDefinitionType={})).UNKNOWN="unknown",n.DOWNLOAD="download",n.EMAIL="email",n.SHAPEWAYS="shapeways"},1340:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeDiverResponseCollectionItemLinkRel=t.ShapeDiverResponseCollectionItemDataName=void 0,(n=t.ShapeDiverResponseCollectionItemDataName||(t.ShapeDiverResponseCollectionItemDataName={})).ACCESSDOMAINS="accessdomains",n.AUTH_GROUPS="auth_groups",n.BACKENDACCESS="backendaccess",n.BACKLINKURL="backlinkurl",n.CHECKURL="checkurl",n.COMP_TIME="comptime",n.CREATEDATE="createdate",n.DOWNLOADURL="downloadurl",n.FILENAME="filename",n.FTYPE="ftype",n.ID="id",n.ID2="id2",n.INITIAL_WARMUP="initial_warmup",n.LAST_SESSION="lastsession",n.LAST_VIEW="lastview",n.MAX_COMP_TIME="max_comp_time",n.MAX_EXPORT_SIZE="max_export_size",n.MAX_IDLE_MINUTES="max_idle_minutes",n.MAX_MODEL_SIZE="max_model_size",n.MAX_OUTPUT_SIZE="max_output_size",n.MAX_WAIT_TIME="max_wait_time",n.MEM_USAGE="memUsage",n.MSG="msg",n.NAME="name",n.NUM_COMP="numcomp",n.NUM_LOADED_MAX="num_loaded_max",n.NUM_LOADED_MIN="num_loaded_min",n.NUM_PRELOADED_MIN="num_preloaded_min",n.NUM_SESSIONS="numsessions",n.PUB="pub",n.REQUEST_TIME="requesttime",n.REQUIRE_TOKEN="require_token",n.S3URL="s3url",n.SESSION_RATE_LIMIT="session_rate_limit",n.SIZE="size",n.STAT="stat",n.TICKET="ticket",n.TRUST="trust",n.WEBHOOK_URL="webhook_url",n.WEBHOOK_TOKEN="webhook_token",(t.ShapeDiverResponseCollectionItemLinkRel||(t.ShapeDiverResponseCollectionItemLinkRel={})).TICKET="ticket"},8981:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3125:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7797:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.DataEngine=void 0;const s=n(2899),a=n(7038),o=n(6538),l=n(4320),c=n(2556),h=n(3858),u=n(1230),d=n(710),p=n(4171),f=n(9780);let m=class{constructor(){this._geometryEngine=s.container.resolve(o.GeometryEngine),this._htmlElementAnchorEngine=s.container.resolve(f.HTMLElementAnchorEngine),this._materialEngine=s.container.resolve(l.MaterialEngine),this._tag3dEngine=s.container.resolve(c.Tag3dEngine),this._logger=s.container.resolve(p.Logger)}loadContent(e){return r(this,void 0,void 0,(function*(){if(!e||e&&!e.format)return this._logger.error("Invalid content was provided to data engine."),new h.TreeNode;try{if("glb"===e.format||"gltf"===e.format)return yield this._geometryEngine.loadContent(e);if("material"===e.format)return yield this._materialEngine.loadContent(e);if("tag2d"===e.format||"anchor"===e.format)return yield this._htmlElementAnchorEngine.loadContent(e);if("tag3d"===e.format)return yield this._tag3dEngine.loadContent(e);if("sdtf"===e.format){const t=yield(new u.Reader).readFromUri(e.href);return t?(new d.TreeNodeConverter).convertToTreeNode(t):new h.TreeNode}{const t=new h.TreeNode("custom");return t.data.push(new a.CustomData(Object.assign({},e))),t}}catch(t){return this._logger.error(`An error occurred while loading the ${e.format}.`,t,t.response&&t.response.status?t.response.status:null),new h.TreeNode}}))}};m=i([s.singleton()],m),t.DataEngine=m},710:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TreeNodeConverter=void 0;const i=n(3858),r=n(2140),s=n(1230);t.TreeNodeConverter=class{convertToTreeNode(e){const t=new i.TreeNode("sdtf");for(let n=0;n<e.chunks.length;n++)t.addChild(this.convertNodeClassToTreeNode(e.chunks[n]));return t}convertAttributesClassToAttributeData(e){return new s.SdtfAttributeData(e)}convertItemClassToItemData(e){return new s.SdtfItemData(e)}convertNodeClassToTreeNode(e){const t=new i.TreeNode(e.name||(e instanceof r.SdtfChunk?"chunk":"node"));if(e.items)for(let n=0;n<e.items.length;n++)t.data.push(this.convertItemClassToItemData(e.items[n]));e.attributes&&t.data.push(this.convertAttributesClassToAttributeData(e.attributes));for(let n=0;n<e.nodes.length;n++)t.addChild(this.convertNodeClassToTreeNode(e.nodes[n]));return t}}},5254:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataEngine=void 0;const i=n(7797);Object.defineProperty(t,"DataEngine",{enumerable:!0,get:function(){return i.DataEngine}})},1183:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryEngine=void 0;const a=n(3858),o=n(8517),l=n(2549),c=n(2899),h=n(4171);let u=class{constructor(){this._logger=c.container.resolve(h.Logger)}loadContent(e){return s(this,void 0,void 0,(function*(){const t=new a.TreeNode("geometry");return!e||e&&!e.href?(this._logger.error("Invalid content was provided to geometry engine."),t):("glb"===e.format&&t.addChild(yield(new o.GLTFLoader).load(e.href)),"gltf"===e.format&&t.addChild(yield(new l.GLTFLoader).load(e.href)),t)}))}};u=i([c.singleton(),r("design:paramtypes",[])],u),t.GeometryEngine=u},8517:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GLTFLoader=void 0;const r=n(3858),s=n(4562),a=n(4465),o=n(887),l=n(7038),c=n(2899),h=n(4171);t.GLTFLoader=class{constructor(){this.BINARY_EXTENSION_HEADER_LENGTH=20,this._httpClient=c.container.resolve(s.HttpClient),this._uuidGenerator=c.container.resolve(s.UuidGenerator),this._logger=c.container.resolve(h.Logger),this._implementedExtensions=["KHR_materials_common"],this._converter=c.container.resolve(s.Converter)}load(e){return i(this,void 0,void 0,(function*(){let t;try{t=(yield this._httpClient.get(e,{responseType:"arraybuffer"})).data}catch(e){return this._logger.error("Initial loading of geometry failed.",e,e.response&&e.response.status?e.response.status:null),new r.TreeNode}const n=new DataView(t,0,this.BINARY_EXTENSION_HEADER_LENGTH),i={magic:String.fromCharCode(n.getUint8(0))+String.fromCharCode(n.getUint8(1))+String.fromCharCode(n.getUint8(2))+String.fromCharCode(n.getUint8(3)),version:n.getUint32(4,!0),length:n.getUint32(8,!0),contentLength:n.getUint32(12,!0),contentFormat:n.getUint32(16,!0)};if("glTF"!=i.magic)return this._logger.error("Invalid data: glTF magic wrong."),new r.TreeNode;const s=new DataView(t,this.BINARY_EXTENSION_HEADER_LENGTH,i.contentLength),a=(new TextDecoder).decode(s);this._content=JSON.parse(a),this._body=t.slice(this.BINARY_EXTENSION_HEADER_LENGTH+i.contentLength,i.length);try{return this.validateVersionAndExtensions(),yield this.loadScene()}catch(e){return this._logger.error("Loading of geometry failed.",e,e.response&&e.response.status?e.response.status:null),new r.TreeNode}}))}validateVersionAndExtensions(){if(this._content.extensionsUsed){const e=[];for(let t=0;t<this._content.extensionsUsed.length;t++)this._implementedExtensions.includes(this._content.extensionsUsed[t])||e.push(this._content.extensionsUsed[t]);if(e.length>0){let t="Extension"+(1===e.length?" ":"s ");e.forEach(((n,i)=>{t+='"'+n+'"'+(i===e.length-1?"":i===e.length-2?" and ":", ")})),t+=(1===e.length?" is":" are")+" not supported, but used. Loading glTF regardless.",this._logger.info(t)}}}loadAccessor(e){return i(this,void 0,void 0,(function*(){if(!this._content.accessors[e])throw new Error("Accessor not available.");const t=this._content.accessors[e],n=yield this.loadBufferView(t.bufferView),i=a.ACCESSORTYPE_V1[t.type],r=a.ACCESSORCOMPONENTTYPE_V1[t.componentType],s=r.BYTES_PER_ELEMENT,o=s*i;return t.byteStride!==o?new l.AttributeData(new r(n),i,!0,t.byteOffset/s,t.byteStride/s):new l.AttributeData(new r(n),i,!1)}))}loadBuffer(e){return i(this,void 0,void 0,(function*(){if(!this._content.buffers[e])throw new Error("Buffer not available.");const t=this._content.buffers[e];return"binary_glTF"===e?this._body:"arraybuffer"===t.type?(yield this._httpClient.get(t.uri,{responseType:"arraybuffer"})).data:this._body}))}loadBufferView(e){return i(this,void 0,void 0,(function*(){if(!this._content.bufferViews[e])throw new Error("Buffer View not available.");const t=this._content.bufferViews[e],n=yield this.loadBuffer(t.buffer),i=void 0!==t.byteLength?t.byteLength:0;return n.slice(t.byteOffset,t.byteOffset+i)}))}loadMaterial(e){return i(this,void 0,void 0,(function*(){if(!this._content.materials[e])throw new Error("Material not available.");const t=this._content.materials[e],n=new l.MaterialData;if(void 0!==t.name&&(n.name=t.name),t.extensions&&t.extensions.KHR_materials_common){const e=t.extensions.KHR_materials_common.technique;e&&"BLINN"!==e&&this._logger.info("The technique "+e+" is not supported. Trying to load the material either way.");const i=t.extensions.KHR_materials_common.values;i.hasOwnProperty("ambient")&&this._logger.info("The value ambient was set for a material, but is not supported."),i.hasOwnProperty("doubleSided")&&(n.side=i.doubleSided?l.MATERIAL_SIDE.DOUBLE:l.MATERIAL_SIDE.FRONT),i.hasOwnProperty("diffuse")&&Array.isArray(i.diffuse)?(n.color=this._converter.toColor(i.diffuse),n.opacity=Math.max(0,Math.min(i.diffuse[3],1))):i.hasOwnProperty("diffuse")&&!Array.isArray(i.diffuse)&&this._logger.info("The value diffuse was set for a material, but is not supported in that type."),i.hasOwnProperty("emission")&&Array.isArray(i.emission)?n.emissiveness=this._converter.toColor(i.emission):this._logger.info("The value emission was set for a material, but is not supported in that type."),i.hasOwnProperty("shininess")&&(n.metalness=Math.min(1,i.shininess),n.roughness=1-Math.min(1,i.shininess)),i.hasOwnProperty("transparency")&&(n.opacity=Math.max(0,Math.min(i.transparency,1))),i.hasOwnProperty("transparent")&&this._logger.info("The value transparent was set for a material, but is not supported."),i.hasOwnProperty("_roughness")&&(n.roughness=Math.min(1,Math.max(0,i.roughness))),i.hasOwnProperty("_metalness")&&(n.metalness=Math.min(1,Math.max(0,i.metalness)))}return n}))}loadMesh(e){return i(this,void 0,void 0,(function*(){if(!this._content.meshes[e])throw new Error("Mesh not available.");const t=this._content.meshes[e],n=new r.TreeNode(e);for(let e=0,i=t.primitives.length;e<i;e++){const i=new r.TreeNode("primitive_"+e);n.addChild(i);let s=t.primitives[e];const a={};for(let e in s.attributes)a[e]=yield this.loadAccessor(s.attributes[e]);let o=null;s.material&&(o=yield this.loadMaterial(s.material));const c=new l.GeometryData(new l.PrimitiveData(a,4,yield this.loadAccessor(s.indices),o));i.data.push(c)}return n}))}loadNode(e){return i(this,void 0,void 0,(function*(){if(!this._content.nodes[e])throw new Error("Node not available.");const t=this._content.nodes[e],n=new r.TreeNode(e);if(t.matrix)n.transformations.push({id:this._uuidGenerator.create(),name:"glTFNode_"+e,matrix:o.mat4.fromValues(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5],t.matrix[6],t.matrix[7],t.matrix[8],t.matrix[9],t.matrix[10],t.matrix[11],t.matrix[12],t.matrix[13],t.matrix[14],t.matrix[15])});else if(t.translation||t.scale||t.rotation){const i=t.translation?o.mat4.fromTranslation(o.mat4.create(),o.vec3.fromValues(t.translation[0],t.translation[1],t.translation[2])):o.mat4.create(),r=t.scale?o.mat4.fromScaling(o.mat4.create(),o.vec3.fromValues(t.scale[0],t.scale[1],t.scale[2])):o.mat4.create(),s=t.rotation?o.mat4.fromQuat(o.mat4.create(),o.vec4.fromValues(t.rotation[0],t.rotation[1],t.rotation[2],t.rotation[3])):o.mat4.create(),a=o.mat4.mul(o.mat4.create(),o.mat4.mul(o.mat4.create(),i,r),s);n.transformations.push({id:this._uuidGenerator.create(),name:"glTFNode_"+e,matrix:a})}for(let e=0,i=t.meshes.length;e<i;e++)n.addChild(yield this.loadMesh(t.meshes[e]));if(t.children)for(let e=0,i=t.children.length;e<i;e++)n.addChild(yield this.loadNode(t.children[e]));return n}))}loadScene(){return i(this,void 0,void 0,(function*(){if(!this._content.scene)throw new Error("No scene.");if(!this._content.scenes[this._content.scene])throw new Error("Scene not available.");const e=this._content.scenes[this._content.scene],t=new r.TreeNode(this._content.scene);for(let n=0,i=e.nodes.length;n<i;n++)t.addChild(yield this.loadNode(e.nodes[n]));return t}))}}},2549:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GLTFLoader=void 0;const r=n(3858),s=n(4562),a=n(2899),o=n(4465),l=n(887),c=n(7038),h=n(4171),u=n(4636);t.GLTFLoader=class{constructor(){this.BINARY_EXTENSION_HEADER_LENGTH=20,this._httpClient=a.container.resolve(s.HttpClient),this._imageLoader=a.container.resolve(s.ImageLoader),this._uuidGenerator=a.container.resolve(s.UuidGenerator),this._logger=a.container.resolve(h.Logger),this._globalTransformation=l.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),this._implementedExtensions=["KHR_materials_pbrSpecularGlossiness"],this._converter=a.container.resolve(s.Converter)}load(e){return i(this,void 0,void 0,(function*(){let t;try{t=yield this._httpClient.get(e,{responseType:"arraybuffer"})}catch(e){return this._logger.error("Initial loading of geometry failed.",e,e.response&&e.response.status?e.response.status:null),new r.TreeNode}if(!t.headers["content-type"]||"model/gltf-binary"!==t.headers["content-type"]&&"application/octet-stream"!==t.headers["content-type"]&&"model/gltf.binary"!==t.headers["content-type"]){this._content=JSON.parse((new TextDecoder).decode(t.data));const n=e=>{const t=e.includes("/")?"/":"\\",n=e.split(t);return n.pop(),n.join(t)};this._baseUri=n(e),!this._baseUri&&window&&window.location&&window.location.href&&(this._baseUri=n(window.location.href))}else{const e=t.data,n=new DataView(e,0,this.BINARY_EXTENSION_HEADER_LENGTH),i={magic:String.fromCharCode(n.getUint8(0))+String.fromCharCode(n.getUint8(1))+String.fromCharCode(n.getUint8(2))+String.fromCharCode(n.getUint8(3)),version:n.getUint32(4,!0),length:n.getUint32(8,!0),contentLength:n.getUint32(12,!0),contentFormat:n.getUint32(16,!0)};if("glTF"!=i.magic)return this._logger.error("Invalid data: glTF magic wrong."),new r.TreeNode;const s=new DataView(e,this.BINARY_EXTENSION_HEADER_LENGTH,i.contentLength),a=(new TextDecoder).decode(s);this._content=JSON.parse(a),this._body=e.slice(this.BINARY_EXTENSION_HEADER_LENGTH+i.contentLength+8,i.length)}try{return this.validateVersionAndExtensions(),yield this.loadScene()}catch(e){return this._logger.error("Loading of geometry failed.",e,e.response&&e.response.status?e.response.status:null),new r.TreeNode}}))}loadAccessor(e){return i(this,void 0,void 0,(function*(){if(!this._content.accessors[e])throw new Error("Accessor not available.");const t=this._content.accessors[e],n=yield this.loadBufferView(t.bufferView),i=o.ACCESSORTYPE_V2[t.type],r=o.ACCESSORCOMPONENTTYPE_V2[t.componentType],s=r.BYTES_PER_ELEMENT,a=s*i;var l=t.byteOffset||0,h=void 0!==t.bufferView?this._content.bufferViews[t.bufferView].byteStride:void 0,u=!0===t.normalized;if(h&&h!==a){var d=Math.floor(l/h);return new c.AttributeData(new r(n,d*h,t.count*h/s),i,!0,l/s,h/s,u)}return new c.AttributeData(new r(n).slice(l/s,l/s+t.count*a/s),i,!1)}))}loadBuffer(e){return i(this,void 0,void 0,(function*(){if(!this._content.buffers[e])throw new Error("Buffer not available.");const t=this._content.buffers[e];return t.uri||0!==e?(yield this._httpClient.get(this._baseUri+"/"+t.uri,{responseType:"arraybuffer"})).data:this._body}))}loadBufferView(e){return i(this,void 0,void 0,(function*(){if(!this._content.bufferViews[e])throw new Error("Buffer View not available.");const t=this._content.bufferViews[e],n=t.byteLength||0,i=t.byteOffset||0;return(yield this.loadBuffer(t.buffer)).slice(i,i+n)}))}loadMap(e){return i(this,void 0,void 0,(function*(){let t;const n=this._content.textures[e],i=this._content.images[n.source],r=this._content.samplers&&this._content.samplers[n.source]?this._content.samplers[n.source]:{},s=/^data:(.*?)(;base64)?,(.*)$/,a=/^https:\/\//;if(void 0!==i.bufferView){const e=yield this.loadBufferView(i.bufferView),n=new DataView(e),s=[];for(let e=0;e<n.byteLength;e+=1)s[e]=n.getUint8(e);const a=new Blob([new Uint8Array(s)],{type:i.mimeType}),o=window.URL.createObjectURL(a);window.open(o),t=new c.MapData(yield this._imageLoader.load(o),r.wrapS,r.wrapT,r.minFilter,r.magFilter,void 0,void 0,void 0,void 0,void 0,!1)}else{const e=s.test(i.uri)||a.test(i.uri)?i.uri:`${this._baseUri}/${i.uri}`;t=new c.MapData(yield this._imageLoader.load(e),r.wrapS,r.wrapT,r.minFilter,r.magFilter,void 0,void 0,void 0,void 0,void 0,!1)}return t}))}loadMaterial(e){return i(this,void 0,void 0,(function*(){const t=this._content.materials[e],n=new c.MaterialData;if(void 0!==t.name&&(n.name=t.name),void 0!==t.pbrMetallicRoughness&&(void 0!==t.pbrMetallicRoughness.baseColorFactor&&(n.color=this._converter.toColor(t.pbrMetallicRoughness.baseColorFactor)),void 0!==t.pbrMetallicRoughness.baseColorTexture&&(n.map=yield this.loadMap(t.pbrMetallicRoughness.baseColorTexture.index)),void 0!==t.pbrMetallicRoughness.metallicFactor&&(n.metalness=t.pbrMetallicRoughness.metallicFactor),void 0!==t.pbrMetallicRoughness.roughnessFactor&&(n.roughness=t.pbrMetallicRoughness.roughnessFactor),void 0!==t.pbrMetallicRoughness.metallicRoughnessTexture&&(n.metalnessRoughnessMap=yield this.loadMap(t.pbrMetallicRoughness.metallicRoughnessTexture.index))),void 0!==t.normalTexture&&(n.normalMap=yield this.loadMap(t.normalTexture.index)),void 0!==t.occlusionTexture&&(n.alphaMap=yield this.loadMap(t.occlusionTexture.index)),void 0!==t.emissiveTexture&&(n.emissiveMap=yield this.loadMap(t.emissiveTexture.index)),void 0!==t.emissiveFactor&&(n.emissiveness=this._converter.toColor(t.emissiveFactor)),void 0!==t.alphaMode&&(n.alphaMode=t.alphaMode.toLowerCase()===c.MATERIAL_ALPHA.MASK?c.MATERIAL_ALPHA.MASK:t.alphaMode.toLowerCase()===c.MATERIAL_ALPHA.BLEND?c.MATERIAL_ALPHA.BLEND:c.MATERIAL_ALPHA.OPAQUE),void 0!==t.alphaCutoff&&(n.alphaCutoff=t.alphaCutoff),void 0!==t.doubleSided&&(n.side=t.doubleSided?c.MATERIAL_SIDE.DOUBLE:c.MATERIAL_SIDE.FRONT),t.extensions&&t.extensions.KHR_materials_pbrSpecularGlossiness){const e=t.extensions.KHR_materials_pbrSpecularGlossiness,i=(new u.PbrMaterialConverter).convertToMetallicRoughness({diffuseFactor:void 0!==e.diffuseFactor?l.vec4.fromValues(e.diffuseFactor[0],e.diffuseFactor[1],e.diffuseFactor[2],e.diffuseFactor[3]):l.vec4.fromValues(1,1,1,1),specularFactor:void 0!==e.specularFactor?l.vec3.fromValues(e.specularFactor[0],e.specularFactor[1],e.specularFactor[2]):l.vec3.fromValues(1,1,1),glossinessFactor:void 0!==e.glossinessFactor?e.glossinessFactor:1});n.color=i.color,n.metalness=i.metalness,n.roughness=i.roughness,void 0!==e.diffuseTexture&&(n.map=yield this.loadMap(e.diffuseTexture.index)),void 0!==e.specularGlossinessTexture&&this._logger.info("Due to issues with the material conversion, the specularGlossinessTexture is not supported at the moment.")}return n}))}loadMesh(e){return i(this,void 0,void 0,(function*(){if(!this._content.meshes||!this._content.meshes[e])throw new Error("Mesh not available.");const t=this._content.meshes[e],n=new r.TreeNode(t.name||"mesh_"+e);if(t.primitives)for(let e=0,i=t.primitives.length;e<i;e++)n.addChild(yield this.loadPrimitive(t.primitives,e));return n}))}loadNode(e){return i(this,void 0,void 0,(function*(){if(!this._content.nodes||!this._content.nodes[e])throw new Error("Node not available.");const t=this._content.nodes[e],n=new r.TreeNode(t.name||"node_"+e);if(t.matrix)n.transformations.push({id:this._uuidGenerator.create(),name:"glTFNode_"+e,matrix:l.mat4.fromValues(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5],t.matrix[6],t.matrix[7],t.matrix[8],t.matrix[9],t.matrix[10],t.matrix[11],t.matrix[12],t.matrix[13],t.matrix[14],t.matrix[15])});else if(t.translation||t.scale||t.rotation){const i=t.translation?l.mat4.fromTranslation(l.mat4.create(),l.vec3.fromValues(t.translation[0],t.translation[1],t.translation[2])):l.mat4.create(),r=t.scale?l.mat4.fromScaling(l.mat4.create(),l.vec3.fromValues(t.scale[0],t.scale[1],t.scale[2])):l.mat4.create(),s=t.rotation?l.mat4.fromQuat(l.mat4.create(),l.vec4.fromValues(t.rotation[0],t.rotation[1],t.rotation[2],t.rotation[3])):l.mat4.create(),a=l.mat4.mul(l.mat4.create(),l.mat4.mul(l.mat4.create(),i,r),s);n.transformations.push({id:this._uuidGenerator.create(),name:"glTFNode_"+e,matrix:a})}if(void 0!==t.mesh&&n.addChild(yield this.loadMesh(t.mesh)),t.children)for(let e=0,i=t.children.length;e<i;e++)n.addChild(yield this.loadNode(t.children[e]));return n}))}loadPrimitive(e,t){return i(this,void 0,void 0,(function*(){const n=e[t],i=new r.TreeNode("primitive_"+t),s={};for(let e in n.attributes)s[e]=yield this.loadAccessor(n.attributes[e]);let a=null;(n.indices||0===n.indices)&&(a=yield this.loadAccessor(n.indices));let o=null;return(n.material||0===n.material)&&(o=yield this.loadMaterial(n.material)),i.data.push(new c.GeometryData(new c.PrimitiveData(s,n.mode,a,o))),i}))}validateVersionAndExtensions(){if(!this._content.asset)throw new Error("Asset not available.");const e=this._content.asset;if(!e.version)throw new Error("Asset does not have a version.");if(!(e.minVersion?e.minVersion:e.version).startsWith("2"))throw new Error("Version of the glTF not supported.");if(this._content.extensionsUsed){const e=[];for(let t=0;t<this._content.extensionsUsed.length;t++)this._implementedExtensions.includes(this._content.extensionsUsed[t])||e.push(this._content.extensionsUsed[t]);if(e.length>0){let t="Extension"+(1===e.length?" ":"s ");e.forEach(((n,i)=>{t+='"'+n+'"'+(i===e.length-1?"":i===e.length-2?" and ":", ")})),t+=(1===e.length?" is":" are")+" not supported, but used. Loading glTF regardless.",this._logger.info(t)}}if(this._content.extensionsRequired){const e=[];for(let t=0;t<this._content.extensionsRequired.length;t++)this._implementedExtensions.includes(this._content.extensionsRequired[t])||e.push(this._content.extensionsRequired[t]);if(e.length>0){let t="Extension"+(1===e.length?" ":"s ");throw e.forEach(((n,i)=>{t+='"'+n+'"'+(i===e.length-1?"":i===e.length-2?" and ":", ")})),t+=(1===e.length?" is":" are")+" not supported, but required. Aborting glTF loading.",new Error(t)}}}loadScene(){return i(this,void 0,void 0,(function*(){const e=this._content.scene||0;if(!this._content.scenes||!this._content.scenes[e])throw new Error("Scene not available.");const t=this._content.scenes[e],n=new r.TreeNode("scene_"+t.name||0);if(n.transformations.push({id:this._uuidGenerator.create(),name:"glTF_global_transformation",matrix:this._globalTransformation}),t.nodes)for(let e=0,i=t.nodes.length;e<i;e++)n.addChild(yield this.loadNode(t.nodes[e]));return n}))}}},4636:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PbrMaterialConverter=void 0;const i=n(4562),r=n(887),s=n(2899);t.PbrMaterialConverter=class{constructor(){this._dielectricSpecular=r.vec3.fromValues(.04,.04,.04),this._epsilon=1e-6,this._converter=s.container.resolve(i.Converter)}convertToMetallicRoughness(e){const t=e.diffuseFactor,n=e.specularFactor,i=e.glossinessFactor,s=1-Math.max(n[0],n[1],n[2]),a=this.solveMetallic(this.getPerceivedBrightness(r.vec3.fromValues(t[0],t[1],t[2])),this.getPerceivedBrightness(n),s),o=t.map((e=>e*(s/(1-this._dielectricSpecular[0])/Math.max(1-a,this._epsilon)))),l=this._dielectricSpecular.map((e=>e*(1-a))).map((e=>e*(1/Math.max(a,this._epsilon)))),c=r.vec3.sub(r.vec3.create(),n,r.vec3.fromValues(l[0],l[1],l[2])),h=r.vec3.lerp(r.vec3.create(),r.vec3.fromValues(o[0],o[1],o[2]),c,a*a).map((e=>this.clamp(e)));return{color:this._converter.toColor(r.vec4.fromValues(h[0],h[1],h[2],t[3])),metalness:a,roughness:1-i}}clamp(e,t=0,n=1){return e>n?n:e<t?t:e}getPerceivedBrightness(e){const t=e[0],n=e[1],i=e[2];return Math.sqrt(.299*t*t+.587*n*n+.114*i*i)}solveMetallic(e,t,n){if(t<this._dielectricSpecular[0])return 0;const i=this._dielectricSpecular[0],r=e*n/(1-this._dielectricSpecular[0])+t-2*this._dielectricSpecular[0],s=this._dielectricSpecular[0]-t,a=Math.max(r*r-4*i*s,0);return this.clamp((-r+Math.sqrt(a))/(2*i),0,1)}}},6538:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryEngine=void 0;const i=n(1183);Object.defineProperty(t,"GeometryEngine",{enumerable:!0,get:function(){return i.GeometryEngine}})},9078:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.HTMLElementAnchorEngine=void 0;const s=n(2899),a=n(7038),o=n(3858),l=n(4171),c=n(4562),h=n(5174);let u=class{constructor(){this._logger=s.container.resolve(l.Logger),this._converter=s.container.resolve(c.Converter)}loadContent(e){return r(this,void 0,void 0,(function*(){try{const t=e.data,n=new o.TreeNode("htmlElementAnchors");return"tag2d"===e.format?t.forEach((e=>{e.location&&e.text?n.data.push(new a.HTMLElementAnchorData(this._converter.toVec3(e.location),{color:this._converter.toColor(e.color,"#000000"),text:e.text},"text")):this._logger.warn("One of the specified Tag2D elements did not have all necessary properties.")})):"anchor"===e.format&&t.forEach((e=>{if(!e.location||!e.data)return void this._logger.warn("One of the specified Anchor elements did not have all necessary properties.");let t,i;if(e.data.position&&(t={vertical:e.data.position.vertical,horizontal:e.data.position.horizontal}),e.intersectionTarget&&("string"==typeof e.intersectionTarget||Array.isArray(e.intersectionTarget)?i=e.intersectionTarget:e.intersectionTarget.min&&e.intersectionTarget.max&&(i=new h.Box(this._converter.toVec3(e.intersectionTarget.min),this._converter.toVec3(e.intersectionTarget.max)))),e.format&&"text"!==e.format){if("image"===e.format){if(!(e.data.src&&e.data.width&&e.data.height&&e.data.alt))return void this._logger.warn("One of the specified Anchor elements did not have all necessary properties.");const r=e.data;n.data.push(new a.HTMLElementAnchorData(this._converter.toVec3(e.location),{alt:r.alt,height:"string"==typeof r.height?+r.height:r.height,width:"string"==typeof r.width?+r.width:r.width,src:r.src,hidden:r.hidden,position:t},"image",e.hideable,e.viewports,i))}}else{if(!e.data.text)return void this._logger.warn("The text property for an Anchor element is missing.");const r=e.data;n.data.push(new a.HTMLElementAnchorData(this._converter.toVec3(e.location),{color:this._converter.toColor(r.color,"#000000"),text:r.text,hidden:r.hidden,textAlign:r.textAlign,position:t},"text",e.hideable,e.viewports,i))}this._logger.warn(`The Anchor does not have a recognized format: ${e.format}`)})),n}catch(e){return this._logger.error("Loading of anchors failed.",e),new o.TreeNode}}))}};u=i([s.singleton()],u),t.HTMLElementAnchorEngine=u},9780:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HTMLElementAnchorEngine=void 0;const i=n(9078);Object.defineProperty(t,"HTMLElementAnchorEngine",{enumerable:!0,get:function(){return i.HTMLElementAnchorEngine}})},421:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MaterialEngine=void 0;const a=n(3858),o=n(2899),l=n(4562),c=n(7038),h=n(887),u=n(4171),d=n(7244);let p=class{constructor(){this._imageLoader=o.container.resolve(l.ImageLoader),this._logger=o.container.resolve(u.Logger),this._converter=o.container.resolve(l.Converter)}loadContent(e){return s(this,void 0,void 0,(function*(){const t=new a.TreeNode("material");if(!e)return this._logger.error("Invalid content was provided to material engine."),t;const n=new c.MaterialData;return t.data.push(n),e.data?(e.data.materialpreset&&(yield this.loadPresetMaterial(e.data.materialpreset,n)),e.data.materialType&&"standard"!==e.data.materialType||e.data.version&&("1.0"===e.data.version&&(yield this.loadMaterialV1(e.data,n)),"2.0"===e.data.version&&(yield this.loadMaterialV2(e.data,n)),"3.0"===e.data.version&&(yield this.loadMaterialV3(e.data,n)))):this._logger.error("No material data was provided to material engine."),t}))}assignGeneralDefinition(e,t,n,i){return s(this,void 0,void 0,(function*(){if(t.transparencytexture&&!n.transparencytexture){const n=yield this.loadMap(t.transparencytexture,e.class);n&&(i.alphaMap=n)}if(t.hasOwnProperty("alphaThreshold")&&!n.hasOwnProperty("alphaThreshold")&&(i.alphaCutoff=t.alphaThreshold),t.bumptexture&&!n.bumptexture){const n=yield this.loadMap(t.bumptexture,e.class);n&&(i.bumpMap=n)}if(t.hasOwnProperty("bumpAmplitude")&&!n.hasOwnProperty("bumpAmplitude")&&(i.bumpScale=t.bumpAmplitude),t.color&&!n.color&&(i.color=this._converter.toColor(t.color)),t.bitmaptexture&&!n.bitmaptexture){const n=yield this.loadMap(t.bitmaptexture,e.class);n&&(i.map=n)}if(t.hasOwnProperty("metalness")&&!n.hasOwnProperty("metalness")&&(i.metalness=t.metalness),t.metalnesstexture&&!n.metalnesstexture){const n=yield this.loadMap(t.metalnesstexture,e.class);n&&(i.metalnessMap=n)}if(t.normaltexture&&!n.normaltexture){const n=yield this.loadMap(t.normaltexture,e.class);n&&(i.normalMap=n)}if(t.hasOwnProperty("transparency")&&!n.hasOwnProperty("transparency")&&(i.opacity=1-t.transparency),t.hasOwnProperty("roughness")&&!n.hasOwnProperty("roughness")&&(i.roughness=t.roughness),t.roughnesstexture&&!n.roughnesstexture){const n=yield this.loadMap(t.roughnesstexture,e.class);n&&(i.roughnessMap=n)}t.side&&!n.side&&(i.side="front"===t.side?c.MATERIAL_SIDE.FRONT:"back"===t.side?c.MATERIAL_SIDE.BACK:c.MATERIAL_SIDE.DOUBLE)}))}assignSpecificDefinition(e,t,n){return s(this,void 0,void 0,(function*(){if(t.transparencytexture){const i=yield this.loadMap(t.transparencytexture,e.class+"/"+e.specific);i&&(n.alphaMap=i)}if(t.hasOwnProperty("alphaThreshold")&&(n.alphaCutoff=t.alphaThreshold),t.bumptexture){const i=yield this.loadMap(t.bumptexture,e.class+"/"+e.specific);i&&(n.bumpMap=i)}if(t.hasOwnProperty("bumpAmplitude")&&(n.bumpScale=t.bumpAmplitude),t.color&&(n.color=this._converter.toColor(t.color)),t.bitmaptexture){const i=yield this.loadMap(t.bitmaptexture,e.class+"/"+e.specific);i&&(n.map=i)}if(t.hasOwnProperty("metalness")&&(n.metalness=t.metalness),t.metalnesstexture){const i=yield this.loadMap(t.metalnesstexture,e.class+"/"+e.specific);i&&(n.metalnessMap=i)}if(t.normaltexture){const i=yield this.loadMap(t.normaltexture,e.class+"/"+e.specific);i&&(n.normalMap=i)}if(t.hasOwnProperty("transparency")&&(n.opacity=1-t.transparency),t.hasOwnProperty("roughness")&&(n.roughness=t.roughness),t.roughnesstexture){const i=yield this.loadMap(t.roughnesstexture,e.class+"/"+e.specific);i&&(n.roughnessMap=i)}t.side&&(n.side="front"===t.side?c.MATERIAL_SIDE.FRONT:"back"===t.side?c.MATERIAL_SIDE.BACK:c.MATERIAL_SIDE.DOUBLE)}))}getClassAndSpecificID(e){e<100&&e%10==0&&(e/=10),e<10&&(e*=100);const t=e=>String(e).padStart(2,"0").slice(0,2);return{class:t(Math.floor(e/100)),specific:t(e-100*Math.floor(e/100))}}loadMap(e,t){return s(this,void 0,void 0,(function*(){let n;try{n=t?yield this._imageLoader.load("https://viewer.shapediver.com/v2/materials/1024/"+t+"/"+e):yield this._imageLoader.load(e)}catch(e){return this._logger.error("Loading of map failed.",e,e.response&&e.response.status?e.response.status:null),null}return new c.MapData(n)}))}loadMapWithProperties(e){return s(this,void 0,void 0,(function*(){let t;try{t=yield this._imageLoader.load(e.href)}catch(e){return this._logger.error("Loading of map failed.",e,e.response&&e.response.status?e.response.status:null),null}const n=1===e.wrapS?c.TEXTURE_WRAPPING.CLAMP_TO_EDGE:2===e.wrapS?c.TEXTURE_WRAPPING.MIRRORED_REPEAT:c.TEXTURE_WRAPPING.REPEAT,i=1===e.wrapT?c.TEXTURE_WRAPPING.CLAMP_TO_EDGE:2===e.wrapT?c.TEXTURE_WRAPPING.MIRRORED_REPEAT:c.TEXTURE_WRAPPING.REPEAT,r=e.center?h.vec2.fromValues(e.center[0],e.center[1]):h.vec2.fromValues(0,0),s=e.color?h.vec4.fromValues(e.color[0]/255,e.color[1]/255,e.color[2]/255,e.color[3]/255):h.vec4.fromValues(1,1,1,1),a=e.offset?h.vec2.fromValues(e.offset[0],e.offset[1]):h.vec2.fromValues(0,0),o=e.repeat?h.vec2.fromValues(e.repeat[0],e.repeat[1]):h.vec2.fromValues(1,1);return new c.MapData(t,n,i,c.TEXTURE_FILTERING.LINEAR_MIPMAP_LINEAR,c.TEXTURE_FILTERING.LINEAR,r,s,a,o,e.rotation||0)}))}loadMaterialV1(e,t){return s(this,void 0,void 0,(function*(){if(e.color?t.color=this._converter.toColor(e.color):e.diffuse&&(t.color=this._converter.toColor(e.diffuse)),e.emission&&(t.emissiveness=this._converter.toColor(e.emission)),(e.shine||0===e.shine)&&(t.metalness=Math.min(1,e.shine),t.roughness=1-Math.min(1,e.shine)),t.opacity=e.hasOwnProperty("transparency")?1-e.transparency:1,e.bitmaptexture){const n=yield this.loadMap(e.bitmaptexture);n&&(t.map=n)}if(e.bumptexture){const n=yield this.loadMap(e.bumptexture);n&&(t.bumpMap=n)}if(e.transparencytexture){const n=yield this.loadMap(e.transparencytexture);n&&(t.alphaMap=n)}}))}loadMaterialV2(e,t){return s(this,void 0,void 0,(function*(){if(e.color&&(t.color=this._converter.toColor(e.color)),t.side="front"===e.side?c.MATERIAL_SIDE.FRONT:"back"===e.side?c.MATERIAL_SIDE.BACK:c.MATERIAL_SIDE.DOUBLE,(e.metalness||0===e.metalness)&&(t.metalness=e.metalness),(e.roughness||0===e.roughness)&&(t.roughness=e.roughness),t.opacity=e.hasOwnProperty("transparency")?1-e.transparency:1,(e.alphaThreshold||0===e.alphaThreshold)&&(t.alphaCutoff=e.alphaThreshold),e.bitmaptexture){const n=yield this.loadMap(e.bitmaptexture);n&&(t.map=n)}if(e.metalnesstexture){const n=yield this.loadMap(e.metalnesstexture);n&&(t.metalnessMap=n)}if(e.roughnesstexture){const n=yield this.loadMap(e.roughnesstexture);n&&(t.roughnessMap=n)}if(e.bumptexture){const n=yield this.loadMap(e.bumptexture);n&&(t.bumpMap=n)}if(e.normaltexture){const n=yield this.loadMap(e.normaltexture);n&&(t.normalMap=n)}if(e.transparencytexture){const n=yield this.loadMap(e.transparencytexture);n&&(t.alphaMap=n)}}))}loadMaterialV3(e,t){return s(this,void 0,void 0,(function*(){if(e.color&&(t.color=this._converter.toColor(e.color)),t.side="front"===e.side?c.MATERIAL_SIDE.FRONT:"back"===e.side?c.MATERIAL_SIDE.BACK:c.MATERIAL_SIDE.DOUBLE,(e.metalness||0===e.metalness)&&(t.metalness=e.metalness),(e.roughness||0===e.roughness)&&(t.roughness=e.roughness),t.opacity=e.hasOwnProperty("transparency")?1-e.transparency:1,(e.alphaThreshold||0===e.alphaThreshold)&&(t.alphaCutoff=e.alphaThreshold),(e.bumpAmplitude||0===e.bumpAmplitude)&&(t.bumpScale=e.bumpAmplitude),e.bitmaptexture){const n=yield this.loadMapWithProperties(e.bitmaptexture);n&&(t.map=n)}if(e.metalnesstexture){const n=yield this.loadMapWithProperties(e.metalnesstexture);n&&(t.metalnessMap=n)}if(e.roughnesstexture){const n=yield this.loadMapWithProperties(e.roughnesstexture);n&&(t.roughnessMap=n)}if(e.bumptexture){const n=yield this.loadMapWithProperties(e.bumptexture);n&&(t.bumpMap=n)}if(e.normaltexture){const n=yield this.loadMapWithProperties(e.normaltexture);n&&(t.normalMap=n)}if(e.transparencytexture){const n=yield this.loadMapWithProperties(e.transparencytexture);n&&(t.alphaMap=n)}}))}loadPresetMaterial(e,t){return s(this,void 0,void 0,(function*(){const n=this.getClassAndSpecificID(e);d.materialDatabase[n.class]&&d.materialDatabase[n.class][n.specific]?(yield this.assignSpecificDefinition(n,d.materialDatabase[n.class][n.specific],t),yield this.assignGeneralDefinition(n,d.materialDatabase[n.class].properties,d.materialDatabase[n.class][n.specific],t)):d.materialDatabase[n.class]["00"]?(yield this.assignSpecificDefinition(n,d.materialDatabase[n.class]["00"],t),yield this.assignGeneralDefinition(n,d.materialDatabase[n.class].properties,d.materialDatabase[n.class]["00"],t)):(yield this.assignSpecificDefinition({class:"00",specific:"00"},d.materialDatabase["00"]["00"],t),yield this.assignGeneralDefinition({class:"00",specific:"00"},d.materialDatabase["00"].properties,d.materialDatabase["00"]["00"],t))}))}};p=i([o.singleton(),r("design:paramtypes",[])],p),t.MaterialEngine=p},4320:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MaterialEngine=void 0;const i=n(421);Object.defineProperty(t,"MaterialEngine",{enumerable:!0,get:function(){return i.MaterialEngine}})},7244:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.materialDatabase=void 0,t.materialDatabase={"00":{"00":{name:"Default material",color:[211,211,211,255],metalness:0,roughness:1},properties:{name:"Default materials"}},"01":{"01":{name:"Default groundplane material",color:[211,211,211,255],metalness:0,roughness:1},properties:{name:"Groundplane materials"}},"02":{"00":{name:"Default plastic material",color:[211,211,211,255],metalness:0,roughness:1,normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},properties:{name:"Plastic materials"}},"03":{10:{name:"Gold material",color:[230,207,92,255],roughness:0},11:{name:"Used gold material",color:[230,207,92,255],roughness:0,roughnesstexture:"roughnessMap.jpg"},21:{name:"Hammered metal material",color:[205,205,205,255],roughness:1,normaltexture:"normalMap.jpg"},"00":{name:"Default metal material",color:[205,205,205,255],roughness:.25},"01":{name:"Used metal material 1",color:[205,205,205,255],roughness:1,roughnesstexture:"roughnessMap.jpg"},"02":{name:"Used metal material 2",color:[205,205,205,255],roughness:1,roughnesstexture:"roughnessMap.jpg"},"03":{name:"Used metal material 3",color:[205,205,205,255],roughness:1,roughnesstexture:"roughnessMap.jpg"},properties:{name:"Metal materials",metalness:1}},"04":{"00":{name:"Default glass material",color:[211,211,211,255],metalness:1,roughness:0,transparency:.75},properties:{name:"Glass materials"}},"05":{10:{bitmaptexture:"map.jpg",name:"Natural oak material",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},11:{bitmaptexture:"map.jpg",name:"Premium oak material",roughnesstexture:"roughnessMap.jpg"},"00":{bitmaptexture:"map.jpg",name:"Default wood material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},"01":{bitmaptexture:"map.jpg",name:"Wood floor material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},properties:{name:"Wood materials",color:[211,211,211,255],metalness:0,roughness:1}},"06":{10:{bitmaptexture:"map.jpg",name:"Worn leather material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},"00":{bitmaptexture:"map.jpg",name:"Default leather material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},"01":{bitmaptexture:"map.jpg",name:"Dark brown leather material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},"02":{bitmaptexture:"map.jpg",name:"Black leather material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},properties:{name:"Leather materials",metalness:0,roughness:1}},"07":{"00":{bitmaptexture:"map.jpg",name:"Default fabric material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},"01":{bitmaptexture:"map.jpg",name:"Grey fabric material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},properties:{name:"Fabric materials",metalness:1,roughness:1}}}},2e3:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ACCESSORTYPE=t.ACCESSORCOMPONENTSIZE=t.ACCESSORCOMPONENTTYPE=void 0,t.ACCESSORCOMPONENTTYPE={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},t.ACCESSORCOMPONENTSIZE={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},t.ACCESSORTYPE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}},4465:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ACCESSORTYPE_V2=t.ACCESSORCOMPONENTSIZE_V2=t.ACCESSORCOMPONENTTYPE_V2=t.ACCESSORTYPE_V1=t.ACCESSORCOMPONENTSIZE_V1=t.ACCESSORCOMPONENTTYPE_V1=void 0;const i=n(2e3);Object.defineProperty(t,"ACCESSORCOMPONENTTYPE_V1",{enumerable:!0,get:function(){return i.ACCESSORCOMPONENTTYPE}}),Object.defineProperty(t,"ACCESSORCOMPONENTTYPE_V2",{enumerable:!0,get:function(){return i.ACCESSORCOMPONENTTYPE}}),Object.defineProperty(t,"ACCESSORTYPE_V1",{enumerable:!0,get:function(){return i.ACCESSORTYPE}}),Object.defineProperty(t,"ACCESSORTYPE_V2",{enumerable:!0,get:function(){return i.ACCESSORTYPE}}),Object.defineProperty(t,"ACCESSORCOMPONENTSIZE_V1",{enumerable:!0,get:function(){return i.ACCESSORCOMPONENTSIZE}}),Object.defineProperty(t,"ACCESSORCOMPONENTSIZE_V2",{enumerable:!0,get:function(){return i.ACCESSORCOMPONENTSIZE}})},5656:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Tag3dEngine=void 0;const c=n(3858),h=a(n(2212)),u=n(2899),d=n(4171),p=n(4562),f=n(7038);var m;!function(e){e.TOP_LEFT="TL",e.TOP_CENTER="TC",e.TOP_RIGHT="TR",e.MIDDLE_LEFT="ML",e.MIDDLE_CENTER="MC",e.MIDDLE_RIGHT="MR",e.BOTTOM_LEFT="BL",e.BOTTOM_CENTER="BC",e.BOTTOM_RIGHT="BR"}(m||(m={}));let g=class{constructor(){this._logger=u.container.resolve(d.Logger),this._converter=u.container.resolve(p.Converter),(new h.FontLoader).load("https://viewer.shapediver.com/graphik_regular.typeface.json",(e=>this._font=e))}loadContent(e){return l(this,void 0,void 0,(function*(){const t=new c.TreeNode("tag3d");if(!e)return this._logger.error("Invalid content was provided to tag3d engine."),t;if(e.data&&Array.isArray(e.data))for(let r=0;r<e.data.length;r++){const s=e.data[r];s.size=s.size?+s.size:1,s.text=s.text||"",s.color=this._converter.toColor(s.color);const a=s.text.split(/\r\n|\r|\n/g);let o=[];for(let e=0;e<a.length;++e){let t=new h.TextBufferGeometry(a[e],{size:s.size,height:s.size/10,font:this._font});o.push(t)}let l=new h.Object3D;for(let e of o)l.add(new h.Mesh(e,new h.MeshPhongMaterial));let c,u,d,p=0;p=0;for(let e of l.children)c=(new h.Box3).setFromObject(e),d=c.max.y-c.min.y,p=Math.max(p,d);p*=1.15,o.forEach(((e,t)=>{e.translate(0,(-t-1)*p,0)})),c=(new h.Box3).setFromObject(l),u=c.max.x-c.min.x,d=c.max.y-c.min.y;var n=new h.Vector3(0,0,0);switch(s.justification){case"TL":break;case"TC":n.x=.5*-u;break;case"TR":n.x=-u;break;case"ML":n.y=.5*d;break;case"MC":n.x=.5*-u,n.y=.5*d;break;case"MR":n.x=-u,n.y=.5*d;break;case"BL":n.y=d;break;case"BC":n.x=.5*-u,n.y=d;break;case"BR":n.x=-u,n.y=d}for(let e of o)e.translate(n.x,n.y,n.z);if(s.location.hasOwnProperty("xAxis")){var i=new h.Matrix4;i.set(s.location.xAxis.X,s.location.yAxis.X,s.location.normal.X,0,s.location.xAxis.Y,s.location.yAxis.Y,s.location.normal.Y,0,s.location.xAxis.Z,s.location.yAxis.Z,s.location.normal.Z,0,0,0,0,1);for(let e of o)e.applyMatrix4(i),e.translate(s.location.origin.X,s.location.origin.Y,s.location.origin.Z)}for(let e of o){const n={};for(let t in e.attributes)n[t.toUpperCase()]=new f.AttributeData(e.attributes[t].array,e.attributes[t].itemSize);t.data.push(new f.GeometryData(new f.PrimitiveData(n,4,null,new f.MaterialData({color:s.color}))))}}else this._logger.error("No tag3d data was provided to tag3d engine.");return t}))}};g=s([u.singleton(),o("design:paramtypes",[])],g),t.Tag3dEngine=g},2556:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tag3dEngine=void 0;const i=n(5656);Object.defineProperty(t,"Tag3dEngine",{enumerable:!0,get:function(){return i.Tag3dEngine}})},7230:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BeautyRenderer=void 0;const a=n(8877),o=s(n(2212)),l=n(1647),c=n(6426),h=n(3114),u=n(3919),d=n(2899);t.BeautyRenderer=class{constructor(e,t,n){this._renderingEngine=e,this._renderer=t,this._scene=n,this._systemInfo=d.container.resolve(a.SystemInfo),this._beautyRenderingActive=!1,this._beautyRenderingDurationActive=0,this._beautyRenderingTimeout=null,this._initialized=!1,this._lastTime=0,this._lightSizeUVEnd=.15,this._lightSizeUVStart=.025,this._effectComposer=new l.EffectComposer(this._renderer)}get beautyRenderingActive(){return this._beautyRenderingActive}set beautyRenderingActive(e){this._beautyRenderingActive=e}get beautyRenderingDurationActive(){return this._beautyRenderingDurationActive}set beautyRenderingDurationActive(e){this._beautyRenderingDurationActive=e}get beautyRenderingTimeout(){return this._beautyRenderingTimeout}set beautyRenderingTimeout(e){this._beautyRenderingTimeout=e}activateBeautyRenderShaders(){this._renderer.shadowMap.type=o.PCFShadowMap,this._renderer.shadowMap.needsUpdate=!0,this._renderingEngine.materialLoader.updateMaterials()}deactivateBeautyRenderShaders(){this._beautyRenderingTimeout=null,this._beautyRenderingActive=!1,this._beautyRenderingDurationActive=0,this._renderer.shadowMap.type=o.PCFSoftShadowMap,this._renderer.shadowMap.needsUpdate=!0,this._renderingEngine.materialLoader.updateSoftShadow(this._lightSizeUVStart,.1),this._renderingEngine.materialLoader.updateMaterials()}initialize(e,t,n){this._renderPass=new c.RenderPass(this._scene,e),this._ssaaPass=new u.SSAARenderPass(this._scene,e,this._renderer.getClearColor(new o.Color),this._renderer.getClearAlpha()),this._effectComposer.addPass(this._ssaaPass),this._saoPass=new h.SAOPass(this._scene,e,!0,!0);const i=this._saoPass.render.bind(this._saoPass);this._saoPass.render=(e,t,n,r,s)=>{const a=[];this._scene.traverse((function(e){e instanceof o.Mesh&&e.material&&e.material instanceof o.MeshStandardMaterial&&e.material.transparent&&e.visible&&(a.push(e),e.visible=!1),!1===e.userData.ambientOcclusion&&(a.push(e),e.visible=!1)})),i(e,t,n,r,s);for(let e=0;e<a.length;e++)a[e].visible=!0},this._effectComposer.addPass(this._saoPass),this._saoPass.params.output=0,this._saoPass.params.saoBias=.5,this._saoPass.params.saoIntensity=.0015,this._saoPass.params.saoScale=4,this._saoPass.params.saoKernelRadius=100,this._saoPass.params.saoMinResolution=.001,this._saoPass.params.saoBlur=!0,this._saoPass.params.saoBlurRadius=4,this._saoPass.params.saoBlurStdDev=4,this._saoPass.params.saoBlurDepthCutoff=.01,this._initialized=!0}render(e,t,n,i){this._initialized||this.initialize(t,n,i);const r=this.setShaderProperties();if(this._renderingEngine.ambientOcclusion&&!(this._systemInfo.isIOSDevice||this._systemInfo.isMobileDevice||this._systemInfo.runningInSafari)){this._ssaaPass.clearColor=this._renderer.getClearColor(new o.Color),this._ssaaPass.clearAlpha=this._renderer.getClearAlpha();const s=this._saoPass.params.saoIntensity;this._saoPass.params.saoIntensity=r*s,this._renderPass.camera=t,this._saoPass.camera=t,this._ssaaPass.camera=t,this._saoPass.setSize(n,i),this._effectComposer.setSize(n,i),this._effectComposer.render(e),this._saoPass.params.saoIntensity=s}else this._renderer.render(this._scene,t)}startBeautyRenderCountdown(){this._beautyRenderingTimeout=setTimeout((()=>{this._beautyRenderingActive=!0,this._beautyRenderingDurationActive=0,this.activateBeautyRenderShaders()}),this._renderingEngine.beautyRenderDelay)}stopBeautyRenderCountdown(){this.beautyRenderingTimeout&&clearTimeout(this.beautyRenderingTimeout),this.deactivateBeautyRenderShaders()}setShaderProperties(){const e=Math.min(this._beautyRenderingDurationActive,this._renderingEngine.beautyRenderBlendingDuration)/this._renderingEngine.beautyRenderBlendingDuration;if(e<.25){const t=e/.25;this._renderingEngine.materialLoader.updateSoftShadow(this._lightSizeUVStart,t)}else{const t=(e-.25)/.75;this._renderingEngine.materialLoader.updateSoftShadow(this._lightSizeUVStart+(this._lightSizeUVEnd-this._lightSizeUVStart)*t,1)}return e}}},9158:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderingEngine=void 0;const o=n(887),l=s(n(2212)),c=n(2899),h=n(1990),u=n(420),d=n(3858),p=n(4084),f=n(3490),m=n(2248),g=n(8877),v=n(1169),_=n(7038),y=n(42),b=n(7840),w=n(4562),x=n(7418),M=n(6975),E=n(1856),S=n(7912),T=n(7038),A=n(5174);t.RenderingEngine=class{constructor(e){var t,n;this._canvasEngine=c.container.resolve(u.CanvasEngine),this._converter=c.container.resolve(w.Converter),this._eventEngine=c.container.resolve(g.EventEngine),this._settingsEngine=c.container.resolve(g.SettingsEngine),this._stateEngine=c.container.resolve(g.StateEngine),this._tree=c.container.resolve(d.Tree),this._ambientOcclusion=!0,this._automaticResizing=!0,this._beautyRenderBlendingDuration=1500,this._beautyRenderDelay=50,this._blur=!1,this._blurSceneWhenBusy=!0,this._clearAlpha=1,this._clearColor="#ffffff",this._closed=!1,this._environmentMap="none",this._environmentMapAsBackground=!1,this._environmentMapResolution="1024",this._gridVisibility=!0,this._groundPlaneVisibility=!0,this._lightScene="default",this._pointSize=1,this._shadows=!0,this._show=!1,this._showStatistics=!1,this._updateCBs=[],l.Object3D.DefaultUp=new l.Vector3(0,0,1),this._id=e.id,this._canvas=this._canvasEngine.createCanvasObject(e.canvas),this._environmentMapLoader=new x.EnvironmentMapLoader(this),this._materialLoader=new b.MaterialLoader(this),this._geometryLoader=new M.GeometryLoader(this),this._htmlElementAnchorLoader=new S.HTMLElementAnchorLoader(this),this._lightLoader=new E.LightLoader(this),this._visibility=e.visibility,this._logoDivElement=document.createElement("div"),this._logoDivElement.style.background="#030531",this._logoDivElement.style.position="relative",this._logoDivElement.style.height="100%",this._logoDivElement.style.width="100%",null===(t=this._canvas.canvasElement.parentElement)||void 0===t||t.insertBefore(this._logoDivElement,null===(n=this._canvas.canvasElement.parentElement)||void 0===n?void 0:n.firstChild);const i=new Image;i.style.position="absolute",i.style.top="50%",i.style.left="50%",i.style.transform="translateX(-50%) translateY(-50%)",i.src="https://d2tuv7fwq0eipl.cloudfront.net/production/assets/img/icon_logo_white.png",this._logoDivElement.appendChild(i),this._domEventEngine=new g.DomEventEngine(this._canvas.canvasElement),this._lightEngine=new f.LightEngine,this._cameraEngine=new h.CameraEngine(this._canvas,this._domEventEngine),this._sceneTree=new p.SceneTree(this),this._sceneTree.scene.background=new l.Color("#ffffff"),this._renderingLogic=new y.RenderingLogic(this),this._gridObject=new v.SDObject("grid",""),this._grid=new l.GridHelper,this._grid.material.opacity=.15,this._grid.material.transparent=!0,this._grid.rotateX(Math.PI/2),this._grid.visible=this.gridVisibility,this._gridObject.add(this._grid),this._gridObject.userData.ambientOcclusion=!1,this._sceneTree.scene.add(this._gridObject),this._groundPlaneObject=new v.SDObject("grid","");let r=new _.MaterialData;r.color="#d3d3d3",r.side=_.MATERIAL_SIDE.FRONT,r.roughness=1,r.metalness=0,this._groundPlane=new l.Mesh(new l.PlaneGeometry,this._materialLoader.load(r)),this._groundPlane.receiveShadow=!0,this._groundPlane.visible=this.groundPlaneVisibility,this._groundPlaneObject.add(this._groundPlane),this._groundPlaneObject.userData.ambientOcclusion=!1,this._sceneTree.scene.add(this._groundPlaneObject),this._grid.position.set(0,0,-.005),this._groundPlane.position.set(0,0,-.005),this._stateEngine.createCustomState(this.id+"_settings_loaded"),this._visibility===m.VISIBILITYMODE.INSTANT&&(this.show=!0),this._visibility===m.VISIBILITYMODE.SESSION&&this._stateEngine.primarySessionLoaded.then((()=>{this._stateEngine.getCustomState(this.id+"_settings_loaded").then((()=>{this.changeSceneExtents(this._sceneTree.boundingBox),this.show=!0}))})),this._stateEngine.primarySettingsRegistered.resolved?this._stateEngine.primarySettingsRegistered.then((()=>setTimeout((()=>this.applySettings()),0))):this._stateEngine.primarySettingsRegistered.then((()=>this.applySettings()))}get ambientOcclusion(){return this._ambientOcclusion}set ambientOcclusion(e){this._ambientOcclusion=e,this._updateCBs.forEach((e=>e()))}get automaticResizing(){return this._automaticResizing}set automaticResizing(e){this._automaticResizing=e,this._updateCBs.forEach((e=>e()))}get beautyRenderBlendingDuration(){return this._beautyRenderBlendingDuration}set beautyRenderBlendingDuration(e){this._beautyRenderBlendingDuration=e,this._updateCBs.forEach((e=>e()))}get beautyRenderDelay(){return this._beautyRenderDelay}set beautyRenderDelay(e){this._beautyRenderDelay=e,this._updateCBs.forEach((e=>e()))}get blur(){return this._blur}set blur(e){this._blur=e,this._updateCBs.forEach((e=>e()))}get blurSceneWhenBusy(){return this._blurSceneWhenBusy}set blurSceneWhenBusy(e){this._blurSceneWhenBusy=e,this._updateCBs.forEach((e=>e()))}get cameraEngine(){return this._cameraEngine}get canvas(){return this._canvas}get clearAlpha(){return this._clearAlpha}set clearAlpha(e){this._clearAlpha=e,this._updateCBs.forEach((e=>e()))}get clearColor(){return this._clearColor}set clearColor(e){this._clearColor=e,this._updateCBs.forEach((e=>e()))}get closed(){return this._closed}get environmentMap(){return this._environmentMap}set environmentMap(e){this._environmentMap=e,this._environmentMapLoader.load(this.environmentMap),this._updateCBs.forEach((e=>e()))}get environmentMapAsBackground(){return this._environmentMapAsBackground}set environmentMapAsBackground(e){this._environmentMapAsBackground=e,this._updateCBs.forEach((e=>e()))}get environmentMapLoader(){return this._environmentMapLoader}get environmentMapResolution(){return this._environmentMapResolution}set environmentMapResolution(e){this._environmentMapResolution=e,this._environmentMapLoader.load(this.environmentMap),this._updateCBs.forEach((e=>e()))}get geometryLoader(){return this._geometryLoader}get gridVisibility(){return this._gridVisibility}set gridVisibility(e){this._grid&&(this._grid.visible=e),this._gridVisibility=e,this._updateCBs.forEach((e=>e()))}get groundPlaneVisibility(){return this._groundPlaneVisibility}set groundPlaneVisibility(e){this._groundPlane&&(this._groundPlane.visible=e),this._groundPlaneVisibility=e,this._updateCBs.forEach((e=>e()))}get htmlElementAnchorLoader(){return this._htmlElementAnchorLoader}get id(){return this._id}get lightEngine(){return this._lightEngine}get lightLoader(){return this._lightLoader}get lightScene(){return this._lightScene}set lightScene(e){this._lightScene=e,this._updateCBs.forEach((e=>e()))}get logoDivElement(){return this._logoDivElement}get materialLoader(){return this._materialLoader}get minimalRendering(){return this._renderingLogic.minimalRendering}get pointSize(){return this._pointSize}set pointSize(e){this._pointSize=e,this._updateCBs.forEach((e=>e()))}get sceneTree(){return this._sceneTree}get shadows(){return this._shadows}set shadows(e){this._shadows=e,this._updateCBs.forEach((e=>e()))}get show(){return this._show}set show(e){this._show=e,this._updateCBs.forEach((e=>e()))}get showStatistics(){return this._showStatistics}set showStatistics(e){this._showStatistics=e,this._updateCBs.forEach((e=>e()))}changeSceneExtents(e){o.vec3.equals(e.min,o.vec3.create())&&o.vec3.equals(e.max,o.vec3.create())&&(e=new A.Box(o.vec3.fromValues(-10,-10,-10),o.vec3.fromValues(10,10,10)));let t=o.vec3.distance(e.min,e.max),n=.1,i=t;if(t>1){let e=Math.floor(t).toString(),r=Math.pow(10,e.length-1);i=Math.max(Math.ceil(t/r)*r,1),r/=10,n=i/r}else{let e=1-Math.floor(Math.log(t)/Math.log(10))-2,r=t.toFixed(e+1),s=parseInt(r.substr(r.length-1))+1,a="0.";for(let t=0;t<e;++t)a+="0";i=parseFloat(a+s),n=10*s}this._gridObject.remove(this._grid),this._grid=new l.GridHelper(2*i,n),this._grid.material.opacity=.15,this._grid.material.transparent=!0,this._grid.rotateX(Math.PI/2),this._grid.visible=this.gridVisibility,this._gridObject.add(this._grid),this._groundPlane.geometry=new l.PlaneGeometry(2*i,2*i,2,2);let r=e.boundingSphere;this._grid.position.set(r.center[0],r.center[1],e.min[2]-.005),this._groundPlane.position.set(r.center[0],r.center[1],e.min[2]-.005)}close(){var e,t;return a(this,void 0,void 0,(function*(){return this._closed=!0,null===(e=this._canvas.canvasElement.parentElement)||void 0===e||e.removeChild(this._logoDivElement),null===(t=this._canvas.canvasElement.parentNode)||void 0===t||t.removeChild(this._htmlElementAnchorLoader.parentDiv),this._canvas.reset(),this._domEventEngine.removeAllDomEventListener(),this._domEventEngine.dispose(),!0}))}convert3Dto2D(e){const t=this.canvas.canvasElement.getBoundingClientRect(),n=this.canvas.canvasElement.width,i=this.canvas.canvasElement.height,r=this.cameraEngine.getCamera();if(!r)throw new Error("No camera is defined for this viewer.");const s=o.vec3.normalize(o.vec3.create(),o.vec3.subtract(o.vec3.create(),e,r.position)),a=this.trace(r.position,s),l=r.project(o.vec3.clone(e));return l[0]=l[0]*(n/2)+n/2,l[1]=-l[1]*(i/2)+i/2,l[0]=l[0]/devicePixelRatio,l[1]=l[1]/devicePixelRatio,{hidden:a.length>1&&a[0].distance>0&&a[0].distance<1/0&&a[0].distance<o.vec3.distance(r.position,e),container:o.vec2.clone(l),client:o.vec2.fromValues(l[0]+t.left,l[1]+t.top),page:o.vec2.fromValues(l[0]+t.left+window.pageXOffset,l[1]+t.top+window.pageYOffset)}}getScreenshot(e,t){return this._renderingLogic.getScreenshot(e,t)}reset(){this.changeSceneExtents(this._sceneTree.boundingBox),this._visibility===m.VISIBILITYMODE.SESSION&&(this.show=!1),this._stateEngine.getCustomState(this.id+"_settings_loaded").reset()}resize(e,t){this._renderingLogic.resize(e,t),this._renderingLogic.render()}saveSettings(){this.lightEngine.saveSettings(),this._settingsEngine.general.viewer.blurSceneWhenBusy.value=this.blurSceneWhenBusy,this._settingsEngine.scene.gridVisibility.value=this.gridVisibility,this._settingsEngine.scene.groundPlaneVisibility.value=this.groundPlaneVisibility,this._settingsEngine.scene.lights.lightScene.value=this.lightScene,this._settingsEngine.scene.material.environmentMapResolution.value=this.environmentMapResolution,this._settingsEngine.scene.material.environmentMap.value=Array.isArray(this.environmentMap)?JSON.stringify(this.environmentMap):this.environmentMap,this._settingsEngine.scene.material.environmentMapAsBackground.value=this.environmentMapAsBackground,this._settingsEngine.scene.render.ambientOcclusion.value=this.ambientOcclusion,this._settingsEngine.scene.render.beautyRenderBlendingDuration.value=this.beautyRenderBlendingDuration,this._settingsEngine.scene.render.beautyRenderDelay.value=this.beautyRenderDelay,this._settingsEngine.scene.render.clearAlpha.value=this.clearAlpha,this._settingsEngine.scene.render.clearColor.value=this.clearColor,this._settingsEngine.scene.render.pointSize.value=this.pointSize,this._settingsEngine.scene.render.shadows.value=this.shadows;const e=this.cameraEngine.getCamera();if(e)if(this._settingsEngine.scene.camera.autoAdjust.value=e.autoAdjust,this._settingsEngine.scene.camera.cameraMovementDuration.value=e.cameraMovementDuration,this._settingsEngine.scene.camera.enableCameraControls.value=e.enableCameraControls,this._settingsEngine.scene.camera.revertAtMouseUp.value=e.revertAtMouseUp,this._settingsEngine.scene.camera.revertAtMouseUpDuration.value=e.revertAtMouseUpDuration,this._settingsEngine.scene.camera.zoomExtentsFactor.value=e.zoomExtentsFactor,e.type===h.CAMERATYPE.PERSPECTIVE){this._settingsEngine.scene.camera.cameraTypes.active.value=0,this._settingsEngine.scene.camera.cameraTypes.perspective.default.value.position={x:e.defaultPosition[0],y:e.defaultPosition[1],z:e.defaultPosition[2]},this._settingsEngine.scene.camera.cameraTypes.perspective.default.value.target={x:e.defaultTarget[0],y:e.defaultTarget[1],z:e.defaultTarget[2]},this._settingsEngine.scene.camera.cameraTypes.orthographic.default.value.position={x:0,y:0,z:0},this._settingsEngine.scene.camera.cameraTypes.orthographic.default.value.target={x:0,y:0,z:0},this._settingsEngine.scene.camera.cameraTypes.perspective.fov.value=e.fov;const t=e.controls;this._settingsEngine.scene.camera.controls.orbit.autoRotationSpeed.value=t.autoRotationSpeed,this._settingsEngine.scene.camera.controls.orbit.damping.value=t.damping,this._settingsEngine.scene.camera.controls.orbit.enableAutoRotation.value=t.enableAutoRotation,this._settingsEngine.scene.camera.controls.orbit.enableKeyPan.value=t.enableKeyPan,this._settingsEngine.scene.camera.controls.orbit.enablePan.value=t.enablePan,this._settingsEngine.scene.camera.controls.orbit.enableRotation.value=t.enableRotation,this._settingsEngine.scene.camera.controls.orbit.enableZoom.value=t.enableZoom,this._settingsEngine.scene.camera.controls.orbit.input.value=t.input,this._settingsEngine.scene.camera.controls.orbit.keyPanSpeed.value=t.keyPanSpeed,this._settingsEngine.scene.camera.controls.orbit.movementSmoothness.value=t.movementSmoothness,this._settingsEngine.scene.camera.controls.orbit.rotationSpeed.value=t.rotationSpeed,this._settingsEngine.scene.camera.controls.orbit.panSpeed.value=t.panSpeed,this._settingsEngine.scene.camera.controls.orbit.zoomSpeed.value=t.zoomSpeed,this._settingsEngine.scene.camera.controls.orbit.restrictions.position.cube.value={min:{x:t.cubePositionRestriction.min[0],y:t.cubePositionRestriction.min[1],z:t.cubePositionRestriction.min[2]},max:{x:t.cubePositionRestriction.max[0],y:t.cubePositionRestriction.max[1],z:t.cubePositionRestriction.max[2]}},this._settingsEngine.scene.camera.controls.orbit.restrictions.position.sphere.value={center:{x:t.spherePositionRestriction.center[0],y:t.spherePositionRestriction.center[1],z:t.spherePositionRestriction.center[2]},radius:t.spherePositionRestriction.radius},this._settingsEngine.scene.camera.controls.orbit.restrictions.target.cube.value={min:{x:t.cubeTargetRestriction.min[0],y:t.cubeTargetRestriction.min[1],z:t.cubeTargetRestriction.min[2]},max:{x:t.cubeTargetRestriction.max[0],y:t.cubeTargetRestriction.max[1],z:t.cubeTargetRestriction.max[2]}},this._settingsEngine.scene.camera.controls.orbit.restrictions.target.sphere.value={center:{x:t.sphereTargetRestriction.center[0],y:t.sphereTargetRestriction.center[1],z:t.sphereTargetRestriction.center[2]},radius:t.sphereTargetRestriction.radius},this._settingsEngine.scene.camera.controls.orbit.restrictions.rotation.value=t.rotationRestriction,this._settingsEngine.scene.camera.controls.orbit.restrictions.zoom.value=t.zoomRestriction}else{const t=this._settingsEngine.scene.camera.cameraTypes.active.value;switch(e.direction){case h.ORTHOGRAPHIC_CAMERA_DIRECTION.TOP:this._settingsEngine.scene.camera.cameraTypes.active.value=1;break;case h.ORTHOGRAPHIC_CAMERA_DIRECTION.BOTTOM:this._settingsEngine.scene.camera.cameraTypes.active.value=2;break;case h.ORTHOGRAPHIC_CAMERA_DIRECTION.RIGHT:this._settingsEngine.scene.camera.cameraTypes.active.value=3;break;case h.ORTHOGRAPHIC_CAMERA_DIRECTION.LEFT:this._settingsEngine.scene.camera.cameraTypes.active.value=4;break;case h.ORTHOGRAPHIC_CAMERA_DIRECTION.BACK:this._settingsEngine.scene.camera.cameraTypes.active.value=5;break;case h.ORTHOGRAPHIC_CAMERA_DIRECTION.FRONT:this._settingsEngine.scene.camera.cameraTypes.active.value=6}t!==this._settingsEngine.scene.camera.cameraTypes.active.value&&this._settingsEngine.scene.camera.cameraTypes.orthographic.default.value.position.x===e.defaultPosition[0]&&this._settingsEngine.scene.camera.cameraTypes.orthographic.default.value.position.y===e.defaultPosition[1]&&this._settingsEngine.scene.camera.cameraTypes.orthographic.default.value.position.z===e.defaultPosition[2]&&this._settingsEngine.scene.camera.cameraTypes.orthographic.default.value.target.x===e.defaultTarget[0]&&this._settingsEngine.scene.camera.cameraTypes.orthographic.default.value.target.y===e.defaultTarget[1]&&this._settingsEngine.scene.camera.cameraTypes.orthographic.default.value.target.z===e.defaultTarget[2]&&(e.defaultPosition=o.vec3.clone(e.position),e.defaultTarget=o.vec3.clone(e.target)),this._settingsEngine.scene.camera.cameraTypes.orthographic.default.value.position={x:e.defaultPosition[0],y:e.defaultPosition[1],z:e.defaultPosition[2]},this._settingsEngine.scene.camera.cameraTypes.orthographic.default.value.target={x:e.defaultTarget[0],y:e.defaultTarget[1],z:e.defaultTarget[2]},this._settingsEngine.scene.camera.cameraTypes.perspective.default.value.position={x:0,y:0,z:0},this._settingsEngine.scene.camera.cameraTypes.perspective.default.value.target={x:0,y:0,z:0};const n=e.controls;this._settingsEngine.scene.camera.controls.orthographic.damping.value=n.damping,this._settingsEngine.scene.camera.controls.orthographic.enableKeyPan.value=n.enableKeyPan,this._settingsEngine.scene.camera.controls.orthographic.enablePan.value=n.enablePan,this._settingsEngine.scene.camera.controls.orthographic.enableZoom.value=n.enableZoom,this._settingsEngine.scene.camera.controls.orthographic.input.value=n.input,this._settingsEngine.scene.camera.controls.orthographic.keyPanSpeed.value=n.keyPanSpeed,this._settingsEngine.scene.camera.controls.orthographic.movementSmoothness.value=n.movementSmoothness,this._settingsEngine.scene.camera.controls.orthographic.panSpeed.value=n.panSpeed,this._settingsEngine.scene.camera.controls.orthographic.zoomSpeed.value=n.zoomSpeed}}trace(e,t,n=this._tree.root){const i=[],r=n=>{for(let r=0;r<n.data.length;r++)if(n.data[r]instanceof T.GeometryData){const s=n.data[r].boundingBox.intersect(e,t);s&&i.push({distance:s,data:n.data[r]})}for(let e=0;e<n.children.length;e++)r(n.children[e])};return r(n),i.sort(((e,t)=>e.distance-t.distance)),i}update(){this._sceneTree.updateSceneTree(this._tree.root,this._lightEngine),this._renderingLogic.updateShadowMap(),this._renderingLogic.render()}applySettings(){const e=this._eventEngine.addListener(g.EVENTTYPE.ENVIRONMENTMAP.ENVIRONMENTMAP_LOADED,(t=>{!t.name||t.name&&t.name!==this._settingsEngine.scene.material.environmentMap.value||(this.environmentMapAsBackground=this._settingsEngine.scene.material.environmentMapAsBackground.value,this.ambientOcclusion=this._settingsEngine.scene.render.ambientOcclusion.value,this.beautyRenderBlendingDuration=this._settingsEngine.scene.render.beautyRenderBlendingDuration.value,this.beautyRenderDelay=this._settingsEngine.scene.render.beautyRenderDelay.value,this.blurSceneWhenBusy=this._settingsEngine.general.viewer.blurSceneWhenBusy.value,this.clearAlpha=this._settingsEngine.scene.render.clearAlpha.value,this.clearColor=this._converter.toColor(this._settingsEngine.scene.render.clearColor.value),this.gridVisibility=this._settingsEngine.scene.gridVisibility.value,this.groundPlaneVisibility=this._settingsEngine.scene.groundPlaneVisibility.value,this.lightScene=this._settingsEngine.scene.lights.lightScene.value,this.pointSize=this._settingsEngine.rendering.pointSize.value,this.shadows=this._settingsEngine.scene.render.shadows.value,this._eventEngine.removeListener(e),this.lightEngine.applySettings(),this.cameraEngine.applySettings(),this._stateEngine.getCustomState(this.id+"_settings_loaded").resolve(!0),this._updateCBs.forEach((e=>e())),this.update())}));this._environmentMapResolution=this._settingsEngine.scene.material.environmentMapResolution.value,this.environmentMap=this._settingsEngine.scene.material.environmentMap.value,this._updateCBs.forEach((e=>e()))}addUpdateCB(e){this._updateCBs.push(e)}}},42:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderingLogic=void 0;const a=n(1990),o=n(8877),l=n(4171),c=n(887),h=s(n(2212)),u=n(2899),d=n(6714),p=n(7230),f=s(n(6194)),m=s(n(3466));t.RenderingLogic=class{constructor(e){this._renderingEngine=e,this._eventEngine=u.container.resolve(o.EventEngine),this._logger=u.container.resolve(l.Logger),this._orthographicCameraThree=new h.OrthographicCamera(1,1,1,1,1,1),this._perspectiveCameraThree=new h.PerspectiveCamera(1,1,1,1),this._stateEngine=u.container.resolve(o.StateEngine),this._systemInfo=u.container.resolve(o.SystemInfo),this._height=0,this._lastTime=0,this._minimalRendering=!1,this._noNeedToRender=!1,this._noWebGL=!1,this._usingSwiftShader=!1,this._width=0,this._currentlyBlurred=!1;let t=h.ShaderChunk.shadowmap_pars_fragment;t.includes("PCSS implementation")||(t=t.replace("#ifdef USE_SHADOWMAP","#ifdef USE_SHADOWMAP"+d.main),t=t.replace(t.substr(t.indexOf("#if defined( SHADOWMAP_TYPE_PCF )"),t.indexOf("#elif defined( SHADOWMAP_TYPE_PCF_SOFT )")-t.indexOf("#if defined( SHADOWMAP_TYPE_PCF )")),"#if defined( SHADOWMAP_TYPE_PCF )\n"+d.entry)),h.ShaderChunk.shadowmap_pars_fragment=t,this._width=this._renderingEngine.canvas.canvasElement.width,this._height=this._renderingEngine.canvas.canvasElement.height;const n={alpha:!0,depth:!1,antialias:!0,preserveDrawingBuffer:!0,canvas:this._renderingEngine.canvas.canvasElement};try{const e=this.createWebGLContext(n);this._renderer=new h.WebGLRenderer(Object.assign({context:e},n)),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.needsUpdate=!0,this._renderer.shadowMap.type=h.PCFSoftShadowMap,this._renderer.shadowMap.autoUpdate=!1,this._renderer.setSize(this._width,this._height),this._renderer.setClearColor(new h.Color("#ffffff"),1),this._beautyRenderer=new p.BeautyRenderer(this._renderingEngine,this._renderer,this._renderingEngine.sceneTree.scene),this._eventEngine.addListener(o.EVENTTYPE.CAMERA.CAMERA_START,(e=>{this._noNeedToRender=!1,this._beautyRenderer.stopBeautyRenderCountdown()})),this._eventEngine.addListener(o.EVENTTYPE.CAMERA.CAMERA_END,(e=>{this._beautyRenderer.startBeautyRenderCountdown()})),window.onresize=()=>{this.render()},this._renderingEngine.canvas.canvasElement.onresize=()=>{this.render()},this._renderingEngine.canvas.canvasElement.parentElement.onresize=()=>{this.render()};const t=new m.default;t.showPanel(0),t.dom.style.cssText="position:absolute;top:0px;left:0px;",this._renderingEngine.canvas.canvasElement.parentElement.appendChild(t.dom);const i=new m.default;i.showPanel(1),i.dom.style.cssText="position:absolute;top:0px;left:80px;",this._renderingEngine.canvas.canvasElement.parentElement.appendChild(i.dom);const r=new m.default;r.showPanel(2),r.dom.style.cssText="position:absolute;top:0px;left:160px;",this._renderingEngine.canvas.canvasElement.parentElement.appendChild(r.dom),this._stats={stats:[t,i,r],begin:()=>{t.begin(),i.begin(),r.begin()},end:()=>{t.end(),i.end(),r.end()}},this.animate(0),this._beautyRenderer.startBeautyRenderCountdown()}catch(e){this._noWebGL=!0}}get minimalRendering(){return this._minimalRendering}getScreenshot(e="image/png",t=1){return this._renderer.domElement.toDataURL(e,t)}render(){this._noNeedToRender=!1,this._beautyRenderer.startBeautyRenderCountdown()}resize(e,t){this._width=e,this._height=t}updateShadowMap(){this._renderer.shadowMap.needsUpdate=!0}adjustCamera(e,t,n){let i;const{position:r,target:s}=this._renderingEngine.cameraEngine.getCamera().update(e);if(this._renderingEngine.cameraEngine.getCamera().type===a.CAMERATYPE.ORTHOGRAPHIC){const e=this._renderingEngine.cameraEngine.getCamera(),a=t/n,o=c.vec3.distance(r,s)/2;this._orthographicCameraThree.up.set(0,0,1),this._orthographicCameraThree.left=e.left=-o*a,this._orthographicCameraThree.bottom=e.bottom=-o,this._orthographicCameraThree.right=e.right=o*a,this._orthographicCameraThree.top=e.top=o,this._orthographicCameraThree.near=e.near=.01*o,this._orthographicCameraThree.far=e.far=1e4*o,this._orthographicCameraThree.position.set(r[0],r[1],r[2]),this._orthographicCameraThree.lookAt(s[0],s[1],s[2]),this._orthographicCameraThree.updateProjectionMatrix(),i=this._orthographicCameraThree}else{const e=this._renderingEngine.cameraEngine.getCamera();this._perspectiveCameraThree.up.set(0,0,1);const a=this._renderingEngine.cameraEngine.getCamera().fov,o=this._renderingEngine.sceneTree.boundingBox.boundingSphere,l=o.radius>0?o.radius:2;this._perspectiveCameraThree.fov=e.fov=a,this._perspectiveCameraThree.aspect=e.aspect=t/n,this._perspectiveCameraThree.far=e.far=a<10?100*a*100*l:100*l,this._perspectiveCameraThree.near=e.near=a<10?100*a*.1*l:.1*l,this._perspectiveCameraThree.position.set(r[0],r[1],r[2]),this._perspectiveCameraThree.lookAt(s[0],s[1],s[2]),this._perspectiveCameraThree.updateProjectionMatrix(),i=this._perspectiveCameraThree}return i}blurScene(){if(this._renderingEngine.blurSceneWhenBusy&&this._renderingEngine.blur&&!this._currentlyBlurred){if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&navigator.userAgent.toLowerCase().indexOf("android")>-1)return;this._renderer.domElement.style.filter="blur(3px)",this._currentlyBlurred=!0}else!this._renderingEngine.blur&&this._currentlyBlurred&&(this._renderer.domElement.style.filter="",this._currentlyBlurred=!1)}showStatistics(){if(this._renderingEngine.showStatistics)for(let e=0;e<this._stats.stats.length;e++)this._stats.stats[e].dom.style.display="";else for(let e=0;e<this._stats.stats.length;e++)this._stats.stats[e].dom.style.display="none"}animate(e){if(this._renderingEngine.closed||this._noWebGL)return;requestAnimationFrame((e=>this.animate(e))),f.update(e);const t=e-this._lastTime<0?0:e-this._lastTime;if(this._lastTime=e,!this._renderingEngine.cameraEngine.hasCamera())return;this._stats.begin(),this.blurScene(),this.showStatistics();let n=this._width,i=this._height;this._renderingEngine.automaticResizing&&(n=this._renderingEngine.canvas.canvasElement.parentNode.clientWidth,i=this._renderingEngine.canvas.canvasElement.parentNode.clientHeight),this._renderingEngine.logoDivElement.style.display=this._renderingEngine.show?"none":"inherit",this._renderingEngine.canvas.canvasElement.style.display=this._renderingEngine.show?"inherit":"none";const r=this.adjustCamera(t,n,i);if(!0===this._noNeedToRender)return;this._renderer.shadowMap.enabled=!this._usingSwiftShader&&this._renderingEngine.shadows,this._renderingEngine.sceneTree.scene.background=this._renderingEngine.environmentMapAsBackground?this._renderingEngine.environmentMapLoader.environmentMap:null,this._renderer.setClearColor(new h.Color(this._renderingEngine.clearColor),this._renderingEngine.clearAlpha);const s=n/i;let a=n,l=i;(n>1920||i>1080)&&((n-1920)/s>i-1080?(a=1920,l=1920/s):(a=1080*s,l=1080)),this._renderer.setSize(a,l),this._renderer.domElement.style.width=n+"px",this._renderer.domElement.style.height=i+"px",this._renderingEngine.htmlElementAnchorLoader.adjustPositions(),this._beautyRenderer.beautyRenderingActive?(this._renderingEngine.shadows||this._renderingEngine.ambientOcclusion&&!this._systemInfo.isIOSDevice||(this._eventEngine.emitEvent(o.EVENTTYPE.RENDERING.BEAUTY_RENDERING_FINISHED,{}),this._beautyRenderer.deactivateBeautyRenderShaders(),this._noNeedToRender=!0),this._beautyRenderer.beautyRenderingDurationActive+=t,this._usingSwiftShader?this._renderer.render(this._renderingEngine.sceneTree.scene,r):this._beautyRenderer.render(t,r,n,i),this._beautyRenderer.beautyRenderingDurationActive>=this._renderingEngine.beautyRenderBlendingDuration&&(this._eventEngine.emitEvent(o.EVENTTYPE.RENDERING.BEAUTY_RENDERING_FINISHED,{}),this._beautyRenderer.deactivateBeautyRenderShaders(),this._noNeedToRender=!0)):this._renderer.render(this._renderingEngine.sceneTree.scene,r),this._stateEngine.firstViewerShown.resolved||this._stateEngine.firstViewerShown.resolve(!0),this._stats.end()}createWebGLContext(e){try{let t=e.canvas;t.addEventListener("webglcontextlost",(()=>{}),!1),t.addEventListener("webglcontextrestored",(()=>{}),!1);const n=Object.assign({stencil:!0,premultipliedAlpha:!0,powerPreference:"default"},e);let i=t.getContext("webgl",n)||t.getContext("experimental-webgl",n);if(null===i){if(i=t.getContext("webgl")||t.getContext("experimental-webgl"),null===i)throw new Error("We were unable to get a WebGL context.");this._logger.warn("We were unable to get a WebGL context using the requested attributes, falling back to default attributes.")}void 0===i.getShaderPrecisionFormat&&(i.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});const r=i.getExtension("WEBGL_debug_renderer_info");return r&&(i.getParameter(r.UNMASKED_VENDOR_WEBGL),"Google SwiftShader"===i.getParameter(r.UNMASKED_RENDERER_WEBGL)&&(this._usingSwiftShader=!0,this._logger.warn("The current device is using Google SwiftShader, a CPU-based renderer. To achieve better rendering results, please enable GPU-rendering in your settings."))),i.getExtension("EXT_shader_texture_lod")||(this._minimalRendering=!0),i}catch(e){throw this._logger.error("We were unable to get a WebGL context."),e}}}},4084:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SceneTree=void 0;const a=s(n(2212)),o=n(7038),l=n(1169),c=n(7787),h=n(5174),u=n(8877),d=n(3490),p=n(887),f=n(2899);t.SceneTree=class{constructor(e){this._renderingEngine=e,this._eventEngine=f.container.resolve(u.EventEngine),this._scene=new a.Scene,this._stateEngine=f.container.resolve(u.StateEngine),this._boundingBox=new h.Box}get boundingBox(){return this._boundingBox}get scene(){return this._scene}convertData(e,t,n){let i=t.children.find((t=>t.SDid===e.id&&t.SDversion===e.version));switch(i||(i=new l.SDObject(e.id,e.version)),t.add(i),!0){case e instanceof o.GeometryData:return this._renderingEngine.geometryLoader.load(e,i,n);case e instanceof c.ThreejsData:i.add(e.obj);break;case e instanceof o.MaterialData:break;case e instanceof d.AbstractLight:this._renderingEngine.lightLoader.load(e,i,this._scene,this._boundingBox);break;case e instanceof o.HTMLElementAnchorData:this._renderingEngine.htmlElementAnchorLoader.load(e)}return new h.Box}updateSceneTree(e,t){const n=this._boundingBox.clone();this._boundingBox=new h.Box,this._renderingEngine.geometryLoader.emptyGeometryCache(),this._mainNode||(this._mainNode=new l.SDObject(e.id,e.version),this._scene.add(this._mainNode)),this.updateNode(e,this._mainNode),this._boundingBox=e.boundingBox.clone();const i=t.getLightSceneObject(),r=this._mainNode.children.filter((e=>i.node.id===e.SDid));if(r.length>1)this.updateNode(i.node,r[0]);else{const e=new l.SDObject(i.node.id,i.node.version);this._mainNode.add(e),this.updateNode(i.node,e)}p.vec3.equals(n.min,this._boundingBox.min)&&p.vec3.equals(n.max,this._boundingBox.max)||(this._stateEngine.boundingBoxCreated.resolved||this._stateEngine.boundingBoxCreated.resolve(!0),this._eventEngine.emitEvent(u.EVENTTYPE.SCENE.SCENE_BOUNDING_BOX_CHANGE,this._boundingBox))}isEmpty(){return p.vec3.equals(this._boundingBox.min,p.vec3.create())&&p.vec3.equals(this._boundingBox.max,p.vec3.create())}updateNode(e,t){if(e.excludeViewers.includes(this._renderingEngine.id))return;t.applyTransformation(e.nodeMatrix),e.boundingBox=new h.Box;for(let n=0,i=e.data.length;n<i;n++){const i=this.convertData(e.data[n],t,e);e.boundingBox.union(i)}const n=[];for(let t=0;t<e.children.length;t++){const i=e.children[t];i&&n.push(i.id)}const i=e.data.map((e=>e.id)),r=e.data.map((e=>e.version)),s=t.children.filter((e=>!(n.includes(e.SDid)||i.includes(e.SDid)&&r.includes(e.SDversion))));for(const e of s)t.remove(e);for(let n=0,i=e.children.length;n<i;n++){const i=e.children[n];if(!i)continue;const r=t.children.find((e=>e.SDid===i.id));if(r)r.SDversion!==i.version&&this.updateNode(i,r);else{const e=new l.SDObject(i.id,i.version);t.add(e),this.updateNode(i,e)}e.boundingBox.union(i.boundingBox)}}}},8977:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SDThreejsObject=t.ThreejsData=t.RenderingEngine=void 0;const i=n(9158);Object.defineProperty(t,"RenderingEngine",{enumerable:!0,get:function(){return i.RenderingEngine}});const r=n(7787);Object.defineProperty(t,"ThreejsData",{enumerable:!0,get:function(){return r.ThreejsData}});const s=n(1169);Object.defineProperty(t,"SDThreejsObject",{enumerable:!0,get:function(){return s.SDObject}})},7418:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.EnvironmentMapLoader=void 0;const o=s(n(2212)),l=n(4171),c=n(8877),h=n(2899);t.EnvironmentMapLoader=class{constructor(e){this._renderingEngine=e,this._environmentMapFilenames=["px","nx","pz","nz","py","ny"],this._environmentMapNamesJPG=["default","default_bw","blurred_lights","georgentor","georgentor_blur","georgentor_blue_blur","georgentor_bw_blur","levelsets","lythwood_field","mountains","ocean","piazza_san_marco","residential_garden","room_abstract_1","sky","storage_room","storm","subway_entrance","subway_entrance_bw_blur","white","yokohama"],this._environmentMaps={},this._logger=h.container.resolve(l.Logger),this._eventEngine=h.container.resolve(c.EventEngine),this._environmentMapName="none",this._environmentMaps.none=null}get environmentMap(){return this._environmentMaps[this._environmentMapName]}load(e){return a(this,void 0,void 0,(function*(){const t=e;if("none"===e)return this.assignEnvironmentMap(e),this._eventEngine.emitEvent(c.EVENTTYPE.ENVIRONMENTMAP.ENVIRONMENTMAP_LOADED,{name:t}),!0;let n,i,r;if(!Array.isArray(e)&&e.startsWith('["https')&&e.endsWith('"]'))try{e=JSON.parse(e)}catch(e){}if(Array.isArray(e)){if(6!==e.length)return this._logger.error("Was not able to load environment map, exactly 6 files are needed in the array."),this._eventEngine.emitEvent(c.EVENTTYPE.ENVIRONMENTMAP.ENVIRONMENTMAP_LOADED,{}),!1;n=JSON.stringify(e,null,0),i=n}else n=e.toLowerCase().replace(/ /g,"_"),i=n+this._renderingEngine.environmentMapResolution;for(let e in this._environmentMaps)if(e===i)return this.assignEnvironmentMap(e),this._eventEngine.emitEvent(c.EVENTTYPE.ENVIRONMENTMAP.ENVIRONMENTMAP_LOADED,{name:t}),!0;if(Array.isArray(e))r=e;else{let t;if(r=[],this._environmentMapNamesJPG.indexOf(n)>=0)for(t=0;t<this._environmentMapFilenames.length;t++)r.push("https://viewer.shapediver.com/v2/envmaps/"+this._renderingEngine.environmentMapResolution+"/"+n+"/"+this._environmentMapFilenames[t]+".jpg");else{if(!e.startsWith("https://")&&!e.startsWith("http://"))return this._logger.error("Was not able to load environment map, format not supported."),this._eventEngine.emitEvent(c.EVENTTYPE.ENVIRONMENTMAP.ENVIRONMENTMAP_LOADED,{}),!1;for(e.endsWith("/")||(e+="/"),t=0;t<this._environmentMapFilenames.length;t++)r.push(e+this._environmentMapFilenames[t]+".jpg")}}try{return yield this.loadEnvironmentMap(i,r),this._eventEngine.emitEvent(c.EVENTTYPE.ENVIRONMENTMAP.ENVIRONMENTMAP_LOADED,{name:t}),Promise.resolve(!0)}catch(e){return this._logger.error("Was not able to load environment map."),this._eventEngine.emitEvent(c.EVENTTYPE.ENVIRONMENTMAP.ENVIRONMENTMAP_LOADED,{}),Promise.resolve(!1)}}))}assignEnvironmentMap(e){e in this._environmentMaps!=0&&(this._environmentMapName=e,this._renderingEngine.materialLoader.assignEnvironmentMap(this._environmentMaps[e]))}loadEnvironmentMap(e,t){return a(this,void 0,void 0,(function*(){return new Promise(((n,i)=>{(new o.CubeTextureLoader).load(t,(t=>{t.format=o.RGBFormat,t.mapping=o.CubeReflectionMapping,t.generateMipmaps=!1,t.minFilter=o.LinearFilter,t.magFilter=o.LinearFilter,this._environmentMaps[e]=t,this.assignEnvironmentMap(e),n()}),(()=>{}),(e=>i(e)))}))}))}}},6975:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryLoader=void 0;const a=s(n(2212)),o=n(7038),l=n(1169);t.GeometryLoader=class{constructor(e){this._renderingEngine=e,this._geometryCache={}}load(e,t,n){if(this._geometryCache[e.id+"_"+o.SD_RENDERINGTYPE.THREEJS]){const n=this._geometryCache[e.id+"_"+o.SD_RENDERINGTYPE.THREEJS];let i,r=n.children.pop();t.updateWorldMatrix(!0,!0);const s=t.matrixWorld.clone().invert();if(r instanceof a.InstancedMesh){const e=r,n=e.count+1;i=new a.InstancedMesh(e.geometry,e.material,n),i.castShadow=!0,i.receiveShadow=!0,i.applyMatrix4(s),i.setMatrixAt(0,t.matrixWorld.clone());for(let t=0;t<e.count;t++){const n=new a.Matrix4;e.getMatrixAt(t,n),i.setMatrixAt(t+1,n)}}else{const e=2;i=new a.InstancedMesh(r.geometry,r.material,e),i.castShadow=!0,i.receiveShadow=!0,i.applyMatrix4(s),i.setMatrixAt(0,t.matrixWorld.clone()),n.updateWorldMatrix(!0,!0),i.setMatrixAt(1,n.matrixWorld.clone())}i.instanceMatrix.needsUpdate=!0;const c=new l.SDObject(e.id,e.version);c.add(i),t.add(c),e.convertedObjects.push(c),this._geometryCache[e.id+"_"+o.SD_RENDERINGTYPE.THREEJS]=c}else{const n=new l.SDObject(e.id,e.version),i=new a.Mesh(this.loadGeometry(e.primitive),this._renderingEngine.materialLoader.load(e.primitive.material));i.geometry.computeVertexNormals(),i.castShadow=!0,i.receiveShadow=!0,n.add(i),this._geometryCache[e.id+"_"+o.SD_RENDERINGTYPE.THREEJS]=n,e.convertedObjects.push(n),t.add(n)}return e.boundingBox.clone().applyMatrix(n.worldMatrix)}loadGeometry(e){let t=new a.BufferGeometry;for(let n in e.attributes){const i=e.attributes[n];let r;switch(r=i.hasOffset?new a.InterleavedBufferAttribute(new a.InterleavedBuffer(i.array,i.stride),i.itemSize,i.offset):new a.BufferAttribute(i.array,i.itemSize,i.normalized),n){case"POSITION":t.setAttribute("position",r);break;case"NORMAL":t.setAttribute("normal",r);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":t.setAttribute("uv",r);break;case"TEXCOORD_1":t.setAttribute("uv2",r);break;case"COLOR_0":case"COLOR0":case"COLOR":t.setAttribute("color",r);break;case"WEIGHT":t.setAttribute("skinWeight",r);break;case"JOINT":t.setAttribute("skinIndex",r)}e.indices&&t.setIndex(new a.BufferAttribute(e.indices.array,e.indices.itemSize))}return t}emptyGeometryCache(){this._geometryCache={}}}},7912:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HTMLElementAnchorLoader=void 0;const i=n(887);t.HTMLElementAnchorLoader=class{constructor(e){var t;this._renderingEngine=e,this._htmlElements={},this._parentDiv=document.createElement("div"),null===(t=this._renderingEngine.canvas.canvasElement.parentNode)||void 0===t||t.appendChild(this._parentDiv)}get parentDiv(){return this._parentDiv}load(e){const t=e.createViewerHtmlElement(this._renderingEngine.id);t&&(this._parentDiv.appendChild(t),this._parentDiv.style.userSelect="none",this._parentDiv.style.cursor="default",this._parentDiv.style.pointerEvents="none",this._parentDiv.style.overflow="hidden",this._parentDiv.style.position="absolute",this._parentDiv.style.width="100%",this._parentDiv.style.height="100%",this._parentDiv.style.left="0%",this._parentDiv.style.top="0%",this._htmlElements[e.id]=e)}adjustPositions(){for(let e in this._htmlElements){const t=this._htmlElements[e],{page:n,container:r,client:s,hidden:a}=this._renderingEngine.convert3Dto2D(i.vec3.clone(t.location)),o=t.createViewerHtmlElement(this._renderingEngine.id);if(!o)continue;let l,c;o.style.display="",a&&(o.style.display="none"),l=t.data.position&&"right"===t.data.position.horizontal?r[0]-o.offsetWidth:t.data.position&&"left"===t.data.position.horizontal?r[0]:r[0]-o.offsetWidth/2,c=t.data.position&&"bottom"===t.data.position.vertical?r[1]-o.offsetHeight:t.data.position&&"top"===t.data.position.vertical?r[1]:r[1]-o.offsetHeight/2,o.style.left=l+"px",o.style.top=c+"px"}}}},1856:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.LightLoader=void 0;const a=s(n(2212)),o=n(3490),l=n(1169),c=n(887);t.LightLoader=class{constructor(e){this._renderingEngine=e}load(e,t,n,i){let r=null;for(let t=0;t<e.convertedObjects.length;t++)e.convertedObjects[t]instanceof l.SDObject&&(r=e.convertedObjects[t]);if(r||(r=new l.SDObject(e.id,e.version),e.convertedObjects.push(r)),e instanceof o.AmbientLight){const t=r.children[0]instanceof a.AmbientLight?r.children[0]:new a.AmbientLight;0===r.children.length&&r.add(t),t.color=new a.Color(e.color),t.intensity=e.intensity}if(e instanceof o.DirectionalLight){const t=r.children[0]instanceof a.DirectionalLight?r.children[0]:new a.DirectionalLight;0===r.children.length&&r.add(t),n.add(t.target),t.color=new a.Color(e.color),t.intensity=e.intensity;const s=i.boundingSphere;t.position.set(s.center[0]+e.direction[0]*s.radius*2.35,s.center[1]+e.direction[1]*s.radius*2.35,s.center[2]+e.direction[2]*s.radius*2.35),t.target.position.set(s.center[0],s.center[1],s.center[2]),!0===e.castShadow?(t.castShadow=!0,t.shadow.camera.up.set(0,0,1),t.shadow.camera.far=8*s.radius,t.shadow.camera.right=1.5*s.radius,t.shadow.camera.left=-1.5*s.radius,t.shadow.camera.top=1.5*s.radius,t.shadow.camera.bottom=-1.5*s.radius,t.shadow.mapSize.width=e.shadowMapResolution,t.shadow.mapSize.height=e.shadowMapResolution,t.shadow.bias=e.shadowMapBias,t.shadow.camera.updateProjectionMatrix()):t.castShadow=!1}if(e instanceof o.HemisphereLight){const t=r.children[0]instanceof a.HemisphereLight?r.children[0]:new a.HemisphereLight;0===r.children.length&&r.add(t),t.color=new a.Color(e.color),t.intensity=e.intensity,t.groundColor=new a.Color(e.groundColor)}if(e instanceof o.PointLight){const t=r.children[0]instanceof a.PointLight?r.children[0]:new a.PointLight;0===r.children.length&&r.add(t),t.color=new a.Color(e.color),t.intensity=e.intensity,t.distance=e.distance,t.decay=e.decay,t.position.set(e.position[0],e.position[1],e.position[2])}if(e instanceof o.SpotLight){const t=r.children[0]instanceof a.SpotLight?r.children[0]:new a.SpotLight(new a.Color(e.color),e.intensity,c.vec3.distance(e.position,e.target),e.angle,e.penumbra,e.decay);0===r.children.length&&r.add(t),n.add(t.target),t.position.set(e.position[0],e.position[1],e.position[2]),t.target.position.set(e.target[0],e.target[1],e.target[2])}t.add(r)}}},7840:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.MaterialLoader=void 0;const a=s(n(2212)),o=n(7038);t.MaterialLoader=class{constructor(e){this._renderingEngine=e,this._defaultColor="#00fff7",this._materialLibrary=[],this._blending=0,this._lightSizeUV=.025,this._envMap=null}assignEnvironmentMap(e){this._envMap=e;for(let t=0;t<this._materialLibrary.length;t++)this._materialLibrary[t].envMap=e,this._materialLibrary[t].needsUpdate=!0}load(e){const t={};e?(t.alphaTest=e.alphaCutoff,void 0!==e.shading&&(t.flatShading="smooth"!==e.shading),void 0!==e.alphaMap&&(t.alphaMap=this.createTexture(e.alphaMap),t.transparent=!0),void 0!==e.bumpMap&&(t.bumpMap=this.createTexture(e.bumpMap)),t.bumpScale=e.bumpScale,e.color&&(t.color=new a.Color(e.color)),e.color||e.map||(t.color=new a.Color(this._defaultColor)),e.emissiveness&&(t.emissive=new a.Color(e.emissiveness)),void 0!==e.emissiveMap&&(t.emissiveMap=this.createTexture(e.emissiveMap)),t.envMap=this._envMap,void 0!==e.map&&(t.map=this.createTexture(e.map)),t.metalness=e.metalness,t.roughness=e.roughness,void 0!==e.metalnessRoughnessMap?(t.metalnessMap=this.createTexture(e.metalnessRoughnessMap),t.roughnessMap=t.metalnessMap):(void 0!==e.metalnessMap&&(t.metalnessMap=this.createTexture(e.metalnessMap)),void 0!==e.roughnessMap&&(t.roughnessMap=this.createTexture(e.roughnessMap))),void 0!==e.normalMap&&(t.normalMap=this.createTexture(e.normalMap)),t.normalScale=new a.Vector2(e.normalScale,e.normalScale),t.side=a.DoubleSide):(t.color=new a.Color(this._defaultColor),t.side=a.DoubleSide);const n=new a.MeshStandardMaterial(t);return n.onBeforeCompile=e=>{e.uniforms.lightSizeUV={value:this._lightSizeUV},e.uniforms.blending={value:this._blending},n.userData.shader=e},n.needsUpdate=!0,this._materialLibrary.push(n),n}updateMaterials(){for(let e=0;e<this._materialLibrary.length;e++)this._materialLibrary[e].needsUpdate=!0}updateSoftShadow(e,t){this._lightSizeUV=e,this._blending=t;for(let n=0;n<this._materialLibrary.length;n++)this._materialLibrary[n].userData.shader&&(this._materialLibrary[n].userData.shader.uniforms.lightSizeUV.value=e,this._materialLibrary[n].userData.shader.uniforms.blending.value=t)}createTexture(e){const t=new a.Texture(e.image);return t.format=a.RGBAFormat,t.minFilter=(()=>{switch(e.minFilter){case o.TEXTURE_FILTERING.NEAREST:return a.NearestFilter;case o.TEXTURE_FILTERING.NEAREST_MIPMAP_NEAREST:return a.NearestMipMapNearestFilter;case o.TEXTURE_FILTERING.LINEAR_MIPMAP_NEAREST:return a.LinearMipMapNearestFilter;case o.TEXTURE_FILTERING.NEAREST_MIPMAP_LINEAR:return a.NearestMipMapLinearFilter;case o.TEXTURE_FILTERING.LINEAR:return a.LinearFilter;case o.TEXTURE_FILTERING.LINEAR_MIPMAP_LINEAR:default:return a.LinearMipMapLinearFilter}})(),t.magFilter=(()=>{switch(e.magFilter){case o.TEXTURE_FILTERING.NEAREST:return a.NearestFilter;case o.TEXTURE_FILTERING.LINEAR:default:return a.LinearFilter}})(),t.wrapS=(()=>{switch(e.wrapS){case o.TEXTURE_WRAPPING.CLAMP_TO_EDGE:return a.ClampToEdgeWrapping;case o.TEXTURE_WRAPPING.MIRRORED_REPEAT:return a.MirroredRepeatWrapping;case o.TEXTURE_WRAPPING.REPEAT:default:return a.RepeatWrapping}})(),t.wrapT=(()=>{switch(e.wrapT){case o.TEXTURE_WRAPPING.CLAMP_TO_EDGE:return a.ClampToEdgeWrapping;case o.TEXTURE_WRAPPING.MIRRORED_REPEAT:return a.MirroredRepeatWrapping;case o.TEXTURE_WRAPPING.REPEAT:default:return a.RepeatWrapping}})(),t.center=new a.Vector2(e.center[0],e.center[1]),t.offset=new a.Vector2(e.offset[0],e.offset[1]),t.repeat=new a.Vector2(e.repeat[0],e.repeat[1]),t.rotation=e.rotation,t.flipY=e.flipY,t.needsUpdate=!0,t}}},6714:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.entry=t.main=void 0,t.main="\n\nuniform float lightSizeUV;\nuniform float blending;\n\n#ifdef SHADOWMAP_TYPE_PCF\n\n#define NEAR_PLANE 0.1\n#define NUM_SAMPLES 20\n#define NUM_RINGS 11\n\nvec2 poissonDisk[NUM_SAMPLES];\n\nvoid initPoissonSamples( const in vec2 randomSeed ) {\n    float ANGLE_STEP = PI2 * float(NUM_RINGS) / float(NUM_SAMPLES);\n    float INV_NUM_SAMPLES = 1.0 / float(NUM_SAMPLES);\n\n    // jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/\n    float angle = rand(randomSeed) * PI2;\n    float radius = INV_NUM_SAMPLES;\n    float radiusStep = radius;\n\n    for (int i = 0; i < int(NUM_SAMPLES); i++ ) {\n        poissonDisk[i] = vec2(cos(angle), sin(angle)) * pow(radius, 0.75);\n        radius += radiusStep;\n        angle += ANGLE_STEP;\n    }\n}\n\nfloat penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation\n    return (zReceiver - zBlocker) / zBlocker;\n}\n\nfloat findBlocker(sampler2D shadowMap, const in vec2 uv, const in float zReceiver ) {\n    // This uses similar triangles to compute what\n    // area of the shadow map we should search\n    float searchRadius = lightSizeUV * (zReceiver - NEAR_PLANE) / zReceiver;\n    float blockerDepthSum = 0.0;\n    int numBlockers = 0;\n\n    for (int i = 0; i < int(NUM_SAMPLES); i++ ) {\n        float shadowMapDepth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[i] * searchRadius));\n        if (shadowMapDepth < zReceiver) {\n            blockerDepthSum += shadowMapDepth;\n            numBlockers++;\n        }\n    }\n\n    if (numBlockers == 0) return -1.0;\n\n    return blockerDepthSum / float(numBlockers);\n}\n\nfloat PCF_Filter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius) {\n    float sum = 0.0;\n    for (int i = 0; i < int(NUM_SAMPLES); i++ ) {\n        float depth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[i] * filterRadius));\n        if (zReceiver <= depth) sum += 1.0;\n    }\n    for (int i = 0; i < int(NUM_SAMPLES); i++ ) {\n        float depth = unpackRGBAToDepth(texture2D(shadowMap, uv + -poissonDisk[i].yx * filterRadius));\n        if (zReceiver <= depth) sum += 1.0;\n    }\n    return sum / (2.0 * float(NUM_SAMPLES));\n}\n\nfloat PCSS(sampler2D shadowMap, vec4 coords) {\n    vec2 uv = coords.xy;\n    float zReceiver = coords.z; // Assumed to be eye-space z in this code\n\n    initPoissonSamples(uv);\n    // STEP 1: blocker search\n    float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver);\n\n    //There are no occluders so early out (this saves filtering)\n    if (avgBlockerDepth == -1.0) return 1.0;\n\n    // STEP 2: penumbra size\n    float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);\n    float filterRadius = penumbraRatio * lightSizeUV * NEAR_PLANE / zReceiver;\n\n    // STEP 3: filtering\n    //return avgBlockerDepth;\n    return PCF_Filter(shadowMap, uv, zReceiver, filterRadius);\n}\n#endif\n",t.entry="\n// PCSS implementation\nvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\nfloat dx = texelSize.x;\nfloat dy = texelSize.y;\nvec2 uv = shadowCoord.xy;\nvec2 f = fract( uv * shadowMapSize + 0.5 );\nuv -= f * texelSize;\nfloat shadow1 = (\n    texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n    texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n    texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n    texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n    mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n         texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n         f.x ) +\n    mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n         texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n         f.x ) +\n    mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n         texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n         f.y ) +\n    mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n         texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n         f.y ) +\n    mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n              texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n              f.x ),\n         mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n              texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n              f.x ),\n         f.y )\n) * ( 1.0 / 9.0 );\nfloat shadow2 = PCSS( shadowMap, shadowCoord );\nshadow = shadow1 * (1.0 - blending) + blending * shadow2;\n            "},1169:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SDObject=void 0;const a=s(n(2212)),o=n(7038);class l extends a.Object3D{constructor(e,t){super(),this._SDid=e,this._SDversion=t,this._SDtype=o.SD_RENDERINGTYPE.THREEJS}applyTransformation(e){this.matrix.identity(),this.applyMatrix4((new a.Matrix4).fromArray(e))}get SDid(){return this._SDid}set SDid(e){this._SDid=e}get SDversion(){return this._SDversion}set SDversion(e){this._SDversion=e}get SDtype(){return this._SDtype}}t.SDObject=l},7787:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThreejsData=void 0;const i=n(3858);class r extends i.AbstractTreeNodeData{constructor(e,t){super(t),this._obj=e}get obj(){return this._obj}set obj(e){this._obj=e}clone(){return new r(this.obj.clone(),this._id)}}t.ThreejsData=r},8551:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraEngine=void 0;const i=n(8877),r=n(4562),s=n(2899),a=n(4976),o=n(5174),l=n(8926),c=n(8065),h=n(5904);t.CameraEngine=class{constructor(e,t){this._canvas=e,this._domEventEngine=t,this._cameras={},this._uuidGenerator=s.container.resolve(r.UuidGenerator),this._settingsEngine=s.container.resolve(i.SettingsEngine),this._stateEngine=s.container.resolve(i.StateEngine),this._eventEngine=s.container.resolve(i.EventEngine),this._boundingBox=new o.Box,this._settingsApplied=!1,this._eventEngine.addListener(i.EVENTTYPE.SCENE.SCENE_BOUNDING_BOX_CHANGE,(e=>{this._boundingBox=e.clone();for(let t in this._cameras)this._cameras[t].boundingBox=e.clone()}))}applySettings(){switch(this._settingsEngine.camera.cameraTypes.active.value){case 1:const e=this.createCamera(a.CAMERATYPE.ORTHOGRAPHIC,"default");e.direction=h.ORTHOGRAPHIC_CAMERA_DIRECTION.TOP,this.assignCamera(e.id);break;case 2:const t=this.createCamera(a.CAMERATYPE.ORTHOGRAPHIC,"default");t.direction=h.ORTHOGRAPHIC_CAMERA_DIRECTION.BOTTOM,this.assignCamera(t.id);break;case 3:const n=this.createCamera(a.CAMERATYPE.ORTHOGRAPHIC,"default");n.direction=h.ORTHOGRAPHIC_CAMERA_DIRECTION.RIGHT,this.assignCamera(n.id);break;case 4:const i=this.createCamera(a.CAMERATYPE.ORTHOGRAPHIC,"default");i.direction=h.ORTHOGRAPHIC_CAMERA_DIRECTION.LEFT,this.assignCamera(i.id);break;case 5:const r=this.createCamera(a.CAMERATYPE.ORTHOGRAPHIC,"default");r.direction=h.ORTHOGRAPHIC_CAMERA_DIRECTION.BACK,this.assignCamera(r.id);break;case 6:const s=this.createCamera(a.CAMERATYPE.ORTHOGRAPHIC,"default");s.direction=h.ORTHOGRAPHIC_CAMERA_DIRECTION.FRONT,this.assignCamera(s.id);break;default:const o=this.createCamera(a.CAMERATYPE.PERSPECTIVE,"default");this.assignCamera(o.id)}for(let e in this._cameras)this._cameras[e].applySettings();this._settingsApplied=!0}assignCamera(e){const t=this.getCamera(e);t&&(this._camera=t)}createCamera(e,t){const n=t||this._uuidGenerator.create();if(this._cameras[n]&&new Error("Camera with this id already exists."),a.CAMERATYPE.ORTHOGRAPHIC===e){const e=new c.OrthographicCamera(n,this._canvas.canvasElement);return this._domEventEngine.addDomEventListener(e.controls.cameraControlsEventDistribution),this._cameras[n]=e,e.boundingBox=this._boundingBox.clone(),this._settingsApplied?e.applySettings():e.zoomTo([],{duration:0}),e}{const e=new l.PerspectiveCamera(n,this._canvas.canvasElement);return this._domEventEngine.addDomEventListener(e.controls.cameraControlsEventDistribution),this._cameras[n]=e,e.boundingBox=this._boundingBox.clone(),this._settingsApplied?e.applySettings():e.zoomTo([],{duration:0}),e}}getCamera(e){if(!e)return this._camera?this._camera:null;return this._cameras[e]||null}getCameras(){const e={};for(let t in this._cameras)e[t]=this._cameras[t];return e}hasCamera(){return!!this._camera}}},3164:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractCamera=void 0;const r=n(887),s=n(8877),a=n(2899),o=n(5174);t.AbstractCamera=class{constructor(e,t){this._id=e,this._type=t,this._autoAdjust=!1,this._cameraMovementDuration=800,this._defaultPosition=r.vec3.create(),this._defaultTarget=r.vec3.create(),this._enableCameraControls=!0,this._far=1e3,this._near=1,this._revertAtMouseUp=!1,this._revertAtMouseUpDuration=800,this._zoomExtentsFactor=1,this._settingsEngine=a.container.resolve(s.SettingsEngine),this._stateEngine=a.container.resolve(s.StateEngine),this._boundingBox=new o.Box,this._position=r.vec3.create(),this._target=r.vec3.create(),this._updateCBs=[]}get autoAdjust(){return this._autoAdjust}set autoAdjust(e){this._autoAdjust=e,this._updateCBs.forEach((e=>e()))}set boundingBox(e){this._boundingBox=e,this._updateCBs.forEach((e=>e()))}get cameraMovementDuration(){return this._cameraMovementDuration}set cameraMovementDuration(e){this._cameraMovementDuration=e,this._updateCBs.forEach((e=>e()))}get controls(){return this._controls}get defaultPosition(){return this._defaultPosition}set defaultPosition(e){this._defaultPosition=e,this._updateCBs.forEach((e=>e()))}get defaultTarget(){return this._defaultTarget}set defaultTarget(e){this._defaultTarget=e,this._updateCBs.forEach((e=>e()))}get enableCameraControls(){return this._enableCameraControls}set enableCameraControls(e){this._enableCameraControls=e,this._updateCBs.forEach((e=>e()))}get far(){return this._far}set far(e){this._far=e,this._updateCBs.forEach((e=>e()))}get id(){return this._id}get near(){return this._near}set near(e){this._near=e,this._updateCBs.forEach((e=>e()))}get position(){return this._position}set position(e){this._position=e,this._controls.position=e,this._updateCBs.forEach((e=>e()))}get revertAtMouseUp(){return this._revertAtMouseUp}set revertAtMouseUp(e){this._revertAtMouseUp=e,this._updateCBs.forEach((e=>e()))}get revertAtMouseUpDuration(){return this._revertAtMouseUpDuration}set revertAtMouseUpDuration(e){this._revertAtMouseUpDuration=e,this._updateCBs.forEach((e=>e()))}get target(){return this._target}set target(e){this._target=e,this._controls.target=e,this._updateCBs.forEach((e=>e()))}get type(){return this._type}get zoomExtentsFactor(){return this._zoomExtentsFactor}set zoomExtentsFactor(e){this._zoomExtentsFactor=e,this._updateCBs.forEach((e=>e()))}animate(e,t){return i(this,void 0,void 0,(function*(){if(0===e.length)return Promise.resolve(!1);if(!this._controls.isWithinRestrictions(e[e.length-1].position,e[e.length-1].target))return Promise.resolve(!1);t||(t={}),t.duration=t.duration>=0?t.duration:this.cameraMovementDuration;const n=yield this._controls.animate(e,t);return n&&(this._position=this._controls.position,this._target=this._controls.target),n}))}reset(e){return r.vec3.equals(r.vec3.create(),this.defaultPosition)&&r.vec3.equals(r.vec3.create(),this.defaultTarget)?this.zoomTo([],e):this.set(r.vec3.clone(this.defaultPosition),r.vec3.clone(this.defaultTarget),e)}set(e,t,n){return i(this,void 0,void 0,(function*(){if(!this._controls.isWithinRestrictions(e,t))return Promise.resolve(!1);n||(n={}),n.duration=n.duration>=0?n.duration:this.cameraMovementDuration;const i=yield this._controls.animate([{position:r.vec3.clone(this.position),target:r.vec3.clone(this.target)},{position:e,target:t}],n);return i&&(this._position=this._controls.position,this._target=this._controls.target),i}))}update(e){const{position:t,target:n}=this._controls.update(e);return this.position=r.vec3.clone(t),this.target=r.vec3.clone(n),{position:t,target:n}}zoomTo(e,t){const{position:n,target:i}=this.getZoomPositionAndTarget(e);return this.set(n,i,t)}addUpdateCB(e){this._updateCBs.push(e)}}},8065:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OrthographicCamera=void 0;const r=n(4562),s=n(2899),a=n(4976),o=n(3164),l=n(887),c=n(8210),h=n(5174),u=n(5904);class d extends o.AbstractCamera{constructor(e,t){super(e,a.CAMERATYPE.ORTHOGRAPHIC),this._converter=s.container.resolve(r.Converter),this._bottom=100,this._left=100,this._right=100,this._top=100,this._direction=u.ORTHOGRAPHIC_CAMERA_DIRECTION.TOP,this._controls=new c.OrthographicCameraControls(this,t,!0)}get bottom(){return this._bottom}set bottom(e){this._bottom=e}get direction(){return this._direction}set direction(e){this._direction=e,this._updateCBs.forEach((e=>e()))}get left(){return this._left}set left(e){this._left=e}get right(){return this._right}set right(e){this._right=e}get top(){return this._top}set top(e){this._top=e}applySettings(){this.autoAdjust=this._settingsEngine.camera.autoAdjust.value,this.cameraMovementDuration=this._settingsEngine.camera.cameraMovementDuration.value,this.enableCameraControls=this._settingsEngine.camera.enableCameraControls.value,this.revertAtMouseUp=this._settingsEngine.camera.revertAtMouseUp.value,this.revertAtMouseUpDuration=this._settingsEngine.camera.revertAtMouseUpDuration.value,this.zoomExtentsFactor=this._settingsEngine.camera.zoomExtentsFactor.value;let e=this._converter.toVec3(this._settingsEngine.camera.cameraTypes.orthographic.default.value.position),t=this._converter.toVec3(this._settingsEngine.camera.cameraTypes.orthographic.default.value.target);this.defaultPosition=l.vec3.clone(e),this.defaultTarget=l.vec3.clone(t),this.position=e,this.target=t,l.vec3.equals(e,t)&&this._stateEngine.boundingBoxCreated.then((()=>i(this,void 0,void 0,(function*(){yield this.zoomTo([],{duration:0}),this.defaultPosition=l.vec3.clone(this._controls.position),this.defaultTarget=l.vec3.clone(this._controls.target)})))),this._controls.applySettings()}getZoomPositionAndTarget(e){let t;t=e&&e instanceof h.Box?e:this._boundingBox.clone();const n=2*t.boundingSphere.radius*this.zoomExtentsFactor,i=l.vec3.clone(t.boundingSphere.center),r=.01;switch(this._direction){case u.ORTHOGRAPHIC_CAMERA_DIRECTION.TOP:return{position:l.vec3.fromValues(i[0],i[1]-r,i[2]+n),target:l.vec3.clone(i)};case u.ORTHOGRAPHIC_CAMERA_DIRECTION.BOTTOM:return{position:l.vec3.fromValues(i[0],i[1]-r,i[2]-n),target:l.vec3.clone(i)};case u.ORTHOGRAPHIC_CAMERA_DIRECTION.RIGHT:return{position:l.vec3.fromValues(i[0]+n,i[1],i[2]-r),target:l.vec3.clone(i)};case u.ORTHOGRAPHIC_CAMERA_DIRECTION.LEFT:return{position:l.vec3.fromValues(i[0]-n,i[1],i[2]-r),target:l.vec3.clone(i)};case u.ORTHOGRAPHIC_CAMERA_DIRECTION.BACK:return{position:l.vec3.fromValues(i[0]-r,i[1]+n,i[2]),target:l.vec3.clone(i)};case u.ORTHOGRAPHIC_CAMERA_DIRECTION.FRONT:return{position:l.vec3.fromValues(i[0]-r,i[1]-n,i[2]),target:l.vec3.clone(i)};default:return{position:l.vec3.fromValues(i[0],i[1]-r,i[2]+n),target:l.vec3.clone(i)}}}project(e){const t=l.mat4.targetTo(l.mat4.create(),this.position,this.target,l.vec3.fromValues(0,0,1)),n=l.mat4.ortho(l.mat4.create(),this.left,this.right,this.bottom,this.top,this.near,this.far);return l.vec3.transformMat4(e,e,l.mat4.invert(t,t)),l.vec3.transformMat4(e,e,n),l.vec2.fromValues(e[0],e[1])}}t.OrthographicCamera=d},8926:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PerspectiveCamera=void 0;const r=n(4562),s=n(2899),a=n(4976),o=n(3164),l=n(887),c=n(9599),h=n(5174);class u extends o.AbstractCamera{constructor(e,t){super(e,a.CAMERATYPE.PERSPECTIVE),this._converter=s.container.resolve(r.Converter),this._aspect=60,this._fov=60,this._controls=new c.PerspectiveCameraControls(this,t,!0)}get aspect(){return this._aspect}set aspect(e){this._aspect=e}get fov(){return this._fov}set fov(e){this._fov=e,this._updateCBs.forEach((e=>e()))}applySettings(){this.autoAdjust=this._settingsEngine.camera.autoAdjust.value,this.cameraMovementDuration=this._settingsEngine.camera.cameraMovementDuration.value,this.enableCameraControls=this._settingsEngine.camera.enableCameraControls.value,this.revertAtMouseUp=this._settingsEngine.camera.revertAtMouseUp.value,this.revertAtMouseUpDuration=this._settingsEngine.camera.revertAtMouseUpDuration.value,this.zoomExtentsFactor=this._settingsEngine.camera.zoomExtentsFactor.value;let e=this._converter.toVec3(this._settingsEngine.camera.cameraTypes.perspective.default.value.position),t=this._converter.toVec3(this._settingsEngine.camera.cameraTypes.perspective.default.value.target);this.defaultPosition=l.vec3.clone(e),this.defaultTarget=l.vec3.clone(t),this.position=e,this.target=t,l.vec3.equals(e,t)&&this._stateEngine.boundingBoxCreated.then((()=>i(this,void 0,void 0,(function*(){yield this.zoomTo([],{duration:0}),this.defaultPosition=l.vec3.clone(this._controls.position),this.defaultTarget=l.vec3.clone(this._controls.target)})))),this.fov=this._settingsEngine.camera.cameraTypes.perspective.fov.value,this._controls.applySettings()}getZoomPositionAndTarget(e){let t;t=e&&e instanceof h.Box?e:this._boundingBox.clone();let n=l.vec3.fromValues((t.max[0]+t.min[0])/2,(t.max[1]+t.min[1])/2,(t.max[2]+t.min[2])/2);l.vec3.equals(this.position,this.target)&&(this.position=l.vec3.fromValues(0,-7.5,n[2]+5));const i=l.vec3.subtract(l.vec3.create(),t.max,n);l.vec3.multiply(i,i,l.vec3.fromValues(this.zoomExtentsFactor,this.zoomExtentsFactor,this.zoomExtentsFactor)),t=new h.Box(l.vec3.subtract(l.vec3.create(),n,i),l.vec3.add(l.vec3.create(),n,i));const r=l.vec3.normalize(l.vec3.create(),l.vec3.subtract(l.vec3.create(),n,this.position));let s=l.vec3.normalize(l.vec3.create(),l.vec3.cross(l.vec3.create(),l.vec3.fromValues(0,0,1),r)),a=l.vec3.normalize(l.vec3.create(),l.vec3.cross(l.vec3.create(),s,r)),o=l.vec3.add(l.vec3.create(),n,l.vec3.multiply(l.vec3.create(),r,l.vec3.fromValues(-1,-1,-1))),c=[];c.push(l.vec3.fromValues(t.min[0],t.min[1],t.min[2])),c.push(l.vec3.fromValues(t.min[0],t.min[1],t.max[2])),c.push(l.vec3.fromValues(t.min[0],t.max[1],t.min[2])),c.push(l.vec3.fromValues(t.min[0],t.max[1],t.max[2])),c.push(l.vec3.fromValues(t.max[0],t.min[1],t.min[2])),c.push(l.vec3.fromValues(t.max[0],t.min[1],t.max[2])),c.push(l.vec3.fromValues(t.max[0],t.max[1],t.min[2])),c.push(l.vec3.fromValues(t.max[0],t.max[1],t.max[2]));let u=l.vec3.transformQuat(l.vec3.create(),r,l.quat.setAxisAngle(l.quat.create(),s,this.fov/2*(Math.PI/180))),d=l.vec3.transformQuat(l.vec3.create(),r,l.quat.setAxisAngle(l.quat.create(),s,-this.fov/2*(Math.PI/180))),p=2*Math.atan(Math.tan(this.fov*Math.PI/180/2)*this.aspect),f=l.vec3.transformQuat(l.vec3.create(),r,l.quat.setAxisAngle(l.quat.create(),a,p/2)),m=l.vec3.transformQuat(l.vec3.create(),r,l.quat.setAxisAngle(l.quat.create(),a,-p/2)),g=new h.Plane(l.vec3.clone(s),0);g.setFromNormalAndCoplanarPoint(l.vec3.clone(s),l.vec3.clone(n));let v=new h.Plane(l.vec3.fromValues(0,0,1),0);v.setFromNormalAndCoplanarPoint(l.vec3.clone(a),l.vec3.clone(n));let _=0;for(let e=0;e<c.length;e++){let t=g.clampPoint(c[e]),i=l.vec3.normalize(l.vec3.create(),l.vec3.subtract(l.vec3.create(),t,o));if(l.vec3.dot(r,u)>l.vec3.dot(r,i)){const e=l.vec3.multiply(l.vec3.create(),l.vec3.dot(u,i)>l.vec3.dot(d,i)?u:d,l.vec3.fromValues(-1,-1,-1)),r=v.intersect(t,e);if(r){const i=l.vec3.add(l.vec3.create(),l.vec3.multiply(l.vec3.create(),e,l.vec3.fromValues(r,r,r)),t);_=Math.max(_,l.vec3.distance(n,i))}}if(t=v.clampPoint(c[e]),i=l.vec3.normalize(l.vec3.create(),l.vec3.subtract(l.vec3.create(),t,o)),l.vec3.dot(r,f)>l.vec3.dot(r,i)){const e=l.vec3.multiply(l.vec3.create(),l.vec3.dot(f,i)>l.vec3.dot(m,i)?f:m,l.vec3.fromValues(-1,-1,-1)),r=g.intersect(t,e);if(r){const i=l.vec3.add(l.vec3.create(),l.vec3.multiply(l.vec3.create(),e,l.vec3.fromValues(r,r,r)),t);_=Math.max(_,l.vec3.distance(n,i))}}}return o=l.vec3.add(l.vec3.create(),n,l.vec3.multiply(l.vec3.create(),r,l.vec3.fromValues(-_,-_,-_))),{position:o,target:n}}project(e,t=this.position,n=this.target){const i=l.mat4.targetTo(l.mat4.create(),t,n,l.vec3.fromValues(0,0,1)),r=l.mat4.perspective(l.mat4.create(),this.fov/(180/Math.PI),this.aspect,this.near,this.far);return l.vec3.transformMat4(e,e,l.mat4.invert(i,i)),l.vec3.transformMat4(e,e,r),l.vec2.fromValues(e[0],e[1])}}t.PerspectiveCamera=u},7938:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractCameraControls=void 0;const i=n(887),r=n(8877),s=n(2899),a=n(1179);t.AbstractCameraControls=class{constructor(e,t,n,o){this._camera=e,this._canvas=t,this._enabled=n,this._eventEngine=s.container.resolve(r.EventEngine),this._manualInteraction=!1,this._moving=!1,this._movingDuration=0,this._nonmanualInteraction=!1,this._position=i.vec3.create(),this._target=i.vec3.create(),this._cameraInterpolationManager=new a.CameraInterpolationManager(this._camera,this),this._manualInteractionTransformations={position:[],target:[]},this._nonmanualInteractionTransformations={position:[],target:[]}}get cameraControlsEventDistribution(){return this._cameraControlsEventDistribution}get canvas(){return this._canvas}set canvas(e){this._canvas=e}get enabled(){return this._enabled}set enabled(e){e||(this._manualInteraction=!1,this._manualInteractionTransformations={position:[],target:[]},this._nonmanualInteraction=!1,this._nonmanualInteractionTransformations={position:[],target:[]},this._cameraControlsEventDistribution.reset(),this._cameraLogic.reset()),this._enabled=e}get camera(){return this._camera}set camera(e){this._camera=e}get position(){return this._position}set position(e){this._position=e}get target(){return this._target}set target(e){this._target=e}animate(e,t){return t&&0===t.duration?(this._position=e[e.length-1].position,this._target=e[e.length-1].target,new Promise((e=>e(!0)))):(this._manualInteraction=!1,this._manualInteractionTransformations={position:[],target:[]},this._cameraInterpolationManager.interpolate(e,t))}applyPositionVector(e,t){this._manualInteraction||t?(this._manualInteraction=!0,this._manualInteractionTransformations.position.push({vector:e})):(this._nonmanualInteraction=!0,this._nonmanualInteractionTransformations.position.push({vector:e}))}applyTargetVector(e,t){this._manualInteraction||t?(this._manualInteraction=!0,this._manualInteractionTransformations.target.push({vector:e})):(this._nonmanualInteraction=!0,this._nonmanualInteractionTransformations.target.push({vector:e}))}applyPositionMatrix(e,t){this._manualInteraction||t?(this._manualInteraction=!0,this._manualInteractionTransformations.position.push({matrix:e})):(this._nonmanualInteraction=!0,this._nonmanualInteractionTransformations.position.push({matrix:e}))}applyTargetMatrix(e,t){this._manualInteraction||t?(this._manualInteraction=!0,this._manualInteractionTransformations.target.push({matrix:e})):(this._nonmanualInteraction=!0,this._nonmanualInteractionTransformations.target.push({matrix:e}))}applyUpMatrix(e,t){throw new Error("Method not implemented.")}getPositionWithManualUpdates(){let e=i.vec3.clone(this._position);if(this._manualInteraction)for(let t=this._manualInteractionTransformations.position.length-1;t>=0;t--)e=this._manualInteractionTransformations.position[t].matrix?i.vec3.transformMat4(e,e,this._manualInteractionTransformations.position[t].matrix):i.vec3.add(e,e,this._manualInteractionTransformations.position[t].vector);return e}getTargetWithManualUpdates(){let e=i.vec3.clone(this._target);if(this._manualInteraction)for(let t=this._manualInteractionTransformations.target.length-1;t>=0;t--)e=this._manualInteractionTransformations.target[t].matrix?i.vec3.transformMat4(e,e,this._manualInteractionTransformations.target[t].matrix):i.vec3.add(e,e,this._manualInteractionTransformations.target[t].vector);return e}getPositionWithUpdates(){return this.getPosition()}getTargetWithUpdates(){return this.getTarget()}isMoving(){return this._manualInteraction||this._nonmanualInteraction}isWithinRestrictions(e,t){return this._cameraLogic.isWithinRestrictions(e,t)}reset(){this._cameraControlsEventDistribution.reset(),this._cameraLogic.reset()}update(e){if(!this._enabled)return{position:i.vec3.clone(this._position),target:i.vec3.clone(this._target)};!0===this._manualInteraction&&this._cameraInterpolationManager.active()&&this._cameraInterpolationManager.stop();let{position:t,target:n}=this._cameraLogic.restrict(this.getPosition(),this.getTarget());this._position=i.vec3.clone(t),this._target=i.vec3.clone(n),this._manualInteraction=!1,this._manualInteractionTransformations={position:[],target:[]},this._nonmanualInteraction=this._cameraInterpolationManager.active(),this._nonmanualInteractionTransformations={position:[],target:[]},this._cameraLogic.update(e,this._nonmanualInteraction);const s=this._moving,a={position:i.vec3.clone(this._position),target:i.vec3.clone(this._target)};switch(this._movingDuration+=e,this._moving=this._manualInteraction||this._nonmanualInteraction,!0){case s!==this._moving&&!0===this._moving:this._eventEngine.emitEvent(r.EVENTTYPE.CAMERA.CAMERA_START,{cameraDefinition:a,movementDuration:0});break;case s!==this._moving&&!1===this._moving:this._eventEngine.emitEvent(r.EVENTTYPE.CAMERA.CAMERA_END,{cameraDefinition:a,movementDuration:this._movingDuration});break;default:this._eventEngine.emitEvent(r.EVENTTYPE.CAMERA.CAMERA_MOVE,{cameraDefinition:a,movementDuration:this._movingDuration})}return this._moving||(this._movingDuration=0),a}getPosition(){let e=i.vec3.clone(this._position);if(this._manualInteraction)for(let t=this._manualInteractionTransformations.position.length-1;t>=0;t--)e=this._manualInteractionTransformations.position[t].matrix?i.vec3.transformMat4(e,e,this._manualInteractionTransformations.position[t].matrix):i.vec3.add(e,e,this._manualInteractionTransformations.position[t].vector);else if(this._nonmanualInteraction)for(let t=this._nonmanualInteractionTransformations.position.length-1;t>=0;t--)e=this._nonmanualInteractionTransformations.position[t].matrix?i.vec3.transformMat4(e,e,this._nonmanualInteractionTransformations.position[t].matrix):i.vec3.add(e,e,this._nonmanualInteractionTransformations.position[t].vector);return e}getTarget(){let e=i.vec3.clone(this._target);if(this._manualInteraction)for(let t=this._manualInteractionTransformations.target.length-1;t>=0;t--)e=this._manualInteractionTransformations.target[t].matrix?i.vec3.transformMat4(e,e,this._manualInteractionTransformations.target[t].matrix):i.vec3.add(e,e,this._manualInteractionTransformations.target[t].vector);else if(this._nonmanualInteraction)for(let t=this._nonmanualInteractionTransformations.target.length-1;t>=0;t--)e=this._nonmanualInteractionTransformations.target[t].matrix?i.vec3.transformMat4(e,e,this._nonmanualInteractionTransformations.target[t].matrix):i.vec3.add(e,e,this._nonmanualInteractionTransformations.target[t].vector);return e}}},8210:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrthographicCameraControls=void 0;const i=n(8877),r=n(2899),s=n(1990),a=n(7938),o=n(704),l=n(3726);class c extends a.AbstractCameraControls{constructor(e,t,n){super(e,t,n,s.CAMERATYPE.ORTHOGRAPHIC),this._damping=.1,this._enableKeyPan=!1,this._enablePan=!0,this._enableZoom=!0,this._input={keys:{up:38,down:40,left:37,right:39},mouse:{rotate:0,zoom:1,pan:2},touch:{rotate:1,zoom:2,pan:3}},this._keyPanSpeed=.5,this._movementSmoothness=.5,this._panSpeed=.5,this._zoomSpeed=.5,this._updateCBs=[],this._settingsEngine=r.container.resolve(i.SettingsEngine),this._stateEngine=r.container.resolve(i.StateEngine),this._cameraLogic=new l.CameraControlsLogic(this),this._cameraControlsEventDistribution=new o.CameraControlsEventDistribution(this,this._cameraLogic)}applySettings(){this.damping=this._settingsEngine.cameraOrthographicControls.damping.value,this.enableKeyPan=this._settingsEngine.cameraOrthographicControls.enableKeyPan.value,this.enablePan=this._settingsEngine.cameraOrthographicControls.enablePan.value,this.enableZoom=this._settingsEngine.cameraOrthographicControls.enableZoom.value,this.input=this._settingsEngine.cameraOrthographicControls.input.value,this.keyPanSpeed=this._settingsEngine.cameraOrthographicControls.keyPanSpeed.value,this.movementSmoothness=this._settingsEngine.cameraOrthographicControls.movementSmoothness.value,this.panSpeed=this._settingsEngine.cameraOrthographicControls.panSpeed.value,this.zoomSpeed=this._settingsEngine.cameraOrthographicControls.zoomSpeed.value}get damping(){return this._damping}set damping(e){this._damping=e,this._updateCBs.forEach((e=>e()))}get enableKeyPan(){return this._enableKeyPan}set enableKeyPan(e){this._enableKeyPan=e,this._updateCBs.forEach((e=>e()))}get enablePan(){return this._enablePan}set enablePan(e){this._enablePan=e,this._updateCBs.forEach((e=>e()))}get enableZoom(){return this._enableZoom}set enableZoom(e){this._enableZoom=e,this._updateCBs.forEach((e=>e()))}get input(){return this._input}set input(e){this._input=e,this._updateCBs.forEach((e=>e()))}get keyPanSpeed(){return this._keyPanSpeed}set keyPanSpeed(e){this._keyPanSpeed=e,this._updateCBs.forEach((e=>e()))}get movementSmoothness(){return this._movementSmoothness}set movementSmoothness(e){this._movementSmoothness=e,this._updateCBs.forEach((e=>e()))}get panSpeed(){return this._panSpeed}set panSpeed(e){this._panSpeed=e,this._updateCBs.forEach((e=>e()))}get zoomSpeed(){return this._zoomSpeed}set zoomSpeed(e){this._zoomSpeed=e,this._updateCBs.forEach((e=>e()))}addUpdateCB(e){this._updateCBs.push(e)}}t.OrthographicCameraControls=c},9599:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerspectiveCameraControls=void 0;const i=n(8877),r=n(4562),s=n(887),a=n(2899),o=n(1990),l=n(7938),c=n(5173),h=n(3118);class u extends l.AbstractCameraControls{constructor(e,t,n){super(e,t,n,o.CAMERATYPE.PERSPECTIVE),this._autoRotationSpeed=0,this._cubePositionRestriction={min:s.vec3.fromValues(-1/0,-1/0,-1/0),max:s.vec3.fromValues(1/0,1/0,1/0)},this._cubeTargetRestriction={min:s.vec3.fromValues(-1/0,-1/0,-1/0),max:s.vec3.fromValues(1/0,1/0,1/0)},this._damping=.1,this._enableAutoRotation=!1,this._enableKeyPan=!1,this._enablePan=!0,this._enableRotation=!0,this._enableZoom=!0,this._input={keys:{up:38,down:40,left:37,right:39},mouse:{rotate:0,zoom:1,pan:2},touch:{rotate:1,zoom:2,pan:3}},this._keyPanSpeed=.5,this._movementSmoothness=.5,this._panSpeed=.5,this._rotationRestriction={minPolarAngle:0,maxPolarAngle:180,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0},this._rotationSpeed=.5,this._spherePositionRestriction={center:s.vec3.create(),radius:1/0},this._sphereTargetRestriction={center:s.vec3.create(),radius:1/0},this._zoomRestriction={minDistance:0,maxDistance:1/0},this._zoomSpeed=.5,this._updateCBs=[],this._converter=a.container.resolve(r.Converter),this._settingsEngine=a.container.resolve(i.SettingsEngine),this._stateEngine=a.container.resolve(i.StateEngine),this._cameraLogic=new h.CameraControlsLogic(this),this._cameraControlsEventDistribution=new c.CameraControlsEventDistribution(this,this._cameraLogic)}applySettings(){this.autoRotationSpeed=this._settingsEngine.cameraOrbitControls.autoRotationSpeed.value,this.damping=this._settingsEngine.cameraOrbitControls.damping.value,this.enableAutoRotation=this._settingsEngine.cameraOrbitControls.enableAutoRotation.value,this.enableKeyPan=this._settingsEngine.cameraOrbitControls.enableKeyPan.value,this.enablePan=this._settingsEngine.cameraOrbitControls.enablePan.value,this.enableRotation=this._settingsEngine.cameraOrbitControls.enableRotation.value,this.enableZoom=this._settingsEngine.cameraOrbitControls.enableZoom.value,this.input=this._settingsEngine.cameraOrbitControls.input.value,this.keyPanSpeed=this._settingsEngine.cameraOrbitControls.keyPanSpeed.value,this.movementSmoothness=this._settingsEngine.cameraOrbitControls.movementSmoothness.value,this.rotationSpeed=this._settingsEngine.cameraOrbitControls.rotationSpeed.value,this.panSpeed=this._settingsEngine.cameraOrbitControls.panSpeed.value,this.zoomSpeed=this._settingsEngine.cameraOrbitControls.zoomSpeed.value,this.cubePositionRestriction={min:this._converter.toVec3(this._settingsEngine.cameraOrbitControls.restrictions.position.cube.value.min),max:this._converter.toVec3(this._settingsEngine.cameraOrbitControls.restrictions.position.cube.value.max)},this.spherePositionRestriction={center:this._converter.toVec3(this._settingsEngine.cameraOrbitControls.restrictions.position.sphere.value.center),radius:this._settingsEngine.cameraOrbitControls.restrictions.position.sphere.value.radius},this.cubeTargetRestriction={min:this._converter.toVec3(this._settingsEngine.cameraOrbitControls.restrictions.target.cube.value.min),max:this._converter.toVec3(this._settingsEngine.cameraOrbitControls.restrictions.target.cube.value.max)},this.sphereTargetRestriction={center:this._converter.toVec3(this._settingsEngine.cameraOrbitControls.restrictions.target.sphere.value.center),radius:this._settingsEngine.cameraOrbitControls.restrictions.target.sphere.value.radius},this.rotationRestriction=this._settingsEngine.cameraOrbitControls.restrictions.rotation.value,this.zoomRestriction=this._settingsEngine.cameraOrbitControls.restrictions.zoom.value}get autoRotationSpeed(){return this._autoRotationSpeed}set autoRotationSpeed(e){this._autoRotationSpeed=e,this._updateCBs.forEach((e=>e()))}get cubePositionRestriction(){return this._cubePositionRestriction}set cubePositionRestriction(e){this._cubePositionRestriction=e,this._updateCBs.forEach((e=>e()))}get cubeTargetRestriction(){return this._cubeTargetRestriction}set cubeTargetRestriction(e){this._cubeTargetRestriction=e,this._updateCBs.forEach((e=>e()))}get damping(){return this._damping}set damping(e){this._damping=e,this._updateCBs.forEach((e=>e()))}get enableAutoRotation(){return this._enableAutoRotation}set enableAutoRotation(e){this._enableAutoRotation=e,this._updateCBs.forEach((e=>e()))}get enableKeyPan(){return this._enableKeyPan}set enableKeyPan(e){this._enableKeyPan=e,this._updateCBs.forEach((e=>e()))}get enablePan(){return this._enablePan}set enablePan(e){this._enablePan=e,this._updateCBs.forEach((e=>e()))}get enableRotation(){return this._enableRotation}set enableRotation(e){this._enableRotation=e,this._updateCBs.forEach((e=>e()))}get enableZoom(){return this._enableZoom}set enableZoom(e){this._enableZoom=e,this._updateCBs.forEach((e=>e()))}get input(){return this._input}set input(e){this._input=e,this._updateCBs.forEach((e=>e()))}get keyPanSpeed(){return this._keyPanSpeed}set keyPanSpeed(e){this._keyPanSpeed=e,this._updateCBs.forEach((e=>e()))}get movementSmoothness(){return this._movementSmoothness}set movementSmoothness(e){this._movementSmoothness=e,this._updateCBs.forEach((e=>e()))}get panSpeed(){return this._panSpeed}set panSpeed(e){this._panSpeed=e,this._updateCBs.forEach((e=>e()))}get rotationRestriction(){return this._rotationRestriction}set rotationRestriction(e){this._rotationRestriction=e,this._updateCBs.forEach((e=>e()))}get rotationSpeed(){return this._rotationSpeed}set rotationSpeed(e){this._rotationSpeed=e,this._updateCBs.forEach((e=>e()))}get spherePositionRestriction(){return this._spherePositionRestriction}set spherePositionRestriction(e){this._spherePositionRestriction=e,this._updateCBs.forEach((e=>e()))}get sphereTargetRestriction(){return this._sphereTargetRestriction}set sphereTargetRestriction(e){this._sphereTargetRestriction=e,this._updateCBs.forEach((e=>e()))}get zoomRestriction(){return this._zoomRestriction}set zoomRestriction(e){this._zoomRestriction=e,this._updateCBs.forEach((e=>e()))}get zoomSpeed(){return this._zoomSpeed}set zoomSpeed(e){this._zoomSpeed=e,this._updateCBs.forEach((e=>e()))}addUpdateCB(e){this._updateCBs.push(e)}}t.PerspectiveCameraControls=u},704:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraControlsEventDistribution=void 0,t.CameraControlsEventDistribution=class{constructor(e,t){this._controls=e,this._cameraLogic=t,this._active={zoom:!1,pan:!1}}onDown(e){let{x:t,y:n}=this.convertInput(e),i=window.TouchEvent&&e instanceof TouchEvent?e.touches.length:e.button,r=window.TouchEvent&&e instanceof TouchEvent?this._controls.input.touch:this._controls.input.mouse;if(i===r.pan&&this._controls.enablePan&&(this._cameraLogic.pan(t,n,this._active.pan,window.TouchEvent&&e instanceof TouchEvent),this._active.pan=!0,this._active.zoom=!1),i===r.zoom&&this._controls.enableZoom){let i=t,r=n;window.TouchEvent&&e instanceof TouchEvent&&2===this._controls.input.touch.zoom&&(i=(e.touches[0].pageX-e.touches[1].pageX)/window.innerWidth*(window.innerWidth/window.innerHeight),r=(e.touches[0].pageY-e.touches[1].pageY)/window.innerHeight),this._cameraLogic.zoom(i,r,this._active.zoom,window.TouchEvent&&e instanceof TouchEvent),this._active.pan=!1,this._active.zoom=!0}}onKey(e){if(this._controls.enableKeyPan)switch(e.keyCode){case this._controls.input.keys.up:this._cameraLogic.pan(0,0,!1,!1),this._cameraLogic.pan(0,.05*this._controls.keyPanSpeed,!0,!1),e.preventDefault(),e.stopPropagation();break;case this._controls.input.keys.down:this._cameraLogic.pan(0,0,!1,!1),this._cameraLogic.pan(0,.05*-this._controls.keyPanSpeed,!0,!1),e.preventDefault(),e.stopPropagation();break;case this._controls.input.keys.left:this._cameraLogic.pan(0,0,!1,!1),this._cameraLogic.pan(.05*this._controls.keyPanSpeed,0,!0,!1),e.preventDefault(),e.stopPropagation();break;case this._controls.input.keys.right:this._cameraLogic.pan(0,0,!1,!1),this._cameraLogic.pan(.05*-this._controls.keyPanSpeed,0,!0,!1),e.preventDefault(),e.stopPropagation()}}onKeyDown(e){this.onKey(e)}onMouseDown(e){this.onDown(e)}onMouseMove(e){this.onMove(e)}onMouseUp(e){this.onUp(e)}onMouseWheel(e){this.onWheel(e)}onMove(e){let{x:t,y:n}=this.convertInput(e);if(this._controls.enablePan&&this._active.pan&&this._cameraLogic.pan(t,n,this._active.pan,window.TouchEvent&&e instanceof TouchEvent),this._controls.enableZoom&&this._active.zoom){let i=t,r=n;window.TouchEvent&&e instanceof TouchEvent&&2===this._controls.input.touch.zoom&&(i=(e.touches[0].pageX-e.touches[1].pageX)/window.innerWidth*(window.innerWidth/window.innerHeight),r=(e.touches[0].pageY-e.touches[1].pageY)/window.innerHeight),this._cameraLogic.zoom(i,r,this._active.zoom,window.TouchEvent&&e instanceof TouchEvent)}}onTouchEnd(e){this.onUp(e)}onTouchMove(e){this.onMove(e)}onTouchStart(e){this.onDown(e)}onUp(e){this._active.zoom=!1,this._active.pan=!1}onWheel(e){if(!this._controls.enableZoom)return;let t=0;void 0!==e.deltaY?t=-e.deltaY:void 0!==e.detail&&(t=-e.detail),Math.sign(t)>0?(this._cameraLogic.zoom(0,0,!1,!1),this._cameraLogic.zoom(1,0,!0,!1)):(this._cameraLogic.zoom(1,0,!1,!1),this._cameraLogic.zoom(0,0,!0,!1))}reset(){this._active={zoom:!1,pan:!1}}convertInput(e){let t=window.innerWidth/window.innerHeight;return e instanceof MouseEvent?{x:e.clientX/window.innerWidth*t,y:e.clientY/window.innerHeight}:{x:e.touches[0].pageX/window.innerWidth*t,y:e.touches[0].pageY/window.innerHeight}}}},3726:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraControlsLogic=void 0;const i=n(887);t.CameraControlsLogic=class{constructor(e){this._controls=e,this._adjustedSettings={damping:()=>this._controls.damping*this._settingsAdjustments.damping,movementSmoothness:()=>this._controls.movementSmoothness*this._settingsAdjustments.movementSmoothness,panSpeed:()=>this._controls.panSpeed*this._settingsAdjustments.panSpeed,zoomSpeed:()=>this._controls.zoomSpeed*this._settingsAdjustments.zoomSpeed},this._damping={rotation:{time:0,duration:0,theta:0,phi:0},zoom:{time:0,duration:0,delta:0},pan:{time:0,duration:0,offset:i.vec3.create()}},this._dollyDelta=0,this._dollyEnd=0,this._dollyStart=0,this._panDelta=i.vec2.create(),this._panEnd=i.vec2.create(),this._panStart=i.vec2.create(),this._settingsAdjustments={damping:1,movementSmoothness:1,panSpeed:2,zoomSpeed:.025},this._touchAdjustments={damping:1,movementSmoothness:1,panSpeed:2,zoomSpeed:50}}isWithinRestrictions(e,t){return!0}pan(e,t,n,r){if(r&&(e/=window.devicePixelRatio,t/=window.devicePixelRatio),n){if(this._panEnd=i.vec2.fromValues(e,t),i.vec2.sub(this._panDelta,this._panEnd,this._panStart),0===this._panDelta[0]&&0===this._panDelta[1])return;const n=this._adjustedSettings.panSpeed()*(r?this._touchAdjustments.panSpeed:1);let s=this.panDeltaToOffset(i.vec2.mul(i.vec2.create(),this._panDelta,i.vec2.fromValues(n,n)));this._damping.pan.duration>0&&(s[0]<0?s[0]=Math.min(s[0],this._adjustedSettings.movementSmoothness()*this._damping.pan.offset[0]):s[0]=Math.max(s[0],this._adjustedSettings.movementSmoothness()*this._damping.pan.offset[0]),s[1]<0?s[1]=Math.min(s[1],this._adjustedSettings.movementSmoothness()*this._damping.pan.offset[1]):s[1]=Math.max(s[1],this._adjustedSettings.movementSmoothness()*this._damping.pan.offset[1]),s[2]<0?s[2]=Math.min(s[2],this._adjustedSettings.movementSmoothness()*this._damping.pan.offset[2]):s[2]=Math.max(s[2],this._adjustedSettings.movementSmoothness()*this._damping.pan.offset[2]));let a=1-Math.max(.01,Math.min(.99,this._adjustedSettings.damping())),o=(Math.log(1/Math.abs(s[0]))-5*Math.log(10))/Math.log(a),l=(Math.log(1/Math.abs(s[1]))-5*Math.log(10))/Math.log(a),c=(Math.log(1/Math.abs(s[2]))-5*Math.log(10))/Math.log(a);this._damping.pan.time=0,this._damping.pan.duration=16.6666*Math.max(o,Math.max(l,c)),this._damping.pan.offset=i.vec3.clone(s),this._damping.rotation.duration=0,this._damping.zoom.duration=0,this._controls.applyTargetVector(s,!0),this._controls.applyPositionVector(s,!0)}else this._panStart=i.vec2.fromValues(e,t)}reset(){this._damping={rotation:{time:0,duration:0,theta:0,phi:0},zoom:{time:0,duration:0,delta:0},pan:{time:0,duration:0,offset:i.vec3.create()}},this._dollyDelta=0,this._dollyEnd=0,this._dollyStart=0,this._panDelta=i.vec2.create(),this._panEnd=i.vec2.create(),this._panStart=i.vec2.create()}restrict(e,t){return{position:e,target:t}}update(e,t){!0===t&&(this._damping.zoom.duration=0,this._damping.pan.duration=0);let n=1-Math.max(.01,Math.min(1,this._adjustedSettings.damping()));if(this._damping.pan.duration>0)if(this._damping.pan.time+e>this._damping.pan.duration)this._damping.pan.time=this._damping.pan.duration,this._damping.pan.duration=0;else{this._damping.pan.time+=e;let t=this._damping.pan.time/16.6666,r=Math.pow(n,t),s=i.vec3.multiply(i.vec3.create(),this._damping.pan.offset,i.vec3.fromValues(r,r,r));this._controls.applyTargetVector(s),this._controls.applyPositionVector(s)}else this._damping.pan.time=0;if(this._damping.zoom.duration>0)if(this._damping.zoom.time+e>this._damping.zoom.duration)this._damping.zoom.time=this._damping.zoom.duration,this._damping.zoom.duration=0;else{this._damping.zoom.time+=e;let t=this._damping.zoom.time/16.6666,r=this._damping.zoom.delta*Math.pow(n,t),s=i.vec3.distance(this._controls.getTargetWithManualUpdates(),this._controls.getPositionWithManualUpdates())*(1-r),a=i.vec3.create(),o=i.vec3.create();i.vec3.normalize(a,i.vec3.subtract(a,this._controls.getTargetWithManualUpdates(),this._controls.getPositionWithManualUpdates())),i.vec3.add(o,this._controls.getPositionWithManualUpdates(),i.vec3.multiply(o,a,i.vec3.fromValues(s,s,s))),i.vec3.subtract(o,o,this._controls.getTargetWithManualUpdates()),this._controls.applyTargetVector(o,!0)}else this._damping.zoom.time=0}zoom(e,t,n,r){var s=Math.sqrt(e*e+t*t);if(r&&(s/=window.devicePixelRatio),n){this._dollyEnd=s,this._dollyDelta=this._dollyEnd-this._dollyStart,this._dollyStart=this._dollyEnd,this._damping.zoom.duration>0&&(this._dollyDelta<0?this._dollyDelta=Math.min(this._dollyDelta,this._adjustedSettings.movementSmoothness()*this._damping.zoom.delta):this._dollyDelta=Math.max(this._dollyDelta,this._adjustedSettings.movementSmoothness()*this._damping.zoom.delta));let e=this._dollyDelta*this._adjustedSettings.zoomSpeed()*(r?this._touchAdjustments.zoomSpeed:1),t=1-Math.max(.01,Math.min(1,this._adjustedSettings.damping())),n=(Math.log(1/Math.abs(this._dollyDelta))-5*Math.log(10))/Math.log(t);this._damping.zoom.time=0,this._damping.zoom.duration=16.6666*n,this._damping.zoom.delta=e,this._damping.pan.duration=0;let a=i.vec3.distance(this._controls.getTargetWithManualUpdates(),this._controls.getPositionWithManualUpdates())*(1-e),o=i.vec3.create(),l=i.vec3.create();i.vec3.normalize(o,i.vec3.subtract(o,this._controls.getTargetWithManualUpdates(),this._controls.getPositionWithManualUpdates())),i.vec3.add(l,this._controls.getPositionWithManualUpdates(),i.vec3.multiply(l,o,i.vec3.fromValues(a,a,a))),i.vec3.subtract(l,l,this._controls.getTargetWithManualUpdates()),this._controls.applyTargetVector(l,!0)}else this._dollyStart=s}panDeltaToOffset(e){let t=i.vec3.create(),n=i.vec3.create();i.vec3.subtract(t,this._controls.getPositionWithManualUpdates(),this._controls.getTargetWithManualUpdates());const r=i.mat4.targetTo(i.mat4.create(),this._controls.camera.position,this._controls.camera.target,i.vec3.fromValues(0,0,1)),s=this._controls.camera,a=i.vec3.fromValues(r[0],r[1],r[2]),o=-e[0]*(s.right-s.left)*.5/1;i.vec3.multiply(a,a,i.vec3.fromValues(o,o,o)),i.vec3.add(n,n,a);const l=i.vec3.fromValues(r[4],r[5],r[6]),c=e[1]*(s.right-s.left)*.5/1;return i.vec3.multiply(l,l,i.vec3.fromValues(c,c,c)),i.vec3.add(n,n,l),i.vec3.clone(n)}}},5173:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraControlsEventDistribution=void 0,t.CameraControlsEventDistribution=class{constructor(e,t){this._controls=e,this._cameraLogic=t,this._active={rotation:!1,zoom:!1,pan:!1}}onDown(e){let{x:t,y:n}=this.convertInput(e),i=window.TouchEvent&&e instanceof TouchEvent?e.touches.length:e.button,r=window.TouchEvent&&e instanceof TouchEvent?this._controls.input.touch:this._controls.input.mouse;if(i===r.rotate&&this._controls.enableRotation&&(this._cameraLogic.rotate(t,n,this._active.rotation,window.TouchEvent&&e instanceof TouchEvent),this._active.rotation=!0,this._active.pan=!1,this._active.zoom=!1),i===r.pan&&this._controls.enablePan&&(this._cameraLogic.pan(t,n,this._active.pan,window.TouchEvent&&e instanceof TouchEvent),this._active.rotation=!1,this._active.pan=!0,this._active.zoom=!1),i===r.zoom&&this._controls.enableZoom){let i=t,r=n;window.TouchEvent&&e instanceof TouchEvent&&2===this._controls.input.touch.zoom&&(i=(e.touches[0].pageX-e.touches[1].pageX)/window.innerWidth*(window.innerWidth/window.innerHeight),r=(e.touches[0].pageY-e.touches[1].pageY)/window.innerHeight),this._cameraLogic.zoom(i,r,this._active.zoom,window.TouchEvent&&e instanceof TouchEvent),this._active.rotation=!1,this._active.pan=!1,this._active.zoom=!0}}onKey(e){if(this._controls.enableKeyPan)switch(e.keyCode){case this._controls.input.keys.up:this._cameraLogic.pan(0,0,!1,!1),this._cameraLogic.pan(0,.05*this._controls.keyPanSpeed,!0,!1),e.preventDefault(),e.stopPropagation();break;case this._controls.input.keys.down:this._cameraLogic.pan(0,0,!1,!1),this._cameraLogic.pan(0,.05*-this._controls.keyPanSpeed,!0,!1),e.preventDefault(),e.stopPropagation();break;case this._controls.input.keys.left:this._cameraLogic.pan(0,0,!1,!1),this._cameraLogic.pan(.05*this._controls.keyPanSpeed,0,!0,!1),e.preventDefault(),e.stopPropagation();break;case this._controls.input.keys.right:this._cameraLogic.pan(0,0,!1,!1),this._cameraLogic.pan(.05*-this._controls.keyPanSpeed,0,!0,!1),e.preventDefault(),e.stopPropagation()}}onKeyDown(e){this.onKey(e)}onMouseDown(e){this.onDown(e)}onMouseMove(e){this.onMove(e)}onMouseUp(e){this.onUp(e)}onMouseWheel(e){this.onWheel(e)}onMove(e){let{x:t,y:n}=this.convertInput(e);if(this._controls.enableRotation&&this._active.rotation&&this._cameraLogic.rotate(t,n,this._active.rotation,window.TouchEvent&&e instanceof TouchEvent),this._controls.enablePan&&this._active.pan&&this._cameraLogic.pan(t,n,this._active.pan,window.TouchEvent&&e instanceof TouchEvent),this._controls.enableZoom&&this._active.zoom){let i=t,r=n;window.TouchEvent&&e instanceof TouchEvent&&2===this._controls.input.touch.zoom&&(i=(e.touches[0].pageX-e.touches[1].pageX)/window.innerWidth*(window.innerWidth/window.innerHeight),r=(e.touches[0].pageY-e.touches[1].pageY)/window.innerHeight),this._cameraLogic.zoom(i,r,this._active.zoom,window.TouchEvent&&e instanceof TouchEvent)}}onTouchEnd(e){this.onUp(e)}onTouchMove(e){this.onMove(e)}onTouchStart(e){this.onDown(e)}onUp(e){this._active.rotation=!1,this._active.zoom=!1,this._active.pan=!1}onWheel(e){if(!this._controls.enableZoom)return;let t=0;void 0!==e.deltaY?t=-e.deltaY:void 0!==e.detail&&(t=-e.detail),Math.sign(t)>0?(this._cameraLogic.zoom(0,0,!1,!1),this._cameraLogic.zoom(1,0,!0,!1)):(this._cameraLogic.zoom(1,0,!1,!1),this._cameraLogic.zoom(0,0,!0,!1))}reset(){this._active={rotation:!1,zoom:!1,pan:!1}}convertInput(e){let t=window.innerWidth/window.innerHeight;return e instanceof MouseEvent?{x:e.clientX/window.innerWidth*t,y:e.clientY/window.innerHeight}:{x:e.touches[0].pageX/window.innerWidth*t,y:e.touches[0].pageY/window.innerHeight}}}},3118:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraControlsLogic=void 0;const i=n(887),r=n(5174);t.CameraControlsLogic=class{constructor(e){this._controls=e,this._adjustedSettings={autoRotationSpeed:()=>this._controls.autoRotationSpeed*this._settingsAdjustments.autoRotationSpeed,damping:()=>this._controls.damping*this._settingsAdjustments.damping,movementSmoothness:()=>this._controls.movementSmoothness*this._settingsAdjustments.movementSmoothness,panSpeed:()=>this._controls.panSpeed*this._settingsAdjustments.panSpeed,rotationSpeed:()=>this._controls.rotationSpeed*this._settingsAdjustments.rotationSpeed,zoomSpeed:()=>this._controls.zoomSpeed*this._settingsAdjustments.zoomSpeed},this._damping={rotation:{time:0,duration:0,theta:0,phi:0},zoom:{time:0,duration:0,delta:0},pan:{time:0,duration:0,offset:i.vec3.create()}},this._dollyDelta=0,this._dollyEnd=0,this._dollyStart=0,this._panDelta=i.vec2.create(),this._panEnd=i.vec2.create(),this._panStart=i.vec2.create(),this._rotateDelta=i.vec2.create(),this._rotateEnd=i.vec2.create(),this._rotateStart=i.vec2.create(),this._settingsAdjustments={autoRotationSpeed:2*Math.PI/60/60,damping:1,movementSmoothness:1,panSpeed:2,rotationSpeed:Math.PI,zoomSpeed:.025},this._touchAdjustments={autoRotationSpeed:1,damping:1,movementSmoothness:1,panSpeed:1.5,rotationSpeed:2,zoomSpeed:100},this._quat=i.quat.fromValues(-Math.sin(Math.PI/4),0,0,Math.sin(Math.PI/4)),this._quatInverse=i.quat.fromValues(Math.sin(Math.PI/4),0,0,Math.sin(Math.PI/4))}isWithinRestrictions(e,t){let n=new r.Box(this._controls.cubePositionRestriction.min,this._controls.cubePositionRestriction.max),s=new r.Sphere(this._controls.spherePositionRestriction.center,this._controls.spherePositionRestriction.radius),a=new r.Box(this._controls.cubeTargetRestriction.min,this._controls.cubeTargetRestriction.max),o=new r.Sphere(this._controls.sphereTargetRestriction.center,this._controls.sphereTargetRestriction.radius);if(!n.containsPoint(e)||!s.containsPoint(e))return!1;if(!a.containsPoint(t)||!o.containsPoint(t))return!1;let l=i.vec3.distance(e,t);if(l>this._controls.zoomRestriction.maxDistance||l<this._controls.zoomRestriction.minDistance)return!1;let c=this._controls.rotationRestriction.minPolarAngle*(Math.PI/180),h=this._controls.rotationRestriction.maxPolarAngle*(Math.PI/180),u=this._controls.rotationRestriction.minAzimuthAngle*(Math.PI/180),d=this._controls.rotationRestriction.maxAzimuthAngle*(Math.PI/180);if(u!==-1/0||d!==1/0||0!==c||180!==h){let n=i.vec3.sub(i.vec3.create(),e,t);i.vec3.transformQuat(n,n,this._quat);const s=(new r.Spherical).fromVec3(n);if(s.theta<u||s.theta>d||s.phi<c||s.phi>h)return!1}return!0}pan(e,t,n,r){if(r&&(e/=window.devicePixelRatio,t/=window.devicePixelRatio),n){if(this._panEnd=i.vec2.fromValues(e,t),i.vec2.sub(this._panDelta,this._panEnd,this._panStart),0===this._panDelta[0]&&0===this._panDelta[1])return;i.vec2.copy(this._panStart,this._panEnd);const n=this._adjustedSettings.panSpeed()*(r?this._touchAdjustments.panSpeed:1);let s=this.panDeltaToOffset(i.vec2.mul(i.vec2.create(),this._panDelta,i.vec2.fromValues(n,n)));this._damping.pan.duration>0&&(s[0]<0?s[0]=Math.min(s[0],this._adjustedSettings.movementSmoothness()*this._damping.pan.offset[0]):s[0]=Math.max(s[0],this._adjustedSettings.movementSmoothness()*this._damping.pan.offset[0]),s[1]<0?s[1]=Math.min(s[1],this._adjustedSettings.movementSmoothness()*this._damping.pan.offset[1]):s[1]=Math.max(s[1],this._adjustedSettings.movementSmoothness()*this._damping.pan.offset[1]),s[2]<0?s[2]=Math.min(s[2],this._adjustedSettings.movementSmoothness()*this._damping.pan.offset[2]):s[2]=Math.max(s[2],this._adjustedSettings.movementSmoothness()*this._damping.pan.offset[2]));let a=1-Math.max(.01,Math.min(.99,this._adjustedSettings.damping())),o=(Math.log(1/Math.abs(s[0]))-5*Math.log(10))/Math.log(a),l=(Math.log(1/Math.abs(s[1]))-5*Math.log(10))/Math.log(a),c=(Math.log(1/Math.abs(s[2]))-5*Math.log(10))/Math.log(a);this._damping.pan.time=0,this._damping.pan.duration=16.6666*Math.max(o,Math.max(l,c)),this._damping.pan.offset=i.vec3.clone(s),this._damping.rotation.duration=0,this._damping.zoom.duration=0,this._controls.applyTargetVector(s,!0),this._controls.applyPositionVector(s,!0)}else this._panStart=i.vec2.fromValues(e,t)}reset(){this._damping={rotation:{time:0,duration:0,theta:0,phi:0},zoom:{time:0,duration:0,delta:0},pan:{time:0,duration:0,offset:i.vec3.create()}},this._dollyDelta=0,this._dollyEnd=0,this._dollyStart=0,this._panDelta=i.vec2.create(),this._panEnd=i.vec2.create(),this._panStart=i.vec2.create(),this._rotateDelta=i.vec2.create(),this._rotateEnd=i.vec2.create(),this._rotateStart=i.vec2.create()}restrict(e,t){let n=new r.Box(this._controls.cubePositionRestriction.min,this._controls.cubePositionRestriction.max),s=new r.Sphere(this._controls.spherePositionRestriction.center,this._controls.spherePositionRestriction.radius),a=new r.Box(this._controls.cubeTargetRestriction.min,this._controls.cubeTargetRestriction.max),o=new r.Sphere(this._controls.sphereTargetRestriction.center,this._controls.sphereTargetRestriction.radius);n.containsPoint(e)||(e=n.clampPoint(e)),s.containsPoint(e)||(e=s.clampPoint(e)),a.containsPoint(t)||(t=a.clampPoint(t)),o.containsPoint(t)||(t=o.clampPoint(t));let l=i.vec3.distance(e,t);if(l>this._controls.zoomRestriction.maxDistance||l<this._controls.zoomRestriction.minDistance){let n=i.vec3.normalize(i.vec3.create(),i.vec3.subtract(i.vec3.create(),e,t)),r=Math.max(this._controls.zoomRestriction.minDistance,Math.min(this._controls.zoomRestriction.maxDistance,l));i.vec3.add(e,i.vec3.multiply(e,n,i.vec3.fromValues(r,r,r)),t)}let c=this._controls.rotationRestriction.minPolarAngle*(Math.PI/180),h=this._controls.rotationRestriction.maxPolarAngle*(Math.PI/180),u=this._controls.rotationRestriction.minAzimuthAngle*(Math.PI/180),d=this._controls.rotationRestriction.maxAzimuthAngle*(Math.PI/180);if(u!==-1/0||d!==1/0||0!==c||180!==h){let n=i.vec3.subtract(i.vec3.create(),e,t);i.vec3.transformQuat(n,n,this._quat);const s=(new r.Spherical).fromVec3(n);(s.theta<u||s.theta>d||s.phi<c||s.phi>h)&&(s.theta=Math.max(u,Math.min(d,s.theta)),s.phi=Math.max(c,Math.min(h,s.phi)),s.makeSafe(),n=s.toVec3(),i.vec3.transformQuat(n,n,this._quatInverse),i.vec3.add(e,n,t))}return{position:e,target:t}}rotate(e,t,n,s){if(s&&(e/=window.devicePixelRatio,t/=window.devicePixelRatio),n){if(this._rotateEnd=i.vec2.fromValues(e,t),i.vec2.subtract(this._rotateDelta,this._rotateEnd,this._rotateStart),i.vec2.copy(this._rotateStart,this._rotateEnd),0==this._controls.canvas.clientWidth||0==this._controls.canvas.clientHeight)return;const n=new r.Spherical;let a=this._adjustedSettings.rotationSpeed()*(s?this._touchAdjustments.rotationSpeed:1);if(n.theta-=a*this._rotateDelta[0],n.phi-=a*this._rotateDelta[1],this._damping.rotation.duration>0){let e=this._damping.rotation.theta-n.theta;n.theta+=e*this._adjustedSettings.movementSmoothness();let t=this._damping.rotation.phi-n.phi;n.phi+=t*this._adjustedSettings.movementSmoothness()}let o=this.rotationSphericalToOffset(n),l=1-Math.max(.01,Math.min(1,this._adjustedSettings.damping())),c=(Math.log(1/Math.abs(n.theta))-5*Math.log(10))/Math.log(l),h=(Math.log(1/Math.abs(n.phi))-5*Math.log(10))/Math.log(l);this._damping.rotation.time=0,this._damping.rotation.duration=16.6666*Math.max(c,h),this._damping.rotation.theta=n.theta,this._damping.rotation.phi=n.phi,this._damping.pan.duration=0,this._damping.zoom.duration=0,this._controls.applyPositionVector(o,!0)}else this._rotateStart=i.vec2.fromValues(e,t)}update(e,t){!0===t&&(this._damping.zoom.duration=0,this._damping.pan.duration=0,this._damping.rotation.duration=0);let n=1-Math.max(.01,Math.min(1,this._adjustedSettings.damping()));if(this._damping.pan.duration>0)if(this._damping.pan.time+e>this._damping.pan.duration)this._damping.pan.time=this._damping.pan.duration,this._damping.pan.duration=0;else{this._damping.pan.time+=e;let t=this._damping.pan.time/16.6666,r=Math.pow(n,t),s=i.vec3.multiply(i.vec3.create(),this._damping.pan.offset,i.vec3.fromValues(r,r,r));this._controls.applyTargetVector(s),this._controls.applyPositionVector(s)}else this._damping.pan.time=0;if(this._damping.rotation.duration>0)if(this._damping.rotation.time+e>this._damping.rotation.duration)this._damping.rotation.time=this._damping.rotation.duration,this._damping.rotation.duration=0;else{this._damping.rotation.time+=e;let t=this._damping.rotation.time/16.6666,i=new r.Spherical;i.theta=this._damping.rotation.theta*Math.pow(n,t),i.phi=this._damping.rotation.phi*Math.pow(n,t);let s=this.rotationSphericalToOffset(i);this._controls.applyPositionVector(s)}else this._damping.rotation.time=0;if(this._damping.zoom.duration>0)if(this._damping.zoom.time+e>this._damping.zoom.duration)this._damping.zoom.time=this._damping.zoom.duration,this._damping.zoom.duration=0;else{this._damping.zoom.time+=e;let t=this._damping.zoom.time/16.6666,i=this._damping.zoom.delta*Math.pow(n,t),r=this.zoomDistanceToOffset(i);this._controls.applyPositionVector(r)}else this._damping.zoom.time=0;if(this._controls.enableAutoRotation){let e=new r.Spherical(1,0,-this._adjustedSettings.autoRotationSpeed()),t=this.rotationSphericalToOffset(e);this._controls.applyPositionVector(t)}}zoom(e,t,n,i){var r=Math.sqrt(e*e+t*t);if(i&&(r/=window.devicePixelRatio),n){this._dollyEnd=r,this._dollyDelta=this._dollyEnd-this._dollyStart,this._dollyStart=this._dollyEnd,this._damping.zoom.duration>0&&(this._dollyDelta<0?this._dollyDelta=Math.min(this._dollyDelta,this._adjustedSettings.movementSmoothness()*this._damping.zoom.delta):this._dollyDelta=Math.max(this._dollyDelta,this._adjustedSettings.movementSmoothness()*this._damping.zoom.delta));let e=-this._dollyDelta*this._adjustedSettings.zoomSpeed()*(i?this._touchAdjustments.zoomSpeed:1),t=1-Math.max(.01,Math.min(1,this._adjustedSettings.damping())),n=(Math.log(1/Math.abs(this._dollyDelta))-5*Math.log(10))/Math.log(t);this._damping.zoom.time=0,this._damping.zoom.duration=16.6666*n,this._damping.zoom.delta=e,this._damping.rotation.duration=0,this._damping.pan.duration=0;let s=this.zoomDistanceToOffset(e);this._controls.applyPositionVector(s,!0)}else this._dollyStart=r}panDeltaToOffset(e){let t=i.vec3.create(),n=i.vec3.create();i.vec3.subtract(t,this._controls.getPositionWithManualUpdates(),this._controls.getTargetWithManualUpdates());var r=i.vec3.length(t);r*=Math.tan(this._controls.camera.fov/2*Math.PI/180);const s=i.mat4.targetTo(i.mat4.create(),this._controls.camera.position,this._controls.camera.target,i.vec3.fromValues(0,0,1)),a=i.vec3.fromValues(s[0],s[1],s[2]),o=-2*e[0]*r;i.vec3.multiply(a,a,i.vec3.fromValues(o,o,o)),i.vec3.add(n,n,a);const l=i.vec3.fromValues(s[4],s[5],s[6]),c=2*e[1]*r;return i.vec3.multiply(l,l,i.vec3.fromValues(c,c,c)),i.vec3.add(n,n,l),i.vec3.clone(n)}rotationSphericalToOffset(e){let t=i.vec3.create();i.vec3.subtract(t,this._controls.getPositionWithManualUpdates(),this._controls.getTargetWithManualUpdates()),i.vec3.transformQuat(t,t,this._quat);let n=(new r.Spherical).fromVec3(t);n.theta+=e.theta,n.phi+=e.phi;let s=this._controls.rotationRestriction.minAzimuthAngle*(Math.PI/180),a=this._controls.rotationRestriction.maxAzimuthAngle*(Math.PI/180);return n.theta>Math.PI?(n.theta-=2*Math.PI,s>n.theta&&(n.theta+=2*Math.PI)):n.theta<-Math.PI&&(n.theta+=2*Math.PI,a<n.theta&&(n.theta-=2*Math.PI)),n.makeSafe(),t=n.toVec3(),t=i.vec3.transformQuat(i.vec3.create(),t,this._quatInverse),t=i.vec3.add(i.vec3.create(),t,this._controls.getTargetWithManualUpdates()),t=i.vec3.subtract(i.vec3.create(),t,this._controls.getPositionWithManualUpdates()),i.vec3.clone(t)}zoomDistanceToOffset(e){let t=i.vec3.create();return i.vec3.subtract(t,this._controls.getPositionWithManualUpdates(),this._controls.getTargetWithManualUpdates()),i.vec3.multiply(i.vec3.create(),t,i.vec3.fromValues(e,e,e))}}},1179:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.CameraInterpolationManager=void 0;const a=s(n(6194)),o=n(7198),l=n(6861),c=n(3042),h=n(365);t.CameraInterpolationManager=class{constructor(e,t){this._camera=e,this._cameraControls=t,this.TweenWrapper=class{constructor(e,t,n){this._properties={delta:0},this._tween=new a.Tween(this._properties),this._tween.easing(e.easing),this._tween.to({delta:1},e.duration),this._tween.onUpdate((e=>{t.onUpdate(e)})),this._tween.onStop((e=>{t.onStop&&t.onStop(e),this._resolve(!0)})),this._tween.onComplete((e=>{t.onComplete&&t.onComplete(e),n(),this._resolve(!0)}))}start(){return new Promise((e=>{this._resolve=e,this._tween.start()}))}stop(){this._tween.stop()}}}active(){return!!this._tween}interpolate(e,t={}){const n=[];for(let t=0;t<e.length;t++)n.push({position:e[t].position,target:e[t].target});this._tween&&(this._tween.stop(),this._tween=null);let i=this.optionsParser(t);return this._tween=new this.TweenWrapper(i,2===n.length?this.getCameraInterpolation(n[0],n[1],i.coordinates):new o.CameraMultipleInterpolation(this._camera,this._cameraControls,n,i.interpolation),(()=>{this._tween=null})),this._tween.start()}stop(){this._tween&&this._tween.stop(),this._tween=null}getCameraInterpolation(e,t,n){switch(n){case"linear":return new c.CameraLinearInterpolation(this._camera,this._cameraControls,e,t);case"spherical":return new l.CameraSphericalInterpolation(this._camera,this._cameraControls,e,t);case"cylindrical":return new h.CameraCylindricalInterpolation(this._camera,this._cameraControls,e,t);default:return new o.CameraMultipleInterpolation(this._camera,this._cameraControls,[e,t],a.Interpolation.CatmullRom)}}optionsParser(e){return{default:e.default||!1,duration:e.duration&&e.duration>=0?e.duration:0,easing:a.Easing.Quartic.InOut,coordinates:"spherical"!==e.coordinates&&"linear"!==e.coordinates&&"cylindrical"!==e.coordinates?"cylindrical":e.coordinates,interpolation:a.Interpolation.CatmullRom}}}},365:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraCylindricalInterpolation=void 0;const i=n(887);t.CameraCylindricalInterpolation=class{constructor(e,t,n,r){this._camera=e,this._cameraControls=t,this._from=n,this._to=r,this._h_from=this._from.position[2]-this._from.target[2],this._from_position_heightAdjusted=i.vec3.fromValues(this._from.position[0],this._from.position[1],this._from.target[2]),this._r_from=i.vec3.distance(this._from_position_heightAdjusted,this._from.target),this._dir_from=i.vec3.normalize(i.vec3.create(),i.vec3.subtract(i.vec3.create(),this._from_position_heightAdjusted,this._from.target)),this._h_to=this._to.position[2]-this._to.target[2],this._to_position_heightAdjusted=i.vec3.fromValues(this._to.position[0],this._to.position[1],this._to.target[2]),this._r_to=i.vec3.distance(this._to_position_heightAdjusted,this._to.target),this._dir_to=i.vec3.normalize(i.vec3.create(),i.vec3.subtract(i.vec3.create(),this._to_position_heightAdjusted,this._to.target)),0===this._dir_from[0]&&0===this._dir_from[1]&&0===this._dir_from[2]&&(this._dir_from=i.vec3.fromValues(1,0,0)),0===this._dir_to[0]&&0===this._dir_to[1]&&0===this._dir_to[2]&&(this._dir_to=i.vec3.fromValues(1,0,0)),this._lorr=i.vec3.cross(i.vec3.create(),this._dir_to,this._dir_from);let s=Math.min(1,Math.max(-1,i.vec3.dot(this._dir_to,this._dir_from))),a=Math.min(1,Math.max(-1,i.vec3.dot(this._lorr,i.vec3.fromValues(0,0,1))));this._shortest_angle=a>0?-Math.acos(s):Math.acos(s)}onComplete(e){let t=i.vec3.subtract(i.vec3.create(),i.vec3.fromValues(this._to.position[0],this._to.position[1],this._to.position[2]),this._cameraControls.getPositionWithUpdates());this._cameraControls.applyPositionVector(t);let n=i.vec3.subtract(i.vec3.create(),i.vec3.fromValues(this._to.target[0],this._to.target[1],this._to.target[2]),this._cameraControls.getTargetWithUpdates());this._cameraControls.applyTargetVector(n)}onStop(e){}onUpdate(e){let t=i.vec3.add(i.vec3.create(),i.vec3.multiply(i.vec3.create(),this._from.target,i.vec3.fromValues(1-e.delta,1-e.delta,1-e.delta)),i.vec3.multiply(i.vec3.create(),this._to.target,i.vec3.fromValues(e.delta,e.delta,e.delta))),n=i.vec3.subtract(i.vec3.create(),t,this._cameraControls.getTargetWithUpdates());this._cameraControls.applyTargetVector(n);let r=this._shortest_angle*e.delta,s=i.vec3.transformQuat(i.vec3.create(),this._dir_from,i.quat.setAxisAngle(i.quat.create(),i.vec3.fromValues(0,0,1),r)),a=this._r_from*(1-e.delta)+this._r_to*e.delta,o=i.vec3.add(i.vec3.create(),t,i.vec3.multiply(i.vec3.create(),s,i.vec3.fromValues(a,a,a)));i.vec3.add(o,o,i.vec3.fromValues(0,0,this._h_from*(1-e.delta)+this._h_to*e.delta));let l=i.vec3.subtract(i.vec3.create(),o,this._cameraControls.getPositionWithUpdates());this._cameraControls.applyPositionVector(l)}}},3042:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraLinearInterpolation=void 0;const i=n(887);t.CameraLinearInterpolation=class{constructor(e,t,n,i){this._camera=e,this._cameraControls=t,this._from=n,this._to=i}onComplete(e){let t=i.vec3.subtract(i.vec3.create(),this._to.position,this._cameraControls.getPositionWithUpdates());this._cameraControls.applyPositionVector(t);let n=i.vec3.subtract(i.vec3.create(),this._to.target,this._cameraControls.getTargetWithUpdates());this._cameraControls.applyTargetVector(n)}onStop(e){}onUpdate(e){let t=i.vec3.add(i.vec3.create(),i.vec3.multiply(i.vec3.create(),this._from.position,i.vec3.fromValues(1-e.delta,1-e.delta,1-e.delta)),i.vec3.multiply(i.vec3.create(),this._to.position,i.vec3.fromValues(e.delta,e.delta,e.delta))),n=i.vec3.subtract(i.vec3.create(),t,this._cameraControls.getPositionWithUpdates());this._cameraControls.applyPositionVector(n);let r=i.vec3.add(i.vec3.create(),i.vec3.multiply(i.vec3.create(),this._from.target,i.vec3.fromValues(1-e.delta,1-e.delta,1-e.delta)),i.vec3.multiply(i.vec3.create(),this._to.target,i.vec3.fromValues(e.delta,e.delta,e.delta))),s=i.vec3.subtract(i.vec3.create(),r,this._cameraControls.getTargetWithUpdates());this._cameraControls.applyTargetVector(s)}}},7198:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraMultipleInterpolation=void 0;const i=n(887);t.CameraMultipleInterpolation=class{constructor(e,t,n,i){this._camera=e,this._cameraControls=t,this._path=n,this._interpolationFunction=i,this.end={position:{x:[],y:[],z:[]},target:{x:[],y:[],z:[]}};for(let e=0;e<this._path.length;e++)this.end.position.x.push(this._path[e].position[0]),this.end.position.y.push(this._path[e].position[1]),this.end.position.z.push(this._path[e].position[2]),this.end.target.x.push(this._path[e].target[0]),this.end.target.y.push(this._path[e].target[1]),this.end.target.z.push(this._path[e].target[2])}onComplete(e){let t=i.vec3.subtract(i.vec3.create(),i.vec3.fromValues(this._path[this._path.length-1].position[0],this._path[this._path.length-1].position[1],this._path[this._path.length-1].position[2]),this._cameraControls.getPositionWithUpdates());this._cameraControls.applyPositionVector(t);let n=i.vec3.subtract(i.vec3.create(),i.vec3.fromValues(this._path[this._path.length-1].target[0],this._path[this._path.length-1].target[1],this._path[this._path.length-1].target[2]),this._cameraControls.getTargetWithUpdates());this._cameraControls.applyTargetVector(n)}onStop(e){}onUpdate(e){let t=i.vec3.fromValues(this._interpolationFunction(this.end.position.x,e.delta),this._interpolationFunction(this.end.position.y,e.delta),this._interpolationFunction(this.end.position.z,e.delta)),n=i.vec3.subtract(i.vec3.create(),t,this._cameraControls.getPositionWithUpdates());this._cameraControls.applyPositionVector(n);let r=i.vec3.fromValues(this._interpolationFunction(this.end.target.x,e.delta),this._interpolationFunction(this.end.target.y,e.delta),this._interpolationFunction(this.end.target.z,e.delta)),s=i.vec3.subtract(i.vec3.create(),r,this._cameraControls.getTargetWithUpdates());this._cameraControls.applyTargetVector(s)}}},6861:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSphericalInterpolation=void 0;const i=n(887);t.CameraSphericalInterpolation=class{constructor(e,t,n,r){this._camera=e,this._cameraControls=t,this._from=n,this._to=r,this._radius_from=i.vec3.distance(this._from.position,this._from.target),this._direction_from=i.vec3.normalize(i.vec3.create(),i.vec3.subtract(i.vec3.create(),this._from.position,this._from.target)),this._radius_to=i.vec3.distance(this._to.position,this._to.target),this._direction_to=i.vec3.normalize(i.vec3.create(),i.vec3.subtract(i.vec3.create(),this._to.position,this._to.target)),this._axis=i.vec3.normalize(i.vec3.create(),i.vec3.cross(i.vec3.create(),this._direction_to,this._direction_from)),this._c_angle=-Math.acos(i.vec3.dot(this._direction_to,this._direction_from))}onComplete(e){let t=i.vec3.subtract(i.vec3.create(),i.vec3.fromValues(this._to.position[0],this._to.position[1],this._to.position[2]),this._cameraControls.getPositionWithUpdates());this._cameraControls.applyPositionVector(t);let n=i.vec3.subtract(i.vec3.create(),i.vec3.fromValues(this._to.target[0],this._to.target[1],this._to.target[2]),this._cameraControls.getTargetWithUpdates());this._cameraControls.applyTargetVector(n)}onStop(e){}onUpdate(e){let t=i.vec3.add(i.vec3.create(),i.vec3.multiply(i.vec3.create(),this._from.target,i.vec3.fromValues(1-e.delta,1-e.delta,1-e.delta)),i.vec3.multiply(i.vec3.create(),this._to.target,i.vec3.fromValues(e.delta,e.delta,e.delta))),n=i.vec3.subtract(i.vec3.create(),t,this._cameraControls.getTargetWithUpdates());this._cameraControls.applyTargetVector(n);let r=this._c_angle*e.delta,s=i.vec3.normalize(i.vec3.create(),i.vec3.transformQuat(i.vec3.create(),this._direction_from,i.quat.setAxisAngle(i.quat.create(),this._axis,r))),a=this._radius_from*(1-e.delta)+this._radius_to*e.delta,o=i.vec3.add(i.vec3.create(),t,i.vec3.multiply(i.vec3.create(),s,i.vec3.fromValues(a,a,a))),l=i.vec3.subtract(i.vec3.create(),o,this._cameraControls.getPositionWithUpdates());this._cameraControls.applyPositionVector(l)}}},1990:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrthographicCameraControls=t.PerspectiveCameraControls=t.OrthographicCamera=t.PerspectiveCamera=t.ORTHOGRAPHIC_CAMERA_DIRECTION=t.CAMERATYPE=t.AbstractCamera=t.CameraEngine=void 0;const i=n(3164);Object.defineProperty(t,"AbstractCamera",{enumerable:!0,get:function(){return i.AbstractCamera}});const r=n(8551);Object.defineProperty(t,"CameraEngine",{enumerable:!0,get:function(){return r.CameraEngine}});const s=n(4976);Object.defineProperty(t,"CAMERATYPE",{enumerable:!0,get:function(){return s.CAMERATYPE}});const a=n(8065);Object.defineProperty(t,"OrthographicCamera",{enumerable:!0,get:function(){return a.OrthographicCamera}});const o=n(8926);Object.defineProperty(t,"PerspectiveCamera",{enumerable:!0,get:function(){return o.PerspectiveCamera}});const l=n(8210);Object.defineProperty(t,"OrthographicCameraControls",{enumerable:!0,get:function(){return l.OrthographicCameraControls}});const c=n(9599);Object.defineProperty(t,"PerspectiveCameraControls",{enumerable:!0,get:function(){return c.PerspectiveCameraControls}});const h=n(5904);Object.defineProperty(t,"ORTHOGRAPHIC_CAMERA_DIRECTION",{enumerable:!0,get:function(){return h.ORTHOGRAPHIC_CAMERA_DIRECTION}})},4976:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CAMERATYPE=void 0,(n=t.CAMERATYPE||(t.CAMERATYPE={})).PERSPECTIVE="perspective",n.ORTHOGRAPHIC="orthographic"},5904:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ORTHOGRAPHIC_CAMERA_DIRECTION=void 0,(n=t.ORTHOGRAPHIC_CAMERA_DIRECTION||(t.ORTHOGRAPHIC_CAMERA_DIRECTION={})).TOP="top",n.BOTTOM="bottom",n.LEFT="left",n.RIGHT="right",n.FRONT="front",n.BACK="back"},3509:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=void 0,t.Canvas=class{constructor(e,t,n){this._id=e,this._originalDefinition=t,this._canvasElement=n,this._originalDefinition&&this._originalDefinition instanceof HTMLCanvasElement&&(this._originalDefinition=this._originalDefinition.cloneNode(!0)),n?this._canvasElement=n:(this._canvasElement=document.createElement("canvas"),this._canvasElement.id=this._id)}get canvasElement(){return this._canvasElement}get id(){return this._id}reset(){var e;const t=null===(e=this._canvasElement)||void 0===e?void 0:e.parentElement;null==t||t.removeChild(this._canvasElement),this._originalDefinition instanceof HTMLCanvasElement&&(null==t||t.appendChild(this._originalDefinition))}}},5116:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasEngine=void 0;const r=n(2899),s=n(3509),a=n(4562);let o=class{constructor(){this._canvasDictionary={},this._uuidGenerator=r.container.resolve(a.UuidGenerator)}createCanvasObject(e){if(e instanceof HTMLCanvasElement){const t=e;return t.id||(t.id=this._uuidGenerator.create()),this._canvasDictionary[t.id]=new s.Canvas(t.id,e,t),this._canvasDictionary[t.id]}if(e){const t=e,n=document.getElementById(t);if(this._canvasDictionary[t])return this._canvasDictionary[t];if(n instanceof HTMLCanvasElement)return this._canvasDictionary[t]=new s.Canvas(t,e,n),this._canvasDictionary[t];if(!n)return this._canvasDictionary[t]=new s.Canvas(t,e),this._canvasDictionary[t]}const t=this._uuidGenerator.create();return this._canvasDictionary[t]=new s.Canvas(t,e),this._canvasDictionary[t]}};o=i([r.singleton()],o),t.CanvasEngine=o},420:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=t.CanvasEngine=void 0;const i=n(3509);Object.defineProperty(t,"Canvas",{enumerable:!0,get:function(){return i.Canvas}});const r=n(5116);Object.defineProperty(t,"CanvasEngine",{enumerable:!0,get:function(){return r.CanvasEngine}})},3995:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractLight=void 0;const i=n(4562),r=n(3858),s=n(2899);class a extends r.AbstractTreeNodeData{constructor(e){super(),this._convertedObjects=[],this._uuidGenerator=s.container.resolve(i.UuidGenerator),this._updateCBs=[],this._color=e.color,this._intensity=e.intensity,this._type=e.type,this._name=e.name}get color(){return this._color}set color(e){this._color=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get convertedObjects(){return this._convertedObjects}set convertedObjects(e){this._convertedObjects=e,this._updateCBs.forEach((e=>e()))}get intensity(){return this._intensity}set intensity(e){this._intensity=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get name(){return this._name}set name(e){this._name=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get type(){return this._type}addUpdateCB(e){this._updateCBs.push(e)}}t.AbstractLight=a},4739:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LightEngine=void 0;const i=n(2899),r=n(887),s=n(3955),a=n(3520),o=n(3447),l=n(4163),c=n(4410),h=n(4562),u=n(8877),d=n(4771),p=n(4304);t.LightEngine=class{constructor(){this._lightScenes={},this._converter=i.container.resolve(h.Converter),this._uuidGenerator=i.container.resolve(h.UuidGenerator),this._settingsEngine=i.container.resolve(u.SettingsEngine),this._defaultLightScene=this.createLightScene({name:"default",standard:!0}),this._lightScenes[this._defaultLightScene.id]=this._defaultLightScene}addAmbientLight(e){const t=new s.AmbientLight(e);return this._currentLightScene.addLight(t),t}addDirectionalLight(e){const t=new a.DirectionalLight(e);return this._currentLightScene.addLight(t),t}addHemisphereLight(e){const t=new o.HemisphereLight(e);return this._currentLightScene.addLight(t),t}addPointLight(e){const t=new l.PointLight(e);return this._currentLightScene.addLight(t),t}addSpotLight(e){const t=new c.SpotLight(e);return this._currentLightScene.addLight(t),t}assignLightScene(e){if(!this._lightScenes[e]){for(let t in this._lightScenes)if((this._lightScenes[t].name||t)===e)return this.assignLightScene(t);return!1}return this._currentLightScene=this._lightScenes[e],!0}createLightScene(e){const t=this._uuidGenerator.create(),n=new d.LightScene({id:t,name:e.name});return!0===e.standard&&(n.addLight(new s.AmbientLight({color:"#ffffff",intensity:.5,name:"ambient0"})),n.addLight(new a.DirectionalLight({color:"#ffffff",intensity:.75,direction:r.vec3.fromValues(.5774,-.5774,.5774),castShadow:!0,name:"directional0"})),n.addLight(new a.DirectionalLight({color:"#ffffff",intensity:.35,direction:r.vec3.fromValues(.25,-1,1),castShadow:!1,name:"directional1"}))),this._lightScenes[t]=n,this._currentLightScene=n,n}getLight(e){return this._currentLightScene.getLight(e)}getLightScene(e){return e&&this._lightScenes[e]?this._lightScenes[e]:this._currentLightScene}getLightSceneObject(){return this._currentLightScene}getLightScenes(){return this._lightScenes}getLights(){return this._currentLightScene.lights}removeLight(e){return!!this._currentLightScene.getLight(e)&&this._currentLightScene.removeLight(e)}removeLightScene(e){if(e===this._defaultLightScene.id)return!1;if(!this._lightScenes[e]){for(let t in this._lightScenes)if((this._lightScenes[t].name||t)===e)return this.removeLightScene(t);return!1}return this._currentLightScene.id===e&&this.assignLightScene(this._defaultLightScene.id),delete this._lightScenes[e],!0}saveSettings(){this._settingsEngine.lights.lightScene.value=this.getLightScene().id;const e={};for(let t in this._lightScenes){const n=this._lightScenes[t],i=n.name||t;e[i]={id:i,lights:{}};for(let t in n.lights){const r=n.lights[t],s=r.name||r.id;switch(e[i].lights[s]={id:s,type:r.type,properties:{}},r.type){case p.LIGHTTYPE.DIRECTIONAL:e[i].lights[s].properties={color:r.color,intensity:r.intensity,direction:{x:r.direction[0],y:r.direction[1],z:r.direction[2]},castShadow:r.castShadow,shadowMapResolution:r.shadowMapResolution,shadowMapBias:r.shadowMapBias};break;case p.LIGHTTYPE.HEMISPHERE:e[i].lights[s].properties={skyColor:r.color,intensity:r.intensity,groundColor:r.groundColor};break;case p.LIGHTTYPE.POINT:e[i].lights[s].properties={color:r.color,intensity:r.intensity,position:{x:r.position[0],y:r.position[1],z:r.position[2]},distance:r.distance,decay:r.decay};break;case p.LIGHTTYPE.SPOT:e[i].lights[s].properties={color:r.color,intensity:r.intensity,position:{x:r.position[0],y:r.position[1],z:r.position[2]},target:{x:r.target[0],y:r.target[1],z:r.target[2]},distance:r.distance,decay:r.decay,angle:r.angle,penumbra:r.penumbra};break;case p.LIGHTTYPE.AMBIENT:default:e[i].lights[s].properties={color:r.color,intensity:r.intensity}}}}this._settingsEngine.lights.lightScenes.value=e}applySettings(){this._lightScenes={};for(let e in this._settingsEngine.lights.lightScenes.value){const t=new d.LightScene({id:this._uuidGenerator.create(),name:e});for(let n in this._settingsEngine.lights.lightScenes.value[e].lights){const i=this._settingsEngine.lights.lightScenes.value[e].lights[n];let r;switch(i.type){case p.LIGHTTYPE.DIRECTIONAL:r=new a.DirectionalLight({color:this._converter.toColor(i.properties.color),intensity:i.properties.intensity,direction:this._converter.toVec3(i.properties.direction),castShadow:i.properties.castShadow,name:n});break;case p.LIGHTTYPE.HEMISPHERE:r=new o.HemisphereLight({color:this._converter.toColor(i.properties.skyColor),intensity:i.properties.intensity,groundColor:this._converter.toColor(i.properties.groundColor),name:n});break;case p.LIGHTTYPE.POINT:r=new l.PointLight({color:this._converter.toColor(i.properties.color),intensity:i.properties.intensity,position:this._converter.toVec3(i.properties.position),distance:i.properties.distance,decay:i.properties.decay,name:n});break;case p.LIGHTTYPE.SPOT:r=new c.SpotLight({color:this._converter.toColor(i.properties.color),intensity:i.properties.intensity,position:this._converter.toVec3(i.properties.position),target:this._converter.toVec3(i.properties.target),distance:i.properties.distance,decay:i.properties.decay,angle:i.properties.angle,penumbra:i.properties.penumbra,name:n});break;case p.LIGHTTYPE.AMBIENT:default:r=new s.AmbientLight({color:this._converter.toColor(i.properties.color),intensity:i.properties.intensity,name:n})}t.addLight(r)}this._lightScenes[t.id]=t}this._settingsEngine.lights.lightScene.value&&this.assignLightScene(this._settingsEngine.lights.lightScene.value)}}},4771:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LightScene=void 0;const i=n(3858);t.LightScene=class{constructor(e){this._lights={},this._updateCBs=[],this._id=e.id,this._name=e.name,this._node=new i.TreeNode(e.name||e.id)}get name(){return this._name}set name(e){this._name=e,this._updateCBs.forEach((e=>e()))}get id(){return this._id}get lights(){return this._lights}get node(){return this._node}addLight(e){const t=new i.TreeNode(e.id);t.data.push(e),this._node.addChild(t),this._lights[e.id]=e,this._node.updateVersion(),this._updateCBs.forEach((e=>e()))}getLight(e){return this._lights[e]}removeLight(e){if(!this._lights[e])return!1;for(let t=0;t<this._node.children.length;t++){const n=this._node.children[t];if(n&&n.name===e){this._node.removeChild(n);break}}return delete this._lights[e],this._node.updateVersion(),this._updateCBs.forEach((e=>e())),!0}addUpdateCB(e){this._updateCBs.push(e)}}},3955:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AmbientLight=void 0;const i=n(4304),r=n(3995);class s extends r.AbstractLight{constructor(e){super({color:e.color||"#ffffff",intensity:e.intensity||.5,type:i.LIGHTTYPE.AMBIENT,name:e.name})}clone(){return new s({color:this.color||"#ffffff",intensity:this.intensity||.5,name:this.name})}}t.AmbientLight=s},3520:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DirectionalLight=void 0;const i=n(887),r=n(4304),s=n(3995);class a extends s.AbstractLight{constructor(e){super({color:e.color||"#ffffff",intensity:e.intensity||.5,type:r.LIGHTTYPE.DIRECTIONAL,name:e.name}),this._castShadow=!1,this._direction=i.vec3.fromValues(-1,0,1),this._shadowMapBias=-.00175,this._shadowMapResolution=1024,e.direction&&(this._direction=e.direction),e.castShadow&&(this._castShadow=e.castShadow),e.shadowMapResolution&&(this._shadowMapResolution=e.shadowMapResolution),e.shadowMapBias&&(this._shadowMapBias=e.shadowMapBias)}get castShadow(){return this._castShadow}set castShadow(e){this._castShadow=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get direction(){return this._direction}set direction(e){this._direction=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get shadowMapBias(){return this._shadowMapBias}set shadowMapBias(e){this._shadowMapBias=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get shadowMapResolution(){return this._shadowMapResolution}set shadowMapResolution(e){this._shadowMapResolution=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}clone(){return new a({color:this.color,intensity:this.intensity,direction:this.direction,castShadow:this.castShadow,shadowMapResolution:this.shadowMapResolution,shadowMapBias:this.shadowMapBias,name:this.name})}}t.DirectionalLight=a},3447:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HemisphereLight=void 0;const i=n(4304),r=n(3995);class s extends r.AbstractLight{constructor(e){super({color:e.color||"#ffffff",intensity:e.intensity||.5,type:i.LIGHTTYPE.HEMISPHERE,name:e.name}),this._groundColor="#ffffff",e.groundColor&&(this._groundColor=e.groundColor)}get groundColor(){return this._groundColor}set groundColor(e){this._groundColor=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}clone(){return new s({color:this.color,groundColor:this.groundColor,intensity:this.intensity,name:this.name})}}t.HemisphereLight=s},4163:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointLight=void 0;const i=n(887),r=n(4304),s=n(3995);class a extends s.AbstractLight{constructor(e){super({color:e.color||"#ffffff",intensity:e.intensity||.5,type:r.LIGHTTYPE.POINT,name:e.name}),this._decay=2,this._distance=0,this._position=i.vec3.fromValues(0,0,0),e.position&&(this._position=e.position),e.distance&&(this._distance=e.distance),e.decay&&(this._decay=e.decay)}get decay(){return this._decay}set decay(e){this._decay=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get distance(){return this._distance}set distance(e){this._distance=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get position(){return this._position}set position(e){this._position=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}clone(){return new a({color:this.color,position:this.position,distance:this.distance,decay:this.decay,intensity:this.intensity,name:this.name})}}t.PointLight=a},4410:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpotLight=void 0;const i=n(887),r=n(4304),s=n(3995);class a extends s.AbstractLight{constructor(e){super({color:e.color||"#ffffff",intensity:e.intensity||.5,type:r.LIGHTTYPE.SPOT,name:e.name}),this._angle=Math.PI/4,this._decay=1,this._distance=0,this._penumbra=.5,this._position=i.vec3.fromValues(-1,0,1),this._target=i.vec3.fromValues(0,0,0),e.position&&(this._position=e.position),e.target&&(this._target=e.target),e.distance&&(this._distance=e.distance),e.decay&&(this._decay=e.decay),e.angle&&(this._angle=e.angle),e.penumbra&&(this._penumbra=e.penumbra)}get angle(){return this._angle}set angle(e){this._angle=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get decay(){return this._decay}set decay(e){this._decay=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get distance(){return this._distance}set distance(e){this._distance=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get penumbra(){return this._penumbra}set penumbra(e){this._penumbra=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get position(){return this._position}set position(e){this._position=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}get target(){return this._target}set target(e){this._target=e,this.updateVersion(),this._updateCBs.forEach((e=>e()))}clone(){return new a({color:this.color,position:this.position,target:this.target,distance:this.distance,decay:this.decay,angle:this.angle,penumbra:this.penumbra,intensity:this.intensity,name:this.name})}}t.SpotLight=a},3490:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpotLight=t.PointLight=t.HemisphereLight=t.DirectionalLight=t.AmbientLight=t.AbstractLight=t.LightScene=t.LIGHTTYPE=t.LightEngine=void 0;const i=n(3995);Object.defineProperty(t,"AbstractLight",{enumerable:!0,get:function(){return i.AbstractLight}});const r=n(4739);Object.defineProperty(t,"LightEngine",{enumerable:!0,get:function(){return r.LightEngine}});const s=n(4771);Object.defineProperty(t,"LightScene",{enumerable:!0,get:function(){return s.LightScene}});const a=n(3955);Object.defineProperty(t,"AmbientLight",{enumerable:!0,get:function(){return a.AmbientLight}});const o=n(3520);Object.defineProperty(t,"DirectionalLight",{enumerable:!0,get:function(){return o.DirectionalLight}});const l=n(3447);Object.defineProperty(t,"HemisphereLight",{enumerable:!0,get:function(){return l.HemisphereLight}});const c=n(4163);Object.defineProperty(t,"PointLight",{enumerable:!0,get:function(){return c.PointLight}});const h=n(4410);Object.defineProperty(t,"SpotLight",{enumerable:!0,get:function(){return h.SpotLight}});const u=n(4304);Object.defineProperty(t,"LIGHTTYPE",{enumerable:!0,get:function(){return u.LIGHTTYPE}})},4304:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.LIGHTTYPE=void 0,(n=t.LIGHTTYPE||(t.LIGHTTYPE={})).AMBIENT="ambient",n.DIRECTIONAL="directional",n.HEMISPHERE="hemisphere",n.POINT="point",n.RECTANGLE="rectangle",n.SPOT="spot"},3673:(e,t)=>{"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.VISIBILITYMODE=t.RENDERERTYPE=void 0,(i=t.RENDERERTYPE||(t.RENDERERTYPE={})).STANDARD="standard",i.BASIC="basic",(n=t.VISIBILITYMODE||(t.VISIBILITYMODE={})).INSTANT="instant",n.SESSION="session",n.MANUAL="manual"},2248:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VISIBILITYMODE=t.RENDERERTYPE=void 0;const i=n(3673);Object.defineProperty(t,"RENDERERTYPE",{enumerable:!0,get:function(){return i.RENDERERTYPE}}),Object.defineProperty(t,"VISIBILITYMODE",{enumerable:!0,get:function(){return i.VISIBILITYMODE}})},5421:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Reader=void 0;const r=n(1585),s=n(9882);t.Reader=class{readFromUri(e){return i(this,void 0,void 0,(function*(){if(!e)return null;const t=yield(new r.Encoder).encodeFromUriToArrayBuffer(e);return t?this.readFromArrayBuffer(t):null}))}readFromArrayBuffer(e){return i(this,void 0,void 0,(function*(){if(!e)return null;const t=yield(new r.Encoder).encodeFromArrayBufferToJson(e);return t?this.readFromJson(t.json,t.binaryData):null}))}readFromJson(e,t){return i(this,void 0,void 0,(function*(){return e?(new s.SdtfFactory).create(e,t):null}))}}},1436:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfAttributeData=void 0;const i=n(3858);class r extends i.AbstractTreeNodeData{constructor(e,t){super(t),this._attributes=e}get data(){return this._attributes.attributes}set data(e){this._attributes.attributes=e}clone(){return new r(this._attributes,this.id)}}t.SdtfAttributeData=r},9882:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfFactory=void 0;const i=n(2140);t.SdtfFactory=class{create(e,t){const n=this.createTypeHints(e),r=this.createBuffers(e,t),s=this.createBufferViews(e,r),a=this.createAccessors(e,s),o=this.createAttributes(e,a,n),l=this.createItems(e,n,a,o),c=this.createNodes(e,l,n,o),h=this.createChunks(e,l,n,o,c);return new i.SdtfFile(h,n)}createTypeHints(e){const t=[];for(let n=0;n<e.typeHints.length;n++)t.push(new i.SdtfTypeHint(e.typeHints[n].name));return t}createBuffers(e,t){const n=[];for(let r=0;r<e.buffers.length;r++)n.push(new i.SdtfBuffer(e.buffers[r].byteLength,e.buffers[r].uri,t));return n}createBufferViews(e,t){const n=[];for(let r=0;r<e.bufferViews.length;r++)n.push(new i.SdtfBufferView(t[e.bufferViews[r].buffer],e.bufferViews[r].byteLength,e.bufferViews[r].byteOffset,e.bufferViews[r].contentType,e.bufferViews[r].contentEncoding,e.bufferViews[r].name));return n}createAccessors(e,t){const n=[];for(let r=0;r<e.accessors.length;r++)n.push(new i.SdtfAccessor(t[e.accessors[r].bufferView],e.accessors[r].id));return n}createAttributes(e,t,n){const r=[];for(let s=0;s<e.attributes.length;s++){const a=e.attributes[s],o={},l=new i.SdtfDataFactory;for(let e in a)o[e]=l.createAttribute(n[a[e].typeHint],void 0!==a[e].accessor?t[a[e].accessor]:void 0,a[e].value);r.push(new i.SdtfAttributes(o))}return r}createItems(e,t,n,r){const s=[],a=new i.SdtfDataFactory;for(let i=0;i<e.items.length;i++)s.push(a.createItem(t[e.items[i].typeHint],void 0!==e.items[i].accessor?n[e.items[i].accessor]:void 0,e.items[i].value,void 0!==e.items[i].attributes?r[e.items[i].attributes]:void 0));return s}createNodes(e,t,n,r){const s=[];for(let a=0;a<e.nodes.length;a++){const o=[];if(void 0!==e.nodes[a].items)for(let n=0;n<e.nodes[a].items.length;n++)o.push(t[e.nodes[a].items[n]]);s.push(new i.SdtfNode(o,[],void 0!==e.nodes[a].attributes?r[e.nodes[a].attributes]:void 0,e.nodes[a].name,void 0!==e.nodes[a].typeHint?n[e.nodes[a].typeHint]:void 0))}for(let t=0;t<e.nodes.length;t++){const n=[];if(void 0!==e.nodes[t].nodes)for(let i=0;i<e.nodes[t].nodes.length;i++)n.push(s[e.nodes[t].nodes[i]]);s[t].nodes=n}return s}createChunks(e,t,n,r,s){const a=[];for(let o=0;o<e.chunks.length;o++){const l=[];if(void 0!==e.chunks[o].items)for(let n=0;n<e.chunks[o].items.length;n++)l.push(t[e.chunks[o].items[n]]);const c=[];if(void 0!==e.chunks[o].nodes)for(let t=0;t<e.chunks[o].nodes.length;t++)c.push(s[e.chunks[o].nodes[t]]);a.push(new i.SdtfChunk(l,c,void 0!==e.chunks[o].attributes?r[e.chunks[o].attributes]:void 0,e.chunks[o].name,void 0!==e.chunks[o].typeHint?n[e.chunks[o].typeHint]:void 0))}return a}}},4662:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfItemData=void 0;const i=n(3858),r=n(1436);class s extends i.AbstractTreeNodeData{constructor(e,t){super(t),this._item=e,this._item.attributes&&(this._attributes=new r.SdtfAttributeData(this._item.attributes))}get attributes(){return this._attributes}set attributes(e){this._attributes=e}get data(){return this._item.data}set data(e){this._item.data=e}clone(){return new s(this._item,this.id)}}t.SdtfItemData=s},1230:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfFile=t.SdtfItemData=t.SdtfAttributeData=t.Reader=void 0;const i=n(2140);Object.defineProperty(t,"SdtfFile",{enumerable:!0,get:function(){return i.SdtfFile}});const r=n(5421);Object.defineProperty(t,"Reader",{enumerable:!0,get:function(){return r.Reader}});const s=n(1436);Object.defineProperty(t,"SdtfAttributeData",{enumerable:!0,get:function(){return s.SdtfAttributeData}});const a=n(4662);Object.defineProperty(t,"SdtfItemData",{enumerable:!0,get:function(){return a.SdtfItemData}})},6792:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Encoder=void 0;const r=n(4562),s=n(2899),a=n(4171);t.Encoder=class{constructor(){this.BINARY_EXTENSION_HEADER_LENGTH=20,this._httpClient=s.container.resolve(r.HttpClient),this._logger=s.container.resolve(a.Logger)}encodeFromUriToArrayBuffer(e){return i(this,void 0,void 0,(function*(){if(""===e)return null;let t;try{t=yield this._httpClient.get(e,{responseType:"arraybuffer"})}catch(e){return this._logger.error("Was not able to get array buffer from uri.",e,e.response&&e.response.status?e.response.status:null),null}return t.headers["content-type"]&&"model/vnd.sdtf"===t.headers["content-type"]?t.data instanceof ArrayBuffer?t.data:t.data.buffer:(this._logger.error("Non-binary SDTF encoding not implemented."),null)}))}encodeFromArrayBufferToJson(e){return i(this,void 0,void 0,(function*(){const t=new DataView(e,0,this.BINARY_EXTENSION_HEADER_LENGTH);if("sdtf"!==String.fromCharCode(t.getUint8(0))+String.fromCharCode(t.getUint8(1))+String.fromCharCode(t.getUint8(2))+String.fromCharCode(t.getUint8(3)))return this._logger.error("Invalid data: sdtf magic wrong."),null;const n=t.getUint32(4,!0);if(1!==n)return this._logger.error(`Invalid version: sdtf loader does not support version ${n}.`),null;const i=t.getUint32(8,!0),r=t.getUint32(12,!0);return 0!==t.getUint32(16,!0)?(this._logger.error("Content format is not Json (0), content invalid."),null):{json:JSON.parse((new TextDecoder).decode(new DataView(e,this.BINARY_EXTENSION_HEADER_LENGTH,r))),binaryData:e.slice(this.BINARY_EXTENSION_HEADER_LENGTH+r,i)}}))}encodeFromUriToJson(e){return i(this,void 0,void 0,(function*(){const t=yield this.encodeFromUriToArrayBuffer(e);return t?yield this.encodeFromArrayBufferToJson(t):null}))}}},1585:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Encoder=void 0;const i=n(6792);Object.defineProperty(t,"Encoder",{enumerable:!0,get:function(){return i.Encoder}})},6273:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfFile=void 0,t.SdtfFile=class{constructor(e=[],t=[]){this._chunks=e,this._typeHints=t}get chunks(){return this._chunks}get typeHints(){return this._typeHints}}},1135:(e,t)=>{"use strict";var n,i,r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.RHINOTYPEHINT=t.GEOMETRYTYPEHINT=t.PRIMITIVETYPEHINT=t.CONTENT_ENCODING=t.CONTENTTYPE=void 0,(s=t.CONTENTTYPE||(t.CONTENTTYPE={})).IMAGE_JPEG="image/jpeg",s.IMAGE_PNG="image/png",s.IMAGE_TIF="image/tif",s.IMAGE_GIF="image/gif",s.IMAGE_BMP="image/bmp",s.MODEL_VND_3DM="model/vnd.3dm",(r=t.CONTENT_ENCODING||(t.CONTENT_ENCODING={})).GZIP="gzip",r.COMPRESS="compress",r.DEFLATE="deflate",r.IDENTITY="identity",r.BR="br",(i=t.PRIMITIVETYPEHINT||(t.PRIMITIVETYPEHINT={})).DOUBLE="double",i.STRING="string",i.BOOL="bool",i.FLOAT="float",i.DECIMAL="decimal",i.CULTUREINFO="cultureinfo",i.INT="int",(n=t.GEOMETRYTYPEHINT||(t.GEOMETRYTYPEHINT={})).COMPLEX="geometry.complex",n.INTERVAL2="geometry.interval2",n.PATH="grasshopper.path",n.ARC="geometry.arc",n.BOUNDINGBOX="geometry.boundingbox",n.BOX="geometry.box",n.CIRCLE="geometry.circle",n.CONE="geometry.cone",n.CYLINDER="geometry.cylinder",n.ELLIPSE="geometry.ellipse",n.INTERVAL="geometry.interval",n.LINE="geometry.line",n.MATRIX="geometry.matrix",n.PLANE="geometry.plane",n.POINT2D="geometry.point2d",n.POINT2F="geometry.point2f",n.POINT3D="geometry.point3d",n.POINT3F="geometry.point3f",n.POINT4D="geometry.point4d",n.POLYLINE="geometry.polyline",n.RAY="geometry.ray",n.RECTANGLE="geometry.rectangle",n.SPHERE="geometry.sphere",n.TORUS="geometry.torus",n.TRANSFORM="geometry.transform",n.VECTOR2D="geometry.vector2d",n.VECTOR2F="geometry.vector2f",n.VECTOR3D="geometry.vector3d",n.VECTOR3F="geometry.vector3f",(t.RHINOTYPEHINT||(t.RHINOTYPEHINT={})).TEMP="temp"},9130:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfAccessor=void 0,t.SdtfAccessor=class{constructor(e,t){this._bufferView=e,this._id=t}get bufferView(){return this._bufferView}get id(){return this._id}load(){return n(this,void 0,void 0,(function*(){return this._data||(this._data=yield this.bufferView.load()),this._data}))}}},5251:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfBuffer=void 0;const r=n(4562),s=n(2899),a=n(4171);t.SdtfBuffer=class{constructor(e,t,n){this._byteLength=e,this._uri=t,this._binaryData=n,this._httpClient=s.container.resolve(r.HttpClient),this._logger=s.container.resolve(a.Logger),this._uri||(this._arrayBuffer=this._binaryData)}get byteLength(){return this._byteLength}get uri(){return this._uri}load(){return i(this,void 0,void 0,(function*(){if(this._arrayBuffer)return this._arrayBuffer;let e;try{e=yield this._httpClient.get(this.uri,{responseType:"arraybuffer"})}catch(e){return this._logger.error("Initial loading of geometry failed.",e,e.response&&e.response.status?e.response.status:null),null}return this._arrayBuffer=e.data,this._arrayBuffer}))}}},9472:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfBufferView=void 0;const r=n(1135),s=n(4171),a=n(2899);t.SdtfBufferView=class{constructor(e,t,n,i,r,o){this._buffer=e,this._byteLength=t,this._byteOffset=n,this._contentType=i,this._contentEncoding=r,this._name=o,this._logger=a.container.resolve(s.Logger)}get buffer(){return this._buffer}get byteLength(){return this._byteLength}get byteOffset(){return this._byteOffset}get contentEncoding(){return this._contentEncoding}get contentType(){return this._contentType}get name(){return this._name}load(){return i(this,void 0,void 0,(function*(){if(this._data)return this._data;const e=this.byteLength||0,t=this.byteOffset||0,n=yield this.buffer.load();if(!n)return null;const i=n.slice(t,t+e);if(Object.values(r.CONTENTTYPE).includes(this.contentType)&&this.contentType!==r.CONTENTTYPE.MODEL_VND_3DM){const e=new FileReader;return e.readAsDataURL(new Blob([new Uint8Array(i).buffer],{type:this.contentType})),this._data=new Image,yield new Promise((t=>{e.onload=()=>{this._data.src=e.result,t()}})),this._data}return this._logger.error('The MIME type "model/vnd.3dm" is currently not implemented.'),null}))}}},9593:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfChunk=void 0;const i=n(1733);class r extends i.SdtfNode{constructor(e=[],t=[],n,i,r){super(e,t,n,i,r)}}t.SdtfChunk=r},1733:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfNode=void 0,t.SdtfNode=class{constructor(e=[],t=[],n,i,r){this._items=e,this._nodes=t,this._attributes=n,this._name=i,this._typeHint=r}get attributes(){return this._attributes}get items(){return this._items}get name(){return this._name}get nodes(){return this._nodes}set nodes(e){this._nodes=e}get typeHint(){return this._typeHint}}},5121:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfTypeHint=void 0,t.SdtfTypeHint=class{constructor(e){this._name=e}get name(){return this._name}}},2342:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractSdtfData=void 0,t.AbstractSdtfData=class{constructor(e,t,n,i){this._typeHint=e,this._accessor=t,this._value=n,this._attributes=i}get accessor(){return this._accessor}get attributes(){return this._attributes}set attributes(e){this._attributes=e}get typeHint(){return this._typeHint}get value(){return this._value}}},7488:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfDataFactory=void 0;const i=n(1135),r=n(7775),s=n(4002),a=n(6307);t.SdtfDataFactory=class{createItem(e,t,n,a){switch(!0){case e.name===i.PRIMITIVETYPEHINT.BOOL:case e.name===i.PRIMITIVETYPEHINT.DOUBLE||e.name===i.PRIMITIVETYPEHINT.FLOAT||e.name===i.PRIMITIVETYPEHINT.DECIMAL||e.name===i.PRIMITIVETYPEHINT.INT:case e.name===i.PRIMITIVETYPEHINT.STRING:return new s.SdtfPrimitiveItem(e,t,n,a);default:return new r.SdtfCustomItem(e,t,n,a)}}createAttribute(e,t,n){return new a.SdtfAttribute(e,t,n)}}},6307:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfAttribute=void 0;const i=n(2342);class r extends i.AbstractSdtfData{get data(){return void 0!==this.value?Promise.resolve(this.value):this.accessor.load()}set data(e){e.then((e=>{this._value=e}))}}t.SdtfAttribute=r},1891:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfAttributes=void 0,t.SdtfAttributes=class{constructor(e){this._attributes=e}get attributes(){return this._attributes}set attributes(e){this._attributes=e}}},7775:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfCustomItem=void 0;const i=n(2342);class r extends i.AbstractSdtfData{get data(){return void 0!==this.value?Promise.resolve(this.value):this.accessor.load()}set data(e){e.then((e=>{this._value=e}))}}t.SdtfCustomItem=r},4002:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdtfPrimitiveItem=void 0;const i=n(2342);class r extends i.AbstractSdtfData{get data(){return Promise.resolve(this._value)}set data(e){e.then((e=>{this._value=e}))}}t.SdtfPrimitiveItem=r},2140:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTENT_ENCODING=t.CONTENTTYPE=t.RHINOTYPEHINT=t.GEOMETRYTYPEHINT=t.PRIMITIVETYPEHINT=t.SdtfDataFactory=t.SdtfAttributes=t.SdtfAccessor=t.SdtfBuffer=t.SdtfBufferView=t.SdtfData=t.SdtfTypeHint=t.SdtfNode=t.SdtfChunk=t.SdtfFile=void 0;const i=n(9593);Object.defineProperty(t,"SdtfChunk",{enumerable:!0,get:function(){return i.SdtfChunk}});const r=n(1733);Object.defineProperty(t,"SdtfNode",{enumerable:!0,get:function(){return r.SdtfNode}});const s=n(2342);Object.defineProperty(t,"SdtfData",{enumerable:!0,get:function(){return s.AbstractSdtfData}});const a=n(6273);Object.defineProperty(t,"SdtfFile",{enumerable:!0,get:function(){return a.SdtfFile}});const o=n(5121);Object.defineProperty(t,"SdtfTypeHint",{enumerable:!0,get:function(){return o.SdtfTypeHint}});const l=n(7488);Object.defineProperty(t,"SdtfDataFactory",{enumerable:!0,get:function(){return l.SdtfDataFactory}});const c=n(9130);Object.defineProperty(t,"SdtfAccessor",{enumerable:!0,get:function(){return c.SdtfAccessor}});const h=n(1891);Object.defineProperty(t,"SdtfAttributes",{enumerable:!0,get:function(){return h.SdtfAttributes}});const u=n(5251);Object.defineProperty(t,"SdtfBuffer",{enumerable:!0,get:function(){return u.SdtfBuffer}});const d=n(9472);Object.defineProperty(t,"SdtfBufferView",{enumerable:!0,get:function(){return d.SdtfBufferView}});const p=n(1135);Object.defineProperty(t,"PRIMITIVETYPEHINT",{enumerable:!0,get:function(){return p.PRIMITIVETYPEHINT}}),Object.defineProperty(t,"GEOMETRYTYPEHINT",{enumerable:!0,get:function(){return p.GEOMETRYTYPEHINT}}),Object.defineProperty(t,"RHINOTYPEHINT",{enumerable:!0,get:function(){return p.RHINOTYPEHINT}}),Object.defineProperty(t,"CONTENT_ENCODING",{enumerable:!0,get:function(){return p.CONTENT_ENCODING}}),Object.defineProperty(t,"CONTENTTYPE",{enumerable:!0,get:function(){return p.CONTENTTYPE}})},5934:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutputDelayException=void 0;class n extends Error{constructor(e){super(),this._delay=e}get delay(){return this._delay}}t.OutputDelayException=n},4919:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OutputLoader=void 0;const r=n(2899),s=n(7038),a=n(5254),o=n(5934),l=n(3574),c=n(5414);t.OutputLoader=class{constructor(){this._dataEngine=r.container.resolve(a.DataEngine),this._outputNodes={}}loadOutputs(e,t){return i(this,void 0,void 0,(function*(){const n=new l.SessionTreeNode(e.name);let i={},r=[],s=0;for(let e in t)i[e]={},this._outputNodes[e]||(this._outputNodes[e]={}),this._outputNodes[e][t[e].version]||(t[e].delay?s=Math.max(s,t[e].delay):(i[e][t[e].version]=this.loadOutput(e,t[e]),r.push(i[e][t[e].version])));if(s)throw new o.OutputDelayException(s);yield Promise.all(r);for(let e in t)this._outputNodes[e][t[e].version]||(this._outputNodes[e][t[e].version]=yield i[e][t[e].version]),n.addChild(this._outputNodes[e][t[e].version]);for(let e in t)for(let n in this._outputNodes[e])n!==t[e].version&&delete this._outputNodes[e][n];return this.assignMaterials(n),n}))}assignMaterials(e){for(let t=0;t<e.children.length;t++){const n=e.children[t];if(!n)continue;const i=(e,t)=>{for(let n=0;n<e.data.length;n++)e.data[n]instanceof s.GeometryData&&(e.data[n].primitive.material=t);for(let n=0;n<e.children.length;n++){const r=e.children[n];r&&i(r,t)}};let r=null;for(let t=0;t<n.data.length;t++){if(!(n.data[t]instanceof c.SessionOutputData))continue;const i=n.data[t];if(i.sessionOutput.material){for(let n=0;n<e.children.length;n++){const a=e.children[n];if(a&&a.name===i.sessionOutput.material){const e=n=>{for(let e=0;e<n.data.length;e++)if(n.data[e]instanceof s.MaterialData)return n.data[e];for(let i=0;i<n.children.length;i++){const i=n.children[t];if(!i)continue;let r=e(i);if(r)return r}return null};r=e(a)}}if(r)break}}r&&i(n,r)}}loadOutput(e,t){return i(this,void 0,void 0,(function*(){const n=new l.SessionTreeNode(e);if(n.data.push(new c.SessionOutputData(t)),t.content)for(let e=0,i=t.content.length;e<i;e++)n.addChild(yield this.loadContent("content_"+e,t.content[e]));return n}))}loadContent(e,t){return i(this,void 0,void 0,(function*(){const n=new l.SessionTreeNode(e);return n.addChild(yield this._dataEngine.loadContent(t)),n}))}}},1224:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;const r=n(5934),s=n(4919),a=n(3574),o=n(4562),l=n(2899),c=n(8877),h=n(4171),u=n(9044),d=n(6042);t.Session=class{constructor(e){this._exports={},this._httpClient=l.container.resolve(o.HttpClient),this._logger=l.container.resolve(h.Logger),this._outputs={},this._outputsCreated={},this._parameters={},this._parameterValues={},this._sessionEngineId=l.container.resolve(o.UuidGenerator).create(),this._closed=!1,this._headers={"X-ShapeDiver-Origin":l.container.resolve(c.SystemInfo).origin,"X-ShapeDiver-SessionEngineId":this._sessionEngineId,"X-ShapeDiver-BuildVersion":"","X-ShapeDiver-BuildDate":""},this._initialized=!1,this._settingsConfig={},this._updateCBs=[],this._id=e.id,this._ticket=e.ticket,this._modelViewUrl=e.modelViewUrl,this._bearerToken=e.bearerToken,this._headers["X-ShapeDiver-BuildDate"]=e.buildDate,this._headers["X-ShapeDiver-BuildVersion"]=e.buildVersion,this._outputLoader=new s.OutputLoader}get authorTicket(){return this._authorTicket}set authorTicket(e){this._authorTicket=e,this._updateCBs.forEach((e=>e()))}get bearerToken(){return this._bearerToken}set bearerToken(e){this._bearerToken=e,this._updateCBs.forEach((e=>e()))}get exports(){return this._exports}get id(){return this._id}get initialized(){return this._initialized}get modelViewUrl(){return this._modelViewUrl}get outputs(){return this._outputs}get parameters(){return this._parameters}get parameterValues(){return this._parameterValues}set refreshBearerToken(e){this._refreshBearerToken=e,this._updateCBs.forEach((e=>e()))}get sessionResponse(){return this._sessionResponse}get settingsConfig(){return this._settingsConfig}get ticket(){return this._ticket}close(){var e,t;return i(this,void 0,void 0,(function*(){if(this._closed=!0,this._initialized)try{yield this.sessionCommunication(null===(e=this._sessionResponse.actions)||void 0===e?void 0:e.filter((e=>"close"===e.name))[0].href,null===(t=this._sessionResponse.actions)||void 0===t?void 0:t.filter((e=>"close"===e.name))[0].method,null,"application/json")}catch(e){return this._logger.error("Session closing failed.",e,e.response&&e.response.status?e.response.status:null),!1}return!0}))}customize(){return i(this,void 0,void 0,(function*(){return this.customizeSession(this._parameterValues)}))}init(){var e,t;return i(this,void 0,void 0,(function*(){if(!0===this._initialized)return this._logger.error("Session already initialized."),this.loadOutputs(this._parameterValues);try{let n;try{n=(yield this.sessionCommunication(this._modelViewUrl+"/ticket/"+this._ticket,"post",null)).data}catch(e){return this._logger.error("Session init failed.",e,e.response&&e.response.status?e.response.status:null),new a.SessionTreeNode}return this._settingsConfig=n.config,this._sessionResponse=this.mergeResponses(this._sessionResponse,n,this._parameters,this._outputs,this._exports),this._authorTicket=!(!(null===(e=this._sessionResponse.actions)||void 0===e?void 0:e.filter((e=>"defaultparam"===e.name))[0])||!(null===(t=this._sessionResponse.actions)||void 0===t?void 0:t.filter((e=>"configure"===e.name))[0])),this._initialized=!0,this._updateCBs.forEach((e=>e())),this.loadOutputs(this._parameterValues)}catch(e){return this._logger.error("Something went wrong at session init.",e),new a.SessionTreeNode}}))}mergeResponses(e,t,n,i,r){if(e||(e={version:t.version}),t.version&&(e.version=t.version),t.collection&&(e.collection=t.collection),t.actions)for(let n=0,i=t.actions.length;n<i;n++)e.actions=e.actions||[],-1===e.actions.findIndex((e=>e.name===t.actions[n].name))&&e.actions.push(t.actions[n]);if(t.templates)for(let n=0,i=t.templates.length;n<i;n++)e.templates=e.templates||[],-1===e.templates.findIndex((e=>e.name===t.actions[n].name))&&e.templates.push(t.templates[n]);if(t.config&&!e.config&&(e.config=t.config),t.name&&!e.name&&(e.name=t.name),t.parameters)for(let n in t.parameters)e.parameters=e.parameters||{},e.parameters[n]=e.parameters[n]||t.parameters[n];if(t.outputs)for(let n in t.outputs)e.outputs=e.outputs||{},!("version"in t.outputs[n])&&e.outputs[n]&&"version"in e.outputs[n]||(e.outputs[n]=t.outputs[n]);if(t.exports)for(let n in t.exports)e.exports=e.exports||{},!("version"in t.exports[n])&&e.exports[n]&&"version"in e.exports[n]||(e.exports[n]=t.exports[n]);if(n)for(let t in e.parameters)n[t]||(n[t]=e.parameters[t],n[t].id=t);if(r)for(let t in e.exports)e.exports[t].type!==u.ShapeDiverResponseExportDefinitionType.EMAIL&&e.exports[t].type!==u.ShapeDiverResponseExportDefinitionType.DOWNLOAD||(r[t]=e.exports[t],r[t].id=t);if(i)for(let t in e.outputs)i[t]=e.outputs[t],i[t].id=t;return e}saveDefaultParameters(){var e,t,n;return i(this,void 0,void 0,(function*(){if(!(null===(e=this._sessionResponse.actions)||void 0===e?void 0:e.filter((e=>"defaultparam"===e.name))[0]))return this._logger.error("Session has to be in edit mode to be able to save the settings."),!1;try{return yield this.sessionCommunication(null===(t=this._sessionResponse.actions)||void 0===t?void 0:t.filter((e=>"defaultparam"===e.name))[0].href,null===(n=this._sessionResponse.actions)||void 0===n?void 0:n.filter((e=>"defaultparam"===e.name))[0].method,this._parameterValues,"application/json"),!0}catch(e){return this._logger.error("Saving of default parameters failed.",e,e.response&&e.response.status?e.response.status:null),!1}}))}saveSettings(e){var t,n,r;return i(this,void 0,void 0,(function*(){if(!(null===(t=this._sessionResponse.actions)||void 0===t?void 0:t.filter((e=>"configure"===e.name))[0]))return this._logger.error("Session has to be in edit mode to be able to save the settings."),!1;try{return yield this.sessionCommunication(null===(n=this._sessionResponse.actions)||void 0===n?void 0:n.filter((e=>"configure"===e.name))[0].href,null===(r=this._sessionResponse.actions)||void 0===r?void 0:r.filter((e=>"configure"===e.name))[0].method,e,"application/json"),!0}catch(e){return this._logger.error("Saving of settings failed.",e,e.response&&e.response.status?e.response.status:null),!1}}))}sessionCommunication(e,t,n,r){return i(this,void 0,void 0,(function*(){let i=this._bearerToken?Object.assign({Authorization:this._bearerToken},this._headers):this._headers;if(r&&(i=Object.assign({"Content-Type":r},this._headers)),"post"!==(t=t.toLowerCase())&&"get"!==t)throw new Error("Method "+t+" not recognized.");try{return yield this._httpClient[t](e,{data:n,headers:i})}catch(i){if(i.response&&i.response.status&&403===i.response.status&&i.response.data&&("SdJwtValidationError"===i.response.data.error||"SdErrorUnauthorized"===i.response.data.error)){if(this._refreshBearerToken){const s=this.bearerToken,a=this._refreshBearerToken();if(s===a)throw this._logger.error('Session request failed. Bearer Token invalid, callback "refreshBearerToken" supplied the same token.'),i;return this.bearerToken=a,this.sessionCommunication(e,t,n,r)}throw this._logger.error('Session request failed. Bearer Token invalid, please try to supply a valid token or assign the "refreshBearerToken" callback.'),i}throw i}}))}customizeSession(e){var t;return i(this,void 0,void 0,(function*(){if(!1===this._initialized)return this._logger.error("Session not initialized."),new a.SessionTreeNode;try{let n;try{n=(yield this.sessionCommunication(null===(t=this._sessionResponse.actions)||void 0===t?void 0:t.filter((e=>"customize"===e.name))[0].href,"post",e,"application/json")).data}catch(t){return t.response&&t.response.status&&t.response&&t.response.status&&410===t.response.status&&!this._closed?(this._logger.info("Session customization failed. Session expired. Re-initializing session."),this._initialized=!1,this._updateCBs.forEach((e=>e())),yield this.init(),this.customizeSession(e)):(this._logger.error("Session customization failed.",t,t.response&&t.response.status?t.response.status:null),new a.SessionTreeNode)}return this._sessionResponse=this.mergeResponses(this._sessionResponse,n,this._parameters,this._outputs,this._exports),this.loadOutputs(e)}catch(e){return this._logger.error("Something went wrong at session customization.",e),new a.SessionTreeNode}}))}loadOutputs(e){var t,n;return i(this,void 0,void 0,(function*(){const i=Object.assign({},this._outputs,this._outputsCreated);try{const e=yield this._outputLoader.loadOutputs(this._sessionResponse,i);return e.data.push(new d.SessionData(this._sessionResponse)),e}catch(s){s instanceof r.OutputDelayException&&(yield this.timeout(s.delay));let a={};for(let e in i)a[e]=i[e].version;let o=(yield this.sessionCommunication(null===(t=this._sessionResponse.actions)||void 0===t?void 0:t.filter((e=>"cache"===e.name))[0].href,null===(n=this._sessionResponse.actions)||void 0===n?void 0:n.filter((e=>"cache"===e.name))[0].method.toLowerCase(),a,"application/json")).data;return this._sessionResponse=this.mergeResponses(this._sessionResponse,o,this._parameters,this._outputs,this._exports),yield this.loadOutputs(e)}}))}timeout(e){return i(this,void 0,void 0,(function*(){return new Promise((t=>setTimeout(t,e)))}))}addUpdateCB(e){this._updateCBs.push(e)}}},6042:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionData=void 0;const i=n(3858);class r extends i.AbstractTreeNodeData{constructor(e,t){super(t),this._session=e}get session(){return this._session}set session(e){this._session=e}clone(){return new r(this.session,this._id)}}t.SessionData=r},5414:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionOutputData=void 0;const i=n(3858);class r extends i.AbstractTreeNodeData{constructor(e,t){super(t),this._sessionOutput=e}get sessionOutput(){return this._sessionOutput}set sessionOutput(e){this._sessionOutput=e}clone(){return new r(this.sessionOutput,this._id)}}t.SessionOutputData=r},3574:function(e,t,n){"use strict";var i,r=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionTreeNode=void 0;const s=n(3858);class a extends s.TreeNode{constructor(e,t,n,r,s){super(e,n,r,s),i.set(this,!0),t&&(this.id=t)}get sessionNode(){return r(this,i,"f")}}t.SessionTreeNode=a,i=new WeakMap},9878:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionOutputData=t.SessionData=t.Session=void 0;const i=n(1224);Object.defineProperty(t,"Session",{enumerable:!0,get:function(){return i.Session}});const r=n(5414);Object.defineProperty(t,"SessionOutputData",{enumerable:!0,get:function(){return r.SessionOutputData}});const s=n(6042);Object.defineProperty(t,"SessionData",{enumerable:!0,get:function(){return s.SessionData}})},8721:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Box=void 0;const i=n(887),r=n(2113);class s{constructor(e=i.vec3.create(),t=i.vec3.create()){this._min=e,this._max=t,this._boundingSphere=new r.Sphere,this._boundingSphereState={min:i.vec3.create(),max:i.vec3.create()}}intersect(e,t){let n,i,r,s,a,o,l,c;const h=1/t[0],u=1/t[1],d=1/t[2];return r=h>=0?(this.min[0]-e[0])*h:(this.max[0]-e[0])*h,s=h>=0?(this.max[0]-e[0])*h:(this.min[0]-e[0])*h,n=r,i=s,a=u>=0?(this.min[1]-e[1])*u:(this.max[1]-e[1])*u,o=u>=0?(this.max[1]-e[1])*u:(this.min[1]-e[1])*u,n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),l=d>=0?(this.min[2]-e[2])*d:(this.max[2]-e[2])*d,c=d>=0?(this.max[2]-e[2])*d:(this.min[2]-e[2])*d,n>c||l>i?null:((l>n||n!=n)&&(n=l),(c<i||i!=i)&&(i=c),i<0?null:n>=0?n:i))}get boundingSphere(){return i.vec3.equals(this._boundingSphereState.min,this.min)&&i.vec3.equals(this._boundingSphereState.max,this.max)||(this._boundingSphere.setFromBox(this),this._boundingSphereState={min:i.vec3.clone(this.min),max:i.vec3.clone(this.max)}),this._boundingSphere}get max(){return this._max}set max(e){this._max=e}get min(){return this._min}set min(e){this._min=e}applyMatrix(e){return i.vec3.transformMat4(this.min,this.min,e),i.vec3.transformMat4(this.max,this.max,e),this}clone(){return new s(i.vec3.clone(this.min),i.vec3.clone(this.max))}containsPoint(e){return!(e[0]<this.min[0]||e[0]>this.max[0]||e[1]<this.min[1]||e[1]>this.max[1]||e[2]<this.min[2]||e[2]>this.max[2])}clampPoint(e){return e}setFromAttributeArray(e){let t=1/0,n=1/0,r=1/0,s=-1/0,a=-1/0,o=-1/0;for(let i=0;i<e.length;i+=3){const l=e[i],c=e[i+1],h=e[i+2];l<t&&(t=l),c<n&&(n=c),h<r&&(r=h),l>s&&(s=l),c>a&&(a=c),h>o&&(o=h)}return this.min=i.vec3.fromValues(t,n,r),this.max=i.vec3.fromValues(s,a,o),this}union(e){return e.min[0]<this.min[0]&&(this.min[0]=e.min[0]),e.min[1]<this.min[1]&&(this.min[1]=e.min[1]),e.min[2]<this.min[2]&&(this.min[2]=e.min[2]),e.max[0]>this.max[0]&&(this.max[0]=e.max[0]),e.max[1]>this.max[1]&&(this.max[1]=e.max[1]),e.max[2]>this.max[2]&&(this.max[2]=e.max[2]),this}}t.Box=s},3065:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Plane=void 0;const i=n(887);class r{constructor(e=i.vec3.fromValues(1,0,0),t=0){this._normal=e,this._constant=t}get constant(){return this._constant}set constant(e){this._constant=e}get normal(){return this._normal}set normal(e){this._normal=e}applyMatrix(e){throw new Error("Method not implemented.")}clampPoint(e){const t=-this.distanceToPoint(e);return i.vec3.add(i.vec3.create(),i.vec3.multiply(i.vec3.create(),this.normal,i.vec3.fromValues(t,t,t)),e)}clone(){return new r(this._normal,this._constant)}containsPoint(e){throw new Error("Method not implemented.")}distanceToPoint(e){return i.vec3.dot(this.normal,e)+this.constant}intersect(e,t){const n=i.vec3.dot(this.normal,t);if(0===n)return 0===this.distanceToPoint(e)?0:null;const r=-(i.vec3.dot(e,this.normal)+this.constant)/n;return r<0?null:r}setFromNormalAndCoplanarPoint(e,t){return i.vec3.copy(this.normal,e),this.constant=-i.vec3.dot(t,this.normal),this}}t.Plane=r},2113:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sphere=void 0;const i=n(887);t.Sphere=class{constructor(e=i.vec3.create(),t=0){this._center=e,this._radius=t}get center(){return this._center}set center(e){this._center=e}get radius(){return this._radius}set radius(e){this._radius=e}intersect(e,t){const n=i.vec3.subtract(i.vec3.create(),this.center,e),r=i.vec3.dot(n,t),s=i.vec3.dot(n,n)-r*r,a=this.radius*this.radius;if(s>a)return null;const o=Math.sqrt(a-s),l=r-o,c=r+o;return l<0&&c<0?null:l<0?c:l}applyMatrix(e){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}containsPoint(e){return i.vec3.squaredDistance(e,this.center)<=this.radius*this.radius}clampPoint(e){return e}setFromBox(e){return i.vec3.add(this.center,e.min,e.max),i.vec3.scale(this.center,this.center,.5),this.radius=.5*i.vec3.dist(e.min,e.max),this}}},6680:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spherical=void 0;const i=n(887);t.Spherical=class{constructor(e=1,t=0,n=0){this._radius=e,this._phi=t,this._theta=n}get radius(){return this._radius}set radius(e){this._radius=e}get phi(){return this._phi}set phi(e){this._phi=e}get theta(){return this._theta}set theta(e){this._theta=e}makeSafe(){const e=1e-6;this.phi=Math.max(e,Math.min(Math.PI-e,this.phi))}fromVec3(e){return this.radius=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e[0],e[2]),this.phi=Math.acos(Math.max(-1,Math.min(1,e[1]/this.radius)))),this}toVec3(){const e=Math.sin(this.phi)*this.radius;return i.vec3.fromValues(e*Math.sin(this.theta),Math.cos(this.phi)*this.radius,e*Math.cos(this.theta))}}},5174:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Plane=t.Spherical=t.Sphere=t.Box=void 0;const i=n(8721);Object.defineProperty(t,"Box",{enumerable:!0,get:function(){return i.Box}});const r=n(3065);Object.defineProperty(t,"Plane",{enumerable:!0,get:function(){return r.Plane}});const s=n(2113);Object.defineProperty(t,"Sphere",{enumerable:!0,get:function(){return s.Sphere}});const a=n(6680);Object.defineProperty(t,"Spherical",{enumerable:!0,get:function(){return a.Spherical}})},4171:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceEvaluator=t.LOGGINGLEVEL=t.Logger=void 0;const i=n(9411);Object.defineProperty(t,"Logger",{enumerable:!0,get:function(){return i.Logger}}),Object.defineProperty(t,"LOGGINGLEVEL",{enumerable:!0,get:function(){return i.LOGGINGLEVEL}});const r=n(7469);Object.defineProperty(t,"PerformanceEvaluator",{enumerable:!0,get:function(){return r.PerformanceEvaluator}})},9411:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=t.LOGGINGLEVEL=void 0;const r=n(2899);var s;!function(e){e.NONE="none",e.ERROR="error",e.FATAL="fatal",e.WARN="warn",e.INFO="info",e.DEBUG="debug",e.DEBUG_HIGH="debug.high",e.DEBUG_MEDIUM="debug.medium",e.DEBUG_LOW="debug.low"}(s=t.LOGGINGLEVEL||(t.LOGGINGLEVEL={}));let a=class{constructor(){this._loggingLevel=s.NONE,this._showMessages=!0,this._updateCBs=[]}get loggingLevel(){return this._loggingLevel}set loggingLevel(e){this._loggingLevel=e,this._updateCBs.forEach((e=>e()))}get showMessages(){return this._showMessages}set showMessages(e){this._showMessages=e,this._updateCBs.forEach((e=>e()))}canLog(e){switch(this.loggingLevel){case s.ERROR:if(e===s.FATAL)return!1;if(e===s.WARN)return!1;if(e===s.INFO)return!1;if(e===s.DEBUG)return!1;if(e===s.DEBUG_HIGH)return!1;if(e===s.DEBUG_MEDIUM)return!1;if(e===s.DEBUG_LOW)return!1;case s.FATAL:if(e===s.WARN)return!1;if(e===s.INFO)return!1;if(e===s.DEBUG)return!1;if(e===s.DEBUG_HIGH)return!1;if(e===s.DEBUG_MEDIUM)return!1;if(e===s.DEBUG_LOW)return!1;case s.WARN:if(e===s.INFO)return!1;if(e===s.DEBUG)return!1;if(e===s.DEBUG_HIGH)return!1;if(e===s.DEBUG_MEDIUM)return!1;if(e===s.DEBUG_LOW)return!1;case s.INFO:if(e===s.DEBUG)return!1;if(e===s.DEBUG_HIGH)return!1;if(e===s.DEBUG_MEDIUM)return!1;if(e===s.DEBUG_LOW)return!1;case s.DEBUG_HIGH:if(e===s.DEBUG_MEDIUM)return!1;if(e===s.DEBUG_LOW)return!1;case s.DEBUG_MEDIUM:if(e===s.DEBUG_LOW)return!1;case s.DEBUG_LOW:case s.DEBUG:default:return!0}}debug(e){this.canLog(s.DEBUG)&&!0===this.showMessages&&console.debug("(DEBUG) "+this.messageConstruction(e))}debugHigh(e){this.canLog(s.DEBUG_HIGH)&&!0===this.showMessages&&console.debug("(DEBUG_HIGH) "+this.messageConstruction(e))}debugLow(e){this.canLog(s.DEBUG_LOW)&&!0===this.showMessages&&console.debug("(DEBUG_LOW) "+this.messageConstruction(e))}debugMedium(e){this.canLog(s.DEBUG_MEDIUM)&&!0===this.showMessages&&console.debug("(DEBUG_MEDIUM) "+this.messageConstruction(e))}error(e,t,n){n&&t?(t&&console.error(t),this.httpError(e,t,n)):this.canLog(s.ERROR)&&!0===this.showMessages&&(console.error("(ERROR) "+this.messageConstruction(e)),t&&console.error(t))}fatal(e){this.canLog(s.FATAL)&&!0===this.showMessages&&console.error("(FATAL) "+this.messageConstruction(e))}info(e){this.canLog(s.INFO)&&!0===this.showMessages&&console.info("(INFO) "+this.messageConstruction(e))}warn(e){this.canLog(s.WARN)&&!0===this.showMessages&&console.warn("(WARN) "+this.messageConstruction(e))}httpError(e,t,n){if("1"===n.toString()[0]){if(this.canLog(s.INFO)&&!0===this.showMessages)switch(n){case 100:this.info(e+"\nHttp-Code "+n+": Continue. "+t.message);break;case 101:this.info(e+"\nHttp-Code "+n+": Switching Protocols. "+t.message);break;case 102:this.info(e+"\nHttp-Code "+n+": Processing. "+t.message);break;case 103:this.info(e+"\nHttp-Code "+n+": Early Hints. "+t.message);break;default:this.info(e+"\nHttp-Code "+n+": Unknown Informational Response. "+t.message)}}else if("2"===n.toString()[0]){if(this.canLog(s.INFO)&&!0===this.showMessages)switch(n){case 200:this.info(e+"\nHttp-Code "+n+": OK. "+t.message);break;case 201:this.info(e+"\nHttp-Code "+n+": Created. "+t.message);break;case 202:this.info(e+"\nHttp-Code "+n+": Accepted. "+t.message);break;case 203:this.info(e+"\nHttp-Code "+n+": Non-Authoritative Information. "+t.message);break;case 204:this.info(e+"\nHttp-Code "+n+": No Content. "+t.message);break;case 205:this.info(e+"\nHttp-Code "+n+": Reset Content. "+t.message);break;case 206:this.info(e+"\nHttp-Code "+n+": Partial Content. "+t.message);break;case 207:this.info(e+"\nHttp-Code "+n+": Multi-Status. "+t.message);break;case 208:this.info(e+"\nHttp-Code "+n+": Already Reported. "+t.message);break;case 226:this.info(e+"\nHttp-Code "+n+": IM Used. "+t.message);break;default:this.info(e+"\nHttp-Code "+n+": Unknown Success Message. "+t.message)}}else if("3"===n.toString()[0]){if(this.canLog(s.WARN)&&!0===this.showMessages)switch(n){case 300:this.warn(e+"\nHttp-Code "+n+": Multiple Choices. "+t.message);break;case 301:this.warn(e+"\nHttp-Code "+n+": Moved Permanently. "+t.message);break;case 302:this.warn(e+"\nHttp-Code "+n+': Found (Previously "Moved temporarily"). '+t.message);break;case 303:this.warn(e+"\nHttp-Code "+n+": See Other. "+t.message);break;case 304:this.warn(e+"\nHttp-Code "+n+": Not Modified. "+t.message);break;case 305:this.warn(e+"\nHttp-Code "+n+": Use Proxy. "+t.message);break;case 306:this.warn(e+"\nHttp-Code "+n+": Switch Proxy. "+t.message);break;case 307:this.warn(e+"\nHttp-Code "+n+": Temporary Redirect. "+t.message);break;case 308:this.warn(e+"\nHttp-Code "+n+": Permanent Redirect. "+t.message);break;default:this.warn(e+"\nHttp-Code "+n+": Unknown Redirection Error. "+t.message)}}else if("4"===n.toString()[0]){if(this.canLog(s.ERROR)&&!0===this.showMessages)switch(n){case 400:this.error(e+"\nHttp-Code "+n+": Bad Request. "+t.message);break;case 401:this.error(e+"\nHttp-Code "+n+": Unauthorized. "+t.message);break;case 402:this.error(e+"\nHttp-Code "+n+": Payment Required. "+t.message);break;case 403:this.error(e+"\nHttp-Code "+n+": Forbidden. "+t.message);break;case 404:this.error(e+"\nHttp-Code "+n+": Not Found. "+t.message);break;case 405:this.error(e+"\nHttp-Code "+n+": Method Not Allowed. "+t.message);break;case 406:this.error(e+"\nHttp-Code "+n+": Not Acceptable. "+t.message);break;case 407:this.error(e+"\nHttp-Code "+n+": Proxy Authentication Required. "+t.message);break;case 408:this.error(e+"\nHttp-Code "+n+": Request Timeout. "+t.message);break;case 409:this.error(e+"\nHttp-Code "+n+": Conflict. "+t.message);break;case 410:this.error(e+"\nHttp-Code "+n+": Gone. "+t.message);break;case 411:this.error(e+"\nHttp-Code "+n+": Length Required. "+t.message);break;case 412:this.error(e+"\nHttp-Code "+n+": Precondition Failed. "+t.message);break;case 413:this.error(e+"\nHttp-Code "+n+": Payload Too Large. "+t.message);break;case 414:this.error(e+"\nHttp-Code "+n+": URI Too Long. "+t.message);break;case 415:this.error(e+"\nHttp-Code "+n+": Unsupported Media Type. "+t.message);break;case 416:this.error(e+"\nHttp-Code "+n+": Range Not Satisfiable. "+t.message);break;case 417:this.error(e+"\nHttp-Code "+n+": Expectation Failed. "+t.message);break;case 421:this.error(e+"\nHttp-Code "+n+": Misdirected Request. "+t.message);break;case 422:this.error(e+"\nHttp-Code "+n+": Unprocessable Entity. "+t.message);break;case 423:this.error(e+"\nHttp-Code "+n+": Locked. "+t.message);break;case 424:this.error(e+"\nHttp-Code "+n+": Failed Dependency. "+t.message);break;case 425:this.error(e+"\nHttp-Code "+n+": Too Early. "+t.message);break;case 426:this.error(e+"\nHttp-Code "+n+": Upgrade Required. "+t.message);break;case 428:this.error(e+"\nHttp-Code "+n+": Precondition Required. "+t.message);break;case 429:this.error(e+"\nHttp-Code "+n+": Too Many Requests. "+t.message);break;case 431:this.error(e+"\nHttp-Code "+n+": Request Header Fields Too Large. "+t.message);break;case 451:this.error(e+"\nHttp-Code "+n+": Unavailable For Legal Reasons. "+t.message);break;case 418:this.error(e+"\nHttp-Code "+n+": I'm a teapot. "+t.message);break;case 420:this.error(e+"\nHttp-Code "+n+": Policy Not Fulfilled. "+t.message);break;case 444:this.error(e+"\nHttp-Code "+n+": No Response. "+t.message);break;case 449:this.error(e+"\nHttp-Code "+n+": The request should be retried after doing the appropriate action. "+t.message);break;case 499:this.error(e+"\nHttp-Code "+n+": Client Closed Request. "+t.message);break;default:this.error(e+"\nHttp-Code "+n+": Unknown Client Error. "+t.message)}}else if("5"===n.toString()[0]){if(this.canLog(s.INFO)&&!0===this.showMessages)switch(n){case 500:this.error(e+"\nHttp-Code "+n+": Internal Server Error. "+t.message);break;case 501:this.error(e+"\nHttp-Code "+n+": Not Implemented. "+t.message);break;case 502:this.error(e+"\nHttp-Code "+n+": Bad Gateway. "+t.message);break;case 503:this.error(e+"\nHttp-Code "+n+": Service Unavailable. "+t.message);break;case 504:this.error(e+"\nHttp-Code "+n+": Gateway Timeout. "+t.message);break;case 505:this.error(e+"\nHttp-Code "+n+": HTTP Version Not Supported. "+t.message);break;case 506:this.error(e+"\nHttp-Code "+n+": Variant Also Negotiates. "+t.message);break;case 507:this.error(e+"\nHttp-Code "+n+": Insufficient Storage. "+t.message);break;case 508:this.error(e+"\nHttp-Code "+n+": Loop Detected. "+t.message);break;case 510:this.error(e+"\nHttp-Code "+n+": Not Extended. "+t.message);break;case 511:this.error(e+"\nHttp-Code "+n+": Network Authentication Required. "+t.message);break;default:this.error(e+"\nHttp-Code "+n+": Unknown Server Error. "+t.message)}}else this.canLog(s.INFO)&&!0===this.showMessages&&this.error(e+"\nHttp-Code "+n+": Unknown Error Code. "+t.message)}messageConstruction(e){return(new Date).toISOString()+": "+e}addUpdateCB(e){this._updateCBs.push(e)}};a=i([r.singleton()],a),t.Logger=a},7469:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceEvaluator=void 0;const r=n(2899);let s=class{constructor(){this._eval={}}start(e,t){this._eval[e]={start:t||(new Date).getTime(),pauses:[]}}pause(e){this._eval[e]&&(this._eval[e].end||(0===this._eval[e].pauses.length||this._eval[e].pauses[this._eval[e].pauses.length-1].continue)&&this._eval[e].pauses.push({pause:(new Date).getTime()}))}continue(e){if(!this._eval[e])return;if(0===this._eval[e].pauses.length)return;if(this._eval[e].end)return;const t=this._eval[e].pauses[this._eval[e].pauses.length-1];t.continue||(t.continue=(new Date).getTime(),t.duration=t.continue-t.pause)}end(e){if(!this._eval[e])return;if(this._eval[e].end)return;this._eval[e].end=(new Date).getTime();let t=0;for(let n=0;n<this._eval[e].pauses.length;n++)t+=this._eval[e].pauses[n].duration?this._eval[e].pauses[n].duration:this._eval[e].end-this._eval[e].pauses[n].pause;this._eval[e].duration=this._eval[e].end-this._eval[e].start-t}getEvaluation(e){return this._eval[e]}getEvaluationToString(e){return`Performance Evaluation for ${e}: ${this._eval[e].duration}ms\n`}};s=i([r.singleton()],s),t.PerformanceEvaluator=s},6063:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractTreeNodeData=void 0;const i=n(2899),r=n(4562),s=n(8877);t.AbstractTreeNodeData=class{constructor(e){this._uuidGenerator=i.container.resolve(r.UuidGenerator),this._eventEngine=i.container.resolve(s.EventEngine),this._id=e||this._uuidGenerator.create(),this._version=this._uuidGenerator.create()}get id(){return this._id}get version(){return this._version}updateVersion(){this._version=this._uuidGenerator.create(),this._eventEngine.emitEvent(s.EVENTTYPE.UPDATE.UPDATE_READY,{})}}},1769:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Tree=void 0;const s=n(2899),a=n(1360);let o=class{constructor(){this._root=new a.TreeNode("root")}get root(){return this._root}addNode(e,t=this._root,n=this._root){if(n===t)return n.addChild(e),!0;for(let i=0;i<n.children.length;i++){const r=n.children[i];if(r&&this.addNode(e,t,r))return!0}return!1}addNodeAtPath(e,t=this.root.getPath(),n=this._root){if(n.id===t)return n.addChild(e),!0;const i=t.substr(0,t.indexOf("."));if(n.id===i){const r=t.substr(i.length+1,t.length);for(let t=0;t<n.children.length;t++){const i=n.children[t];if(i&&this.addNodeAtPath(e,r,i))return!0}}return!1}removeNode(e,t=this._root){if(t.hasChild(e))return t.removeChild(e),!0;for(let n=0;n<t.children.length;n++){const i=t.children[n];if(i&&this.removeNode(e,i))return!0}return!1}removeNodeAtPath(e,t=this._root){var n;if(t.id===e)return null===(n=t.parent)||void 0===n||n.removeChild(t),!0;const i=e.substr(0,e.indexOf("."));if(t.id===i){const n=e.substr(i.length+1,e.length);for(let e=0;e<t.children.length;e++){const i=t.children[e];if(i&&this.removeNodeAtPath(n,i))return!0}}return!1}};o=i([s.singleton(),r("design:paramtypes",[])],o),t.Tree=o},1360:function(e,t,n){"use strict";var i,r,s,a,o,l,c,h,u,d,p,f=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},m=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.TreeNode=void 0;const g=n(887),v=n(2899),_=n(4562),y=n(8877),b=n(5174);class w{constructor(e="",t=null,n=[],g=[]){var w;i.set(this,[]),r.set(this,[]),s.set(this,v.container.resolve(y.EventEngine)),a.set(this,""),o.set(this,v.container.resolve(_.UuidGenerator)),l.set(this,new b.Box),c.set(this,void 0),h.set(this,null),u.set(this,[]),d.set(this,[]),p.set(this,void 0),f(this,a,e,"f"),f(this,h,t,"f"),f(this,r,n,"f"),f(this,u,g,"f"),f(this,c,m(this,o,"f").create(),"f"),f(this,p,m(this,o,"f").create(),"f"),null===(w=m(this,h,"f"))||void 0===w||w.addChild(this)}get boundingBox(){return m(this,l,"f")}set boundingBox(e){f(this,l,e,"f")}get children(){return m(this,i,"f")}get data(){return m(this,r,"f")}get excludeViewers(){return m(this,d,"f")}set excludeViewers(e){f(this,d,e,"f")}get id(){return m(this,c,"f")}set id(e){f(this,c,e,"f")}get name(){return m(this,a,"f")}get nodeMatrix(){const e=g.mat4.create();for(let t of m(this,u,"f"))g.mat4.multiply(e,e,t.matrix);return e}get parent(){return m(this,h,"f")}set parent(e){null===e&&null!==m(this,h,"f")&&m(this,h,"f").removeChild(this),null!==e&&e.addChild(this),f(this,h,e,"f")}get transformations(){return m(this,u,"f")}set transformations(e){f(this,u,e,"f")}get version(){return m(this,p,"f")}get worldMatrix(){const e=g.mat4.create();for(let t of m(this,u,"f"))g.mat4.multiply(e,e,t.matrix);let t=this;for(;t.parent;)g.mat4.multiply(e,e,t.parent.nodeMatrix),t=t.parent;return e}addChild(e){return!this.hasChild(e)&&(m(this,i,"f").push(e),null!==e.parent&&e.parent.removeChild(e),e.parent=this,!0)}clone(){const e=new w(this.name);for(let t of m(this,i,"f"))e.addChild(t.clone());for(let t of m(this,r,"f"))e.data.push(t.clone());for(let t of m(this,u,"f"))e.transformations.push({id:t.id,name:t.name,matrix:g.mat4.clone(t.matrix)});return e}cloneInstance(){const e=new w(this.name);for(let t of m(this,i,"f"))e.addChild(t.cloneInstance());for(let t of m(this,r,"f"))e.data.push(t);for(let t of m(this,u,"f"))e.transformations.push({id:t.id,name:t.name,matrix:g.mat4.clone(t.matrix)});return e}getChild(e){for(let t=0;t<m(this,i,"f").length;t++)if(m(this,i,"f")[t].id===e)return m(this,i,"f")[t];return null}getPath(){let e=this.id,t=this.parent;for(;t;)e=t.id+"."+e,t=t.parent;return e}hasChild(e){return m(this,i,"f").includes(e)}removeChild(e){const t=m(this,i,"f").indexOf(e);return-1!==t&&(m(this,i,"f").splice(t,1),e.parent=null,!0)}updateVersion(){let e=this;for(;null!==e.parent;)e=e.parent,e.updateVersionAtomic();for(let e=0;e<m(this,r,"f").length;e++)m(this,r,"f")[e].updateVersion();for(let e=0;e<m(this,i,"f").length;e++)m(this,i,"f")[e].updateVersion();f(this,p,m(this,o,"f").create(),"f"),m(this,s,"f").emitEvent(y.EVENTTYPE.UPDATE.UPDATE_READY,{})}updateVersionAtomic(){f(this,p,m(this,o,"f").create(),"f"),m(this,s,"f").emitEvent(y.EVENTTYPE.UPDATE.UPDATE_READY,{})}}t.TreeNode=w,i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap,l=new WeakMap,c=new WeakMap,h=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap},3858:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractTreeNodeData=t.TreeNode=t.Tree=void 0;const i=n(1769);Object.defineProperty(t,"Tree",{enumerable:!0,get:function(){return i.Tree}});const r=n(1360);Object.defineProperty(t,"TreeNode",{enumerable:!0,get:function(){return r.TreeNode}});const s=n(6063);Object.defineProperty(t,"AbstractTreeNodeData",{enumerable:!0,get:function(){return s.AbstractTreeNodeData}})},4529:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DomEventEngine=void 0;const i=n(2899),r=n(4562);t.DomEventEngine=class{constructor(e){this._uuidGenerator=i.container.resolve(r.UuidGenerator),this._domEventListeners={},this._currentMousePosition={x:0,y:0},this._canvas=e,this.addEventListeners()}addDomEventListener(e){const t=this._uuidGenerator.create();return this._domEventListeners[t]=e,t}removeDomEventListener(e){this._domEventListeners[e]&&delete this._domEventListeners[e]}removeAllDomEventListener(){for(let e in this._domEventListeners)delete this._domEventListeners[e]}dispose(){this.removeEventListeners()}addEventListeners(){this._canvas.addEventListener("mousewheel",this.onMouseWheel.bind(this)),this._canvas.addEventListener("MozMousePixelScroll",this.onMouseWheel.bind(this)),this._canvas.addEventListener("mousedown",this.onMouseDown.bind(this),{passive:!1}),this._canvas.addEventListener("mousemove",this.onMouseMove.bind(this),{passive:!1}),this._canvas.addEventListener("mouseup",this.onMouseUp.bind(this),{passive:!1}),this._canvas.addEventListener("mouseout",this.onMouseUp.bind(this),{passive:!1}),this._canvas.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!1}),this._canvas.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),this._canvas.addEventListener("touchend",this.onTouchEnd.bind(this),{passive:!1}),window.addEventListener("keydown",this.onKeyDown.bind(this),{passive:!1}),window.addEventListener("mousemove",this.onKeyDownMousePositionHelper.bind(this),{passive:!1}),this._canvas.addEventListener("contextmenu",this.onContextMenu.bind(this),{passive:!1})}onContextMenu(e){e.preventDefault()}onKeyDown(e){this._canvas===document.elementFromPoint(this._currentMousePosition.x,this._currentMousePosition.y)&&Object.values(this._domEventListeners).forEach((t=>t.onKeyDown(e)))}onKeyDownMousePositionHelper(e){this._currentMousePosition={x:e.pageX,y:e.pageY}}onMouseDown(e){e.preventDefault(),Object.values(this._domEventListeners).forEach((t=>t.onMouseDown(e)))}onMouseMove(e){e.preventDefault(),Object.values(this._domEventListeners).forEach((t=>t.onMouseMove(e)))}onMouseUp(e){Object.values(this._domEventListeners).forEach((t=>t.onMouseUp(e)))}onMouseWheel(e){e.preventDefault(),e.stopPropagation(),Object.values(this._domEventListeners).forEach((t=>t.onMouseWheel(e)))}onTouchEnd(e){Object.values(this._domEventListeners).forEach((t=>t.onTouchEnd(e)))}onTouchMove(e){Object.values(this._domEventListeners).forEach((t=>t.onTouchMove(e)))}onTouchStart(e){Object.values(this._domEventListeners).forEach((t=>t.onTouchStart(e)))}removeEventListeners(){this._canvas.removeEventListener("mousewheel",this.onMouseWheel.bind(this),!1),this._canvas.removeEventListener("MozMousePixelScroll",this.onMouseWheel.bind(this),!1),this._canvas.removeEventListener("mousedown",this.onMouseDown.bind(this),!1),this._canvas.removeEventListener("mousemove",this.onMouseMove.bind(this),!1),this._canvas.removeEventListener("mouseup",this.onMouseUp.bind(this),!1),this._canvas.removeEventListener("mouseout",this.onMouseUp.bind(this),!1),this._canvas.removeEventListener("touchstart",this.onTouchStart.bind(this),!1),this._canvas.removeEventListener("touchmove",this.onTouchMove.bind(this),!1),this._canvas.removeEventListener("touchend",this.onTouchEnd.bind(this),!1),window.removeEventListener("keydown",this.onKeyDown.bind(this),!1),window.removeEventListener("mousemove",this.onKeyDownMousePositionHelper.bind(this),!1),this._canvas.removeEventListener("contextmenu",this.onContextMenu.bind(this),!1)}}},4345:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.EventEngine=void 0;const s=n(2899),a=n(5488),o=n(4562),l=n(4171);let c=class{constructor(){this._uuidGenerator=s.container.resolve(o.UuidGenerator),this._logger=s.container.resolve(l.Logger),this._eventListeners={};for(const e in a.EVENTTYPE){const t=a.EVENTTYPE[e];this._eventListeners[e.toLowerCase()]=[];for(const e in t)this._eventListeners[t[e]]=[]}}convertTypeToString(e){let t="";"string"==typeof e&&(t=e);for(const n in a.EVENTTYPE)e===a.EVENTTYPE[n]&&(t=n.toLowerCase());return t&&this._eventListeners[t]?t:(this._logger.error("No valid type provided."),"")}addListener(e,t){var n;const i=this.convertTypeToString(e);if(!i)return"";const r=this._uuidGenerator.create();return null===(n=this._eventListeners[i])||void 0===n||n.push({token:r,cb:t}),r}emitEvent(e,t){const n=this.convertTypeToString(e);if(this._eventListeners[n]&&0!==this._eventListeners[n].length)for(let e=0;e<this._eventListeners[n].length;e++)this._eventListeners[n][e].cb(t);n.includes(".")&&this.emitEvent(n.substr(0,n.indexOf(".")),t)}removeListener(e){for(const t in a.EVENTTYPE){const n=a.EVENTTYPE[t],i=t.toLowerCase();for(let t=0;t<this._eventListeners[i].length;t++)if(this._eventListeners[i][t].token===e)return this._eventListeners[i].splice(t,1),!0;for(const t in n)for(let i=0;i<this._eventListeners[n[t]].length;i++)if(this._eventListeners[n[t]][i].token===e)return this._eventListeners[n[t]].splice(i,1),!0}return!1}};c=i([s.singleton(),r("design:paramtypes",[])],c),t.EventEngine=c},5488:(e,t)=>{"use strict";var n,i,r,s,a,o,l,c,h,u,d,p,f;Object.defineProperty(t,"__esModule",{value:!0}),t.EVENTTYPE=t.VIEWER=t.SESSION=t.UPDATE=t.SETTINGS=t.SCENE=t.RENDERING=t.PARAMETER=t.LIGHT=t.INTERACTION=t.HTML=t.EXPORT=t.ENVIRONMENTMAP=t.CAMERA=void 0,function(e){e.CAMERA_START="camera.start",e.CAMERA_MOVE="camera.move",e.CAMERA_END="camera.end"}(n=t.CAMERA||(t.CAMERA={})),function(e){e.ENVIRONMENTMAP_LOADED="environmentmap.loaded"}(i=t.ENVIRONMENTMAP||(t.ENVIRONMENTMAP={})),r=t.EXPORT||(t.EXPORT={}),s=t.HTML||(t.HTML={}),a=t.INTERACTION||(t.INTERACTION={}),function(e){e.LIGHT_ADDED="light.added",e.LIGHT_REMOVED="light.removed",e.LIGHT_CHANGED="light.changed",e.LIGHT_SCENE_ADDED="light.scene.added",e.LIGHT_SCENE_REMOVED="light.scene.removed",e.LIGHT_SCENE_CHANGED="light.scene.changed"}(o=t.LIGHT||(t.LIGHT={})),l=t.PARAMETER||(t.PARAMETER={}),function(e){e.BEAUTY_RENDERING_FINISHED="rendering.beautyrenderingfinished"}(c=t.RENDERING||(t.RENDERING={})),function(e){e.SCENE_BOUNDING_BOX_CHANGE="scene.boundingboxchange"}(h=t.SCENE||(t.SCENE={})),function(e){e.SETTINGS_REGISTERED="settings.registered",e.SETTINGS_UPDATE="settings.update"}(u=t.SETTINGS||(t.SETTINGS={})),function(e){e.UPDATE_READY="update.ready"}(d=t.UPDATE||(t.UPDATE={})),function(e){e.SESSION_CREATED="session.created",e.SESSION_INITIALIZED="session.initialized",e.SESSION_LOADED="session.loaded",e.SESSION_CUSTOMIZED="session.customized",e.SESSION_CLOSED="session.closed"}(p=t.SESSION||(t.SESSION={})),function(e){e.VIEWER_CREATED="viewer.created",e.VIEWER_INITIALIZED="viewer.initialized",e.VIEWER_UPDATED="viewer.updated",e.VIEWER_CLOSED="viewer.closed"}(f=t.VIEWER||(t.VIEWER={})),t.EVENTTYPE={CAMERA:n,ENVIRONMENTMAP:i,EXPORT:r,HTML:s,INTERACTION:a,LIGHT:o,PARAMETER:l,RENDERING:c,SCENE:h,SESSION:p,SETTINGS:u,UPDATE:d,VIEWER:f}},8877:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DomEventEngine=t.SystemInfo=t.StateEngine=t.SettingsEngine=t.EVENTTYPE=t.EventEngine=void 0;const i=n(4345);Object.defineProperty(t,"EventEngine",{enumerable:!0,get:function(){return i.EventEngine}});const r=n(5488);Object.defineProperty(t,"EVENTTYPE",{enumerable:!0,get:function(){return r.EVENTTYPE}});const s=n(3170);Object.defineProperty(t,"SettingsEngine",{enumerable:!0,get:function(){return s.SettingsEngine}});const a=n(2100);Object.defineProperty(t,"StateEngine",{enumerable:!0,get:function(){return a.StateEngine}});const o=n(6629);Object.defineProperty(t,"SystemInfo",{enumerable:!0,get:function(){return o.SystemInfo}});const l=n(4529);Object.defineProperty(t,"DomEventEngine",{enumerable:!0,get:function(){return l.DomEventEngine}})},6088:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultSettings=void 0;const i=n(1671),r=n(57),s=n(2662),a=n(3913);t.DefaultSettings={build_date:new a.StringSetting("",""),build_version:new a.StringSetting("",""),settings_version:new a.StringSetting("2.0",""),parameters:{controlOrder:new r.CustomSetting([],""),controlNames:new r.CustomSetting({},""),parametersHidden:new r.CustomSetting([],"")},viewer:{blurSceneWhenBusy:new i.BooleanSetting(!0,"Blur or don't blur the scene while a process is busy"),showMessages:new i.BooleanSetting(!0,"Show or don't show user messages in the viewport"),commitParameters:new i.BooleanSetting(!1,"Use or don't commit mode for parameters"),commitSettings:new i.BooleanSetting(!1,"Use or don't commit mode for settings"),scene:{camera:{autoAdjust:new i.BooleanSetting(!1,"Enable / disable that the camera adjusts to geometry updates"),cameraMovementDuration:new s.NumberSetting(800,"Default duration of camera movements",(e=>e>=0)),cameraTypes:{perspective:{default:new r.CustomSetting({position:{x:0,y:0,z:0},target:{x:0,y:0,z:0}},"Default position and target for the perspective camera"),fov:new s.NumberSetting(45,"Camera frustum vertical field of view angle, unit degree, interval [0,180]",(e=>e>=0))},orthographic:{default:new r.CustomSetting({position:{x:0,y:0,z:0},target:{x:0,y:0,z:0}},"Default position and target for the orthographic camera")},active:new s.NumberSetting(0,"Set camera type",(e=>e>=0&&e<=6))},controls:{orbit:{autoRotationSpeed:new s.NumberSetting(0,"Speed of autorotation, can be negative, also refer to enableAutoRotation"),damping:new s.NumberSetting(.1,"How much to damp camera movements by the user",(e=>e>=0)),enableAutoRotation:new i.BooleanSetting(!1,"Enable / disable automatic rotation of the camera, also refer to autoRotationSpeed"),enableKeyPan:new i.BooleanSetting(!1,"Enable / disable panning using the keyboard, also refer to enablePan"),enablePan:new i.BooleanSetting(!0,"Enable / disable panning in general, also refer to enableKeyPan"),enableRotation:new i.BooleanSetting(!0,"Enable / disable camera rotation"),enableZoom:new i.BooleanSetting(!0,"Enable / disable zooming"),input:new r.CustomSetting({keys:{up:38,down:40,left:37,right:39},mouse:{rotate:0,zoom:1,pan:2},touch:{rotate:1,zoom:2,pan:3}}),keyPanSpeed:new s.NumberSetting(.5,"Speed of panning when using the keyboard",(e=>e>=0&&e<=1)),movementSmoothness:new s.NumberSetting(.5,"How much to the current movement is affected by the previous one",(e=>e>=0&&e<=1)),restrictions:{position:{cube:new r.CustomSetting({min:{x:-1/0,y:-1/0,z:-1/0},max:{x:1/0,y:1/0,z:1/0}},"Restriction of the camera position inside a cube, minimum and maximum corner of the cube"),sphere:new r.CustomSetting({center:{x:0,y:0,z:0},radius:1/0},"Restriction of the camera position inside a sphere, center and radius of the sphere")},target:{cube:new r.CustomSetting({min:{x:-1/0,y:-1/0,z:-1/0},max:{x:1/0,y:1/0,z:1/0}},"Restriction of the camera target inside a cube, minimum and maximum corner of the cube"),sphere:new r.CustomSetting({center:{x:0,y:0,z:0},radius:1/0},"Restriction of the camera target inside a sphere, center and radius of the sphere")},rotation:new r.CustomSetting({minPolarAngle:0,maxPolarAngle:180,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0},"Minimum and maximum polar and azimuth angle of the camera position with respect to the camera target, unit degree"),zoom:new r.CustomSetting({minDistance:0,maxDistance:1/0},"Minimum and maximum distance between camera position and target")},rotationSpeed:new s.NumberSetting(.5,"Speed of camera rotation",(e=>e>=0&&e<=1)),panSpeed:new s.NumberSetting(.5,"Speed of panning",(e=>e>=0&&e<=1)),zoomSpeed:new s.NumberSetting(.5,"Speed of zooming",(e=>e>=0&&e<=1))},orthographic:{damping:new s.NumberSetting(.1,"How much to damp camera movements by the user",(e=>e>=0)),enableKeyPan:new i.BooleanSetting(!1,"Enable / disable panning using the keyboard, also refer to enablePan"),enablePan:new i.BooleanSetting(!0,"Enable / disable panning in general, also refer to enableKeyPan"),enableZoom:new i.BooleanSetting(!0,"Enable / disable zooming"),input:new r.CustomSetting({keys:{up:38,down:40,left:37,right:39},mouse:{rotate:0,zoom:1,pan:2},touch:{rotate:1,zoom:2,pan:3}}),keyPanSpeed:new s.NumberSetting(.5,"Speed of panning when using the keyboard",(e=>e>=0&&e<=1)),movementSmoothness:new s.NumberSetting(.5,"How much to the current movement is affected by the previous one",(e=>e>=0&&e<=1)),panSpeed:new s.NumberSetting(.5,"Speed of panning",(e=>e>=0&&e<=1)),zoomSpeed:new s.NumberSetting(.5,"Speed of zooming",(e=>e>=0&&e<=1))}},enableCameraControls:new i.BooleanSetting(!0,"Enable / disable camera controls"),revertAtMouseUp:new i.BooleanSetting(!1,"Enable / disable if the mouse should reset on mouse up"),revertAtMouseUpDuration:new s.NumberSetting(800,"The duration of the transition of the revertAtMouseUp",(e=>e>=0)),zoomExtentsFactor:new s.NumberSetting(1,"Factor to apply to the bounding box before zooming to extents",(e=>e>0))},gridVisibility:new i.BooleanSetting(!0,"Show / hide the grid"),groundPlaneVisibility:new i.BooleanSetting(!0,"Show / hide the ground plane"),lights:{lightScene:new a.StringSetting("default"),lightScenes:new r.CustomSetting({})},material:{environmentMap:new a.StringSetting("none","Name of the environment map to use, or an array of 6 image URLs making up the cube mapped environment map (px, nx, pz, nz, py, ny)",(e=>!0)),environmentMapAsBackground:new i.BooleanSetting(!1,"Show / hide the environment map in the background"),environmentMapResolution:new a.StringSetting("1024","Image resolution to be used for the named environment maps (available resolutions: 256, 512, 1024)",(e=>["256","512","1024","2048"].includes(e)))},render:{ambientOcclusion:new i.BooleanSetting(!0,"Enable / disable ambient occlusion for rendering"),beautyRenderDelay:new s.NumberSetting(50,"Amount of which the beauty rendering is delayed",(e=>e>=0)),beautyRenderBlendingDuration:new s.NumberSetting(1500,"Time to blend the beauty rendering",(e=>e>=0)),clearColor:new a.StringSetting("#ffffff","Set background color"),clearAlpha:new s.NumberSetting(1,"Set background alpha value",(e=>e>=0&&e<=1)),pointSize:new s.NumberSetting(1,"Set size of point objects",(e=>e>=0)),shadows:new i.BooleanSetting(!0,"Enable / disable shadows for rendering")}}}}},3170:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsEngine=void 0;const r=n(2899),s=n(4345),a=n(5488),o=n(2100),l=n(6088),c=n(2698),h=n(8503),u=n(628),d=n(57),p=n(169);let f=class{constructor(){this._defaultSettings=l.DefaultSettings,this._eventEngine=r.container.resolve(s.EventEngine),this._stateEngine=r.container.resolve(o.StateEngine),this._sessionSettings=["commitParameters","commitSettings","controlNames","controlOrder","parametersHidden"]}get camera(){return this._defaultSettings.viewer.scene.camera}get cameraOrbitControls(){return this._defaultSettings.viewer.scene.camera.controls.orbit}get cameraOrthographicControls(){return this._defaultSettings.viewer.scene.camera.controls.orthographic}get general(){return this._defaultSettings}get lights(){return this._defaultSettings.viewer.scene.lights}get material(){return this._defaultSettings.viewer.scene.material}get rendering(){return this._defaultSettings.viewer.scene.render}get scene(){return this._defaultSettings.viewer.scene}_fromJson(e,t,n=!1){if(e)for(let i in t)!0===t[i].isSetting?void 0===e[i]||n&&!this._sessionSettings.includes(i)||(t[i].value=e[i]):this._fromJson(e[i],t[i])}fromJson(e,t,n=!1){const i=e?(new h.SettingsConversion).convert(e,"2.0"):e;this._fromJson(i,this._defaultSettings,n),this._eventEngine.emitEvent(a.EVENTTYPE.SETTINGS.SETTINGS_REGISTERED,{sessionId:t,loadAsPrimary:n})}_toJson(e,t){for(let n in e)e[n]instanceof u.AbstractSetting?e[n]instanceof p.Vec3Setting?t[n]={x:e[n].value[0]||0,y:e[n].value[1]||0,z:e[n].value[2]||0}:(e[n],d.CustomSetting,t[n]=e[n].value):(t[n]||(t[n]={}),this._toJson(e[n],t[n]))}toJson(){const e={};return this._toJson(this._defaultSettings,e),(new h.SettingsConversion).convert(e,"2.0")}_reset(e){for(let t in e)e[t]instanceof u.AbstractSetting?e[t].value=e[t].default:this._reset(e[t])}reset(){this._reset(this._defaultSettings);const e=(new h.SettingsConversion).convert((new c.Settings_2_0).toJSON(),"2.0");this._fromJson(e,this._defaultSettings,!0),this._eventEngine.emitEvent(a.EVENTTYPE.SETTINGS.SETTINGS_REGISTERED,{loadAsPrimary:!0})}_deconstruct(e,t,n){for(let i in e)!0===e[i].isSetting?t[n?n+"."+i:""+i]=e[i].value:this._deconstruct(e[i],t,n?n+"."+i:""+i)}deconstruct(){let e={};return this._deconstruct(this.general,e,""),e}};f=i([r.singleton()],f),t.SettingsEngine=f},9545:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseSettings=void 0;const i=n(6845);t.BaseSettings=class{get settings(){return this._settings}set settings(e){this._settings=e}get version(){return this._version}getSettingDefinitions(){let e={};return this._getSettingDefinitions(this._settings,e,""),e}getSettingObject(e){let t=e.split("."),n=this._settings;for(let e=0;e<t.length;e++)if(n=n[t[e]],n instanceof i.Setting&&e<t.length-1)n=n.value;else{if(n instanceof i.Setting)return n;if(!n)return null}return null}getSettings(e=!1){let t={};return this._getSettings(this._settings,e,t,""),t}toJSON(e=!1){return this._toJSON(this._settings,e)}_fromJSON(e,t){if(e)for(let n in t)if(t[n]instanceof i.Setting){let r=t[n],s="object"==typeof r.value&&null!==r.value?Object.values(r.value):[];0!==s.length&&s[0]instanceof i.Setting?this._fromJSON(e[n],t[n].value):void 0!==e[n]&&(t[n].value=e[n])}else this._fromJSON(e[n],t[n])}_toJSON(e,t){let n={};for(let r in e)if(e[r]instanceof i.Setting){let s=e[r];if(!t||s.persistent){let a="object"==typeof s.value&&null!==s.value?Object.values(s.value):[];0!==a.length&&a[0]instanceof i.Setting?n[r]=this._toJSON(e[r].value,t):n[r]=e[r].value}}else e[r]instanceof String||"string"==typeof e[r]?n[r]=e[r]:n[r]=this._toJSON(e[r],t);return n}_getSettingDefinitions(e,t,n){let r=n?n+".":"";for(let n in e)if(e[n]instanceof i.Setting){let s=e[n],a="object"==typeof s.value&&null!==s.value?Object.values(s.value):[];0!==a.length&&a[0]instanceof i.Setting?(e[n].desc&&(t[r+n]={},t[r+n].descripton=e[n].desc,("string"==typeof e[n].type||e[n].type instanceof String)&&(t[r+n].type=e[n].type)),this._getSettingDefinitions(e[n].value,t,r+n)):e[n].desc&&(t[r+n]={},t[r+n].descripton=e[n].desc,("string"==typeof e[n].type||e[n].type instanceof String)&&(t[r+n].type=e[n].type))}else e[n]instanceof String||"string"==typeof e[n]||this._getSettingDefinitions(e[n],t,r+n)}_getSettings(e,t,n,r){let s=r?r+".":"";for(let r in e)if(e[r]instanceof i.Setting){let a=e[r];if(!t||a.persistent){let o="object"==typeof a.value&&null!==a.value?Object.values(a.value):[];0!==o.length&&o[0]instanceof i.Setting?this._getSettings(e[r].value,t,n,s+r):n[s+r]=e[r].value}}else e[r]instanceof String||"string"==typeof e[r]?n[s+r]=e[r]:this._getSettings(e[r],t,n,s+r)}}},6845:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Setting=void 0,t.Setting=class{constructor(e,t,n,i=!0){this._value=e,this._type=t,this._desc=n,this._persistent=i}get desc(){return this._desc}get persistent(){return this._persistent}get type(){return this._type}get value(){return this._value}set value(e){this._value=e}}},8503:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsConversion=void 0;const i=n(1469),r=n(2495),s=n(3102);class a{constructor(e,t){this.viewer_version=new i.SettingsVersion(e),this.settings_version=new i.SettingsVersion(t)}}t.SettingsConversion=class{constructor(){this._settingsVersions=[],this._versions={"1.0.0":r.Settings,"2.0.0":s.Settings},this._mapViewerVersionSettingsVersion=[new a("2.18.0","2.0")];for(let e of Object.keys(this._versions))this._settingsVersions.push(new this._versions[e])}convert(e,t,n=!1){let r=this.createSettingsObject(e),s=r.version,a=new i.SettingsVersion(t),o=this._findVersionIndex(s),l=this._findVersionIndex(a);if(-1===o||-1===l)return r.toJSON();let c=r;if(o<l)for(;o<l;)o+=1,c=(new(0,this._versions[this._settingsVersions[o].version.toString()])).convertFromPreviousVersion(c);else if(o>l)for(;o>l;)o-=1,c=c.convertToPreviousVersion();return c.toJSON(n)}createSettingsObject(e){if(!e.settings_version)return new r.Settings(e);let t=new i.SettingsVersion(e.settings_version);return new(this._versions[t.toString()])(e)}mapViewerVersionToSettingsVersion(e){let t=new i.SettingsVersion(e||"0.0.0");for(let e of this._mapViewerVersionSettingsVersion)if(e.viewer_version.isLowerThan(t)||e.viewer_version.equalTo(t))return e.settings_version.toString();return"1.0"}_findVersionIndex(e){let t=new i.SettingsVersion(e.toString());for(let e=0;e<this._settingsVersions.length;e++)if(this._settingsVersions[e].version.equalTo(t))return e;t.versionLevels[t.versionLevels.length-1]=0;for(let e=0;e<this._settingsVersions.length;e++)if(this._settingsVersions[e].version.equalTo(t))return e;return-1}}},1469:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsVersion=void 0,t.SettingsVersion=class{constructor(e=""){this._versionLevels=[1,0,0];let t=e.split(".");for(let e=0,n=Math.min(t.length,this._versionLevels.length);e<n;e++)this._versionLevels[e]=+t[e]}get versionLevels(){return this._versionLevels}equalTo(e){if(e.versionLevels.length!==this._versionLevels.length)return!1;for(let t=0;t<this._versionLevels.length;t++)if(e.versionLevels[t]!==this._versionLevels[t])return!1;return!0}isLowerThan(e){for(let t=0;t<this._versionLevels.length;t++){if(this._versionLevels[t]>e.versionLevels[t])return!1;if(this._versionLevels[t]<e.versionLevels[t])return!0}return!1}toString(){return this._versionLevels.join(".")}}},2698:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Settings_2_0=t.Settings_1_0=t.SettingsConversion=void 0;const i=n(8503);Object.defineProperty(t,"SettingsConversion",{enumerable:!0,get:function(){return i.SettingsConversion}});const r=n(2495);Object.defineProperty(t,"Settings_1_0",{enumerable:!0,get:function(){return r.Settings}});const s=n(3102);Object.defineProperty(t,"Settings_2_0",{enumerable:!0,get:function(){return s.Settings}})},2495:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Settings=void 0;const i=n(1469),r=n(6845),s=n(9545);class a extends s.BaseSettings{constructor(e){if(super(),this._version=new i.SettingsVersion("1.0"),this._settings={build_date:new r.Setting("","string","",!1),build_version:new r.Setting("","string","",!1),settings_version:new r.Setting("1.0","string","",!0),ambientOcclusion:new r.Setting(!0,(e=>!0)),autoRotateSpeed:new r.Setting(0,(e=>!0)),backgroundColor:new r.Setting("#ffffff",(e=>!0)),bumpAmplitude:new r.Setting(1,(e=>!0)),camera:new r.Setting({position:new r.Setting({x:0,y:0,z:0},(e=>!0)),target:new r.Setting({x:0,y:0,z:0},(e=>!0))},(e=>!0)),cameraAutoAdjust:new r.Setting(!1,(e=>!0)),cameraMovementDuration:new r.Setting(0,(e=>!0)),cameraOrtho:new r.Setting({position:new r.Setting({x:0,y:0,z:0},(e=>!0)),target:new r.Setting({x:0,y:0,z:0},(e=>!0))},(e=>!0)),cameraRevertAtMouseUp:new r.Setting(!1,(e=>!0)),clearAlpha:new r.Setting(1,(e=>!0)),clearColor:new r.Setting("#ffffff",(e=>!0)),commitParameters:new r.Setting(!1,(e=>!0)),controlDamping:new r.Setting(.1,(e=>!0)),controlNames:new r.Setting({},(e=>!0)),controlOrder:new r.Setting([],(e=>!0)),defaultMaterialColor:new r.Setting("#d3d3d3",(e=>!0)),disablePan:new r.Setting(!1,(e=>!0)),disableZoom:new r.Setting(!1,(e=>!0)),enableAutoRotation:new r.Setting(!1,(e=>!0)),enableRotation:new r.Setting(!0,(e=>!0)),environmentMap:new r.Setting("none",(e=>!0)),environmentMapResolution:new r.Setting("1024",(e=>!0)),fov:new r.Setting(45,(e=>!0)),lightScene:new r.Setting("default",(e=>!0)),lightScenes:new r.Setting(null,(e=>!0)),panSpeed:new r.Setting(.5,(e=>!0)),parametersHidden:new r.Setting([],(e=>!0)),pointSize:new r.Setting(1,(e=>!0)),revertAtMouseUpDuration:new r.Setting(800,(e=>!0)),rotateSpeed:new r.Setting(.25,(e=>!0)),showEnvironmentMap:new r.Setting(!1,(e=>!0)),showGrid:new r.Setting(!1,(e=>!0)),showGroundPlane:new r.Setting(!1,(e=>!0)),showShadows:new r.Setting(!0,(e=>!0)),topView:new r.Setting(!1,(e=>!0)),zoomExtentFactor:new r.Setting(1,(e=>!0)),zoomSpeed:new r.Setting(1,(e=>!0))},e){if(e.clearAlpha&&e.clearColor||!e.backgroundColor||"string"!=typeof e.backgroundColor||(e.clearColor=e.backgroundColor.substring(0,8),e.clearAlpha=parseInt(e.backgroundColor.substring(8),16)/255),e.defaultMaterialColor&&Array.isArray(e.defaultMaterialColor)){let t="#";for(let n=0;n<e.defaultMaterialColor.length;n++)t+=Number(e.defaultMaterialColor[n]).toString(16);e.defaultMaterialColor=t}e.topView&&e.camera&&!e.cameraOrtho&&(e.cameraOrtho=e.camera),this._fromJSON(e,this._settings)}}convertFromPreviousVersion(e){return this}convertToPreviousVersion(){return this}}t.Settings=a},3102:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Settings=void 0;const i=n(1469),r=n(6845),s=n(2495),a=n(9545);class o extends a.BaseSettings{constructor(e){super(),this._version=new i.SettingsVersion("2.0"),this._settings={build_date:new r.Setting("","string","",!1),build_version:new r.Setting("","string","",!1),settings_version:new r.Setting("2.0","string","",!0),ar:{enableCameraSync:new r.Setting(!1,"boolean","Enable / disable synchronisation of the camera with AR tracking information. Enabling this will disable the orbit controls.",!1),enableCameraSyncInitial:new r.Setting(!1,"boolean","Enable / disable the inital synchronisation of the camera with AR tracking information. Enabling this will disable the orbit controls."),enableLightingEstimation:new r.Setting(!0,"boolean","Enable / disable automatic lighting estimation. Enabling this stores the current state of the lights which will get restored once automatic lighting estimation gets disabled again."),enableTouchControls:new r.Setting(!0,"boolean","Enable / disable touch controls for placement of objects in the AR scene while AR camera synchronisation is enabled."),enableTouchControlRotation:new r.Setting(!0,"boolean","Enable / disable rotation of objects in the AR scene by means of touch controls. Typically this should be enabled for objects to be placed horizontally."),enableAutomaticPlacement:new r.Setting(!0,"boolean","Enable / disable initial automatic placement of objects in the AR scene as soon as plane anchors get detected. Automatic placement stops once the user starts to interact."),defaultHitTestType:new r.Setting("existingPlaneUsingGeometry",(e=>["featurePoint","estimatedHorizontalPlane","estimatedVerticalPlane","existingPlane","existingPlaneUsingExtent","existingPlaneUsingGeometry"].includes(e)),"Default type of feature to use for hit tests, used by touch controls. ")},defaultMaterial:{bumpAmplitude:new r.Setting(1,"notnegative","Bump amplitude of the default material"),color:new r.Setting("#d3d3d3","string","Color of the default material"),metalness:new r.Setting(0,"factor","Metalness of the default material"),roughness:new r.Setting(1,"factor","Roughness of the default material")},parameters:{controlOrder:new r.Setting([],"stringarray",""),controlNames:new r.Setting({},(e=>!0),""),parametersHidden:new r.Setting([],"stringarray","")},viewer:{blurSceneWhenBusy:new r.Setting(!0,"boolean","Blur or don't blur the scene while a process is busy"),ignoreSuperseded:new r.Setting(!0,"boolean","Ignore intermediate solutions which at the time of their arrival have already been superseded by another customization request",!1),loggingLevel:new r.Setting(-1,(e=>e>=-1&&e<=3),"Level of log messages shown on the console, allowed values: -1 (none), 0 (error), 1 (warn), 2 (info), 3 (debug)",!1),messageLoggingLevel:new r.Setting(-1,(e=>e>=-1&&e<=3),"Log level to be used for logging internal messages, allowed values: -1 (none), 0 (error), 1 (warn), 2 (info), 3 (debug)",!1),showMessages:new r.Setting(!0,"boolean","Show or don't show user messages in the viewport",!1),hasRestoredSettings:new r.Setting(!1,"boolean","True if settings have been restored from a settings object delivered by a CommPlugin",!1),useModelSettings:new r.Setting(!1,"boolean","True if settings object delivered by first CommPlugin should be used",!1),commitParameters:new r.Setting(!1,"boolean","Use or don't commit mode for parameters"),commitSettings:new r.Setting(!1,"boolean","Use or don't commit mode for settings"),viewerRuntimeId:new r.Setting("","string","The runtime id of this viewer",!1),scene:{show:new r.Setting(!1,"boolean","Show / hide the scene",!1),showSceneTransition:new r.Setting("1s","string",""),camera:{autoAdjust:new r.Setting(!1,"boolean","Enable / disable that the camera adjusts to geometry updates"),cameraMovementDuration:new r.Setting(800,"notnegative","Default duration of camera movements"),cameraTypes:{perspective:{default:new r.Setting({position:new r.Setting({x:0,y:0,z:0},"vector3any","Default position for the perspective camera"),target:new r.Setting({x:0,y:0,z:0},"vector3any","Default target for the perspective camera")},(e=>!0),"Default position and target for the perspective camera"),fov:new r.Setting(45,"notnegative","Camera frustum vertical field of view angle, unit degree, interval [0,180]"),controls:new r.Setting(0,(e=>0===e||1===e),"Set camera control type")},orthographic:{default:new r.Setting({position:new r.Setting({x:0,y:0,z:0},"vector3any","Default position for the orthographic camera"),target:new r.Setting({x:0,y:0,z:0},"vector3any","Default target for the orthographic camera")},(e=>!0),"Default position and target for the orthographic camera")},active:new r.Setting(0,(e=>e>=0&&e<=6),"Set camera type")},controls:{orbit:{autoRotationSpeed:new r.Setting(0,"number","Speed of autoration, can be negative, also refer to enableAutoRotation"),damping:new r.Setting(.1,"notnegative","How much to damp camera movements by the user"),enableAutoRotation:new r.Setting(!1,"boolean","Enable / disable automatic rotation of the camera, also refer to autoRotationSpeed"),enableKeyPan:new r.Setting(!1,"boolean","Enable / disable panning using the keyboard, also refer to enablePan"),enablePan:new r.Setting(!0,"boolean","Enable / disable panning in general, also refer to enableKeyPan"),enableRotation:new r.Setting(!0,"boolean","Enable / disable camera rotation"),enableZoom:new r.Setting(!0,"boolean","Enable / disable zooming"),input:new r.Setting({keys:{up:38,down:40,left:37,right:39},mouse:{rotate:0,zoom:1,pan:2},touch:{rotate:1,zoom:2,pan:3}},"any"),keyPanSpeed:new r.Setting(.5,"notnegative","Speed of panning when using the keyboard"),movementSmoothness:new r.Setting(.5,"factor","How much to the current movement is affected by the previous one"),restrictions:{position:{cube:new r.Setting({min:new r.Setting({x:-1/0,y:-1/0,z:-1/0},"vector3any","Restriction of the camera position inside a cube, minimum corner of the cube"),max:new r.Setting({x:1/0,y:1/0,z:1/0},"vector3any","Restriction of the camera position inside a cube, maximum corner of the cube")},(e=>!0),"Restriction of the camera position inside a cube, minimum and maximum corner of the cube",!1),sphere:new r.Setting({center:new r.Setting({x:0,y:0,z:0},"vector3any","Restriction of the camera position inside a sphere, center of the sphere"),radius:new r.Setting(1/0,"notnegative","Restriction of the camera position inside a sphere, radius of the sphere")},(e=>!0),"Restriction of the camera position inside a sphere, center and radius of the sphere",!1)},target:{cube:new r.Setting({min:new r.Setting({x:-1/0,y:-1/0,z:-1/0},"vector3any","Restriction of the camera target inside a cube, minimum corner of the cube"),max:new r.Setting({x:1/0,y:1/0,z:1/0},"vector3any","Restriction of the camera target inside a cube, maximum corner of the cube")},(e=>!0),"Restriction of the camera target inside a cube, minimum and maximum corner of the cube",!1),sphere:new r.Setting({center:new r.Setting({x:0,y:0,z:0},"vector3any","Restriction of the camera target inside a sphere, center of the sphere"),radius:new r.Setting(1/0,"notnegative","Restriction of the camera target inside a sphere, radius of the sphere")},(e=>!0),"Restriction of the camera target inside a sphere, center and radius of the sphere",!1)},rotation:new r.Setting({minPolarAngle:new r.Setting(0,(e=>!0),"Minimum polar angle of the camera position with respect to the camera target, unit degree, interval [0,180]"),maxPolarAngle:new r.Setting(180,(e=>!0),"Maximum polar angle of the camera position with respect to the camera target, unit degree, interval [0,180]"),minAzimuthAngle:new r.Setting(-1/0,"number","Minimum azimuth angle of the camera position with respect to the camera target, unit degree, interval [-180,180]"),maxAzimuthAngle:new r.Setting(1/0,"number","Maximum azimuth angle of the camera position with respect to the camera target, unit degree, interval [-180,180]")},(e=>!0),"Minimum and maximum polar and azimuth angle of the camera position with respect to the camera target, unit degree",!1),zoom:new r.Setting({minDistance:new r.Setting(0,"notnegative","Minimum distance between camera position and target"),maxDistance:new r.Setting(1/0,"notnegative","Maximum distance between camera position and target")},(e=>!0),"Minimum and maximum distance between camera position and target",!1)},rotationSpeed:new r.Setting(.5,"notnegative","Speed of camera rotation"),panSpeed:new r.Setting(.5,"notnegative","Speed of panning"),zoomSpeed:new r.Setting(.5,"notnegative","Speed of zooming")},fps:{},orthographic:{damping:new r.Setting(.1,"notnegative","How much to damp camera movements by the user"),enableKeyPan:new r.Setting(!1,"boolean","Enable / disable panning using the keyboard, also refer to enablePan"),enablePan:new r.Setting(!0,"boolean","Enable / disable panning in general, also refer to enableKeyPan"),enableZoom:new r.Setting(!0,"boolean","Enable / disable zooming"),input:new r.Setting({keys:{up:38,down:40,left:37,right:39},mouse:{rotate:0,zoom:1,pan:2},touch:{rotate:1,zoom:2,pan:3}},"any"),keyPanSpeed:new r.Setting(.5,"notnegative","Speed of panning when using the keyboard"),movementSmoothness:new r.Setting(.5,"factor","How much to the current movement is affected by the previous one"),panSpeed:new r.Setting(.5,"notnegative","Speed of panning"),zoomSpeed:new r.Setting(.5,"notnegative","Speed of zooming")}},enableCameraControls:new r.Setting(!0,"boolean","Enable / disable camera controls"),revertAtMouseUp:new r.Setting(!1,"boolean","Enable / disable if the mouse should reset on mouse up"),revertAtMouseUpDuration:new r.Setting(800,"notnegative","The duration of the transition of the revertAtMouseUp"),zoomExtentsFactor:new r.Setting(1,"number","Factor to apply to the bounding box before zooming to extents")},duration:new r.Setting(0,"notnegative","Set fade in / fade out duration"),fullscreen:new r.Setting(!1,"boolean","Enable / disable fullscreen mode",!1),gridVisibility:new r.Setting(!0,"boolean","Show / hide the grid"),groundPlaneReflectionThreshold:new r.Setting(.01,"notnegative","Allows to control the distance to objects that are still reflected by the groundplane"),groundPlaneReflectionVisibility:new r.Setting(!1,"boolean","Enable / disable the reflectivity of the groundplane"),groundPlaneVisibility:new r.Setting(!0,"boolean","Show / hide the ground plane"),lights:{helper:new r.Setting(!1,"boolean","Show / hide the light helpers"),lightScene:new r.Setting("default","string"),lightScenes:new r.Setting({},"any")},material:{environmentMap:new r.Setting("none",(e=>!0),"Name of the environment map to use, or an array of 6 image URLs making up the cube mapped environment map (px, nx, pz, nz, py, ny)"),environmentMapAsBackground:new r.Setting(!1,"boolean","Show / hide the environment map in the background"),environmentMapResolution:new r.Setting("1024",(e=>["256","512","1024","2048"].includes(e)),"Image resolution to be used for the named environment maps (available resolutions: 256, 512, 1024)")},render:{ambientOcclusion:new r.Setting(!0,"boolean","Enable / disable ambient occlusion for rendering"),beautyRenderDelay:new r.Setting(50,"notnegative","Amount of which the beauty rendering is delayed"),beautyRenderBlendingDuration:new r.Setting(1500,"notnegative","Time needed to blend the results of the beauty rendering"),clearColor:new r.Setting("#ffffff","string","Set background color"),clearAlpha:new r.Setting(1,"factor","Set background alpha value"),pointSize:new r.Setting(1,"notnegative","Set size of point objects"),shadows:new r.Setting(!0,"boolean","Enable / disable shadows for rendering"),sao:{samples:new r.Setting(8,"notnegative"),intensity:new r.Setting(.1,"notnegative"),kernelRadius:new r.Setting(8,"notnegative"),standardDev:new r.Setting(25,"notnegative")}}}}},e&&this._fromJSON(e,this._settings)}convertFromPreviousVersion(e){let t=e.settings;return this._settings.viewer.scene.render.clearAlpha.value=t.clearAlpha.value,this._settings.viewer.scene.render.clearColor.value=t.clearColor.value,this._settings.defaultMaterial.color.value=t.defaultMaterialColor.value,this._settings.build_date.value=t.build_date.value,this._settings.build_version.value=t.build_version.value,5===t.camera.value.position.value.x&&5===t.camera.value.position.value.y&&5===t.camera.value.position.value.z&&0===t.camera.value.target.value.x&&0===t.camera.value.target.value.y&&0===t.camera.value.target.value.z||0===t.camera.value.position.value.x&&0===t.camera.value.position.value.y&&0===t.camera.value.position.value.z&&0===t.camera.value.target.value.x&&0===t.camera.value.target.value.y&&0===t.camera.value.target.value.z||(this._settings.viewer.scene.camera.cameraTypes.perspective.default.value.position.value=t.camera.value.position.value,this._settings.viewer.scene.camera.cameraTypes.perspective.default.value.target.value=t.camera.value.target.value),5===t.cameraOrtho.value.position.value.x&&5===t.cameraOrtho.value.position.value.y&&5===t.cameraOrtho.value.position.value.z&&0===t.cameraOrtho.value.target.value.x&&0===t.cameraOrtho.value.target.value.y&&0===t.cameraOrtho.value.target.value.z||0===t.cameraOrtho.value.position.value.x&&0===t.cameraOrtho.value.position.value.y&&0===t.cameraOrtho.value.position.value.z&&0===t.cameraOrtho.value.target.value.x&&0===t.cameraOrtho.value.target.value.y&&0===t.cameraOrtho.value.target.value.z?!t.topView.value||5===t.camera.value.position.value.x&&5===t.camera.value.position.value.y&&5===t.camera.value.position.value.z&&0===t.camera.value.target.value.x&&0===t.camera.value.target.value.y&&0===t.camera.value.target.value.z||0===t.camera.value.position.value.x&&0===t.camera.value.position.value.y&&0===t.camera.value.position.value.z&&0===t.camera.value.target.value.x&&0===t.camera.value.target.value.y&&0===t.camera.value.target.value.z||(this._settings.viewer.scene.camera.cameraTypes.orthographic.default.value.position.value=t.camera.value.position.value,this._settings.viewer.scene.camera.cameraTypes.orthographic.default.value.target.value=t.camera.value.target.value):(this._settings.viewer.scene.camera.cameraTypes.orthographic.default.value.position.value=t.cameraOrtho.value.position.value,this._settings.viewer.scene.camera.cameraTypes.orthographic.default.value.target.value=t.cameraOrtho.value.target.value),this._settings.viewer.scene.render.ambientOcclusion.value=t.ambientOcclusion.value,this._settings.viewer.scene.camera.controls.orbit.autoRotationSpeed.value=t.autoRotateSpeed.value,this._settings.defaultMaterial.bumpAmplitude.value=t.bumpAmplitude.value,this._settings.viewer.scene.camera.autoAdjust.value=t.cameraAutoAdjust.value,this._settings.viewer.scene.camera.cameraMovementDuration.value=t.cameraMovementDuration.value,this._settings.viewer.scene.camera.revertAtMouseUp.value=t.cameraRevertAtMouseUp.value,this._settings.viewer.commitParameters.value=t.commitParameters.value,this._settings.viewer.scene.camera.controls.orbit.damping.value=t.controlDamping.value,this._settings.viewer.scene.camera.controls.orthographic.damping.value=t.controlDamping.value,this._settings.parameters.controlNames.value=t.controlNames.value,this._settings.parameters.controlOrder.value=t.controlOrder.value,this._settings.viewer.scene.camera.controls.orbit.enablePan.value=!t.disablePan.value,this._settings.viewer.scene.camera.controls.orthographic.enablePan.value=!t.disablePan.value,this._settings.viewer.scene.camera.controls.orbit.enableZoom.value=!t.disableZoom.value,this._settings.viewer.scene.camera.controls.orthographic.enableZoom.value=!t.disableZoom.value,this._settings.viewer.scene.camera.controls.orbit.enableAutoRotation.value=t.enableAutoRotation.value,this._settings.viewer.scene.camera.controls.orbit.enableRotation.value=t.enableRotation.value,this._settings.viewer.scene.material.environmentMap.value=t.environmentMap.value,this._settings.viewer.scene.material.environmentMapResolution.value=t.environmentMapResolution.value,this._settings.viewer.scene.camera.cameraTypes.perspective.fov.value=t.fov.value,this._settings.viewer.scene.lights.lightScene.value=t.lightScene.value,this._settings.viewer.scene.lights.lightScenes.value=t.lightScenes.value,this._settings.viewer.scene.camera.controls.orbit.panSpeed.value=t.panSpeed.value,this._settings.parameters.parametersHidden.value=t.parametersHidden.value,this._settings.viewer.scene.render.pointSize.value=t.pointSize.value,this._settings.viewer.scene.camera.revertAtMouseUpDuration.value=t.revertAtMouseUpDuration.value,this._settings.viewer.scene.camera.controls.orbit.rotationSpeed.value=t.rotateSpeed.value,this._settings.viewer.scene.material.environmentMapAsBackground.value=t.showEnvironmentMap.value,this._settings.viewer.scene.gridVisibility.value=t.showGrid.value,this._settings.viewer.scene.groundPlaneVisibility.value=t.showGroundPlane.value,this._settings.viewer.scene.render.shadows.value=t.showShadows.value,t.topView.value&&(this._settings.viewer.scene.camera.cameraTypes.active.value=1),this._settings.viewer.scene.camera.zoomExtentsFactor.value=t.zoomExtentFactor.value,this._settings.viewer.scene.camera.controls.orbit.zoomSpeed.value=t.zoomSpeed.value,this._settings.viewer.scene.camera.controls.orthographic.zoomSpeed.value=t.zoomSpeed.value,this}convertToPreviousVersion(){let e=new s.Settings;return e.settings.build_date.value=this._settings.build_date.value,e.settings.build_version.value=this._settings.build_version.value,e.settings.ambientOcclusion.value=this._settings.viewer.scene.render.ambientOcclusion.value,e.settings.autoRotateSpeed.value=this._settings.viewer.scene.camera.controls.orbit.autoRotationSpeed.value,e.settings.bumpAmplitude.value=this._settings.defaultMaterial.bumpAmplitude.value,e.settings.camera.value=new r.Setting({position:this._settings.viewer.scene.camera.cameraTypes.perspective.default.value.position.value,target:this._settings.viewer.scene.camera.cameraTypes.perspective.default.value.target.value},(e=>!0)).value,e.settings.cameraAutoAdjust.value=this._settings.viewer.scene.camera.autoAdjust.value,e.settings.cameraMovementDuration.value=this._settings.viewer.scene.camera.cameraMovementDuration.value,e.settings.cameraOrtho.value=new r.Setting({position:this._settings.viewer.scene.camera.cameraTypes.orthographic.default.value.position.value,target:this._settings.viewer.scene.camera.cameraTypes.orthographic.default.value.target.value},(e=>!0)).value,e.settings.cameraRevertAtMouseUp.value=this._settings.viewer.scene.camera.revertAtMouseUp.value,e.settings.clearAlpha.value=this._settings.viewer.scene.render.clearAlpha.value,e.settings.clearColor.value=this._settings.viewer.scene.render.clearColor.value,e.settings.commitParameters.value=this._settings.viewer.commitParameters.value,e.settings.controlDamping.value=this._settings.viewer.scene.camera.controls.orbit.damping.value,this._settings.parameters.controlNames.value&&(e.settings.controlNames.value=this._settings.parameters.controlNames.value),this._settings.parameters.controlOrder.value&&(e.settings.controlOrder.value=this._settings.parameters.controlOrder.value),e.settings.defaultMaterialColor.value=this._settings.defaultMaterial.color.value,e.settings.disablePan.value=!this._settings.viewer.scene.camera.controls.orbit.enablePan.value,e.settings.disableZoom.value=!this._settings.viewer.scene.camera.controls.orbit.enableZoom.value,e.settings.enableAutoRotation.value=this._settings.viewer.scene.camera.controls.orbit.enableAutoRotation.value,e.settings.enableRotation.value=this._settings.viewer.scene.camera.controls.orbit.enableRotation.value,e.settings.environmentMap.value=this._settings.viewer.scene.material.environmentMap.value,e.settings.environmentMapResolution.value=this._settings.viewer.scene.material.environmentMapResolution.value,e.settings.fov.value=this._settings.viewer.scene.camera.cameraTypes.perspective.fov.value,e.settings.lightScene.value=this._settings.viewer.scene.lights.lightScene.value,e.settings.lightScenes.value=this._settings.viewer.scene.lights.lightScenes.value,e.settings.panSpeed.value=this._settings.viewer.scene.camera.controls.orbit.panSpeed.value,this._settings.parameters.parametersHidden.value&&(e.settings.parametersHidden.value=this._settings.parameters.parametersHidden.value),e.settings.pointSize.value=this._settings.viewer.scene.render.pointSize.value,e.settings.revertAtMouseUpDuration.value=this._settings.viewer.scene.camera.revertAtMouseUpDuration.value,e.settings.rotateSpeed.value=this._settings.viewer.scene.camera.controls.orbit.rotationSpeed.value,e.settings.showEnvironmentMap.value=this._settings.viewer.scene.material.environmentMapAsBackground.value,e.settings.showGrid.value=this._settings.viewer.scene.gridVisibility.value,e.settings.showGroundPlane.value=this._settings.viewer.scene.groundPlaneVisibility.value,e.settings.showShadows.value=this._settings.viewer.scene.render.shadows.value,e.settings.topView.value=1===this._settings.viewer.scene.camera.cameraTypes.active.value,e.settings.zoomExtentFactor.value=this._settings.viewer.scene.camera.zoomExtentsFactor.value,e.settings.zoomSpeed.value=this._settings.viewer.scene.camera.controls.orbit.zoomSpeed.value,e.settings.backgroundColor.value=this._settings.viewer.scene.render.clearColor.value,e}}t.Settings=o},628:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractSetting=void 0,t.AbstractSetting=class{constructor(e=""){this._note=e}get note(){return this._note}set note(e){this._note=e}get isSetting(){return!0}}},1671:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BooleanSetting=void 0;const i=n(628);class r extends i.AbstractSetting{constructor(e,t="",n=(()=>!0)){super(t),this._default=e,this._check=n,this._value=e}get default(){return this._default}get value(){return this._value}set value(e){this._value=e}check(e){return this._check(e)}}t.BooleanSetting=r},57:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CustomSetting=void 0;const i=n(628);class r extends i.AbstractSetting{constructor(e,t="",n=(()=>!0)){super(t),this._default=e,this._check=n,this._value=e}get default(){return this._default}get value(){return this._value}set value(e){this._value=e}check(e){return this._check(e)}}t.CustomSetting=r},2662:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NumberSetting=void 0;const i=n(628);class r extends i.AbstractSetting{constructor(e,t="",n=(()=>!0)){super(t),this._default=e,this._check=n,this._value=e}get default(){return this._default}get value(){return this._value}set value(e){this._value=e}check(e){return this._check(e)}}t.NumberSetting=r},3913:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StringSetting=void 0;const i=n(628);class r extends i.AbstractSetting{constructor(e,t="",n=(()=>!0)){super(t),this._default=e,this._check=n,this._value=e}get default(){return this._default}get value(){return this._value}set value(e){this._value=e}check(e){return this._check(e)}}t.StringSetting=r},169:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vec3Setting=void 0;const i=n(628),r=n(887);class s extends i.AbstractSetting{constructor(e,t="",n=(()=>!0)){super(t),this._default=e,this._check=n,this._value=r.vec3.clone(e)}get default(){return this._default}get value(){return this._value}set value(e){this._value=e}check(e){return this._check(e)}}t.Vec3Setting=s},2100:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.StateEngine=void 0;const s=n(2899),a=n(8877),o=n(3262);let l=class{constructor(){this._eventEngine=s.container.resolve(a.EventEngine),this._customStates={},this._primarySettingsRegistered=new o.StatePromise,this._boundingBoxCreated=new o.StatePromise,this._primarySessionLoaded=new o.StatePromise,this._firstViewerShown=new o.StatePromise,this._eventEngine.addListener(a.EVENTTYPE.SETTINGS.SETTINGS_REGISTERED,(e=>{e.loadAsPrimary&&this._primarySettingsRegistered.resolve(!0),e.sessionId&&this.getCustomState(e.sessionId+"_settings_registered").resolve(!0)})),this._eventEngine.addListener(a.EVENTTYPE.SESSION.SESSION_INITIALIZED,(e=>{e.session.primarySession&&this._primarySessionLoaded.resolve(!0)}))}get primarySettingsRegistered(){return this._primarySettingsRegistered}get boundingBoxCreated(){return this._boundingBoxCreated}get primarySessionLoaded(){return this._primarySessionLoaded}get firstViewerShown(){return this._firstViewerShown}getCustomState(e){return this._customStates[e]}createCustomState(e){return this._customStates[e]=new o.StatePromise,this._customStates[e]}};l=i([s.singleton(),r("design:paramtypes",[])],l),t.StateEngine=l},3262:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.StatePromise=void 0,t.StatePromise=class{constructor(){this._resolved=!1,this._callbacks=[],this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t})),this._promise.finally((()=>{this._resolved=!0}))}get resolved(){return this._resolved}get resolve(){return this._resolve}get reject(){return this._reject}then(e){return n(this,void 0,void 0,(function*(){this._callbacks.push(e),!0===this.resolved?e():this._promise.then(e)}))}reset(){this._resolved=!1,this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t})),this._promise.finally((()=>{this._resolved=!0}));const e=[...this._callbacks];this._callbacks=[];for(let t=0;t<e.length;t++)this.then(e[t])}}},6629:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SystemInfo=void 0;const s=n(2899);let a=class{constructor(){this._runningInInternetExplorer="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent.indexOf("Trident")>-1,this._runningInBrowser=this._runningInInternetExplorer||"undefined"!=typeof document&&"function"==typeof document.getElementById&&window&&"function"==typeof window.Event,this._runningInIframe=!1,this._runningInBrowser?(this._runningInIframe=parent!==window,this._origin=this._runningInIframe?document.referrer:window.location.origin):this._origin="direct",this._runningInSafari=navigator.userAgent.indexOf("Safari")>-1,this._isIOSDevice=(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream,this._isMobileDevice=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))}get isIOSDevice(){return this._isIOSDevice}get isMobileDevice(){return this._isMobileDevice}get runningInInternetExplorer(){return this._runningInInternetExplorer}get runningInSafari(){return this._runningInSafari}get runningInBrowser(){return this._runningInBrowser}get runningInIframe(){return this._runningInIframe}get origin(){return this._origin+""}};a=i([s.singleton(),r("design:paramtypes",[])],a),t.SystemInfo=a},7027:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CustomData=void 0;const i=n(3858);class r extends i.AbstractTreeNodeData{constructor(e,t){super(t),this._data=e}get data(){return this._data}set data(e){this._data=e}clone(){return new r(Object.assign({},this.data),this._id)}}t.CustomData=r},446:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryData=t.PrimitiveData=t.AttributeData=void 0;const i=n(887),r=n(3858),s=n(5174);class a{constructor(e,t,n=!1,i,r,s){this._array=e,this._itemSize=t,this._hasOffset=n,this._offset=i,this._stride=r,this._normalized=s}get array(){return this._array}get hasOffset(){return this._hasOffset}get itemSize(){return this._itemSize}get normalized(){return this._normalized}get offset(){return this._offset}get stride(){return this._stride}clone(){let e=this._array.slice(0,this._array.length);return e.set(this._array),new a(e,this._itemSize,this._hasOffset,this._offset,this._stride,this._normalized)}}t.AttributeData=a;class o{constructor(e={},t=4,n=null,i=null){this._attributes=e,this._mode=t,this._indices=n,this._material=i,this._boundingBox=new s.Box,this._attributes.POSITION&&this._boundingBox.setFromAttributeArray(this._attributes.POSITION.array)}get attributes(){return this._attributes}get boundingBox(){return this._boundingBox}get indices(){return this._indices}set indices(e){this._indices=e}get material(){return this._material}set material(e){this._material=e}get mode(){return this._mode}clone(){var e,t;let n={};for(let e in this._attributes)n[e]=this._attributes[e].clone();return new o(n,this._mode,null===(e=this._indices)||void 0===e?void 0:e.clone(),null===(t=this._material)||void 0===t?void 0:t.clone())}}t.PrimitiveData=o;class l extends r.AbstractTreeNodeData{constructor(e,t=i.mat4.create(),n=[],r){super(r),this._primitive=e,this._matrix=t,this._convertedObjects=n,this._boundingBox=new s.Box,this._boundingBox=this.primitive.boundingBox.clone(),this._boundingBox.applyMatrix(this.matrix)}get boundingBox(){return this._boundingBox}get convertedObjects(){return this._convertedObjects}set convertedObjects(e){this._convertedObjects=e}get matrix(){return this._matrix}get primitive(){return this._primitive}clone(){return new l(this._primitive.clone(),i.mat4.clone(this.matrix),this.convertedObjects,this._id)}}t.GeometryData=l},3001:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HTMLElementAnchorData=void 0;const i=n(3858);class r extends i.AbstractTreeNodeData{constructor(e,t,n,i=!0,r=[],s,a){super(a),this._location=e,this._data=t,this._format=n,this._hideable=i,this._viewers=r,this._intersectionTarget=s,this._viewerHtmlElement={},this._htmlElement=document.createElement("div"),this._htmlElement.style.display="none",this._htmlElement.style.userSelect="none",this._htmlElement.style.cursor="default",this._htmlElement.style.pointerEvents="none",this._htmlElement.style.position="absolute",this._htmlElement.style.fontFamily='"Helvetica Neue", Helvetica, Arial, sans-serif',this._htmlElement.style.whiteSpace="nowrap",this._htmlElement.style.textOverflow="clip",this._htmlElement.classList.add("shapediver-domElement"),"text"===this.format&&this.createTextElement(this.data),"image"===this.format&&this.createImageElement(this.data)}createTextElement(e){var t;const n=document.createElement("span");n.style.color=null===(t=e.color)||void 0===t?void 0:t.toString(),n.innerHTML=e.text,n.style.display="block",n.style.textOverflow="clip",n.style.overflow="hidden",this._htmlElement.appendChild(n),!e.textAlign||"right"!==e.textAlign&&"center"!==e.textAlign?n.style.textAlign="left":n.style.textAlign=e.textAlign}createImageElement(e){const t=document.createElement("img");this._htmlElement.appendChild(t),t.src=e.src,e.height&&(t.height=e.height),e.width&&(t.width=e.width),e.alt&&(t.alt=e.alt)}get data(){return this._data}set data(e){this._data=e}get format(){return this._format}set format(e){this._format=e}createViewerHtmlElement(e){return this._viewerHtmlElement[e]?this._viewerHtmlElement[e]:this.viewers.includes(e)||0===this.viewers.length?(this._viewerHtmlElement[e]=this._htmlElement.cloneNode(!0),this._viewerHtmlElement[e]):null}get hideable(){return this._hideable}set hideable(e){this._hideable=e}get intersectionTarget(){return this._intersectionTarget}set intersectionTarget(e){this._intersectionTarget=e}get location(){return this._location}set location(e){this._location=e}get viewers(){return this._viewers}set viewers(e){this._viewers=e}update(){}clone(){return new r(this.location,this.data,this.format,this.hideable,this.viewers,this.intersectionTarget,this.id)}}t.HTMLElementAnchorData=r},5907:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SD_RENDERINGTYPE=void 0,(n=t.SD_RENDERINGTYPE||(t.SD_RENDERINGTYPE={})).THREEJS="threejs",n.BABYLONJS="babylonjs"},1919:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MaterialData=t.MapData=t.MATERIAL_SHADING=t.MATERIAL_ALPHA=t.TEXTURE_FILTERING=t.TEXTURE_WRAPPING=t.MATERIAL_SIDE=void 0;const i=n(887),r=n(3858);var s,a,o,l,c;!function(e){e.DOUBLE="double",e.FRONT="front",e.BACK="back"}(s=t.MATERIAL_SIDE||(t.MATERIAL_SIDE={})),function(e){e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(a=t.TEXTURE_WRAPPING||(t.TEXTURE_WRAPPING={})),function(e){e[e.NONE=0]="NONE",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(o=t.TEXTURE_FILTERING||(t.TEXTURE_FILTERING={})),function(e){e.OPAQUE="opaque",e.MASK="mask",e.BLEND="blend"}(l=t.MATERIAL_ALPHA||(t.MATERIAL_ALPHA={})),function(e){e.FLAT="flat",e.SMOOTH="smooth"}(c=t.MATERIAL_SHADING||(t.MATERIAL_SHADING={})),t.MapData=class{constructor(e,t=a.REPEAT,n=a.REPEAT,r=o.NONE,s=o.NONE,l=i.vec2.fromValues(0,0),c=i.vec4.fromValues(1,1,1,1),h=i.vec2.fromValues(0,0),u=i.vec2.fromValues(1,1),d=0,p=!0){this._image=e,this._wrapS=t,this._wrapT=n,this._minFilter=r,this._magFilter=s,this._center=l,this._color=c,this._offset=h,this._repeat=u,this._rotation=d,this._flipY=p}get center(){return this._center}get color(){return this._color}get image(){return this._image}get magFilter(){return this._magFilter}get minFilter(){return this._minFilter}get offset(){return this._offset}get repeat(){return this._repeat}get rotation(){return this._rotation}get wrapS(){return this._wrapS}get wrapT(){return this._wrapT}get flipY(){return this._flipY}};class h extends r.AbstractTreeNodeData{constructor(e,t){super(t),this._alphaCutoff=0,this._alphaMode=l.OPAQUE,this._bumpScale=1,this._shading=c.SMOOTH,this._metalness=1,this._normalScale=1,this._opacity=1,this._roughness=1,this._side=s.DOUBLE,this._convertedObjects=[],e&&(e.alphaMap&&(this.alphaMap=e.alphaMap),e.alphaCutoff&&(this.alphaCutoff=e.alphaCutoff),e.alphaMode&&(this.alphaMode=e.alphaMode),e.bumpMap&&(this.bumpMap=e.bumpMap),e.bumpScale&&(this.bumpScale=e.bumpScale),e.color&&(this.color=e.color),e.emissiveMap&&(this.emissiveMap=e.emissiveMap),e.emissiveness&&(this.emissiveness=e.emissiveness),e.shading&&(this.shading=e.shading),e.map&&(this.map=e.map),e.metalness&&(this.metalness=e.metalness),e.metalnessMap&&(this.metalnessMap=e.metalnessMap),e.metalnessRoughnessMap&&(this.metalnessRoughnessMap=e.metalnessRoughnessMap),e.name&&(this.name=e.name),e.normalMap&&(this.normalMap=e.normalMap),e.normalScale&&(this.normalScale=e.normalScale),e.opacity&&(this.opacity=e.opacity),e.roughness&&(this.roughness=e.roughness),e.roughnessMap&&(this.roughnessMap=e.roughnessMap),e.side&&(this.side=e.side),e.convertedObjects&&(this.convertedObjects=e.convertedObjects))}get alphaCutoff(){return this._alphaCutoff}set alphaCutoff(e){this._alphaCutoff=e}get alphaMap(){return this._alphaMap}set alphaMap(e){this._alphaMap=e}get alphaMode(){return this._alphaMode}set alphaMode(e){this._alphaMode=e}get bumpMap(){return this._bumpMap}set bumpMap(e){this._bumpMap=e}get bumpScale(){return this._bumpScale}set bumpScale(e){this._bumpScale=e}get color(){return this._color}set color(e){this._color=e}get convertedObjects(){return this._convertedObjects}set convertedObjects(e){this._convertedObjects=e}get emissiveMap(){return this._emissiveMap}set emissiveMap(e){this._emissiveMap=e}get emissiveness(){return this._emissiveness}set emissiveness(e){this._emissiveness=e}get map(){return this._map}set map(e){this._map=e}get metalness(){return this._metalness}set metalness(e){this._metalness=e}get metalnessMap(){return this._metalnessMap}set metalnessMap(e){this._metalnessMap=e}get metalnessRoughnessMap(){return this._metalnessRoughnessMap}set metalnessRoughnessMap(e){this._metalnessRoughnessMap=e}get name(){return this._name}set name(e){this._name=e}get normalMap(){return this._normalMap}set normalMap(e){this._normalMap=e}get normalScale(){return this._normalScale}set normalScale(e){this._normalScale=e}get opacity(){return this._opacity}set opacity(e){this._opacity=e}get roughness(){return this._roughness}set roughness(e){this._roughness=e}get roughnessMap(){return this._roughnessMap}set roughnessMap(e){this._roughnessMap=e}get shading(){return this._shading}set shading(e){this._shading=e}get side(){return this._side}set side(e){this._side=e}clone(){return new h({alphaMap:this.alphaMap,alphaCutoff:this.alphaCutoff,alphaMode:this.alphaMode,bumpMap:this.bumpMap,bumpScale:this.bumpScale,color:this.color,emissiveMap:this.emissiveMap,emissiveness:this.emissiveness,shading:this.shading,map:this.map,metalness:this.metalness,metalnessMap:this.metalnessMap,metalnessRoughnessMap:this.metalnessRoughnessMap,name:this.name,normalMap:this.normalMap,normalScale:this.normalScale,opacity:this.opacity,roughness:this.roughness,roughnessMap:this.roughnessMap,side:this.side,convertedObjects:this.convertedObjects},this.id)}}t.MaterialData=h},7038:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CustomData=t.HTMLElementAnchorData=t.PrimitiveData=t.AttributeData=t.GeometryData=t.TEXTURE_FILTERING=t.TEXTURE_WRAPPING=t.MATERIAL_SHADING=t.MATERIAL_ALPHA=t.MATERIAL_SIDE=t.MapData=t.MaterialData=t.SD_RENDERINGTYPE=void 0;const i=n(5907);Object.defineProperty(t,"SD_RENDERINGTYPE",{enumerable:!0,get:function(){return i.SD_RENDERINGTYPE}});const r=n(7027);Object.defineProperty(t,"CustomData",{enumerable:!0,get:function(){return r.CustomData}});const s=n(446);Object.defineProperty(t,"AttributeData",{enumerable:!0,get:function(){return s.AttributeData}}),Object.defineProperty(t,"GeometryData",{enumerable:!0,get:function(){return s.GeometryData}}),Object.defineProperty(t,"PrimitiveData",{enumerable:!0,get:function(){return s.PrimitiveData}});const a=n(1919);Object.defineProperty(t,"MapData",{enumerable:!0,get:function(){return a.MapData}}),Object.defineProperty(t,"MaterialData",{enumerable:!0,get:function(){return a.MaterialData}}),Object.defineProperty(t,"MATERIAL_ALPHA",{enumerable:!0,get:function(){return a.MATERIAL_ALPHA}}),Object.defineProperty(t,"MATERIAL_SHADING",{enumerable:!0,get:function(){return a.MATERIAL_SHADING}}),Object.defineProperty(t,"MATERIAL_SIDE",{enumerable:!0,get:function(){return a.MATERIAL_SIDE}}),Object.defineProperty(t,"TEXTURE_FILTERING",{enumerable:!0,get:function(){return a.TEXTURE_FILTERING}}),Object.defineProperty(t,"TEXTURE_WRAPPING",{enumerable:!0,get:function(){return a.TEXTURE_WRAPPING}});const o=n(3001);Object.defineProperty(t,"HTMLElementAnchorData",{enumerable:!0,get:function(){return o.HTMLElementAnchorData}})},6570:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Converter=void 0;const r=n(887),s=n(9521),a=n(2899);let o=class{tinyColorToString(e){return e.toHexString()}toColor(e,t="#00fff7"){if(!e||"default"===e)return t;e.constructor===Float32Array&&(e=Array.from(e));const n=new s.TinyColor(e);if(e instanceof s.TinyColor)return this.tinyColorToString(n);if("number"==typeof e){let n=e.toString(16),i=n.length;i<3?n=n.padStart(3,"0"):i<6?n=n.padStart(6,"0"):i<8&&(n=n.padEnd(8,"0"));let r=new s.TinyColor(n);return r.isValid?this.tinyColorToString(r):t}if(e.isColor&&"function"==typeof e.getHexString){let n=new s.TinyColor(e.getHexString());return n.isValid?this.tinyColorToString(n):t}if(Array.isArray(e)&&(3==e.length||4==e.length)){let n=!0;for(let t=0;t<3;++t)e[t]=parseFloat(e[t]),isNaN(e[t])&&(n=!1);if(!n)return t;let i=new s.TinyColor({r:Math.max(0,Math.min(e[0],255)),g:Math.max(0,Math.min(e[1],255)),b:Math.max(0,Math.min(e[2],255))});if(4==e.length){let t=parseFloat(e[3]);isNaN(t)||i.setAlpha(Math.max(0,Math.min(t,255))/255)}return i.isValid?this.tinyColorToString(i):t}if("string"!=typeof e){let n=new s.TinyColor(e);return n.isValid?this.tinyColorToString(n):t}var i=e.replace("0x","#");if(null!==i.match(/^#[a-f0-9]{6}$/i)){let e=new s.TinyColor(i+"ff");return e.isValid?this.tinyColorToString(e):t}if(null!==i.match(/^#[a-f0-9]{8}$/i)){let e=new s.TinyColor(i);return e.isValid?this.tinyColorToString(e):t}if(null!==i.match(/^#[a-f0-9]{7}$/i)){let e=new s.TinyColor(i.slice(0,7)+"0"+i.slice(-1));return e.isValid?this.tinyColorToString(e):t}let r=new s.TinyColor(i);return r.isValid?this.tinyColorToString(r):t}toVec3(e){return Array.isArray(e)&&e.length>=3&&"number"==typeof e[0]&&"number"==typeof e[1]&&"number"==typeof e[2]?r.vec3.fromValues(e[0],e[1],e[2]):!e.x&&0!==e.x||"number"!=typeof e.x||!e.y&&0!==e.y||"number"!=typeof e.y||!e.z&&0!==e.z||"number"!=typeof e.z?!e.X&&0!==e.X||"number"!=typeof e.X||!e.Y&&0!==e.Y||"number"!=typeof e.Y||!e.Z&&0!==e.Z||"number"!=typeof e.Z?r.vec3.create():r.vec3.fromValues(e.X,e.Y,e.Z):r.vec3.fromValues(e.x,e.y,e.z)}};o=i([a.singleton()],o),t.Converter=o},9890:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpClient=void 0;const o=a(n(9669)),l=n(2899);let c=class{constructor(){this._cache={},o.default.interceptors.response.use((e=>e),(e=>{throw e}))}get(e,t){return s(this,void 0,void 0,(function*(){return this._cache[e]||(this._cache[e]=o.default(e,Object.assign({method:"get"},t))),this._cache[e]}))}post(e,t){return s(this,void 0,void 0,(function*(){return o.default(e,Object.assign({method:"post"},t))}))}put(e,t){return s(this,void 0,void 0,(function*(){return o.default(e,Object.assign({method:"put"},t))}))}};c=i([l.singleton(),r("design:paramtypes",[])],c),t.HttpClient=c},5446:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageLoader=void 0;const s=n(2899);let a=class{constructor(){this._imageCache={}}load(e){return r(this,void 0,void 0,(function*(){if(this._imageCache[e])return this._imageCache[e];this._imageCache[e]=document.createElementNS("http://www.w3.org/1999/xhtml","img");const t=new Promise((t=>{this._imageCache[e].onload=n=>{t(this._imageCache[e])}}));return"data:"!==e.substr(0,5)&&(this._imageCache[e].crossOrigin="anonymous"),this._imageCache[e].src=e,yield t,this._imageCache[e]}))}};a=i([s.singleton()],a),t.ImageLoader=a},4562:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputValidator=t.TypeChecker=t.Converter=t.UuidGenerator=t.ImageLoader=t.HttpClient=void 0;const i=n(6570);Object.defineProperty(t,"Converter",{enumerable:!0,get:function(){return i.Converter}});const r=n(9890);Object.defineProperty(t,"HttpClient",{enumerable:!0,get:function(){return r.HttpClient}});const s=n(5446);Object.defineProperty(t,"ImageLoader",{enumerable:!0,get:function(){return s.ImageLoader}});const a=n(1076);Object.defineProperty(t,"InputValidator",{enumerable:!0,get:function(){return a.InputValidator}});const o=n(8802);Object.defineProperty(t,"TypeChecker",{enumerable:!0,get:function(){return o.TypeChecker}});const l=n(9608);Object.defineProperty(t,"UuidGenerator",{enumerable:!0,get:function(){return l.UuidGenerator}})},1076:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.InputValidator=void 0;const r=n(2899),s=n(4171),a=n(8802);let o=class{constructor(){this._logger=r.container.resolve(s.Logger),this._typeChecker=r.container.resolve(a.TypeChecker)}validate(e,t,n=!0,i=[]){if(!1!==n||void 0!==e){switch(t){case"string":if(this._typeChecker.isTypeOf(e,"string"))return;break;case"boolean":if(this._typeChecker.isTypeOf(e,"boolean"))return;break;case"function":if(this._typeChecker.isTypeOf(e,"function"))return;break;case"number":if(this._typeChecker.isTypeOf(e,"number"))return;break;case"factor":if(this._typeChecker.isTypeOf(e,"number")&&e>=0&&e<=1)return;break;case"positive":if(this._typeChecker.isTypeOf(e,"number")&&e>=0)return;break;case"HTMLCanvasElement":if(this._typeChecker.isHTMLCanvasElement(e))return;break;case"enum":if(this._typeChecker.isTypeOf(e,"string")&&i.includes(e))return;break;case"vec3":if(e.constructor===Float32Array&&(e=Array.from(e)),Array.isArray(e)&&this._typeChecker.isTypeOf(e[0],"number")&&this._typeChecker.isTypeOf(e[1],"number")&&this._typeChecker.isTypeOf(e[2],"number"))return;break;case"cubeMap":if(Array.isArray(e)&&6===e.length&&this._typeChecker.isTypeOf(e[0],"string")&&this._typeChecker.isTypeOf(e[1],"string")&&this._typeChecker.isTypeOf(e[2],"string")&&this._typeChecker.isTypeOf(e[3],"string")&&this._typeChecker.isTypeOf(e[4],"string")&&this._typeChecker.isTypeOf(e[5],"string"))return;if(this._typeChecker.isTypeOf(e,"string"))return;break;case"stringArray":if(Array.isArray(e)){let t=!0;for(let n=0;n<e.length;n++)"string"!=typeof e[n]&&(t=!1);if(!0===t)return}break;case"object":if(this._typeChecker.isTypeOf(e,"object"))return;break;case"file":if(this._typeChecker.isTypeOf(e,"string")||e instanceof File||e instanceof Blob)return;break;case"color":if(this._typeChecker.isTypeOf(e,"string")||Array.isArray(e)&&this._typeChecker.isTypeOf(e[0],"number")&&this._typeChecker.isTypeOf(e[1],"number")&&this._typeChecker.isTypeOf(e[2],"number")||this._typeChecker.isTypeOf(e,"number"))return;break;default:throw new Error(`The type ${t} is not recognized.`)}throw new Error(`The value ${e} is not of type ${t}, but is ${typeof e} instead.`)}}};o=i([r.singleton()],o),t.InputValidator=o},8802:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TypeChecker=void 0;const r=n(2899);let s=class{isTypeOf(e,t){return typeof e===t}isHTMLCanvasElement(e){return e instanceof HTMLCanvasElement}};s=i([r.singleton()],s),t.TypeChecker=s},9608:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.UuidGenerator=void 0;const r=n(2899),s=n(1614);let a=class{create(){return s.v4()}validate(e){return s.validate(e)}parse(e){return s.parse(e)}stringify(e){return s.stringify(e)}};a=i([r.singleton()],a),t.UuidGenerator=a},8006:function(e,t,n){"use strict";var i,r,s,a,o,l,c,h,u,d=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},m=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.Api=void 0;const g=n(3858),v=n(2899),_=n(1196),y=n(733),b=n(8877),w=n(4562),x=n(2248),M=n(4171),E=n(2248),S=n(3680);let T=class{constructor(){i.set(this,v.container.resolve(b.EventEngine)),r.set(this,v.container.resolve(w.InputValidator)),s.set(this,v.container.resolve(M.Logger)),a.set(this,v.container.resolve(M.PerformanceEvaluator)),o.set(this,{}),l.set(this,v.container.resolve(b.SettingsEngine)),c.set(this,v.container.resolve(b.StateEngine)),h.set(this,{}),this.sceneTree=v.container.resolve(g.Tree),this.sessions={},this.viewers={},u.set(this,(()=>{this.loggingLevel=m(this,s,"f").loggingLevel,this.showMessages=m(this,s,"f").showMessages})),m(this,c,"f").primarySettingsRegistered.then((()=>{m(this,s,"f").showMessages=m(this,l,"f").general.viewer.showMessages.value})),m(this,s,"f").info(`Viewer version: ${S.build_data.build_version}`),m(this,s,"f").addUpdateCB(m(this,u,"f")),m(this,u,"f").call(this)}addListener(e,t){return m(this,i,"f").addListener(e,t)}closeSession(e){return f(this,void 0,void 0,(function*(){if(m(this,r,"f").validate(e,"string"),!this.sessions[e])return m(this,s,"f").info(`Session with id ${e} was not registered`),!1;const t=yield m(this,o,"f")[e].close();if(m(this,c,"f").getCustomState(e+"_settings_registered").reset(),this.sessions[e].primarySession){for(let e in this.viewers)this.viewers[e].reset();m(this,c,"f").primarySessionLoaded.reset(),m(this,c,"f").primarySettingsRegistered.reset()}this.update(),m(this,o,"f")[e]=void 0,delete m(this,o,"f")[e],this.sessions[e]=void 0,delete this.sessions[e],m(this,s,"f").info(`Session (${e}): Session closed.`);for(let e in this.sessions)if(this.sessions[e].primarySessionRequest){yield m(this,o,"f")[e].setAsPrimary(),m(this,s,"f").info(`Session (${e}): Initializing settings.`);break}return t}))}closeViewer(e){return f(this,void 0,void 0,(function*(){if(m(this,r,"f").validate(e,"string"),!this.viewers[e])return m(this,s,"f").info(`Viewer with id ${e} was not registered`),!1;const t=yield m(this,h,"f")[e].close();return m(this,h,"f")[e]=void 0,delete m(this,h,"f")[e],this.viewers[e]=void 0,delete this.viewers[e],m(this,s,"f").info(`Viewer (${e}): Viewer closed.`),t}))}createAndInitializeSession(e){return f(this,void 0,void 0,(function*(){m(this,r,"f").validate(e,"object"),m(this,r,"f").validate(e.ticket,"string"),m(this,r,"f").validate(e.modelViewUrl,"string"),m(this,r,"f").validate(e.bearerToken,"string",!1),m(this,r,"f").validate(e.primarySession,"boolean",!1),m(this,r,"f").validate(e.excludeViewers,"stringArray",!1),m(this,r,"f").validate(e.id,"string",!1);const t=e.id||v.container.resolve(w.UuidGenerator).create();if(this.sessions[t])throw m(this,s,"f").error("Session with this id already exists."),new Error("Session with this id already exists.");const n=this.createSession(e);return yield n.init(),n}))}createAndInitializeViewer(e){return f(this,void 0,void 0,(function*(){m(this,r,"f").validate(e,"object",!1);const t=Object.assign({},e);m(this,r,"f").validate(t.type,"enum",!1,Object.values(x.RENDERERTYPE)),m(this,r,"f").validate(t.visibility,"enum",!1,Object.values(E.VISIBILITYMODE)),m(this,r,"f").validate(t.canvas,"HTMLCanvasElement",!1),m(this,r,"f").validate(t.id,"string",!1);const n=t.id||v.container.resolve(w.UuidGenerator).create();this.viewers[n]&&m(this,s,"f").error("Viewer with this id already exists."),m(this,a,"f").start("viewer_creation_"+n);let o={};const l=new y.Viewer({id:n,canvas:t.canvas,visibility:t.visibility||E.VISIBILITYMODE.SESSION,type:t.type||x.RENDERERTYPE.STANDARD},o);return m(this,i,"f").emitEvent(b.EVENTTYPE.VIEWER.VIEWER_CREATED,{viewer:l}),this.viewers[n]=l,m(this,h,"f")[n]=o,m(this,a,"f").end("viewer_creation_"+n),m(this,s,"f").info(m(this,a,"f").getEvaluationToString("viewer_creation_"+n)),m(this,a,"f").start("viewer_init_"+n),yield l.init(t),l.update(),m(this,i,"f").emitEvent(b.EVENTTYPE.VIEWER.VIEWER_INITIALIZED,{viewer:l}),m(this,a,"f").end("viewer_init_"+n),m(this,s,"f").info(m(this,a,"f").getEvaluationToString("viewer_init_"+n)),this.viewers[n]}))}createSession(e){m(this,r,"f").validate(e,"object"),m(this,r,"f").validate(e.ticket,"string"),m(this,r,"f").validate(e.modelViewUrl,"string"),m(this,r,"f").validate(e.bearerToken,"string",!1),m(this,r,"f").validate(e.primarySession,"boolean",!1),m(this,r,"f").validate(e.excludeViewers,"stringArray",!1),m(this,r,"f").validate(e.id,"string",!1);const t=e.id||v.container.resolve(w.UuidGenerator).create();if(this.sessions[t])throw m(this,s,"f").error("Session with this id already exists."),new Error("Session with this id already exists.");m(this,a,"f").start("session_creation_"+t);let n={};const l=new _.Session(Object.assign({},e,{id:t}),n);return m(this,i,"f").emitEvent(b.EVENTTYPE.SESSION.SESSION_CREATED,{session:l}),this.sessions[t]=l,m(this,o,"f")[t]=n,m(this,a,"f").end("session_creation_"+t),m(this,s,"f").info(m(this,a,"f").getEvaluationToString("session_creation_"+t)),l}createViewer(e){m(this,r,"f").validate(e,"object",!1);const t=Object.assign({},e);m(this,r,"f").validate(t.type,"enum",!1,Object.values(x.RENDERERTYPE)),m(this,r,"f").validate(t.visibility,"enum",!1,Object.values(E.VISIBILITYMODE)),m(this,r,"f").validate(t.canvas,"HTMLCanvasElement",!1),m(this,r,"f").validate(t.id,"string",!1);const n=t.id||v.container.resolve(w.UuidGenerator).create();this.viewers[n]&&m(this,s,"f").error("Viewer with this id already exists."),m(this,a,"f").start("viewer_creation_"+n);let o={};const l=new y.Viewer({id:n,canvas:t.canvas,visibility:t.visibility||E.VISIBILITYMODE.SESSION,type:t.type||x.RENDERERTYPE.STANDARD},o);return m(this,i,"f").emitEvent(b.EVENTTYPE.VIEWER.VIEWER_CREATED,{viewer:l}),this.viewers[n]=l,m(this,h,"f")[n]=o,m(this,a,"f").end("viewer_creation_"+n),m(this,s,"f").info(m(this,a,"f").getEvaluationToString("viewer_creation_"+n)),this.viewers[n]}getSession(e){return m(this,r,"f").validate(e,"string"),this.sessions[e]}getViewer(e){return m(this,r,"f").validate(e,"string"),this.viewers[e]}removeListener(e){return m(this,i,"f").removeListener(e)}update(){for(let e in this.viewers)this.viewers[e].update()}updateLoggingLevel(e){m(this,r,"f").validate(e,"enum",!0,Object.values(M.LOGGINGLEVEL)),m(this,s,"f").loggingLevel=e,m(this,s,"f").info(`LoggingLevel was set to: ${e}`)}updateShowMessages(e){m(this,r,"f").validate(e,"boolean"),m(this,s,"f").showMessages=e,m(this,l,"f").general.viewer.showMessages.value=m(this,s,"f").showMessages,m(this,s,"f").info(`ShowMessages was set to: ${e}`)}};i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap,l=new WeakMap,c=new WeakMap,h=new WeakMap,u=new WeakMap,T=d([v.singleton(),p("design:paramtypes",[])],T),t.Api=T},3680:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.build_data=void 0,t.build_data={build_version:"3.1",build_date:"2021-06-22T10:43:46.533Z",build_branch:"development",build_commit:"434283e727d911a0681fd685dbf13a85c9ee2095"}},3256:(e,t,n)=>{"use strict";t.hi=void 0;n(1990);const i=n(2899),r=(n(3490),n(2248),n(8006));n(733),n(6072),n(6535),n(1196),n(3858),n(8977),n(7038),n(4171),n(8877),n(9878),n(9049),n(358),n(2621),n(1088),n(5932),n(2201),n(2724),n(2736),n(168),n(2227),n(6494),n(3368),n(9044);t.hi=i.container.resolve(r.Api)},6535:function(e,t,n){"use strict";var i,r,s,a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},o=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.Export=void 0;const c=n(4171),h=n(4562),u=n(2899);t.Export=class{constructor(e,t){i.set(this,u.container.resolve(h.InputValidator)),r.set(this,u.container.resolve(c.Logger)),s.set(this,void 0),o(this,s,e,"f"),t.dependency&&(this.dependency=t.dependency),this.id=t.uid||t.id,this.name=t.name,this.type=t.type,t.uid&&(this.uid=t.uid),this.displayName=void 0,this.order=void 0,this.hidden=!1}request(e={}){var t,n;return a(this,void 0,void 0,(function*(){const i=l(this,s,"f").parameterValues,a={};for(let t in i)a[t]=e[t]||""===e[t]?e[t]:i[t];try{let e=(yield l(this,s,"f").sessionCommunication(null===(t=l(this,s,"f").sessionResponse.actions)||void 0===t?void 0:t.filter((e=>"export"===e.name))[0].href,null===(n=l(this,s,"f").sessionResponse.actions)||void 0===n?void 0:n.filter((e=>"export"===e.name))[0].method.toLowerCase(),{exports:{id:this.id},parameters:a},"application/json")).data,i=e.exports[this.id];return l(this,s,"f").mergeResponses(l(this,s,"f").sessionResponse,{version:l(this,s,"f").sessionResponse.version,actions:e.actions}),"delay"in i&&(yield new Promise((e=>setTimeout(e,i.delay))),i=yield this.cacheRequest(i.version)),i}catch(e){throw l(this,r,"f").error("Export request failed.",e,e.response&&e.response.status?e.response.status:null),new Error(`Requesting the export with id ${this.id} failed.`)}}))}updateDisplayName(e){l(this,i,"f").validate(e,"string",!1),this.displayName=e}updateHidden(e){l(this,i,"f").validate(e,"boolean"),this.hidden=e}updateOrder(e){l(this,i,"f").validate(e,"number",!1),this.order=e}cacheRequest(e){var t,n;return a(this,void 0,void 0,(function*(){try{let i=(yield l(this,s,"f").sessionCommunication(null===(t=l(this,s,"f").sessionResponse.actions)||void 0===t?void 0:t.filter((e=>"export-cache"===e.name))[0].href,null===(n=l(this,s,"f").sessionResponse.actions)||void 0===n?void 0:n.filter((e=>"export-cache"===e.name))[0].method.toLowerCase(),{[this.id]:e},"application/json")).data.exports[this.id];return"delay"in i&&(yield new Promise((e=>setTimeout(e,i.delay))),i=yield this.cacheRequest(e)),i}catch(e){throw l(this,r,"f").error("Export cache request failed.",e,e.response&&e.response.status?e.response.status:null),new Error(`Requesting the export with id ${this.id} failed.`)}}))}},i=new WeakMap,r=new WeakMap,s=new WeakMap},3368:function(e,t,n){"use strict";var i,r,s,a,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},l=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.FileParameter=void 0;const h=n(4171),u=n(4562),d=n(2899),p=n(6494);class f extends p.Parameter{constructor(e,t){super(e,t),i.set(this,d.container.resolve(u.HttpClient)),r.set(this,d.container.resolve(h.Logger)),s.set(this,void 0),a.set(this,d.container.resolve(u.UuidGenerator)),l(this,s,e,"f")}upload(){var e,t;return o(this,void 0,void 0,(function*(){if(!this.value)return;if("string"==typeof this.value&&36===this.value.length&&c(this,a,"f").validate(this.value))return this.value;const n=new File(["string"==typeof this.value?new Blob([this.value],{type:"text/plain"}):this.value],"upload");if(0!==n.size)try{let r=(yield c(this,s,"f").sessionCommunication(null===(e=c(this,s,"f").sessionResponse.actions)||void 0===e?void 0:e.filter((e=>"upload"===e.name))[0].href,null===(t=c(this,s,"f").sessionResponse.actions)||void 0===t?void 0:t.filter((e=>"upload"===e.name))[0].method.toLowerCase(),{[this.id]:{size:n.size,format:this.format[0]}},"application/json")).data;return yield c(this,i,"f").put(r[this.id].href,{data:n,headers:{"Content-Type":this.format[0]}}),r[this.id].id}catch(e){c(this,r,"f").error("Upload request failed.",e,e.response&&e.response.status?e.response.status:null)}else c(this,r,"f").error("Error uploading parameter "+this.id+": file size is 0.")}))}}t.FileParameter=f,i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap},6072:function(e,t,n){"use strict";var i,r,s,a=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Output=void 0;const o=n(2899),l=n(4562),c=n(4171);t.Output=class{constructor(e,t){i.set(this,o.container.resolve(l.InputValidator)),r.set(this,o.container.resolve(c.Logger)),s.set(this,void 0),a(this,s,e,"f"),t.dependency&&(this.dependency=t.dependency),this.id=t.uid||t.id,this.name=t.name,t.uid&&(this.uid=t.uid),t.material&&(this.material=t.material),t.chunks&&(this.chunks=t.chunks)}},i=new WeakMap,r=new WeakMap,s=new WeakMap},6494:function(e,t,n){"use strict";var i,r,s,a,o,l=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.Parameter=t.PARAMETERVISUALIZATION=t.PARAMETERTYPE=void 0;const h=n(4171),u=n(4562),d=n(2899);var p,f;!function(e){e.FLOAT="Float",e.INT="Int",e.EVEN="Even",e.ODD="Odd",e.STRING="String",e.COLOR="Color",e.STRINGLIST="StringList",e.BOOL="Bool",e.TIME="Time",e.FILE="File",e.SNUMBER="sNumber",e.SINTEGER="sInteger",e.SSTRING="sString",e.SCOLOR="sColor",e.SBOOL="sBool",e.STIME="sTime",e.SBITMAP="sBitmap",e.SDOMAIN="sDomain",e.SDOMAIN2D="sDomain2D",e.SPOINT="sPoint",e.SLINE="sLine",e.SVECTOR="sVector",e.SBOX="sBox",e.SPLANE="sPlane",e.SRECTANGLE="sRectangle",e.SCURVE="sCurve",e.SCIRCLE="sCircle",e.SMESH="sMesh",e.SSURFACE="sSurface",e.SBREP="sBrep",e.SSUBDIV="sSubdiv"}(p=t.PARAMETERTYPE||(t.PARAMETERTYPE={})),function(e){e.SLIDER="slider",e.SEQUENCE="sequence",e.CYCLE="cycle",e.DROPDOWN="dropdown",e.CHECKLIST="checklist",e.CLOCK="color",e.CALENDAR="calendar",e.TOGGLE="toggle",e.SWATCH="swatch",e.BUTTON="button",e.DIAL="dial",e.TEXT="text"}(f=t.PARAMETERVISUALIZATION||(t.PARAMETERVISUALIZATION={})),t.Parameter=class{constructor(e,t){i.set(this,d.container.resolve(u.Converter)),r.set(this,void 0),s.set(this,d.container.resolve(u.InputValidator)),a.set(this,d.container.resolve(h.Logger)),o.set(this,void 0),l(this,o,e,"f"),this.id=t.id,this.defval=t.defval,this.name=t.name,this.type=t.type,t.choices&&(this.choices=t.choices),t.decimalplaces&&(this.decimalplaces=+t.decimalplaces),t.expression&&(this.expression=t.expression),t.format&&(this.format=t.format),t.min&&(this.min=+t.min),t.max&&(this.max=+t.max),t.visualization&&(this.visualization=t.visualization),t.structure&&(this.structure=t.structure),t.group&&(this.group=t.group),t.tooltip&&(this.tooltip=t.tooltip),this.displayName=void 0,this.order=void 0,this.hidden=!1,this.type===p.BOOL||this.type===p.SBOOL?l(this,r,"true"===this.defval,"f"):this.type===p.EVEN||this.type===p.FLOAT||this.type===p.INT||this.type===p.ODD||this.type===p.SINTEGER||this.type===p.SNUMBER?l(this,r,+this.defval,"f"):l(this,r,this.defval,"f"),this.value=c(this,r,"f"),this.sessionValue=this.value,this.lastValidatedValue=this.value}isValid(e){try{switch(!0){case this.type===p.BOOL||this.type===p.SBOOL:if("string"==typeof e){if("true"!==e&&"false"!==e)throw new Error(`The value ${e} is a string that is neither true or false.`)}else c(this,s,"f").validate(e,"boolean");break;case this.type===p.COLOR||this.type===p.SCOLOR:c(this,s,"f").validate(e,"color");break;case this.type===p.FILE:c(this,s,"f").validate(e,"file");break;case this.type===p.EVEN||this.type===p.FLOAT||this.type===p.INT||this.type===p.ODD||this.type===p.SINTEGER||this.type===p.SNUMBER:let t=e;if("string"==typeof e&&(t=+e),c(this,s,"f").validate(t,"number"),this.type===p.EVEN){if(t%2!=0)throw new Error(`The value ${e} is not even.`)}else if(this.type===p.ODD){if(t%2==0)throw new Error(`The value ${e} is not odd.`)}else if((this.type===p.INT||this.type===p.SINTEGER)&&!Number.isInteger(t))throw new Error(`The value ${e} is not an integer.`);if((this.min||0===this.min)&&t<this.min)throw new Error(`The value ${e} is smaller than the minimum ${this.min}.`);if((this.max||0===this.max)&&t>this.max)throw new Error(`The value ${e} is larger than the maximum ${this.max}.`);if(this.decimalplaces||0===this.decimalplaces){const n=t+"";let i=0;if(n.includes(".")&&(i=n.split(".")[1].length),this.decimalplaces<i)throw new Error(`The value ${e} has not the correct number of decimalplaces (${this.decimalplaces}).`)}break;case this.type===p.STRINGLIST:c(this,s,"f").validate(e,"string");const n=e=>{const t=+e;if(c(this,s,"f").validate(t,"number"),t<0||t>this.choices.length-1)throw new Error(`The value ${e} is not within the range of the defined number choices.`)};if(this.visualization===f.CHECKLIST)if(e.includes(",")){const t=e.split(",");for(let e=0;e<t.length;e++){if(1!==t.filter((n=>n===t[e])).length)throw new Error(`The value ${t[e]} exists multiple times, but should only exist once.`);n(t[e])}}else n(e);else n(e);break;default:c(this,s,"f").validate(e,"string")}}catch(e){return c(this,a,"f").info(e.message),!1}return!0}resetToDefaultValue(){this.value=c(this,r,"f")}resetToSessionValue(){this.value=this.sessionValue}stringify(){switch(!0){case this.type===p.BOOL||this.type===p.SBOOL:return"string"==typeof this.value?this.value:this.value+"";case this.type===p.COLOR||this.type===p.SCOLOR:return"string"==typeof this.value?this.value:c(this,i,"f").toColor(this.value);case this.type===p.FILE:if("string"!=typeof this.value)throw c(this,a,"f").error(`Parameter (${this.id}): Error in stringify. Cannot stringify FileParameter that has not been uploaded yet.`),new Error(`Parameter (${this.id}): Error in stringify. Cannot stringify FileParameter that has not been uploaded yet.`);return this.value;case this.type===p.EVEN||this.type===p.FLOAT||this.type===p.INT||this.type===p.ODD||this.type===p.SINTEGER||this.type===p.SNUMBER:return"string"==typeof this.value?this.value:this.value+"";default:return this.value}}updateDisplayName(e){c(this,s,"f").validate(e,"string",!1),this.displayName=e}updateHidden(e){c(this,s,"f").validate(e,"boolean"),this.hidden=e}updateOrder(e){c(this,s,"f").validate(e,"number",!1),this.order=e}updateValue(e){if(!this.isValid(e))throw new Error(`Parameter (${this.id}): Could not validate value.`);this.value=e,this.lastValidatedValue=this.value}},i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap},1196:function(e,t,n){"use strict";var i,r,s,a,o,l,c,h,u,d=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},m=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},g=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;const v=n(3858),_=n(9878),y=n(6535),b=n(6072),w=n(2899),x=n(4171),M=n(8877),E=n(4562),S=n(3680),T=n(8006),A=n(6494),R=n(3368);let C=class{constructor(e,t){i.set(this,w.container.resolve(T.Api)),r.set(this,w.container.resolve(M.EventEngine)),s.set(this,w.container.resolve(E.InputValidator)),a.set(this,w.container.resolve(x.Logger)),o.set(this,void 0),l.set(this,w.container.resolve(M.SettingsEngine)),c.set(this,w.container.resolve(M.StateEngine)),h.set(this,(()=>{this.authorTicket=g(this,o,"f").authorTicket,this.bearerToken=g(this,o,"f").bearerToken,this.initialized=g(this,o,"f").initialized})),this.commitParameters=!1,this.commitSettings=!1,this.exports={},this.initialized=!1,this.outputs={},this.parameters={},this.primarySession=!1,this.primarySessionRequest=!1,u.set(this,[]),this.node=new v.TreeNode(e.id),m(this,o,new _.Session(Object.assign({buildDate:S.build_data.build_date,buildVersion:S.build_data.build_version},e)),"f"),this.id=g(this,o,"f").id,this.ticket=g(this,o,"f").ticket,this.modelViewUrl=g(this,o,"f").modelViewUrl,g(this,c,"f").createCustomState(this.id+"_settings_registered"),m(this,u,e.excludeViewers||[],"f"),this.primarySessionRequest=!1!==e.primarySession,!0===this.primarySessionRequest&&(!1===g(this,c,"f").primarySessionLoaded.resolved&&(this.primarySession=!0),g(this,c,"f").getCustomState(this.id+"_settings_registered").then((()=>{this.commitParameters=g(this,l,"f").general.viewer.commitParameters.value,this.commitSettings=g(this,l,"f").general.viewer.commitSettings.value;const e=g(this,l,"f").general.parameters.controlNames.value;for(let t in e)this.parameters[t]&&this.parameters[t].updateDisplayName(e[t]),this.exports[t]&&this.exports[t].updateDisplayName(e[t]);const t=g(this,l,"f").general.parameters.controlOrder.value;for(let e=0;e<t.length;e++)this.parameters[t[e]]&&this.parameters[t[e]].updateOrder(e),this.exports[t[e]]&&this.exports[t[e]].updateOrder(e);const n=g(this,l,"f").general.parameters.parametersHidden.value;for(let e=0;e<n.length;e++)this.parameters[n[e]]&&this.parameters[n[e]].updateHidden(!0),this.exports[n[e]]&&this.exports[n[e]].updateHidden(!0)}))),t.setAsPrimary=()=>f(this,void 0,void 0,(function*(){this.primarySession=!0,g(this,r,"f").emitEvent(M.EVENTTYPE.SESSION.SESSION_INITIALIZED,{session:this}),g(this,l,"f").fromJson(g(this,o,"f").settingsConfig,this.id,this.primarySession),yield new Promise((e=>g(this,c,"f").getCustomState(this.id+"_settings_registered").then((()=>{e()})))),g(this,r,"f").emitEvent(M.EVENTTYPE.SESSION.SESSION_LOADED,{session:this}),g(this,i,"f").update()})),t.close=()=>f(this,void 0,void 0,(function*(){const e=yield g(this,o,"f").close();return w.container.resolve(v.Tree).removeNode(this.node),g(this,i,"f").update(),this.primarySession&&(g(this,c,"f").primarySessionLoaded.reset(),g(this,c,"f").primarySettingsRegistered.reset(),g(this,l,"f").reset(),g(this,c,"f").primarySettingsRegistered.reset()),g(this,r,"f").emitEvent(M.EVENTTYPE.SESSION.SESSION_CLOSED,{}),e||g(this,a,"f").warn(`Session (${this.id}): Was not able to close session completely, please disregard this session.`),e})),g(this,o,"f").addUpdateCB(g(this,h,"f")),g(this,h,"f").call(this)}customize(){return f(this,void 0,void 0,(function*(){const e={};for(let t in g(this,i,"f").viewers)e[t]=g(this,i,"f").viewers[t].blur,g(this,i,"f").viewers[t].updateBlur(!0);w.container.resolve(v.Tree).removeNode(this.node);for(const e in this.parameters)if(this.parameters[e]instanceof R.FileParameter){const t=yield this.parameters[e].upload();this.parameters[e]=t}const t={};for(const e in this.parameters)t[e]={value:this.parameters[e].value,valueString:this.parameters[e].stringify()};for(const e in this.parameters)g(this,o,"f").parameterValues[e]=t[e].valueString;this.node=yield g(this,o,"f").customize();for(const e in this.parameters)this.parameters[e].sessionValue=t[e].value;w.container.resolve(v.Tree).addNode(this.node),this.node.excludeViewers=g(this,u,"f"),g(this,r,"f").emitEvent(M.EVENTTYPE.SESSION.SESSION_CUSTOMIZED,{session:this});for(let t in g(this,i,"f").viewers)g(this,i,"f").viewers[t].updateBlur(e[t]);return g(this,i,"f").update(),g(this,a,"f").info(`Session (${this.id}): Session customized.`),this.node}))}getExportById(e){return g(this,s,"f").validate(e,"string"),this.exports[e]}getExportByName(e){g(this,s,"f").validate(e,"string");const t=[];for(let n in this.exports)e===this.exports[n].name&&t.push(this.exports[n]);return t}getExportByType(e){g(this,s,"f").validate(e,"string");const t=[];for(let n in this.exports)e===this.exports[n].type&&t.push(this.exports[n]);return t}getOutputById(e){return g(this,s,"f").validate(e,"string"),this.outputs[e]}getOutputByName(e){g(this,s,"f").validate(e,"string");const t=[];for(let n in this.outputs)e===this.outputs[n].name&&t.push(this.outputs[n]);return t}getParameterById(e){return g(this,s,"f").validate(e,"string"),this.parameters[e]}getParameterByName(e){g(this,s,"f").validate(e,"string");const t=[];for(let n in this.parameters)e===this.parameters[n].name&&t.push(this.parameters[n]);return t}getParameterByType(e){g(this,s,"f").validate(e,"string");const t=[];for(let n in this.parameters)e===this.parameters[n].type&&t.push(this.parameters[n]);return t}init(){return f(this,void 0,void 0,(function*(){this.node=yield g(this,o,"f").init();for(let e in g(this,o,"f").parameters){const t=g(this,o,"f").parameters[e];switch(!0){case t.type===A.PARAMETERTYPE.BOOL||t.type===A.PARAMETERTYPE.SBOOL:case t.type===A.PARAMETERTYPE.COLOR||t.type===A.PARAMETERTYPE.SCOLOR:this.parameters[e]=new A.Parameter(g(this,o,"f"),g(this,o,"f").parameters[e]);break;case t.type===A.PARAMETERTYPE.FILE:this.parameters[e]=new R.FileParameter(g(this,o,"f"),g(this,o,"f").parameters[e]);break;case t.type===A.PARAMETERTYPE.EVEN||t.type===A.PARAMETERTYPE.FLOAT||t.type===A.PARAMETERTYPE.INT||t.type===A.PARAMETERTYPE.ODD||t.type===A.PARAMETERTYPE.SINTEGER||t.type===A.PARAMETERTYPE.SNUMBER:default:this.parameters[e]=new A.Parameter(g(this,o,"f"),g(this,o,"f").parameters[e])}}for(let e in g(this,o,"f").exports)this.exports[e]=new y.Export(g(this,o,"f"),g(this,o,"f").exports[e]);for(let e in g(this,o,"f").outputs)this.outputs[e]=new b.Output(g(this,o,"f"),g(this,o,"f").outputs[e]);return w.container.resolve(v.Tree).addNode(this.node),this.node.excludeViewers=g(this,u,"f"),g(this,a,"f").info(`Session (${this.id}): Session initialized.`),g(this,r,"f").emitEvent(M.EVENTTYPE.SESSION.SESSION_INITIALIZED,{session:this}),g(this,l,"f").fromJson(g(this,o,"f").settingsConfig,this.id,this.primarySession),yield new Promise((e=>g(this,c,"f").getCustomState(this.id+"_settings_registered").then((()=>{e()})))),g(this,r,"f").emitEvent(M.EVENTTYPE.SESSION.SESSION_LOADED,{session:this}),g(this,i,"f").update(),this.node}))}saveDefaultParameters(){return f(this,void 0,void 0,(function*(){const e=yield g(this,o,"f").saveDefaultParameters();return g(this,a,"f").info(`Session (${this.id}): ${e?"Saved default parameters.":"Could not save default parameters."}`),e}))}saveSettings(e){return f(this,void 0,void 0,(function*(){g(this,l,"f").general.viewer.commitParameters.value=this.commitParameters,g(this,l,"f").general.viewer.commitSettings.value=this.commitSettings;const t=this.parameters,n=this.exports,r={};for(let e in t)t[e].displayName&&(r[e]=t[e].displayName);for(let e in n)n[e].displayName&&(r[e]=n[e].displayName);g(this,l,"f").general.parameters.controlNames.value=r;let s=[];for(let e in t)s.push(t[e]);for(let e in n)s.push(n[e]);s.sort(((e,t)=>(e.order||1/0)-(t.order||1/0)));let c=s.filter((e=>0===e.order));s=s.filter((e=>!c.includes(e))),s=c.concat(s),g(this,l,"f").general.parameters.controlOrder.value=s.map((e=>e.id));const h=[];for(let e in t)t[e].hidden&&h.push(e);for(let e in n)n[e].hidden&&h.push(e);if(g(this,l,"f").general.parameters.parametersHidden.value=h,g(this,l,"f").general.build_version.value=S.build_data.build_version,g(this,l,"f").general.build_date.value=S.build_data.build_date,g(this,l,"f").general.settings_version.value="2.0",0!==Object.values(g(this,i,"f").viewers).length){let t=e?g(this,i,"f").viewers[e]:null;t||(t=Object.values(g(this,i,"f").viewers)[0]);const n=w.container.resolveAll("renderingEngine");let r;for(let e=0;e<n.length;e++)n[e].id===t.id&&(r=n[e]);r.saveSettings();const s=g(this,l,"f").toJson(),c=yield g(this,o,"f").saveSettings(s);return g(this,a,"f").info(`Session (${this.id}): ${c?"Saved settings.":"Could not save settings."}`),c}return g(this,a,"f").warn(`Session (${this.id}): Could not save settings, no viewer initialized.`),!1}))}updateAuthorTicket(e){g(this,s,"f").validate(e,"boolean",!1),g(this,o,"f").authorTicket=e,g(this,a,"f").info(`Session (${this.id}): authorTicket was set to: ${e}`)}updateBearerToken(e){g(this,s,"f").validate(e,"string",!1),g(this,o,"f").bearerToken=e,g(this,a,"f").info(`Session (${this.id}): bearerToken was set to: ${e}`)}updateCommitParameters(e){g(this,s,"f").validate(e,"boolean"),this.commitParameters=e,g(this,a,"f").info(`Session (${this.id}): commitParameters was set to: ${e}`)}updateCommitSettings(e){g(this,s,"f").validate(e,"boolean"),this.commitSettings=e,g(this,a,"f").info(`Session (${this.id}): commitSettings was set to: ${e}`)}updateRefreshBearerToken(e){g(this,s,"f").validate(e,"function"),g(this,o,"f").refreshBearerToken=e,g(this,a,"f").info(`Session (${this.id}): refreshBearerToken was set to: ${e}`)}};i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap,l=new WeakMap,c=new WeakMap,h=new WeakMap,u=new WeakMap,C=d([w.injectable(),p("design:paramtypes",[Object,Object])],C),t.Session=C},733:function(e,t,n){"use strict";var i,r,s,a,o,l,c,h,u,d,p,f=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},v=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},_=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.Viewer=void 0;const y=n(8977),b=n(1990),w=n(2248),x=n(4171),M=n(8877),E=n(4562),S=n(2899),T=n(358),A=n(2621),R=n(2227);let C=class{constructor(e,t){i.set(this,{}),r.set(this,S.container.resolve(E.Converter)),s.set(this,S.container.resolve(M.EventEngine)),a.set(this,S.container.resolve(E.InputValidator)),o.set(this,{}),l.set(this,S.container.resolve(x.Logger)),c.set(this,S.container.resolve(x.PerformanceEvaluator)),h.set(this,S.container.resolve(M.StateEngine)),this.initialized=!1,u.set(this,(()=>{_(this,p,"f")&&(this.ambientOcclusion=_(this,p,"f").ambientOcclusion,this.automaticResizing=_(this,p,"f").automaticResizing,this.beautyRenderBlendingDuration=_(this,p,"f").beautyRenderBlendingDuration,this.beautyRenderDelay=_(this,p,"f").beautyRenderDelay,this.blur=_(this,p,"f").blur,this.blurSceneWhenBusy=_(this,p,"f").blurSceneWhenBusy,this.clearAlpha=_(this,p,"f").clearAlpha,this.clearColor=_(this,p,"f").clearColor,this.environmentMap=_(this,p,"f").environmentMap,this.environmentMapAsBackground=_(this,p,"f").environmentMapAsBackground,this.environmentMapResolution=_(this,p,"f").environmentMapResolution,this.gridVisibility=_(this,p,"f").gridVisibility,this.groundPlaneVisibility=_(this,p,"f").groundPlaneVisibility,this.id=_(this,p,"f").id,this.lightScene=_(this,p,"f").lightScene,this.pointSize=_(this,p,"f").pointSize,this.shadows=_(this,p,"f").shadows,this.show=_(this,p,"f").show,this.showStatistics=_(this,p,"f").showStatistics)})),d.set(this,void 0),p.set(this,void 0),v(this,d,e,"f"),t.close=()=>g(this,void 0,void 0,(function*(){const e=yield _(this,p,"f").close();return _(this,s,"f").emitEvent(M.EVENTTYPE.VIEWER.VIEWER_CLOSED,{}),e||_(this,l,"f").warn(`Viewer (${this.id}): Was not able to close viewer completely, please disregard this viewer.`),e}))}updateAmbientOcclusion(e){this.isInitialized(),_(this,a,"f").validate(e,"boolean"),_(this,p,"f").ambientOcclusion=e,_(this,l,"f").info(`Viewer (${this.id}): ambientOcclusion was set to: ${e}`)}updateAutomaticResizing(e){this.isInitialized(),_(this,a,"f").validate(e,"boolean"),_(this,p,"f").automaticResizing=e,_(this,l,"f").info(`Viewer (${this.id}): automaticResizing was set to: ${e}`)}updateBeautyRenderBlendingDuration(e){this.isInitialized(),_(this,a,"f").validate(e,"positive"),_(this,p,"f").beautyRenderBlendingDuration=e,_(this,l,"f").info(`Viewer (${this.id}): beautyRenderBlendingDuration was set to: ${e}`)}updateBeautyRenderDelay(e){this.isInitialized(),_(this,a,"f").validate(e,"positive"),_(this,p,"f").beautyRenderDelay=e,_(this,l,"f").info(`Viewer (${this.id}): beautyRenderDelay was set to: ${e}`)}updateBlur(e){this.isInitialized(),_(this,a,"f").validate(e,"boolean"),_(this,p,"f").blur=e,_(this,l,"f").info(`Viewer (${this.id}): blur was set to: ${e}`)}updateBlurSceneWhenBusy(e){this.isInitialized(),_(this,a,"f").validate(e,"boolean"),_(this,p,"f").blurSceneWhenBusy=e,_(this,l,"f").info(`Viewer (${this.id}): blurSceneWhenBusy was set to: ${e}`)}updateClearAlpha(e){this.isInitialized(),_(this,a,"f").validate(e,"factor"),_(this,p,"f").clearAlpha=e,_(this,l,"f").info(`Viewer (${this.id}): clearAlpha was set to: ${e}`)}updateClearColor(e){this.isInitialized(),_(this,a,"f").validate(e,"color"),_(this,p,"f").clearColor=_(this,r,"f").toColor(e),_(this,l,"f").info(`Viewer (${this.id}): clearColor was set to: ${e}`)}updateEnvironmentMap(e){this.isInitialized(),_(this,a,"f").validate(e,"cubeMap"),_(this,p,"f").environmentMap=e,_(this,l,"f").info(`Viewer (${this.id}): environmentMap was set to: ${e}`)}updateEnvironmentMapAsBackground(e){_(this,a,"f").validate(e,"boolean"),_(this,p,"f").environmentMapAsBackground=e,_(this,l,"f").info(`Viewer (${this.id}): environmentMapAsBackground was set to: ${e}`)}updateEnvironmentMapResolution(e){this.isInitialized(),_(this,a,"f").validate(e,"string"),_(this,p,"f").environmentMapResolution=e,_(this,l,"f").info(`Viewer (${this.id}): environmentMapResolution was set to: ${e}`)}updateGridVisibility(e){this.isInitialized(),_(this,a,"f").validate(e,"boolean"),_(this,p,"f").gridVisibility=e,_(this,l,"f").info(`Viewer (${this.id}): gridVisibility was set to: ${e}`)}updateGroundPlaneVisibility(e){this.isInitialized(),_(this,a,"f").validate(e,"boolean"),_(this,p,"f").groundPlaneVisibility=e,_(this,l,"f").info(`Viewer (${this.id}): groundPlaneVisibility was set to: ${e}`)}updateLightScene(e){this.isInitialized(),_(this,a,"f").validate(e,"string"),this.assignLightScene(e)&&(_(this,p,"f").lightScene=e,_(this,l,"f").info(`Viewer (${this.id}): lightScene was set to: ${e}`))}updatePointSize(e){this.isInitialized(),_(this,a,"f").validate(e,"positive"),_(this,p,"f").pointSize=e,_(this,l,"f").info(`Viewer (${this.id}): pointSize was set to: ${e}`)}updateShadows(e){this.isInitialized(),_(this,a,"f").validate(e,"boolean"),_(this,p,"f").shadows=e,_(this,l,"f").info(`Viewer (${this.id}): shadows was set to: ${e}`)}updateShow(e){this.isInitialized(),_(this,a,"f").validate(e,"boolean"),_(this,p,"f").show=e,_(this,l,"f").info(`Viewer (${this.id}): show was set to: ${e}`)}updateShowStatistics(e){this.isInitialized(),_(this,a,"f").validate(e,"boolean"),_(this,p,"f").showStatistics=e,_(this,l,"f").info(`Viewer (${this.id}): showStatistics was set to: ${e}`)}addAmbientLight(e){this.isInitialized(),_(this,a,"f").validate(e,"object",!1);const t=Object.assign({},e);_(this,a,"f").validate(t.color,"color",!1),_(this,a,"f").validate(t.intensity,"positive",!1),_(this,a,"f").validate(t.name,"string",!1),void 0!==t.color&&(t.color=_(this,r,"f").toColor(t.color));const n=_(this,p,"f").lightEngine.addAmbientLight(t),i=this.getLightScene().lights[n.id];return _(this,l,"f").info(`Viewer (${this.id}): Ambient light with id ${i.id} created.`),this.update(),i}addDirectionalLight(e){this.isInitialized(),_(this,a,"f").validate(e,"object",!1);const t=Object.assign({},e);_(this,a,"f").validate(t.color,"color",!1),_(this,a,"f").validate(t.intensity,"positive",!1),_(this,a,"f").validate(t.direction,"vec3",!1),_(this,a,"f").validate(t.castShadow,"boolean",!1),_(this,a,"f").validate(t.shadowMapResolution,"positive",!1),_(this,a,"f").validate(t.shadowMapBias,"number",!1),_(this,a,"f").validate(t.name,"string",!1),void 0!==t.color&&(t.color=_(this,r,"f").toColor(t.color));const n=_(this,p,"f").lightEngine.addDirectionalLight(t),i=this.getLightScene().lights[n.id];return _(this,l,"f").info(`Viewer (${this.id}): Directional light with id ${i.id} created.`),this.update(),i}addHemisphereLight(e){this.isInitialized(),_(this,a,"f").validate(e,"object",!1);const t=Object.assign({},e);_(this,a,"f").validate(t.color,"color",!1),_(this,a,"f").validate(t.groundColor,"color",!1),_(this,a,"f").validate(t.intensity,"positive",!1),_(this,a,"f").validate(t.name,"string",!1),void 0!==t.color&&(t.color=_(this,r,"f").toColor(t.color)),void 0!==t.groundColor&&(t.groundColor=_(this,r,"f").toColor(t.groundColor));const n=_(this,p,"f").lightEngine.addHemisphereLight(t),i=this.getLightScene().lights[n.id];return _(this,l,"f").info(`Viewer (${this.id}): Hemisphere light with id ${i.id} created.`),this.update(),i}addPointLight(e){this.isInitialized(),_(this,a,"f").validate(e,"object",!1);const t=Object.assign({},e);_(this,a,"f").validate(t.color,"color",!1),_(this,a,"f").validate(t.intensity,"positive",!1),_(this,a,"f").validate(t.position,"vec3",!1),_(this,a,"f").validate(t.distance,"positive",!1),_(this,a,"f").validate(t.decay,"positive",!1),_(this,a,"f").validate(t.name,"string",!1),void 0!==t.color&&(t.color=_(this,r,"f").toColor(t.color));const n=_(this,p,"f").lightEngine.addPointLight(t),i=this.getLightScene().lights[n.id];return _(this,l,"f").info(`Viewer (${this.id}): Point light with id ${i.id} created.`),this.update(),i}addSpotLight(e){this.isInitialized(),_(this,a,"f").validate(e,"object",!1);const t=Object.assign({},e);_(this,a,"f").validate(t.color,"color",!1),_(this,a,"f").validate(t.intensity,"positive",!1),_(this,a,"f").validate(t.position,"vec3",!1),_(this,a,"f").validate(t.target,"vec3",!1),_(this,a,"f").validate(t.distance,"positive",!1),_(this,a,"f").validate(t.decay,"positive",!1),_(this,a,"f").validate(t.angle,"positive",!1),_(this,a,"f").validate(t.penumbra,"positive",!1),_(this,a,"f").validate(t.name,"string",!1),void 0!==t.color&&(t.color=_(this,r,"f").toColor(t.color));const n=_(this,p,"f").lightEngine.addSpotLight(t),i=this.getLightScene().lights[n.id];return _(this,l,"f").info(`Viewer (${this.id}): Spot light with id ${i.id} created.`),this.update(),i}assignCamera(e){this.isInitialized(),_(this,a,"f").validate(e,"string"),_(this,p,"f").cameraEngine.assignCamera(e),_(this,l,"f").info(`Viewer (${this.id}): Camera with id ${e} assigned.`)}assignLightScene(e){if(this.isInitialized(),_(this,a,"f").validate(e,"string"),this.lightScene===e)return _(this,l,"f").info(`Viewer (${this.id}): The light scene with id ${e} was already assigned.`),!0;const t=_(this,p,"f").lightEngine.assignLightScene(e);return t&&(_(this,p,"f").lightScene=e),t&&_(this,l,"f").info(`Viewer (${this.id}): Assigned light scene with id ${e}.`),t||_(this,l,"f").info(`Viewer (${this.id}): Could not assign light scene with id ${e}.`),this.update(),t}createCamera(e,t){this.isInitialized(),_(this,a,"f").validate(e,"enum",!0,Object.values(b.CAMERATYPE)),_(this,a,"f").validate(t,"string",!1);const n=_(this,p,"f").cameraEngine.createCamera(e,t);return _(this,i,"f")[n.id]=n.type===b.CAMERATYPE.ORTHOGRAPHIC?new T.OrthographicCamera(n,this):new A.PerspectiveCamera(n,this),_(this,l,"f").info(`Viewer (${this.id}): ${n.type===b.CAMERATYPE.ORTHOGRAPHIC?"Orthographic":"Perspective"} camera with id ${t} created.`),_(this,i,"f")[n.id]}createLightScene(e){this.isInitialized(),_(this,a,"f").validate(e.name,"string",!1),_(this,a,"f").validate(e.standard,"boolean",!1);const t=_(this,p,"f").lightEngine.createLightScene(e),n=new R.LightScene(t);return _(this,o,"f")[t.id]=n,_(this,l,"f").info(`Viewer (${this.id}): New light scene with id ${t.id} created.`),t.id&&this.assignLightScene(t.id),this.update(),n}createOrthographicCamera(e){return _(this,a,"f").validate(e,"string",!1),_(this,l,"f").info(`Viewer (${this.id}): Orthographic camera with id ${e} created.`),this.createCamera(b.CAMERATYPE.ORTHOGRAPHIC,e)}createPerspectiveCamera(e){return _(this,a,"f").validate(e,"string",!1),_(this,l,"f").info(`Viewer (${this.id}): Perspective camera with id ${e} created.`),this.createCamera(b.CAMERATYPE.PERSPECTIVE,e)}getCamera(e){this.isInitialized(),_(this,a,"f").validate(e,"string",!1);const t=_(this,p,"f").cameraEngine.getCamera(e);return t?(_(this,i,"f")[t.id]||(_(this,i,"f")[t.id]=t.type===b.CAMERATYPE.ORTHOGRAPHIC?new T.OrthographicCamera(t,this):new A.PerspectiveCamera(t,this)),_(this,i,"f")[t.id]):null}getCameras(){this.isInitialized();const e=_(this,p,"f").cameraEngine.getCameras(),t={};for(let n in e)_(this,i,"f")[e[n].id]||(_(this,i,"f")[e[n].id]=e[n].type===b.CAMERATYPE.ORTHOGRAPHIC?new T.OrthographicCamera(e[n],this):new A.PerspectiveCamera(e[n],this)),t[n]=_(this,i,"f")[e[n].id];return t}getLight(e){this.isInitialized(),_(this,a,"f").validate(e,"string");const t=_(this,p,"f").lightEngine.getLightScene().id;if(!_(this,o,"f")[t]){const e=_(this,p,"f").lightEngine.getLightScene(t);_(this,o,"f")[t]=new R.LightScene(e)}return _(this,o,"f")[t].lights[e]}getLightScene(e){if(this.isInitialized(),_(this,a,"f").validate(e,"string",!1),e||(e=_(this,p,"f").lightEngine.getLightScene().id),!_(this,o,"f")[e]){const t=_(this,p,"f").lightEngine.getLightScene(e);_(this,o,"f")[t.id]=new R.LightScene(t)}return _(this,o,"f")[e]}getLightScenes(){this.isInitialized();const e=_(this,p,"f").lightEngine.getLightScenes(),t={};for(let n in e)t[n]=this.getLightScene(n);return t}getLights(){this.isInitialized();const e=_(this,p,"f").lightEngine.getLights(),t={};for(let n in e)t[n]=this.getLight(n);return t}getScreenshot(e,t){return this.isInitialized(),_(this,a,"f").validate(e,"string",!1),_(this,a,"f").validate(t,"factor",!1),_(this,l,"f").info(`Viewer (${this.id}): screenshot was requested`),_(this,p,"f").getScreenshot(e,t)}hasCamera(){return this.isInitialized(),_(this,p,"f").cameraEngine.hasCamera()}init(e){return g(this,void 0,void 0,(function*(){_(this,a,"f").validate(e,"object",!1);const t=Object.assign({},e);_(this,a,"f").validate(t.type,"enum",!1,Object.values(w.RENDERERTYPE)),_(this,a,"f").validate(t.visibility,"enum",!1,Object.values(w.VISIBILITYMODE)),_(this,a,"f").validate(t.canvas,"HTMLCanvasElement",!1),_(this,a,"f").validate(t.id,"string",!1);const n=t&&t.id?t.id:S.container.resolve(E.UuidGenerator).create();t.visibility=t.visibility||w.VISIBILITYMODE.SESSION,t&&v(this,d,{id:n||_(this,d,"f").id,canvas:t.canvas||_(this,d,"f").canvas,visibility:t.visibility||_(this,d,"f").visibility,type:t.type||w.RENDERERTYPE.STANDARD},"f"),v(this,p,new y.RenderingEngine(_(this,d,"f")),"f"),_(this,p,"f").addUpdateCB(_(this,u,"f")),_(this,u,"f").call(this),S.container.registerInstance("renderingEngine",_(this,p,"f"));const i=this.createCamera(b.CAMERATYPE.PERSPECTIVE);return this.assignCamera(i.id),t.visibility===w.VISIBILITYMODE.SESSION&&!0===_(this,h,"f").primarySessionLoaded.resolved&&(yield new Promise((e=>{_(this,h,"f").getCustomState(this.id+"_settings_loaded").then((()=>e()))}))),_(this,s,"f").emitEvent(M.EVENTTYPE.VIEWER.VIEWER_INITIALIZED,{viewer:this}),this.initialized=!0,Promise.resolve()}))}removeLight(e){this.isInitialized(),_(this,a,"f").validate(e,"string");const t=_(this,p,"f").lightEngine.removeLight(e);return t&&_(this,l,"f").info(`Viewer (${this.id}): Light with id ${e} removed.`),t||_(this,l,"f").info(`Viewer (${this.id}): Could not remove light with id ${e}.`),this.update(),t}removeLightScene(e){this.isInitialized(),_(this,a,"f").validate(e,"string");const t=_(this,p,"f").lightEngine.removeLightScene(e);return t&&delete _(this,o,"f")[e],t&&_(this,l,"f").info(`Viewer (${this.id}): Light scene with id ${e} removed.`),t||_(this,l,"f").info(`Viewer (${this.id}): Could not remove light scene with id ${e}.`),this.update(),t}reset(){this.isInitialized(),_(this,p,"f").reset()}resize(e,t){this.isInitialized(),_(this,a,"f").validate(e,"number"),_(this,a,"f").validate(t,"number"),_(this,l,"f").info(`Viewer (${this.id}) was resized to ${e} / ${t}.`),_(this,p,"f").resize(e,t)}update(){_(this,p,"f")&&(_(this,p,"f").update(),_(this,l,"f").info(`Viewer (${this.id}) was updated.`),_(this,s,"f").emitEvent(M.EVENTTYPE.VIEWER.VIEWER_UPDATED,{viewer:this}))}isInitialized(){if(!_(this,p,"f"))throw _(this,l,"f").error("Viewer has not been initialized. Please initialize it first."),new Error("Viewer not initialized.")}};i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap,l=new WeakMap,c=new WeakMap,h=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,C=f([S.injectable(),m("design:paramtypes",[Object,Object])],C),t.Viewer=C},8091:function(e,t,n){"use strict";var i,r,s,a,o=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=void 0;const c=n(2899),h=n(4562),u=n(887),d=n(4171),p=n(5174);t.Camera=class{constructor(e){i.set(this,void 0),r.set(this,c.container.resolve(h.InputValidator)),s.set(this,c.container.resolve(d.Logger)),a.set(this,(()=>{this.autoAdjust=l(this,i,"f").autoAdjust,this.cameraMovementDuration=l(this,i,"f").cameraMovementDuration,this.defaultPosition=l(this,i,"f").defaultPosition,this.defaultTarget=l(this,i,"f").defaultTarget,this.enableCameraControls=l(this,i,"f").enableCameraControls,this.id=l(this,i,"f").id,this.position=l(this,i,"f").position,this.revertAtMouseUp=l(this,i,"f").revertAtMouseUp,this.revertAtMouseUpDuration=l(this,i,"f").revertAtMouseUpDuration,this.target=l(this,i,"f").target,this.type=l(this,i,"f").type,this.zoomExtentsFactor=l(this,i,"f").zoomExtentsFactor})),o(this,i,e,"f"),l(this,i,"f").addUpdateCB(l(this,a,"f")),l(this,a,"f").call(this)}updateCameraMovementDuration(e){l(this,r,"f").validate(e,"positive"),l(this,i,"f").cameraMovementDuration=e,l(this,s,"f").info(`Camera (${l(this,i,"f").id}): cameraMovementDuration was set to: ${e}`)}updateDefaultPosition(e){l(this,r,"f").validate(e,"vec3"),l(this,i,"f").defaultPosition=e,l(this,s,"f").info(`Camera (${l(this,i,"f").id}): defaultPosition was set to: ${e}`)}updateDefaultTarget(e){l(this,r,"f").validate(e,"vec3"),l(this,i,"f").defaultTarget=e,l(this,s,"f").info(`Camera (${l(this,i,"f").id}): defaultTarget was set to: ${e}`)}updateEnableCameraControls(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").enableCameraControls=e,l(this,s,"f").info(`Camera (${l(this,i,"f").id}): enableCameraControls was set to: ${e}`)}updatePosition(e){l(this,r,"f").validate(e,"vec3"),l(this,i,"f").position=e,l(this,s,"f").info(`Camera (${l(this,i,"f").id}): position was set to: ${e}`)}updateRevertAtMouseUp(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").revertAtMouseUp=e,l(this,s,"f").info(`Camera (${l(this,i,"f").id}): revertAtMouseUp was set to: ${e}`)}updateRevertAtMouseUpDuration(e){l(this,r,"f").validate(e,"positive"),l(this,i,"f").revertAtMouseUpDuration=e,l(this,s,"f").info(`Camera (${l(this,i,"f").id}): revertAtMouseUpDuration was set to: ${e}`)}updateTarget(e){l(this,r,"f").validate(e,"vec3"),l(this,i,"f").target=e,l(this,s,"f").info(`Camera (${l(this,i,"f").id}): target was set to: ${e}`)}updateZoomExtentsFactor(e){l(this,r,"f").validate(e,"positive"),l(this,i,"f").zoomExtentsFactor=e,l(this,s,"f").info(`Camera (${l(this,i,"f").id}): zoomExtentsFactor was set to: ${e}`)}animate(e,t){for(let t=0;t<e.length;t++)l(this,r,"f").validate(e[t].position,"vec3"),l(this,r,"f").validate(e[t].target,"vec3");return l(this,r,"f").validate(t,"object"),t&&l(this,r,"f").validate(t.easing,"string",!1),t&&l(this,r,"f").validate(t.duration,"number",!1),t&&l(this,r,"f").validate(t.default,"boolean",!1),t&&l(this,r,"f").validate(t.coordinates,"string",!1),t&&l(this,r,"f").validate(t.interpolation,"string",!1),l(this,s,"f").info(`Camera ${this.id}: Starting camera path animation.`),l(this,i,"f").animate(e,t)}reset(e){return l(this,r,"f").validate(e,"object"),e&&l(this,r,"f").validate(e.easing,"string",!1),e&&l(this,r,"f").validate(e.duration,"number",!1),e&&l(this,r,"f").validate(e.coordinates,"string",!1),e&&l(this,r,"f").validate(e.interpolation,"string",!1),l(this,s,"f").info(`Camera ${this.id}: Resetting position and target.`),l(this,i,"f").reset(e)}set(e,t,n){return l(this,r,"f").validate(e,"vec3"),l(this,r,"f").validate(t,"vec3"),l(this,r,"f").validate(n,"object"),n&&l(this,r,"f").validate(n.easing,"string",!1),n&&l(this,r,"f").validate(n.duration,"number",!1),n&&l(this,r,"f").validate(n.coordinates,"string",!1),n&&l(this,r,"f").validate(n.interpolation,"string",!1),l(this,s,"f").info(`Camera ${this.id}: Setting position to ${e} and target to ${t}.`),l(this,i,"f").set(u.vec3.fromValues(e[0],e[1],e[2]),u.vec3.fromValues(t[0],t[1],t[2]),n)}updateAutoAdjust(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").autoAdjust=e,l(this,s,"f").info(`Camera (${l(this,i,"f").id}): autoAdjust was set to: ${e}`)}zoomTo(e,t){if(e)if(Array.isArray(e))l(this,r,"f").validate(e,"stringArray");else if(!(e instanceof p.Box))return l(this,s,"f").error(`Camera ${this.id}: The specified zoom target does not have a valid type`),Promise.resolve(!1);return t&&l(this,r,"f").validate(t.easing,"string",!1),t&&l(this,r,"f").validate(t.duration,"number",!1),t&&l(this,r,"f").validate(t.coordinates,"string",!1),t&&l(this,r,"f").validate(t.interpolation,"string",!1),l(this,s,"f").info(`Camera ${this.id}: Zooming in.`),l(this,i,"f").zoomTo(e,t)}},i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap},358:function(e,t,n){"use strict";var i,r,s,a,o,l=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.OrthographicCamera=void 0;const h=n(1990),u=n(4171),d=n(4562),p=n(2899),f=n(8091),m=n(1088);class g extends f.Camera{constructor(e,t){super(e),i.set(this,void 0),r.set(this,p.container.resolve(d.InputValidator)),s.set(this,p.container.resolve(u.Logger)),a.set(this,void 0),o.set(this,(()=>{this.direction=c(this,i,"f").direction})),l(this,i,e,"f"),l(this,a,t,"f"),this.controls=new m.OrthographicCameraControls(e.controls),c(this,i,"f").addUpdateCB(c(this,o,"f")),c(this,o,"f").call(this)}updateDirection(e){c(this,r,"f").validate(e,"enum",!0,Object.values(h.ORTHOGRAPHIC_CAMERA_DIRECTION)),c(this,i,"f").direction=e,c(this,i,"f").zoomTo([],{duration:0}),c(this,a,"f").update(),c(this,s,"f").info(`Camera (${c(this,i,"f").id}): direction was set to: ${e}`)}}t.OrthographicCamera=g,i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap},2621:function(e,t,n){"use strict";var i,r,s,a,o,l=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.PerspectiveCamera=void 0;const h=n(4171),u=n(4562),d=n(2899),p=n(8091),f=n(9049);class m extends p.Camera{constructor(e,t){super(e),i.set(this,void 0),r.set(this,d.container.resolve(u.InputValidator)),s.set(this,d.container.resolve(h.Logger)),a.set(this,void 0),o.set(this,(()=>{this.fov=c(this,i,"f").fov})),l(this,i,e,"f"),l(this,a,t,"f"),this.controls=new f.PerspectiveCameraControls(e.controls),c(this,i,"f").addUpdateCB(c(this,o,"f")),c(this,o,"f").call(this)}updateFov(e){c(this,r,"f").validate(e,"positive"),c(this,i,"f").fov=e,c(this,a,"f").update(),c(this,s,"f").info(`Camera (${c(this,i,"f").id}): fov was set to: ${e}`)}}t.PerspectiveCamera=m,i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap},1088:function(e,t,n){"use strict";var i,r,s,a,o=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.OrthographicCameraControls=void 0;const c=n(4171),h=n(4562),u=n(2899);t.OrthographicCameraControls=class{constructor(e){i.set(this,void 0),r.set(this,u.container.resolve(h.InputValidator)),s.set(this,u.container.resolve(c.Logger)),a.set(this,(()=>{this.damping=l(this,i,"f").damping,this.enableKeyPan=l(this,i,"f").enableKeyPan,this.enablePan=l(this,i,"f").enablePan,this.enableZoom=l(this,i,"f").enableZoom,this.enabled=l(this,i,"f").enabled,this.input=l(this,i,"f").input,this.keyPanSpeed=l(this,i,"f").keyPanSpeed,this.movementSmoothness=l(this,i,"f").movementSmoothness,this.panSpeed=l(this,i,"f").panSpeed,this.zoomSpeed=l(this,i,"f").zoomSpeed})),o(this,i,e,"f"),l(this,i,"f").addUpdateCB(l(this,a,"f")),l(this,a,"f").call(this)}updateDamping(e){l(this,r,"f").validate(e,"positive"),l(this,i,"f").damping=e,l(this,s,"f").info(`Camera Controls: damping was set to: ${e}`)}updateEnableKeyPan(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").enableKeyPan=e,l(this,s,"f").info(`Camera Controls: enableKeyPan was set to: ${e}`)}updateEnablePan(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").enablePan=e,l(this,s,"f").info(`Camera Controls: enablePan was set to: ${e}`)}updateEnableZoom(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").enableZoom=e,l(this,s,"f").info(`Camera Controls: enableZoom was set to: ${e}`)}updateEnabled(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").enabled=e,l(this,s,"f").info(`Camera Controls: enabled was set to: ${e}`)}updateInput(e){l(this,r,"f").validate(e.keys.down,"number"),l(this,r,"f").validate(e.keys.left,"number"),l(this,r,"f").validate(e.keys.right,"number"),l(this,r,"f").validate(e.keys.up,"number"),l(this,r,"f").validate(e.mouse.pan,"number"),l(this,r,"f").validate(e.mouse.rotate,"number"),l(this,r,"f").validate(e.mouse.zoom,"number"),l(this,r,"f").validate(e.touch.pan,"number"),l(this,r,"f").validate(e.touch.rotate,"number"),l(this,r,"f").validate(e.touch.zoom,"number"),l(this,i,"f").input=e,l(this,s,"f").info(`Camera Controls: input was set to: ${e}`)}updateKeyPanSpeed(e){l(this,r,"f").validate(e,"factor"),l(this,i,"f").keyPanSpeed=e,l(this,s,"f").info(`Camera Controls: keyPanSpeed was set to: ${e}`)}updateMovementSmoothness(e){l(this,r,"f").validate(e,"factor"),l(this,i,"f").movementSmoothness=e,l(this,s,"f").info(`Camera Controls: movementSmoothness was set to: ${e}`)}updatePanSpeed(e){l(this,r,"f").validate(e,"factor"),l(this,i,"f").panSpeed=e,l(this,s,"f").info(`Camera Controls: panSpeed was set to: ${e}`)}updateZoomSpeed(e){l(this,r,"f").validate(e,"factor"),l(this,i,"f").zoomSpeed=e,l(this,s,"f").info(`Camera Controls: zoomSpeed was set to: ${e}`)}},i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap},9049:function(e,t,n){"use strict";var i,r,s,a,o=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.PerspectiveCameraControls=void 0;const c=n(4171),h=n(4562),u=n(2899);t.PerspectiveCameraControls=class{constructor(e){i.set(this,void 0),r.set(this,u.container.resolve(h.InputValidator)),s.set(this,u.container.resolve(c.Logger)),a.set(this,(()=>{this.autoRotationSpeed=l(this,i,"f").autoRotationSpeed,this.cubePositionRestriction=l(this,i,"f").cubePositionRestriction,this.cubeTargetRestriction=l(this,i,"f").cubeTargetRestriction,this.damping=l(this,i,"f").damping,this.enableAutoRotation=l(this,i,"f").enableAutoRotation,this.enableKeyPan=l(this,i,"f").enableKeyPan,this.enablePan=l(this,i,"f").enablePan,this.enableRotation=l(this,i,"f").enableRotation,this.enableZoom=l(this,i,"f").enableZoom,this.enabled=l(this,i,"f").enabled,this.input=l(this,i,"f").input,this.keyPanSpeed=l(this,i,"f").keyPanSpeed,this.movementSmoothness=l(this,i,"f").movementSmoothness,this.panSpeed=l(this,i,"f").panSpeed,this.rotationRestriction=l(this,i,"f").rotationRestriction,this.rotationSpeed=l(this,i,"f").rotationSpeed,this.spherePositionRestriction=l(this,i,"f").spherePositionRestriction,this.sphereTargetRestriction=l(this,i,"f").sphereTargetRestriction,this.zoomRestriction=l(this,i,"f").zoomRestriction,this.zoomSpeed=l(this,i,"f").zoomSpeed})),o(this,i,e,"f"),l(this,i,"f").addUpdateCB(l(this,a,"f")),l(this,a,"f").call(this)}updateAutoRotationSpeed(e){l(this,r,"f").validate(e,"number"),l(this,i,"f").autoRotationSpeed=e,l(this,s,"f").info(`Camera Controls: autoRotationSpeed was set to: ${e}`)}updateCubePositionRestriction(e){l(this,r,"f").validate(e.min,"vec3"),l(this,r,"f").validate(e.max,"vec3"),l(this,i,"f").cubePositionRestriction=e,l(this,s,"f").info(`Camera Controls: cubePositionRestriction was set to: ${e}`)}updateCubeTargetRestriction(e){l(this,r,"f").validate(e.min,"vec3"),l(this,r,"f").validate(e.max,"vec3"),l(this,i,"f").cubeTargetRestriction=e,l(this,s,"f").info(`Camera Controls: cubeTargetRestriction was set to: ${e}`)}updateDamping(e){l(this,r,"f").validate(e,"positive"),l(this,i,"f").damping=e,l(this,s,"f").info(`Camera Controls: damping was set to: ${e}`)}updateEnableAutoRotation(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").enableAutoRotation=e,l(this,s,"f").info(`Camera Controls: enableAutoRotation was set to: ${e}`)}updateEnableKeyPan(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").enableKeyPan=e,l(this,s,"f").info(`Camera Controls: enableKeyPan was set to: ${e}`)}updateEnablePan(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").enablePan=e,l(this,s,"f").info(`Camera Controls: enablePan was set to: ${e}`)}updateEnableRotation(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").enableRotation=e,l(this,s,"f").info(`Camera Controls: enableRotation was set to: ${e}`)}updateEnableZoom(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").enableZoom=e,l(this,s,"f").info(`Camera Controls: enableZoom was set to: ${e}`)}updateEnabled(e){l(this,r,"f").validate(e,"boolean"),l(this,i,"f").enabled=e,l(this,s,"f").info(`Camera Controls: enabled was set to: ${e}`)}updateInput(e){l(this,r,"f").validate(e.keys.down,"number"),l(this,r,"f").validate(e.keys.left,"number"),l(this,r,"f").validate(e.keys.right,"number"),l(this,r,"f").validate(e.keys.up,"number"),l(this,r,"f").validate(e.mouse.pan,"number"),l(this,r,"f").validate(e.mouse.rotate,"number"),l(this,r,"f").validate(e.mouse.zoom,"number"),l(this,r,"f").validate(e.touch.pan,"number"),l(this,r,"f").validate(e.touch.rotate,"number"),l(this,r,"f").validate(e.touch.zoom,"number"),l(this,i,"f").input=e,l(this,s,"f").info(`Camera Controls: input was set to: ${e}`)}updateKeyPanSpeed(e){l(this,r,"f").validate(e,"factor"),l(this,i,"f").keyPanSpeed=e,l(this,s,"f").info(`Camera Controls: keyPanSpeed was set to: ${e}`)}updateMovementSmoothness(e){l(this,r,"f").validate(e,"factor"),l(this,i,"f").movementSmoothness=e,l(this,s,"f").info(`Camera Controls: movementSmoothness was set to: ${e}`)}updatePanSpeed(e){l(this,r,"f").validate(e,"factor"),l(this,i,"f").panSpeed=e,l(this,s,"f").info(`Camera Controls: panSpeed was set to: ${e}`)}updateRotationRestriction(e){l(this,r,"f").validate(e.minPolarAngle,"number"),l(this,r,"f").validate(e.maxPolarAngle,"number"),l(this,r,"f").validate(e.minAzimuthAngle,"number"),l(this,r,"f").validate(e.maxAzimuthAngle,"number"),l(this,i,"f").rotationRestriction=e,l(this,s,"f").info(`Camera Controls: rotationRestriction was set to: ${e}`)}updateRotationSpeed(e){l(this,r,"f").validate(e,"factor"),l(this,i,"f").rotationSpeed=e,l(this,s,"f").info(`Camera Controls: rotationSpeed was set to: ${e}`)}updateSpherePositionRestriction(e){l(this,r,"f").validate(e.center,"vec3"),l(this,r,"f").validate(e.radius,"positive"),l(this,i,"f").spherePositionRestriction=e,l(this,s,"f").info(`Camera Controls: spherePositionRestriction was set to: ${e}`)}updateSphereTargetRestriction(e){l(this,r,"f").validate(e.center,"vec3"),l(this,r,"f").validate(e.radius,"positive"),l(this,i,"f").sphereTargetRestriction=e,l(this,s,"f").info(`Camera Controls: sphereTargetRestriction was set to: ${e}`)}updateZoomRestriction(e){l(this,r,"f").validate(e.minDistance,"number"),l(this,r,"f").validate(e.maxDistance,"number"),l(this,i,"f").zoomRestriction=e,l(this,s,"f").info(`Camera Controls: zoomRestriction was set to: ${e}`)}updateZoomSpeed(e){l(this,r,"f").validate(e,"factor"),l(this,i,"f").zoomSpeed=e,l(this,s,"f").info(`Camera Controls: zoomSpeed was set to: ${e}`)}},i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap},5932:function(e,t,n){"use strict";var i,r=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.AmbientLight=void 0;const s=n(4797);class a extends s.Light{constructor(e){super(e),i.set(this,void 0),r(this,i,e,"f")}}t.AmbientLight=a,i=new WeakMap},2201:function(e,t,n){"use strict";var i,r,s,a,o=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.DirectionalLight=void 0;const c=n(4797),h=n(4562),u=n(2899),d=n(4171);class p extends c.Light{constructor(e){super(e),i.set(this,u.container.resolve(h.InputValidator)),r.set(this,void 0),s.set(this,u.container.resolve(d.Logger)),a.set(this,(()=>{this.castShadow=l(this,r,"f").castShadow,this.direction=l(this,r,"f").direction,this.shadowMapBias=l(this,r,"f").shadowMapBias,this.shadowMapResolution=l(this,r,"f").shadowMapResolution})),o(this,r,e,"f"),l(this,r,"f").addUpdateCB(l(this,a,"f")),l(this,a,"f").call(this)}updateCastShadow(e){l(this,i,"f").validate(e,"boolean"),l(this,r,"f").castShadow=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): castShadow was set to: ${e}`)}updateDirection(e){l(this,i,"f").validate(e,"vec3"),l(this,r,"f").direction=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): direction was set to: ${e}`)}updateShadowMapBias(e){l(this,i,"f").validate(e,"number"),l(this,r,"f").shadowMapBias=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): shadowMapBias was set to: ${e}`)}updateShadowMapResolution(e){l(this,i,"f").validate(e,"number"),l(this,r,"f").shadowMapResolution=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): shadowMapResolution was set to: ${e}`)}}t.DirectionalLight=p,i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap},2724:function(e,t,n){"use strict";var i,r,s,a,o,l=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.HemisphereLight=void 0;const h=n(4797),u=n(4562),d=n(2899),p=n(4171);class f extends h.Light{constructor(e){super(e),i.set(this,void 0),r.set(this,d.container.resolve(u.Converter)),s.set(this,d.container.resolve(u.InputValidator)),a.set(this,d.container.resolve(p.Logger)),o.set(this,(()=>{this.groundColor=c(this,i,"f").groundColor})),l(this,i,e,"f"),c(this,i,"f").addUpdateCB(c(this,o,"f")),c(this,o,"f").call(this)}updateGroundColor(e){c(this,s,"f").validate(e,"color"),c(this,i,"f").groundColor=c(this,r,"f").toColor(e),c(this,a,"f").info(`Light (${c(this,i,"f").id}): groundColor was set to: ${e}`)}}t.HemisphereLight=f,i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap},4797:function(e,t,n){"use strict";var i,r,s,a,o,l=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.Light=void 0;const h=n(4171),u=n(4562),d=n(2899);t.Light=class{constructor(e){i.set(this,d.container.resolve(u.Converter)),r.set(this,d.container.resolve(u.InputValidator)),s.set(this,void 0),a.set(this,d.container.resolve(h.Logger)),o.set(this,(()=>{this.color=c(this,s,"f").color,this.id=c(this,s,"f").id,this.intensity=c(this,s,"f").intensity,this.name=c(this,s,"f").name,this.type=c(this,s,"f").type})),l(this,s,e,"f"),c(this,s,"f").addUpdateCB(c(this,o,"f")),c(this,o,"f").call(this)}updateColor(e){c(this,r,"f").validate(e,"color"),c(this,s,"f").color=c(this,i,"f").toColor(e),c(this,a,"f").info(`Light (${c(this,s,"f").id}): color was set to: ${e}`)}updateIntensity(e){c(this,r,"f").validate(e,"positive"),c(this,s,"f").intensity=e,c(this,a,"f").info(`Light (${c(this,s,"f").id}): intensity was set to: ${e}`)}updateName(e){c(this,r,"f").validate(e,"string",!1),c(this,s,"f").name=e,c(this,a,"f").info(`Light (${c(this,s,"f").id}): name was set to: ${e}`)}},i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap},2227:function(e,t,n){"use strict";var i,r,s=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},a=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.LightScene=void 0;const o=n(5932),l=n(2736),c=n(168),h=n(2201),u=n(2724),d=n(3490);t.LightScene=class{constructor(e){i.set(this,void 0),r.set(this,(()=>{this.id=a(this,i,"f").id,this.name=a(this,i,"f").name;const e=a(this,i,"f").lights;for(let t in e)if(!this.lights[t])switch(e[t].type){case d.LIGHTTYPE.AMBIENT:this.lights[t]=new o.AmbientLight(e[t]);break;case d.LIGHTTYPE.DIRECTIONAL:this.lights[t]=new h.DirectionalLight(e[t]);break;case d.LIGHTTYPE.HEMISPHERE:this.lights[t]=new u.HemisphereLight(e[t]);break;case d.LIGHTTYPE.POINT:this.lights[t]=new l.PointLight(e[t]);break;case d.LIGHTTYPE.SPOT:this.lights[t]=new c.SpotLight(e[t])}for(let t in this.lights)e[t]||delete this.lights[t];this.name=a(this,i,"f").name,this.node=a(this,i,"f").node})),this.lights={},s(this,i,e,"f"),a(this,i,"f").addUpdateCB(a(this,r,"f")),a(this,r,"f").call(this)}},i=new WeakMap,r=new WeakMap},2736:function(e,t,n){"use strict";var i,r,s,a,o=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.PointLight=void 0;const c=n(4797),h=n(4562),u=n(2899),d=n(4171);class p extends c.Light{constructor(e){super(e),i.set(this,u.container.resolve(h.InputValidator)),r.set(this,void 0),s.set(this,u.container.resolve(d.Logger)),a.set(this,(()=>{this.decay=l(this,r,"f").decay,this.distance=l(this,r,"f").distance,this.position=l(this,r,"f").position})),o(this,r,e,"f"),l(this,r,"f").addUpdateCB(l(this,a,"f")),l(this,a,"f").call(this)}updateDecay(e){l(this,i,"f").validate(e,"positive"),l(this,r,"f").decay=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): decay was set to: ${e}`)}updateDistance(e){l(this,i,"f").validate(e,"positive"),l(this,r,"f").distance=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): distance was set to: ${e}`)}updatePosition(e){l(this,i,"f").validate(e,"vec3"),l(this,r,"f").position=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): position was set to: ${e}`)}}t.PointLight=p,i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap},168:function(e,t,n){"use strict";var i,r,s,a,o=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.SpotLight=void 0;const c=n(4797),h=n(4562),u=n(2899),d=n(4171);class p extends c.Light{constructor(e){super(e),i.set(this,u.container.resolve(h.InputValidator)),r.set(this,void 0),s.set(this,u.container.resolve(d.Logger)),a.set(this,(()=>{this.angle=l(this,r,"f").angle,this.decay=l(this,r,"f").decay,this.distance=l(this,r,"f").distance,this.penumbra=l(this,r,"f").penumbra,this.position=l(this,r,"f").position,this.target=l(this,r,"f").target})),o(this,r,e,"f"),l(this,r,"f").addUpdateCB(l(this,a,"f")),l(this,a,"f").call(this)}updateAngle(e){l(this,i,"f").validate(e,"positive"),l(this,r,"f").angle=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): angle was set to: ${e}`)}updateDecay(e){l(this,i,"f").validate(e,"positive"),l(this,r,"f").decay=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): decay was set to: ${e}`)}updateDistance(e){l(this,i,"f").validate(e,"positive"),l(this,r,"f").distance=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): distance was set to: ${e}`)}updatePenumbra(e){l(this,i,"f").validate(e,"positive"),l(this,r,"f").penumbra=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): penumbra was set to: ${e}`)}updatePosition(e){l(this,i,"f").validate(e,"vec3"),l(this,r,"f").position=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): position was set to: ${e}`)}updateTarget(e){l(this,i,"f").validate(e,"vec3"),l(this,r,"f").target=e,l(this,s,"f").info(`Light (${l(this,r,"f").id}): target was set to: ${e}`)}}t.SpotLight=p,i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap},6194:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>y,Easing:()=>r,Group:()=>a,Interpolation:()=>o,Sequence:()=>l,Tween:()=>h,VERSION:()=>u,add:()=>g,getAll:()=>f,nextId:()=>d,now:()=>s,remove:()=>v,removeAll:()=>m,update:()=>_});var i,r={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-r.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*r.Bounce.In(2*e):.5*r.Bounce.Out(2*e-1)+.5}}},s="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},a=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map((function(t){return e._tweens[t]}))},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){void 0===e&&(e=s()),void 0===t&&(t=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var r=this._tweens[n[i]],a=!t;r&&!1===r.update(e,a)&&!t&&delete this._tweens[n[i]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),o={Linear:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),s=o.Utils.Linear;return t<0?s(e[0],e[1],i):t>1?s(e[n],e[n-1],n-i):s(e[r],e[r+1>n?n:r+1],i-r)},Bezier:function(e,t){for(var n=0,i=e.length-1,r=Math.pow,s=o.Utils.Bernstein,a=0;a<=i;a++)n+=r(1-t,i-a)*r(t,a)*e[a]*s(i,a);return n},CatmullRom:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),s=o.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(r=Math.floor(i=n*(1+t))),s(e[(r-1+n)%n],e[r],e[(r+1)%n],e[(r+2)%n],i-r)):t<0?e[0]-(s(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[n]-(s(e[n],e[n],e[n-1],e[n-1],i-n)-e[n]):s(e[r?r-1:0],e[r],e[n<r+1?n:r+1],e[n<r+2?n:r+2],i-r)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=o.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(i=[1],function(e){var t=1;if(i[e])return i[e];for(var n=e;n>1;n--)t*=n;return i[e]=t,t}),CatmullRom:function(e,t,n,i,r){var s=.5*(n-e),a=.5*(i-t),o=r*r;return(2*t-2*n+s+a)*(r*o)+(-3*t+3*n-2*s-a)*o+s*r+t}}},l=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),c=new a,h=function(){function e(e,t){void 0===t&&(t=c),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=r.Linear.None,this._interpolationFunction=o.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=l.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},e.prototype.duration=function(e){return this._duration=e,this},e.prototype.start=function(e){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var t in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==e?"string"==typeof e?s()+parseFloat(e):e:s(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},e.prototype._setupProperties=function(e,t,n,i){for(var r in n){var s=e[r],a=Array.isArray(s),o=a?"array":typeof s,l=!a&&Array.isArray(n[r]);if("undefined"!==o&&"function"!==o){if(l){var c=n[r];if(0===c.length)continue;c=c.map(this._handleRelativeValue.bind(this,s)),n[r]=[s].concat(c)}if("object"!==o&&!a||!s||l)void 0===t[r]&&(t[r]=s),a||(t[r]*=1),i[r]=l?n[r].slice().reverse():t[r]||0;else{for(var h in t[r]=a?[]:{},s)t[r][h]=s[h];i[r]=a?[]:{},this._setupProperties(s,t[r],n[r],i[r])}}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(e){return void 0===e&&(e=s()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this)),this},e.prototype.resume=function(e){return void 0===e&&(e=s()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return this._group=e,this},e.prototype.delay=function(e){return this._delayTime=e,this},e.prototype.repeat=function(e){return this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return this._yoyo=e,this},e.prototype.easing=function(e){return this._easingFunction=e,this},e.prototype.interpolation=function(e){return this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e,t){if(void 0===e&&(e=s()),void 0===t&&(t=!0),this._isPaused)return!0;var n,i,r=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>r)return!1;t&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(e-this._startTime)/this._duration,i=0===this._duration||i>1?1:i;var a=this._easingFunction(i);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,a),this._onUpdateCallback&&this._onUpdateCallback(this._object,i),1===i){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,l=this._chainedTweens.length;o<l;o++)this._chainedTweens[o].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,n,i){for(var r in n)if(void 0!==t[r]){var s=t[r]||0,a=n[r],o=Array.isArray(e[r]),l=Array.isArray(a);!o&&l?e[r]=this._interpolationFunction(a,i):"object"==typeof a&&a?this._updateProperties(e[r],s,a,i):"number"==typeof(a=this._handleRelativeValue(s,a))&&(e[r]=s+(a-s)*i)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];this._valuesStartRepeat[e]="string"==typeof n?this._valuesStartRepeat[e]+parseFloat(n):this._valuesEnd[e],this._valuesEnd[e]=t},e}(),u="18.6.4",d=l.nextId,p=c,f=p.getAll.bind(p),m=p.removeAll.bind(p),g=p.add.bind(p),v=p.remove.bind(p),_=p.update.bind(p);const y={Easing:r,Group:a,Interpolation:o,now:s,Sequence:l,nextId:d,Tween:h,VERSION:u,getAll:f,removeAll:m,add:g,remove:v,update:_}},9669:(e,t,n)=>{e.exports=n(1609)},5448:(e,t,n)=>{"use strict";var i=n(4867),r=n(6026),s=n(4372),a=n(5327),o=n(4097),l=n(4109),c=n(7985),h=n(5061);e.exports=function(e){return new Promise((function(t,n){var u=e.data,d=e.headers;i.isFormData(u)&&delete d["Content-Type"];var p=new XMLHttpRequest;if(e.auth){var f=e.auth.username||"",m=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";d.Authorization="Basic "+btoa(f+":"+m)}var g=o(e.baseURL,e.url);if(p.open(e.method.toUpperCase(),a(g,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,p.onreadystatechange=function(){if(p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))){var i="getAllResponseHeaders"in p?l(p.getAllResponseHeaders()):null,s={data:e.responseType&&"text"!==e.responseType?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:i,config:e,request:p};r(t,n,s),p=null}},p.onabort=function(){p&&(n(h("Request aborted",e,"ECONNABORTED",p)),p=null)},p.onerror=function(){n(h("Network Error",e,null,p)),p=null},p.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(h(t,e,"ECONNABORTED",p)),p=null},i.isStandardBrowserEnv()){var v=(e.withCredentials||c(g))&&e.xsrfCookieName?s.read(e.xsrfCookieName):void 0;v&&(d[e.xsrfHeaderName]=v)}if("setRequestHeader"in p&&i.forEach(d,(function(e,t){void 0===u&&"content-type"===t.toLowerCase()?delete d[t]:p.setRequestHeader(t,e)})),i.isUndefined(e.withCredentials)||(p.withCredentials=!!e.withCredentials),e.responseType)try{p.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&p.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){p&&(p.abort(),n(e),p=null)})),u||(u=null),p.send(u)}))}},1609:(e,t,n)=>{"use strict";var i=n(4867),r=n(1849),s=n(321),a=n(7185);function o(e){var t=new s(e),n=r(s.prototype.request,t);return i.extend(n,s.prototype,t),i.extend(n,t),n}var l=o(n(5655));l.Axios=s,l.create=function(e){return o(a(l.defaults,e))},l.Cancel=n(5263),l.CancelToken=n(4972),l.isCancel=n(6502),l.all=function(e){return Promise.all(e)},l.spread=n(8713),l.isAxiosError=n(6268),e.exports=l,e.exports.default=l},5263:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},4972:(e,t,n)=>{"use strict";var i=n(5263);function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new i(e),t(n.reason))}))}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var e;return{token:new r((function(t){e=t})),cancel:e}},e.exports=r},6502:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},321:(e,t,n)=>{"use strict";var i=n(4867),r=n(5327),s=n(782),a=n(3572),o=n(7185);function l(e){this.defaults=e,this.interceptors={request:new s,response:new s}}l.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=o(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[a,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)n=n.then(t.shift(),t.shift());return n},l.prototype.getUri=function(e){return e=o(this.defaults,e),r(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},i.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,n){return this.request(o(n||{},{method:e,url:t,data:(n||{}).data}))}})),i.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,n,i){return this.request(o(i||{},{method:e,url:t,data:n}))}})),e.exports=l},782:(e,t,n)=>{"use strict";var i=n(4867);function r(){this.handlers=[]}r.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){i.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=r},4097:(e,t,n)=>{"use strict";var i=n(1793),r=n(7303);e.exports=function(e,t){return e&&!i(t)?r(e,t):t}},5061:(e,t,n)=>{"use strict";var i=n(481);e.exports=function(e,t,n,r,s){var a=new Error(e);return i(a,t,n,r,s)}},3572:(e,t,n)=>{"use strict";var i=n(4867),r=n(8527),s=n(6502),a=n(5655);function o(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return o(e),e.headers=e.headers||{},e.data=r(e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),i.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return o(e),t.data=r(t.data,t.headers,e.transformResponse),t}),(function(t){return s(t)||(o(e),t&&t.response&&(t.response.data=r(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},481:e=>{"use strict";e.exports=function(e,t,n,i,r){return e.config=t,n&&(e.code=n),e.request=i,e.response=r,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},7185:(e,t,n)=>{"use strict";var i=n(4867);e.exports=function(e,t){t=t||{};var n={},r=["url","method","data"],s=["headers","auth","proxy","params"],a=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],o=["validateStatus"];function l(e,t){return i.isPlainObject(e)&&i.isPlainObject(t)?i.merge(e,t):i.isPlainObject(t)?i.merge({},t):i.isArray(t)?t.slice():t}function c(r){i.isUndefined(t[r])?i.isUndefined(e[r])||(n[r]=l(void 0,e[r])):n[r]=l(e[r],t[r])}i.forEach(r,(function(e){i.isUndefined(t[e])||(n[e]=l(void 0,t[e]))})),i.forEach(s,c),i.forEach(a,(function(r){i.isUndefined(t[r])?i.isUndefined(e[r])||(n[r]=l(void 0,e[r])):n[r]=l(void 0,t[r])})),i.forEach(o,(function(i){i in t?n[i]=l(e[i],t[i]):i in e&&(n[i]=l(void 0,e[i]))}));var h=r.concat(s).concat(a).concat(o),u=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===h.indexOf(e)}));return i.forEach(u,c),n}},6026:(e,t,n)=>{"use strict";var i=n(5061);e.exports=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(i("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},8527:(e,t,n)=>{"use strict";var i=n(4867);e.exports=function(e,t,n){return i.forEach(n,(function(n){e=n(e,t)})),e}},5655:(e,t,n)=>{"use strict";var i=n(4867),r=n(6016),s={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var o,l={adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(o=n(5448)),o),transformRequest:[function(e,t){return r(t,"Accept"),r(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)?(a(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),i.forEach(["post","put","patch"],(function(e){l.headers[e]=i.merge(s)})),e.exports=l},1849:e=>{"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}}},5327:(e,t,n)=>{"use strict";var i=n(4867);function r(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var s;if(n)s=n(t);else if(i.isURLSearchParams(t))s=t.toString();else{var a=[];i.forEach(t,(function(e,t){null!=e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,(function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),a.push(r(t)+"="+r(e))})))})),s=a.join("&")}if(s){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},7303:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},4372:(e,t,n)=>{"use strict";var i=n(4867);e.exports=i.isStandardBrowserEnv()?{write:function(e,t,n,r,s,a){var o=[];o.push(e+"="+encodeURIComponent(t)),i.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),i.isString(r)&&o.push("path="+r),i.isString(s)&&o.push("domain="+s),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},1793:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},6268:e=>{"use strict";e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},7985:(e,t,n)=>{"use strict";var i=n(4867);e.exports=i.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var i=e;return t&&(n.setAttribute("href",i),i=n.href),n.setAttribute("href",i),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=i.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},6016:(e,t,n)=>{"use strict";var i=n(4867);e.exports=function(e,t){i.forEach(e,(function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])}))}},4109:(e,t,n)=>{"use strict";var i=n(4867),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,s,a={};return e?(i.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=i.trim(e.substr(0,s)).toLowerCase(),n=i.trim(e.substr(s+1)),t){if(a[t]&&r.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}})),a):a}},8713:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},4867:(e,t,n)=>{"use strict";var i=n(1849),r=Object.prototype.toString;function s(e){return"[object Array]"===r.call(e)}function a(e){return void 0===e}function o(e){return null!==e&&"object"==typeof e}function l(e){if("[object Object]"!==r.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function c(e){return"[object Function]"===r.call(e)}function h(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),s(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}e.exports={isArray:s,isArrayBuffer:function(e){return"[object ArrayBuffer]"===r.call(e)},isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:o,isPlainObject:l,isUndefined:a,isDate:function(e){return"[object Date]"===r.call(e)},isFile:function(e){return"[object File]"===r.call(e)},isBlob:function(e){return"[object Blob]"===r.call(e)},isFunction:c,isStream:function(e){return o(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:h,merge:function e(){var t={};function n(n,i){l(t[i])&&l(n)?t[i]=e(t[i],n):l(n)?t[i]=e({},n):s(n)?t[i]=n.slice():t[i]=n}for(var i=0,r=arguments.length;i<r;i++)h(arguments[i],n);return t},extend:function(e,t,n){return h(t,(function(t,r){e[r]=n&&"function"==typeof t?i(t,n):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},887:(e,t,n)=>{"use strict";n.r(t),n.d(t,{glMatrix:()=>i,mat2:()=>r,mat2d:()=>s,mat3:()=>a,mat4:()=>o,quat:()=>h,quat2:()=>u,vec2:()=>d,vec3:()=>l,vec4:()=>c});var i={};n.r(i),n.d(i,{ARRAY_TYPE:()=>f,EPSILON:()=>p,RANDOM:()=>m,equals:()=>y,setMatrixArrayType:()=>g,toRadian:()=>_});var r={};n.r(r),n.d(r,{LDU:()=>z,add:()=>U,adjoint:()=>R,clone:()=>w,copy:()=>x,create:()=>b,determinant:()=>C,equals:()=>V,exactEquals:()=>H,frob:()=>B,fromRotation:()=>D,fromScaling:()=>O,fromValues:()=>E,identity:()=>M,invert:()=>A,mul:()=>j,multiply:()=>P,multiplyScalar:()=>F,multiplyScalarAndAdd:()=>G,rotate:()=>L,scale:()=>I,set:()=>S,str:()=>N,sub:()=>W,subtract:()=>k,transpose:()=>T});var s={};n.r(s),n.d(s,{add:()=>ce,clone:()=>Y,copy:()=>X,create:()=>q,determinant:()=>Q,equals:()=>fe,exactEquals:()=>pe,frob:()=>le,fromRotation:()=>re,fromScaling:()=>se,fromTranslation:()=>ae,fromValues:()=>$,identity:()=>Z,invert:()=>K,mul:()=>me,multiply:()=>ee,multiplyScalar:()=>ue,multiplyScalarAndAdd:()=>de,rotate:()=>te,scale:()=>ne,set:()=>J,str:()=>oe,sub:()=>ge,subtract:()=>he,translate:()=>ie});var a={};n.r(a),n.d(a,{add:()=>Ve,adjoint:()=>Te,clone:()=>ye,copy:()=>be,create:()=>ve,determinant:()=>Ae,equals:()=>qe,exactEquals:()=>We,frob:()=>He,fromMat2d:()=>Ne,fromMat4:()=>_e,fromQuat:()=>Be,fromRotation:()=>De,fromScaling:()=>Oe,fromTranslation:()=>Ie,fromValues:()=>we,identity:()=>Me,invert:()=>Se,mul:()=>Ye,multiply:()=>Re,multiplyScalar:()=>Ge,multiplyScalarAndAdd:()=>je,normalFromMat4:()=>ze,projection:()=>Ue,rotate:()=>Pe,scale:()=>Le,set:()=>xe,str:()=>ke,sub:()=>Xe,subtract:()=>Fe,translate:()=>Ce,transpose:()=>Ee});var o={};n.r(o),n.d(o,{add:()=>Ot,adjoint:()=>it,clone:()=>$e,copy:()=>Je,create:()=>Ze,determinant:()=>rt,equals:()=>kt,exactEquals:()=>Ut,frob:()=>Dt,fromQuat:()=>St,fromQuat2:()=>yt,fromRotation:()=>ft,fromRotationTranslation:()=>_t,fromRotationTranslationScale:()=>Mt,fromRotationTranslationScaleOrigin:()=>Et,fromScaling:()=>pt,fromTranslation:()=>dt,fromValues:()=>Ke,fromXRotation:()=>mt,fromYRotation:()=>gt,fromZRotation:()=>vt,frustum:()=>Tt,getRotation:()=>xt,getScaling:()=>wt,getTranslation:()=>bt,identity:()=>et,invert:()=>nt,lookAt:()=>Pt,mul:()=>Ht,multiply:()=>st,multiplyScalar:()=>Bt,multiplyScalarAndAdd:()=>zt,ortho:()=>Ct,perspective:()=>At,perspectiveFromFieldOfView:()=>Rt,rotate:()=>lt,rotateX:()=>ct,rotateY:()=>ht,rotateZ:()=>ut,scale:()=>ot,set:()=>Qe,str:()=>It,sub:()=>Vt,subtract:()=>Nt,targetTo:()=>Lt,translate:()=>at,transpose:()=>tt});var l={};n.r(l),n.d(l,{add:()=>Xt,angle:()=>En,bezier:()=>gn,ceil:()=>Kt,clone:()=>Gt,copy:()=>qt,create:()=>Ft,cross:()=>pn,dist:()=>Dn,distance:()=>an,div:()=>In,divide:()=>Jt,dot:()=>dn,equals:()=>Rn,exactEquals:()=>An,floor:()=>Qt,forEach:()=>zn,fromValues:()=>Wt,hermite:()=>mn,inverse:()=>hn,len:()=>Nn,length:()=>jt,lerp:()=>fn,max:()=>tn,min:()=>en,mul:()=>Ln,multiply:()=>$t,negate:()=>cn,normalize:()=>un,random:()=>vn,rotateX:()=>wn,rotateY:()=>xn,rotateZ:()=>Mn,round:()=>nn,scale:()=>rn,scaleAndAdd:()=>sn,set:()=>Yt,sqrDist:()=>On,sqrLen:()=>Bn,squaredDistance:()=>on,squaredLength:()=>ln,str:()=>Tn,sub:()=>Pn,subtract:()=>Zt,transformMat3:()=>yn,transformMat4:()=>_n,transformQuat:()=>bn,zero:()=>Sn});var c={};n.r(c),n.d(c,{add:()=>Gn,ceil:()=>Yn,clone:()=>kn,copy:()=>Vn,create:()=>Un,cross:()=>li,dist:()=>bi,distance:()=>ei,div:()=>yi,divide:()=>qn,dot:()=>oi,equals:()=>gi,exactEquals:()=>mi,floor:()=>Xn,forEach:()=>Ei,fromValues:()=>Hn,inverse:()=>si,len:()=>xi,length:()=>ni,lerp:()=>ci,max:()=>$n,min:()=>Zn,mul:()=>_i,multiply:()=>Wn,negate:()=>ri,normalize:()=>ai,random:()=>hi,round:()=>Jn,scale:()=>Kn,scaleAndAdd:()=>Qn,set:()=>Fn,sqrDist:()=>wi,sqrLen:()=>Mi,squaredDistance:()=>ti,squaredLength:()=>ii,str:()=>fi,sub:()=>vi,subtract:()=>jn,transformMat4:()=>ui,transformQuat:()=>di,zero:()=>pi});var h={};n.r(h),n.d(h,{add:()=>tr,calculateW:()=>Oi,clone:()=>Ji,conjugate:()=>Vi,copy:()=>Qi,create:()=>Si,dot:()=>rr,equals:()=>dr,exactEquals:()=>ur,exp:()=>Ni,fromEuler:()=>Gi,fromMat3:()=>Fi,fromValues:()=>Ki,getAngle:()=>Ci,getAxisAngle:()=>Ri,identity:()=>Ti,invert:()=>Hi,len:()=>or,length:()=>ar,lerp:()=>sr,ln:()=>Bi,mul:()=>nr,multiply:()=>Pi,normalize:()=>hr,pow:()=>zi,random:()=>ki,rotateX:()=>Li,rotateY:()=>Ii,rotateZ:()=>Di,rotationTo:()=>pr,scale:()=>ir,set:()=>er,setAxes:()=>mr,setAxisAngle:()=>Ai,slerp:()=>Ui,sqlerp:()=>fr,sqrLen:()=>cr,squaredLength:()=>lr,str:()=>ji});var u={};n.r(u),n.d(u,{add:()=>kr,clone:()=>vr,conjugate:()=>qr,copy:()=>Er,create:()=>gr,dot:()=>Gr,equals:()=>es,exactEquals:()=>Qr,fromMat4:()=>Mr,fromRotation:()=>xr,fromRotationTranslation:()=>br,fromRotationTranslationValues:()=>yr,fromTranslation:()=>wr,fromValues:()=>_r,getDual:()=>Rr,getReal:()=>Ar,getTranslation:()=>Lr,identity:()=>Sr,invert:()=>Wr,len:()=>Xr,length:()=>Yr,lerp:()=>jr,mul:()=>Vr,multiply:()=>Hr,normalize:()=>Jr,rotateAroundAxis:()=>Ur,rotateByQuatAppend:()=>Br,rotateByQuatPrepend:()=>zr,rotateX:()=>Dr,rotateY:()=>Or,rotateZ:()=>Nr,scale:()=>Fr,set:()=>Tr,setDual:()=>Pr,setReal:()=>Cr,sqrLen:()=>$r,squaredLength:()=>Zr,str:()=>Kr,translate:()=>Ir});var d={};n.r(d),n.d(d,{add:()=>as,angle:()=>Ds,ceil:()=>hs,clone:()=>ns,copy:()=>rs,create:()=>ts,cross:()=>Ss,dist:()=>Fs,distance:()=>vs,div:()=>Vs,divide:()=>cs,dot:()=>Es,equals:()=>zs,exactEquals:()=>Bs,floor:()=>us,forEach:()=>Ws,fromValues:()=>is,inverse:()=>xs,len:()=>Us,length:()=>ys,lerp:()=>Ts,max:()=>ps,min:()=>ds,mul:()=>Hs,multiply:()=>ls,negate:()=>ws,normalize:()=>Ms,random:()=>As,rotate:()=>Is,round:()=>fs,scale:()=>ms,scaleAndAdd:()=>gs,set:()=>ss,sqrDist:()=>Gs,sqrLen:()=>js,squaredDistance:()=>_s,squaredLength:()=>bs,str:()=>Ns,sub:()=>ks,subtract:()=>os,transformMat2:()=>Rs,transformMat2d:()=>Cs,transformMat3:()=>Ps,transformMat4:()=>Ls,zero:()=>Os});var p=1e-6,f="undefined"!=typeof Float32Array?Float32Array:Array,m=Math.random;function g(e){f=e}var v=Math.PI/180;function _(e){return e*v}function y(e,t){return Math.abs(e-t)<=p*Math.max(1,Math.abs(e),Math.abs(t))}function b(){var e=new f(4);return f!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function w(e){var t=new f(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function x(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function M(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function E(e,t,n,i){var r=new f(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}function S(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e}function T(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function A(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=n*s-r*i;return a?(a=1/a,e[0]=s*a,e[1]=-i*a,e[2]=-r*a,e[3]=n*a,e):null}function R(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e}function C(e){return e[0]*e[3]-e[2]*e[1]}function P(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=n[0],l=n[1],c=n[2],h=n[3];return e[0]=i*o+s*l,e[1]=r*o+a*l,e[2]=i*c+s*h,e[3]=r*c+a*h,e}function L(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l+s*o,e[1]=r*l+a*o,e[2]=i*-o+s*l,e[3]=r*-o+a*l,e}function I(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=n[0],l=n[1];return e[0]=i*o,e[1]=r*o,e[2]=s*l,e[3]=a*l,e}function D(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e}function O(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function N(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function B(e){return Math.hypot(e[0],e[1],e[2],e[3])}function z(e,t,n,i){return e[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-e[2]*n[1],[e,t,n]}function U(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function k(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function H(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function V(e,t){var n=e[0],i=e[1],r=e[2],s=e[3],a=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(n-a)<=p*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-o)<=p*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-l)<=p*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-c)<=p*Math.max(1,Math.abs(s),Math.abs(c))}function F(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function G(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var j=P,W=k;function q(){var e=new f(6);return f!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function Y(e){var t=new f(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function X(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Z(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function $(e,t,n,i,r,s){var a=new f(6);return a[0]=e,a[1]=t,a[2]=n,a[3]=i,a[4]=r,a[5]=s,a}function J(e,t,n,i,r,s,a){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=s,e[5]=a,e}function K(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=n*s-i*r;return l?(l=1/l,e[0]=s*l,e[1]=-i*l,e[2]=-r*l,e[3]=n*l,e[4]=(r*o-s*a)*l,e[5]=(i*a-n*o)*l,e):null}function Q(e){return e[0]*e[3]-e[1]*e[2]}function ee(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=n[0],h=n[1],u=n[2],d=n[3],p=n[4],f=n[5];return e[0]=i*c+s*h,e[1]=r*c+a*h,e[2]=i*u+s*d,e[3]=r*u+a*d,e[4]=i*p+s*f+o,e[5]=r*p+a*f+l,e}function te(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=Math.sin(n),h=Math.cos(n);return e[0]=i*h+s*c,e[1]=r*h+a*c,e[2]=i*-c+s*h,e[3]=r*-c+a*h,e[4]=o,e[5]=l,e}function ne(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=n[0],h=n[1];return e[0]=i*c,e[1]=r*c,e[2]=s*h,e[3]=a*h,e[4]=o,e[5]=l,e}function ie(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=n[0],h=n[1];return e[0]=i,e[1]=r,e[2]=s,e[3]=a,e[4]=i*c+s*h+o,e[5]=r*c+a*h+l,e}function re(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e[4]=0,e[5]=0,e}function se(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function ae(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function oe(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function le(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function ce(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e}function he(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}function ue(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e}function de(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e}function pe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function fe(e,t){var n=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=t[0],c=t[1],h=t[2],u=t[3],d=t[4],f=t[5];return Math.abs(n-l)<=p*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=p*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-h)<=p*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(s-u)<=p*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(a-d)<=p*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-f)<=p*Math.max(1,Math.abs(o),Math.abs(f))}var me=ee,ge=he;function ve(){var e=new f(9);return f!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function _e(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function ye(e){var t=new f(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function be(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function we(e,t,n,i,r,s,a,o,l){var c=new f(9);return c[0]=e,c[1]=t,c[2]=n,c[3]=i,c[4]=r,c[5]=s,c[6]=a,c[7]=o,c[8]=l,c}function xe(e,t,n,i,r,s,a,o,l,c){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e[8]=c,e}function Me(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Ee(e,t){if(e===t){var n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Se(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],h=t[8],u=h*a-o*c,d=-h*s+o*l,p=c*s-a*l,f=n*u+i*d+r*p;return f?(f=1/f,e[0]=u*f,e[1]=(-h*i+r*c)*f,e[2]=(o*i-r*a)*f,e[3]=d*f,e[4]=(h*n-r*l)*f,e[5]=(-o*n+r*s)*f,e[6]=p*f,e[7]=(-c*n+i*l)*f,e[8]=(a*n-i*s)*f,e):null}function Te(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],h=t[8];return e[0]=a*h-o*c,e[1]=r*c-i*h,e[2]=i*o-r*a,e[3]=o*l-s*h,e[4]=n*h-r*l,e[5]=r*s-n*o,e[6]=s*c-a*l,e[7]=i*l-n*c,e[8]=n*a-i*s,e}function Ae(e){var t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*(c*s-a*l)+n*(-c*r+a*o)+i*(l*r-s*o)}function Re(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=n[0],p=n[1],f=n[2],m=n[3],g=n[4],v=n[5],_=n[6],y=n[7],b=n[8];return e[0]=d*i+p*a+f*c,e[1]=d*r+p*o+f*h,e[2]=d*s+p*l+f*u,e[3]=m*i+g*a+v*c,e[4]=m*r+g*o+v*h,e[5]=m*s+g*l+v*u,e[6]=_*i+y*a+b*c,e[7]=_*r+y*o+b*h,e[8]=_*s+y*l+b*u,e}function Ce(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=n[0],p=n[1];return e[0]=i,e[1]=r,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e[6]=d*i+p*a+c,e[7]=d*r+p*o+h,e[8]=d*s+p*l+u,e}function Pe(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=Math.sin(n),p=Math.cos(n);return e[0]=p*i+d*a,e[1]=p*r+d*o,e[2]=p*s+d*l,e[3]=p*a-d*i,e[4]=p*o-d*r,e[5]=p*l-d*s,e[6]=c,e[7]=h,e[8]=u,e}function Le(e,t,n){var i=n[0],r=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Ie(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function De(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Oe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Ne(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Be(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=n+n,o=i+i,l=r+r,c=n*a,h=i*a,u=i*o,d=r*a,p=r*o,f=r*l,m=s*a,g=s*o,v=s*l;return e[0]=1-u-f,e[3]=h-v,e[6]=d+g,e[1]=h+v,e[4]=1-c-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-c-u,e}function ze(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],v=t[15],_=n*o-i*a,y=n*l-r*a,b=n*c-s*a,w=i*l-r*o,x=i*c-s*o,M=r*c-s*l,E=h*m-u*f,S=h*g-d*f,T=h*v-p*f,A=u*g-d*m,R=u*v-p*m,C=d*v-p*g,P=_*C-y*R+b*A+w*T-x*S+M*E;return P?(P=1/P,e[0]=(o*C-l*R+c*A)*P,e[1]=(l*T-a*C-c*S)*P,e[2]=(a*R-o*T+c*E)*P,e[3]=(r*R-i*C-s*A)*P,e[4]=(n*C-r*T+s*S)*P,e[5]=(i*T-n*R-s*E)*P,e[6]=(m*M-g*x+v*w)*P,e[7]=(g*b-f*M-v*y)*P,e[8]=(f*x-m*b+v*_)*P,e):null}function Ue(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function ke(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function He(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function Ve(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function Fe(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function Ge(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function je(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e}function We(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function qe(e,t){var n=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=t[0],d=t[1],f=t[2],m=t[3],g=t[4],v=t[5],_=t[6],y=t[7],b=t[8];return Math.abs(n-u)<=p*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-d)<=p*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-f)<=p*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=p*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-g)<=p*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(o-v)<=p*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(l-_)<=p*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-y)<=p*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-b)<=p*Math.max(1,Math.abs(h),Math.abs(b))}var Ye=Re,Xe=Fe;function Ze(){var e=new f(16);return f!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function $e(e){var t=new f(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Je(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ke(e,t,n,i,r,s,a,o,l,c,h,u,d,p,m,g){var v=new f(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=i,v[4]=r,v[5]=s,v[6]=a,v[7]=o,v[8]=l,v[9]=c,v[10]=h,v[11]=u,v[12]=d,v[13]=p,v[14]=m,v[15]=g,v}function Qe(e,t,n,i,r,s,a,o,l,c,h,u,d,p,f,m,g){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e[8]=c,e[9]=h,e[10]=u,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e}function et(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tt(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=r,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function nt(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],v=t[15],_=n*o-i*a,y=n*l-r*a,b=n*c-s*a,w=i*l-r*o,x=i*c-s*o,M=r*c-s*l,E=h*m-u*f,S=h*g-d*f,T=h*v-p*f,A=u*g-d*m,R=u*v-p*m,C=d*v-p*g,P=_*C-y*R+b*A+w*T-x*S+M*E;return P?(P=1/P,e[0]=(o*C-l*R+c*A)*P,e[1]=(r*R-i*C-s*A)*P,e[2]=(m*M-g*x+v*w)*P,e[3]=(d*x-u*M-p*w)*P,e[4]=(l*T-a*C-c*S)*P,e[5]=(n*C-r*T+s*S)*P,e[6]=(g*b-f*M-v*y)*P,e[7]=(h*M-d*b+p*y)*P,e[8]=(a*R-o*T+c*E)*P,e[9]=(i*T-n*R-s*E)*P,e[10]=(f*x-m*b+v*_)*P,e[11]=(u*b-h*x-p*_)*P,e[12]=(o*S-a*A-l*E)*P,e[13]=(n*A-i*S+r*E)*P,e[14]=(m*y-f*w-g*_)*P,e[15]=(h*w-u*y+d*_)*P,e):null}function it(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],v=t[15];return e[0]=o*(d*v-p*g)-u*(l*v-c*g)+m*(l*p-c*d),e[1]=-(i*(d*v-p*g)-u*(r*v-s*g)+m*(r*p-s*d)),e[2]=i*(l*v-c*g)-o*(r*v-s*g)+m*(r*c-s*l),e[3]=-(i*(l*p-c*d)-o*(r*p-s*d)+u*(r*c-s*l)),e[4]=-(a*(d*v-p*g)-h*(l*v-c*g)+f*(l*p-c*d)),e[5]=n*(d*v-p*g)-h*(r*v-s*g)+f*(r*p-s*d),e[6]=-(n*(l*v-c*g)-a*(r*v-s*g)+f*(r*c-s*l)),e[7]=n*(l*p-c*d)-a*(r*p-s*d)+h*(r*c-s*l),e[8]=a*(u*v-p*m)-h*(o*v-c*m)+f*(o*p-c*u),e[9]=-(n*(u*v-p*m)-h*(i*v-s*m)+f*(i*p-s*u)),e[10]=n*(o*v-c*m)-a*(i*v-s*m)+f*(i*c-s*o),e[11]=-(n*(o*p-c*u)-a*(i*p-s*u)+h*(i*c-s*o)),e[12]=-(a*(u*g-d*m)-h*(o*g-l*m)+f*(o*d-l*u)),e[13]=n*(u*g-d*m)-h*(i*g-r*m)+f*(i*d-r*u),e[14]=-(n*(o*g-l*m)-a*(i*g-r*m)+f*(i*l-r*o)),e[15]=n*(o*d-l*u)-a*(i*d-r*u)+h*(i*l-r*o),e}function rt(e){var t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*a-n*s)*(u*g-d*m)-(t*o-i*s)*(h*g-d*f)+(t*l-r*s)*(h*m-u*f)+(n*o-i*a)*(c*g-d*p)-(n*l-r*a)*(c*m-u*p)+(i*l-r*o)*(c*f-h*p)}function st(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],v=t[14],_=t[15],y=n[0],b=n[1],w=n[2],x=n[3];return e[0]=y*i+b*o+w*u+x*m,e[1]=y*r+b*l+w*d+x*g,e[2]=y*s+b*c+w*p+x*v,e[3]=y*a+b*h+w*f+x*_,y=n[4],b=n[5],w=n[6],x=n[7],e[4]=y*i+b*o+w*u+x*m,e[5]=y*r+b*l+w*d+x*g,e[6]=y*s+b*c+w*p+x*v,e[7]=y*a+b*h+w*f+x*_,y=n[8],b=n[9],w=n[10],x=n[11],e[8]=y*i+b*o+w*u+x*m,e[9]=y*r+b*l+w*d+x*g,e[10]=y*s+b*c+w*p+x*v,e[11]=y*a+b*h+w*f+x*_,y=n[12],b=n[13],w=n[14],x=n[15],e[12]=y*i+b*o+w*u+x*m,e[13]=y*r+b*l+w*d+x*g,e[14]=y*s+b*c+w*p+x*v,e[15]=y*a+b*h+w*f+x*_,e}function at(e,t,n){var i,r,s,a,o,l,c,h,u,d,p,f,m=n[0],g=n[1],v=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*v+t[12],e[13]=t[1]*m+t[5]*g+t[9]*v+t[13],e[14]=t[2]*m+t[6]*g+t[10]*v+t[14],e[15]=t[3]*m+t[7]*g+t[11]*v+t[15]):(i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],e[0]=i,e[1]=r,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e[6]=c,e[7]=h,e[8]=u,e[9]=d,e[10]=p,e[11]=f,e[12]=i*m+o*g+u*v+t[12],e[13]=r*m+l*g+d*v+t[13],e[14]=s*m+c*g+p*v+t[14],e[15]=a*m+h*g+f*v+t[15]),e}function ot(e,t,n){var i=n[0],r=n[1],s=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function lt(e,t,n,i){var r,s,a,o,l,c,h,u,d,f,m,g,v,_,y,b,w,x,M,E,S,T,A,R,C=i[0],P=i[1],L=i[2],I=Math.hypot(C,P,L);return I<p?null:(C*=I=1/I,P*=I,L*=I,r=Math.sin(n),a=1-(s=Math.cos(n)),o=t[0],l=t[1],c=t[2],h=t[3],u=t[4],d=t[5],f=t[6],m=t[7],g=t[8],v=t[9],_=t[10],y=t[11],b=C*C*a+s,w=P*C*a+L*r,x=L*C*a-P*r,M=C*P*a-L*r,E=P*P*a+s,S=L*P*a+C*r,T=C*L*a+P*r,A=P*L*a-C*r,R=L*L*a+s,e[0]=o*b+u*w+g*x,e[1]=l*b+d*w+v*x,e[2]=c*b+f*w+_*x,e[3]=h*b+m*w+y*x,e[4]=o*M+u*E+g*S,e[5]=l*M+d*E+v*S,e[6]=c*M+f*E+_*S,e[7]=h*M+m*E+y*S,e[8]=o*T+u*A+g*R,e[9]=l*T+d*A+v*R,e[10]=c*T+f*A+_*R,e[11]=h*T+m*A+y*R,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ct(e,t,n){var i=Math.sin(n),r=Math.cos(n),s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+c*i,e[5]=a*r+h*i,e[6]=o*r+u*i,e[7]=l*r+d*i,e[8]=c*r-s*i,e[9]=h*r-a*i,e[10]=u*r-o*i,e[11]=d*r-l*i,e}function ht(e,t,n){var i=Math.sin(n),r=Math.cos(n),s=t[0],a=t[1],o=t[2],l=t[3],c=t[8],h=t[9],u=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r-c*i,e[1]=a*r-h*i,e[2]=o*r-u*i,e[3]=l*r-d*i,e[8]=s*i+c*r,e[9]=a*i+h*r,e[10]=o*i+u*r,e[11]=l*i+d*r,e}function ut(e,t,n){var i=Math.sin(n),r=Math.cos(n),s=t[0],a=t[1],o=t[2],l=t[3],c=t[4],h=t[5],u=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+c*i,e[1]=a*r+h*i,e[2]=o*r+u*i,e[3]=l*r+d*i,e[4]=c*r-s*i,e[5]=h*r-a*i,e[6]=u*r-o*i,e[7]=d*r-l*i,e}function dt(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function pt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ft(e,t,n){var i,r,s,a=n[0],o=n[1],l=n[2],c=Math.hypot(a,o,l);return c<p?null:(a*=c=1/c,o*=c,l*=c,i=Math.sin(t),s=1-(r=Math.cos(t)),e[0]=a*a*s+r,e[1]=o*a*s+l*i,e[2]=l*a*s-o*i,e[3]=0,e[4]=a*o*s-l*i,e[5]=o*o*s+r,e[6]=l*o*s+a*i,e[7]=0,e[8]=a*l*s+o*i,e[9]=o*l*s-a*i,e[10]=l*l*s+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function mt(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gt(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vt(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _t(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=i+i,l=r+r,c=s+s,h=i*o,u=i*l,d=i*c,p=r*l,f=r*c,m=s*c,g=a*o,v=a*l,_=a*c;return e[0]=1-(p+m),e[1]=u+_,e[2]=d-v,e[3]=0,e[4]=u-_,e[5]=1-(h+m),e[6]=f+g,e[7]=0,e[8]=d+v,e[9]=f-g,e[10]=1-(h+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function yt(e,t){var n=new f(3),i=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=i*i+r*r+s*s+a*a;return u>0?(n[0]=2*(o*a+h*i+l*s-c*r)/u,n[1]=2*(l*a+h*r+c*i-o*s)/u,n[2]=2*(c*a+h*s+o*r-l*i)/u):(n[0]=2*(o*a+h*i+l*s-c*r),n[1]=2*(l*a+h*r+c*i-o*s),n[2]=2*(c*a+h*s+o*r-l*i)),_t(e,t,n),e}function bt(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function wt(e,t){var n=t[0],i=t[1],r=t[2],s=t[4],a=t[5],o=t[6],l=t[8],c=t[9],h=t[10];return e[0]=Math.hypot(n,i,r),e[1]=Math.hypot(s,a,o),e[2]=Math.hypot(l,c,h),e}function xt(e,t){var n=new f(3);wt(n,t);var i=1/n[0],r=1/n[1],s=1/n[2],a=t[0]*i,o=t[1]*r,l=t[2]*s,c=t[4]*i,h=t[5]*r,u=t[6]*s,d=t[8]*i,p=t[9]*r,m=t[10]*s,g=a+h+m,v=0;return g>0?(v=2*Math.sqrt(g+1),e[3]=.25*v,e[0]=(u-p)/v,e[1]=(d-l)/v,e[2]=(o-c)/v):a>h&&a>m?(v=2*Math.sqrt(1+a-h-m),e[3]=(u-p)/v,e[0]=.25*v,e[1]=(o+c)/v,e[2]=(d+l)/v):h>m?(v=2*Math.sqrt(1+h-a-m),e[3]=(d-l)/v,e[0]=(o+c)/v,e[1]=.25*v,e[2]=(u+p)/v):(v=2*Math.sqrt(1+m-a-h),e[3]=(o-c)/v,e[0]=(d+l)/v,e[1]=(u+p)/v,e[2]=.25*v),e}function Mt(e,t,n,i){var r=t[0],s=t[1],a=t[2],o=t[3],l=r+r,c=s+s,h=a+a,u=r*l,d=r*c,p=r*h,f=s*c,m=s*h,g=a*h,v=o*l,_=o*c,y=o*h,b=i[0],w=i[1],x=i[2];return e[0]=(1-(f+g))*b,e[1]=(d+y)*b,e[2]=(p-_)*b,e[3]=0,e[4]=(d-y)*w,e[5]=(1-(u+g))*w,e[6]=(m+v)*w,e[7]=0,e[8]=(p+_)*x,e[9]=(m-v)*x,e[10]=(1-(u+f))*x,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Et(e,t,n,i,r){var s=t[0],a=t[1],o=t[2],l=t[3],c=s+s,h=a+a,u=o+o,d=s*c,p=s*h,f=s*u,m=a*h,g=a*u,v=o*u,_=l*c,y=l*h,b=l*u,w=i[0],x=i[1],M=i[2],E=r[0],S=r[1],T=r[2],A=(1-(m+v))*w,R=(p+b)*w,C=(f-y)*w,P=(p-b)*x,L=(1-(d+v))*x,I=(g+_)*x,D=(f+y)*M,O=(g-_)*M,N=(1-(d+m))*M;return e[0]=A,e[1]=R,e[2]=C,e[3]=0,e[4]=P,e[5]=L,e[6]=I,e[7]=0,e[8]=D,e[9]=O,e[10]=N,e[11]=0,e[12]=n[0]+E-(A*E+P*S+D*T),e[13]=n[1]+S-(R*E+L*S+O*T),e[14]=n[2]+T-(C*E+I*S+N*T),e[15]=1,e}function St(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=n+n,o=i+i,l=r+r,c=n*a,h=i*a,u=i*o,d=r*a,p=r*o,f=r*l,m=s*a,g=s*o,v=s*l;return e[0]=1-u-f,e[1]=h+v,e[2]=d-g,e[3]=0,e[4]=h-v,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Tt(e,t,n,i,r,s,a){var o=1/(n-t),l=1/(r-i),c=1/(s-a);return e[0]=2*s*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(n+t)*o,e[9]=(r+i)*l,e[10]=(a+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*c,e[15]=0,e}function At(e,t,n,i,r){var s,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(s=1/(i-r),e[10]=(r+i)*s,e[14]=2*r*i*s):(e[10]=-1,e[14]=-2*i),e}function Rt(e,t,n,i){var r=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+o),c=2/(r+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-o)*l*.5,e[9]=(r-s)*c*.5,e[10]=i/(n-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*n/(n-i),e[15]=0,e}function Ct(e,t,n,i,r,s,a){var o=1/(t-n),l=1/(i-r),c=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*o,e[13]=(r+i)*l,e[14]=(a+s)*c,e[15]=1,e}function Pt(e,t,n,i){var r,s,a,o,l,c,h,u,d,f,m=t[0],g=t[1],v=t[2],_=i[0],y=i[1],b=i[2],w=n[0],x=n[1],M=n[2];return Math.abs(m-w)<p&&Math.abs(g-x)<p&&Math.abs(v-M)<p?et(e):(h=m-w,u=g-x,d=v-M,r=y*(d*=f=1/Math.hypot(h,u,d))-b*(u*=f),s=b*(h*=f)-_*d,a=_*u-y*h,(f=Math.hypot(r,s,a))?(r*=f=1/f,s*=f,a*=f):(r=0,s=0,a=0),o=u*a-d*s,l=d*r-h*a,c=h*s-u*r,(f=Math.hypot(o,l,c))?(o*=f=1/f,l*=f,c*=f):(o=0,l=0,c=0),e[0]=r,e[1]=o,e[2]=h,e[3]=0,e[4]=s,e[5]=l,e[6]=u,e[7]=0,e[8]=a,e[9]=c,e[10]=d,e[11]=0,e[12]=-(r*m+s*g+a*v),e[13]=-(o*m+l*g+c*v),e[14]=-(h*m+u*g+d*v),e[15]=1,e)}function Lt(e,t,n,i){var r=t[0],s=t[1],a=t[2],o=i[0],l=i[1],c=i[2],h=r-n[0],u=s-n[1],d=a-n[2],p=h*h+u*u+d*d;p>0&&(h*=p=1/Math.sqrt(p),u*=p,d*=p);var f=l*d-c*u,m=c*h-o*d,g=o*u-l*h;return(p=f*f+m*m+g*g)>0&&(f*=p=1/Math.sqrt(p),m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=u*g-d*m,e[5]=d*f-h*g,e[6]=h*m-u*f,e[7]=0,e[8]=h,e[9]=u,e[10]=d,e[11]=0,e[12]=r,e[13]=s,e[14]=a,e[15]=1,e}function It(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Dt(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ot(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Nt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function Bt(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function zt(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e[9]=t[9]+n[9]*i,e[10]=t[10]+n[10]*i,e[11]=t[11]+n[11]*i,e[12]=t[12]+n[12]*i,e[13]=t[13]+n[13]*i,e[14]=t[14]+n[14]*i,e[15]=t[15]+n[15]*i,e}function Ut(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function kt(e,t){var n=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],f=e[11],m=e[12],g=e[13],v=e[14],_=e[15],y=t[0],b=t[1],w=t[2],x=t[3],M=t[4],E=t[5],S=t[6],T=t[7],A=t[8],R=t[9],C=t[10],P=t[11],L=t[12],I=t[13],D=t[14],O=t[15];return Math.abs(n-y)<=p*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-b)<=p*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(r-w)<=p*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(s-x)<=p*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(a-M)<=p*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(o-E)<=p*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(l-S)<=p*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-T)<=p*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-A)<=p*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(u-R)<=p*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(d-C)<=p*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(f-P)<=p*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-L)<=p*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(g-I)<=p*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(v-D)<=p*Math.max(1,Math.abs(v),Math.abs(D))&&Math.abs(_-O)<=p*Math.max(1,Math.abs(_),Math.abs(O))}var Ht=st,Vt=Nt;function Ft(){var e=new f(3);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Gt(e){var t=new f(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function jt(e){var t=e[0],n=e[1],i=e[2];return Math.hypot(t,n,i)}function Wt(e,t,n){var i=new f(3);return i[0]=e,i[1]=t,i[2]=n,i}function qt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Yt(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e}function Xt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Zt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function $t(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Jt(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function Kt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Qt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function en(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function tn(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function nn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function rn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function sn(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e}function an(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.hypot(n,i,r)}function on(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function ln(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function cn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function hn(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function un(e,t){var n=t[0],i=t[1],r=t[2],s=n*n+i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function dn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function pn(e,t,n){var i=t[0],r=t[1],s=t[2],a=n[0],o=n[1],l=n[2];return e[0]=r*l-s*o,e[1]=s*a-i*l,e[2]=i*o-r*a,e}function fn(e,t,n,i){var r=t[0],s=t[1],a=t[2];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e[2]=a+i*(n[2]-a),e}function mn(e,t,n,i,r,s){var a=s*s,o=a*(2*s-3)+1,l=a*(s-2)+s,c=a*(s-1),h=a*(3-2*s);return e[0]=t[0]*o+n[0]*l+i[0]*c+r[0]*h,e[1]=t[1]*o+n[1]*l+i[1]*c+r[1]*h,e[2]=t[2]*o+n[2]*l+i[2]*c+r[2]*h,e}function gn(e,t,n,i,r,s){var a=1-s,o=a*a,l=s*s,c=o*a,h=3*s*o,u=3*l*a,d=l*s;return e[0]=t[0]*c+n[0]*h+i[0]*u+r[0]*d,e[1]=t[1]*c+n[1]*h+i[1]*u+r[1]*d,e[2]=t[2]*c+n[2]*h+i[2]*u+r[2]*d,e}function vn(e,t){t=t||1;var n=2*m()*Math.PI,i=2*m()-1,r=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e[2]=i*t,e}function _n(e,t,n){var i=t[0],r=t[1],s=t[2],a=n[3]*i+n[7]*r+n[11]*s+n[15];return a=a||1,e[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/a,e[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/a,e[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/a,e}function yn(e,t,n){var i=t[0],r=t[1],s=t[2];return e[0]=i*n[0]+r*n[3]+s*n[6],e[1]=i*n[1]+r*n[4]+s*n[7],e[2]=i*n[2]+r*n[5]+s*n[8],e}function bn(e,t,n){var i=n[0],r=n[1],s=n[2],a=n[3],o=t[0],l=t[1],c=t[2],h=r*c-s*l,u=s*o-i*c,d=i*l-r*o,p=r*d-s*u,f=s*h-i*d,m=i*u-r*h,g=2*a;return h*=g,u*=g,d*=g,p*=2,f*=2,m*=2,e[0]=o+h+p,e[1]=l+u+f,e[2]=c+d+m,e}function wn(e,t,n,i){var r=[],s=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e}function xn(e,t,n,i){var r=[],s=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e}function Mn(e,t,n,i){var r=[],s=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e}function En(e,t){var n=e[0],i=e[1],r=e[2],s=t[0],a=t[1],o=t[2],l=Math.sqrt(n*n+i*i+r*r)*Math.sqrt(s*s+a*a+o*o),c=l&&dn(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}function Sn(e){return e[0]=0,e[1]=0,e[2]=0,e}function Tn(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function An(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Rn(e,t){var n=e[0],i=e[1],r=e[2],s=t[0],a=t[1],o=t[2];return Math.abs(n-s)<=p*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=p*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=p*Math.max(1,Math.abs(r),Math.abs(o))}var Cn,Pn=Zt,Ln=$t,In=Jt,Dn=an,On=on,Nn=jt,Bn=ln,zn=(Cn=Ft(),function(e,t,n,i,r,s){var a,o;for(t||(t=3),n||(n=0),o=i?Math.min(i*t+n,e.length):e.length,a=n;a<o;a+=t)Cn[0]=e[a],Cn[1]=e[a+1],Cn[2]=e[a+2],r(Cn,Cn,s),e[a]=Cn[0],e[a+1]=Cn[1],e[a+2]=Cn[2];return e});function Un(){var e=new f(4);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function kn(e){var t=new f(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Hn(e,t,n,i){var r=new f(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}function Vn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Fn(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e}function Gn(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function jn(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function Wn(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function qn(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function Yn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Xn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Zn(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function $n(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function Jn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Kn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Qn(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e}function ei(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],s=t[3]-e[3];return Math.hypot(n,i,r,s)}function ti(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],s=t[3]-e[3];return n*n+i*i+r*r+s*s}function ni(e){var t=e[0],n=e[1],i=e[2],r=e[3];return Math.hypot(t,n,i,r)}function ii(e){var t=e[0],n=e[1],i=e[2],r=e[3];return t*t+n*n+i*i+r*r}function ri(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function si(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function ai(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=n*n+i*i+r*r+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=n*a,e[1]=i*a,e[2]=r*a,e[3]=s*a,e}function oi(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function li(e,t,n,i){var r=n[0]*i[1]-n[1]*i[0],s=n[0]*i[2]-n[2]*i[0],a=n[0]*i[3]-n[3]*i[0],o=n[1]*i[2]-n[2]*i[1],l=n[1]*i[3]-n[3]*i[1],c=n[2]*i[3]-n[3]*i[2],h=t[0],u=t[1],d=t[2],p=t[3];return e[0]=u*c-d*l+p*o,e[1]=-h*c+d*a-p*s,e[2]=h*l-u*a+p*r,e[3]=-h*o+u*s-d*r,e}function ci(e,t,n,i){var r=t[0],s=t[1],a=t[2],o=t[3];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e[2]=a+i*(n[2]-a),e[3]=o+i*(n[3]-o),e}function hi(e,t){var n,i,r,s,a,o;t=t||1;do{a=(n=2*m()-1)*n+(i=2*m()-1)*i}while(a>=1);do{o=(r=2*m()-1)*r+(s=2*m()-1)*s}while(o>=1);var l=Math.sqrt((1-a)/o);return e[0]=t*n,e[1]=t*i,e[2]=t*r*l,e[3]=t*s*l,e}function ui(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*a,e[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*a,e[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*a,e[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*a,e}function di(e,t,n){var i=t[0],r=t[1],s=t[2],a=n[0],o=n[1],l=n[2],c=n[3],h=c*i+o*s-l*r,u=c*r+l*i-a*s,d=c*s+a*r-o*i,p=-a*i-o*r-l*s;return e[0]=h*c+p*-a+u*-l-d*-o,e[1]=u*c+p*-o+d*-a-h*-l,e[2]=d*c+p*-l+h*-o-u*-a,e[3]=t[3],e}function pi(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function fi(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function mi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function gi(e,t){var n=e[0],i=e[1],r=e[2],s=e[3],a=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(n-a)<=p*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-o)<=p*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-l)<=p*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-c)<=p*Math.max(1,Math.abs(s),Math.abs(c))}var vi=jn,_i=Wn,yi=qn,bi=ei,wi=ti,xi=ni,Mi=ii,Ei=function(){var e=Un();return function(t,n,i,r,s,a){var o,l;for(n||(n=4),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,o=i;o<l;o+=n)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();function Si(){var e=new f(4);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ti(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ai(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function Ri(e,t){var n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>p?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n}function Ci(e,t){var n=rr(e,t);return Math.acos(2*n*n-1)}function Pi(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=n[0],l=n[1],c=n[2],h=n[3];return e[0]=i*h+a*o+r*c-s*l,e[1]=r*h+a*l+s*o-i*c,e[2]=s*h+a*c+i*l-r*o,e[3]=a*h-i*o-r*l-s*c,e}function Li(e,t,n){n*=.5;var i=t[0],r=t[1],s=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l+a*o,e[1]=r*l+s*o,e[2]=s*l-r*o,e[3]=a*l-i*o,e}function Ii(e,t,n){n*=.5;var i=t[0],r=t[1],s=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l-s*o,e[1]=r*l+a*o,e[2]=s*l+i*o,e[3]=a*l-r*o,e}function Di(e,t,n){n*=.5;var i=t[0],r=t[1],s=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*o,e[1]=r*l-i*o,e[2]=s*l+a*o,e[3]=a*l-s*o,e}function Oi(e,t){var n=t[0],i=t[1],r=t[2];return e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e}function Ni(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=Math.sqrt(n*n+i*i+r*r),o=Math.exp(s),l=a>0?o*Math.sin(a)/a:0;return e[0]=n*l,e[1]=i*l,e[2]=r*l,e[3]=o*Math.cos(a),e}function Bi(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=Math.sqrt(n*n+i*i+r*r),o=a>0?Math.atan2(a,s)/a:0;return e[0]=n*o,e[1]=i*o,e[2]=r*o,e[3]=.5*Math.log(n*n+i*i+r*r+s*s),e}function zi(e,t,n){return Bi(e,t),ir(e,e,n),Ni(e,e),e}function Ui(e,t,n,i){var r,s,a,o,l,c=t[0],h=t[1],u=t[2],d=t[3],f=n[0],m=n[1],g=n[2],v=n[3];return(s=c*f+h*m+u*g+d*v)<0&&(s=-s,f=-f,m=-m,g=-g,v=-v),1-s>p?(r=Math.acos(s),a=Math.sin(r),o=Math.sin((1-i)*r)/a,l=Math.sin(i*r)/a):(o=1-i,l=i),e[0]=o*c+l*f,e[1]=o*h+l*m,e[2]=o*u+l*g,e[3]=o*d+l*v,e}function ki(e){var t=m(),n=m(),i=m(),r=Math.sqrt(1-t),s=Math.sqrt(t);return e[0]=r*Math.sin(2*Math.PI*n),e[1]=r*Math.cos(2*Math.PI*n),e[2]=s*Math.sin(2*Math.PI*i),e[3]=s*Math.cos(2*Math.PI*i),e}function Hi(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=n*n+i*i+r*r+s*s,o=a?1/a:0;return e[0]=-n*o,e[1]=-i*o,e[2]=-r*o,e[3]=s*o,e}function Vi(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Fi(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var s=(r+1)%3,a=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*a+a]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*s+a]-t[3*a+s])*n,e[s]=(t[3*s+r]+t[3*r+s])*n,e[a]=(t[3*a+r]+t[3*r+a])*n}return e}function Gi(e,t,n,i){var r=.5*Math.PI/180;t*=r,n*=r,i*=r;var s=Math.sin(t),a=Math.cos(t),o=Math.sin(n),l=Math.cos(n),c=Math.sin(i),h=Math.cos(i);return e[0]=s*l*h-a*o*c,e[1]=a*o*h+s*l*c,e[2]=a*l*c-s*o*h,e[3]=a*l*h+s*o*c,e}function ji(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Wi,qi,Yi,Xi,Zi,$i,Ji=kn,Ki=Hn,Qi=Vn,er=Fn,tr=Gn,nr=Pi,ir=Kn,rr=oi,sr=ci,ar=ni,or=ar,lr=ii,cr=lr,hr=ai,ur=mi,dr=gi,pr=(Wi=Ft(),qi=Wt(1,0,0),Yi=Wt(0,1,0),function(e,t,n){var i=dn(t,n);return i<-.999999?(pn(Wi,qi,t),Nn(Wi)<1e-6&&pn(Wi,Yi,t),un(Wi,Wi),Ai(e,Wi,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(pn(Wi,t,n),e[0]=Wi[0],e[1]=Wi[1],e[2]=Wi[2],e[3]=1+i,hr(e,e))}),fr=(Xi=Si(),Zi=Si(),function(e,t,n,i,r,s){return Ui(Xi,t,r,s),Ui(Zi,n,i,s),Ui(e,Xi,Zi,2*s*(1-s)),e}),mr=($i=ve(),function(e,t,n,i){return $i[0]=n[0],$i[3]=n[1],$i[6]=n[2],$i[1]=i[0],$i[4]=i[1],$i[7]=i[2],$i[2]=-t[0],$i[5]=-t[1],$i[8]=-t[2],hr(e,Fi(e,$i))});function gr(){var e=new f(8);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function vr(e){var t=new f(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function _r(e,t,n,i,r,s,a,o){var l=new f(8);return l[0]=e,l[1]=t,l[2]=n,l[3]=i,l[4]=r,l[5]=s,l[6]=a,l[7]=o,l}function yr(e,t,n,i,r,s,a){var o=new f(8);o[0]=e,o[1]=t,o[2]=n,o[3]=i;var l=.5*r,c=.5*s,h=.5*a;return o[4]=l*i+c*n-h*t,o[5]=c*i+h*e-l*n,o[6]=h*i+l*t-c*e,o[7]=-l*e-c*t-h*n,o}function br(e,t,n){var i=.5*n[0],r=.5*n[1],s=.5*n[2],a=t[0],o=t[1],l=t[2],c=t[3];return e[0]=a,e[1]=o,e[2]=l,e[3]=c,e[4]=i*c+r*l-s*o,e[5]=r*c+s*a-i*l,e[6]=s*c+i*o-r*a,e[7]=-i*a-r*o-s*l,e}function wr(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e}function xr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Mr(e,t){var n=Si();xt(n,t);var i=new f(3);return bt(i,t),br(e,n,i),e}function Er(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Sr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Tr(e,t,n,i,r,s,a,o,l){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e}var Ar=Qi;function Rr(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var Cr=Qi;function Pr(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Lr(e,t){var n=t[4],i=t[5],r=t[6],s=t[7],a=-t[0],o=-t[1],l=-t[2],c=t[3];return e[0]=2*(n*c+s*a+i*l-r*o),e[1]=2*(i*c+s*o+r*a-n*l),e[2]=2*(r*c+s*l+n*o-i*a),e}function Ir(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=.5*n[0],l=.5*n[1],c=.5*n[2],h=t[4],u=t[5],d=t[6],p=t[7];return e[0]=i,e[1]=r,e[2]=s,e[3]=a,e[4]=a*o+r*c-s*l+h,e[5]=a*l+s*o-i*c+u,e[6]=a*c+i*l-r*o+d,e[7]=-i*o-r*l-s*c+p,e}function Dr(e,t,n){var i=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=o*a+h*i+l*s-c*r,d=l*a+h*r+c*i-o*s,p=c*a+h*s+o*r-l*i,f=h*a-o*i-l*r-c*s;return Li(e,t,n),i=e[0],r=e[1],s=e[2],a=e[3],e[4]=u*a+f*i+d*s-p*r,e[5]=d*a+f*r+p*i-u*s,e[6]=p*a+f*s+u*r-d*i,e[7]=f*a-u*i-d*r-p*s,e}function Or(e,t,n){var i=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=o*a+h*i+l*s-c*r,d=l*a+h*r+c*i-o*s,p=c*a+h*s+o*r-l*i,f=h*a-o*i-l*r-c*s;return Ii(e,t,n),i=e[0],r=e[1],s=e[2],a=e[3],e[4]=u*a+f*i+d*s-p*r,e[5]=d*a+f*r+p*i-u*s,e[6]=p*a+f*s+u*r-d*i,e[7]=f*a-u*i-d*r-p*s,e}function Nr(e,t,n){var i=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=o*a+h*i+l*s-c*r,d=l*a+h*r+c*i-o*s,p=c*a+h*s+o*r-l*i,f=h*a-o*i-l*r-c*s;return Di(e,t,n),i=e[0],r=e[1],s=e[2],a=e[3],e[4]=u*a+f*i+d*s-p*r,e[5]=d*a+f*r+p*i-u*s,e[6]=p*a+f*s+u*r-d*i,e[7]=f*a-u*i-d*r-p*s,e}function Br(e,t,n){var i=n[0],r=n[1],s=n[2],a=n[3],o=t[0],l=t[1],c=t[2],h=t[3];return e[0]=o*a+h*i+l*s-c*r,e[1]=l*a+h*r+c*i-o*s,e[2]=c*a+h*s+o*r-l*i,e[3]=h*a-o*i-l*r-c*s,o=t[4],l=t[5],c=t[6],h=t[7],e[4]=o*a+h*i+l*s-c*r,e[5]=l*a+h*r+c*i-o*s,e[6]=c*a+h*s+o*r-l*i,e[7]=h*a-o*i-l*r-c*s,e}function zr(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=n[0],l=n[1],c=n[2],h=n[3];return e[0]=i*h+a*o+r*c-s*l,e[1]=r*h+a*l+s*o-i*c,e[2]=s*h+a*c+i*l-r*o,e[3]=a*h-i*o-r*l-s*c,o=n[4],l=n[5],c=n[6],h=n[7],e[4]=i*h+a*o+r*c-s*l,e[5]=r*h+a*l+s*o-i*c,e[6]=s*h+a*c+i*l-r*o,e[7]=a*h-i*o-r*l-s*c,e}function Ur(e,t,n,i){if(Math.abs(i)<p)return Er(e,t);var r=Math.hypot(n[0],n[1],n[2]);i*=.5;var s=Math.sin(i),a=s*n[0]/r,o=s*n[1]/r,l=s*n[2]/r,c=Math.cos(i),h=t[0],u=t[1],d=t[2],f=t[3];e[0]=h*c+f*a+u*l-d*o,e[1]=u*c+f*o+d*a-h*l,e[2]=d*c+f*l+h*o-u*a,e[3]=f*c-h*a-u*o-d*l;var m=t[4],g=t[5],v=t[6],_=t[7];return e[4]=m*c+_*a+g*l-v*o,e[5]=g*c+_*o+v*a-m*l,e[6]=v*c+_*l+m*o-g*a,e[7]=_*c-m*a-g*o-v*l,e}function kr(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e}function Hr(e,t,n){var i=t[0],r=t[1],s=t[2],a=t[3],o=n[4],l=n[5],c=n[6],h=n[7],u=t[4],d=t[5],p=t[6],f=t[7],m=n[0],g=n[1],v=n[2],_=n[3];return e[0]=i*_+a*m+r*v-s*g,e[1]=r*_+a*g+s*m-i*v,e[2]=s*_+a*v+i*g-r*m,e[3]=a*_-i*m-r*g-s*v,e[4]=i*h+a*o+r*c-s*l+u*_+f*m+d*v-p*g,e[5]=r*h+a*l+s*o-i*c+d*_+f*g+p*m-u*v,e[6]=s*h+a*c+i*l-r*o+p*_+f*v+u*g-d*m,e[7]=a*h-i*o-r*l-s*c+f*_-u*m-d*g-p*v,e}var Vr=Hr;function Fr(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e}var Gr=rr;function jr(e,t,n,i){var r=1-i;return Gr(t,n)<0&&(i=-i),e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i,e[3]=t[3]*r+n[3]*i,e[4]=t[4]*r+n[4]*i,e[5]=t[5]*r+n[5]*i,e[6]=t[6]*r+n[6]*i,e[7]=t[7]*r+n[7]*i,e}function Wr(e,t){var n=Zr(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e}function qr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var Yr=ar,Xr=Yr,Zr=lr,$r=Zr;function Jr(e,t){var n=Zr(t);if(n>0){n=Math.sqrt(n);var i=t[0]/n,r=t[1]/n,s=t[2]/n,a=t[3]/n,o=t[4],l=t[5],c=t[6],h=t[7],u=i*o+r*l+s*c+a*h;e[0]=i,e[1]=r,e[2]=s,e[3]=a,e[4]=(o-i*u)/n,e[5]=(l-r*u)/n,e[6]=(c-s*u)/n,e[7]=(h-a*u)/n}return e}function Kr(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function Qr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function es(e,t){var n=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=t[0],u=t[1],d=t[2],f=t[3],m=t[4],g=t[5],v=t[6],_=t[7];return Math.abs(n-h)<=p*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-u)<=p*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-d)<=p*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(s-f)<=p*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-m)<=p*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-g)<=p*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-v)<=p*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(c-_)<=p*Math.max(1,Math.abs(c),Math.abs(_))}function ts(){var e=new f(2);return f!=Float32Array&&(e[0]=0,e[1]=0),e}function ns(e){var t=new f(2);return t[0]=e[0],t[1]=e[1],t}function is(e,t){var n=new f(2);return n[0]=e,n[1]=t,n}function rs(e,t){return e[0]=t[0],e[1]=t[1],e}function ss(e,t,n){return e[0]=t,e[1]=n,e}function as(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function os(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function ls(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function cs(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function hs(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function us(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function ds(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function ps(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function fs(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function ms(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function gs(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e}function vs(e,t){var n=t[0]-e[0],i=t[1]-e[1];return Math.hypot(n,i)}function _s(e,t){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function ys(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function bs(e){var t=e[0],n=e[1];return t*t+n*n}function ws(e,t){return e[0]=-t[0],e[1]=-t[1],e}function xs(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Ms(e,t){var n=t[0],i=t[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e}function Es(e,t){return e[0]*t[0]+e[1]*t[1]}function Ss(e,t,n){var i=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=i,e}function Ts(e,t,n,i){var r=t[0],s=t[1];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e}function As(e,t){t=t||1;var n=2*m()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function Rs(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e}function Cs(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r+n[4],e[1]=n[1]*i+n[3]*r+n[5],e}function Ps(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e}function Ls(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}function Is(e,t,n,i){var r=t[0]-n[0],s=t[1]-n[1],a=Math.sin(i),o=Math.cos(i);return e[0]=r*o-s*a+n[0],e[1]=r*a+s*o+n[1],e}function Ds(e,t){var n=e[0],i=e[1],r=t[0],s=t[1],a=Math.sqrt(n*n+i*i)*Math.sqrt(r*r+s*s),o=a&&(n*r+i*s)/a;return Math.acos(Math.min(Math.max(o,-1),1))}function Os(e){return e[0]=0,e[1]=0,e}function Ns(e){return"vec2("+e[0]+", "+e[1]+")"}function Bs(e,t){return e[0]===t[0]&&e[1]===t[1]}function zs(e,t){var n=e[0],i=e[1],r=t[0],s=t[1];return Math.abs(n-r)<=p*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-s)<=p*Math.max(1,Math.abs(i),Math.abs(s))}var Us=ys,ks=os,Hs=ls,Vs=cs,Fs=vs,Gs=_s,js=bs,Ws=function(){var e=ts();return function(t,n,i,r,s,a){var o,l;for(n||(n=2),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,o=i;o<l;o+=n)e[0]=t[o],e[1]=t[o+1],s(e,e,a),t[o]=e[0],t[o+1]=e[1];return t}}()},8660:(e,t,n)=>{var i;!function(e){!function(t){var i="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),r=s(e);function s(e,t){return function(n,i){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:i}),t&&t(n,i)}}void 0===i.Reflect?i.Reflect=e:r=s(i.Reflect,r),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,i=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",r=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,a={__proto__:[]}instanceof Array,o=!s&&!a,l={create:s?function(){return N(Object.create(null))}:a?function(){return N({__proto__:null})}:function(){return N({})},has:o?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:o?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),h="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,u=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[r]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var i=this._keys.length,r=n+1;r<i;r++)this._keys[r-1]=this._keys[r],this._values[r-1]=this._values[r];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,i)},t.prototype.values=function(){return new n(this._keys,this._values,s)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[r]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function i(e,t){return e}function s(e,t){return t}function a(e,t){return[e,t]}}():Map,d=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new u}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[r]=function(){return this.keys()},e}():Set,p=new(h||"function"!=typeof WeakMap?function(){var e=l.create(),n=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=r(e,!1);return void 0!==t&&l.has(t,this._key)},e.prototype.get=function(e){var t=r(e,!1);return void 0!==t?l.get(t,this._key):void 0},e.prototype.set=function(e,t){return r(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=r(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var t;do{t="@@WeakMap@@"+a()}while(l.has(e,t));return e[t]=!0,t}function r(e,i){if(!t.call(e,n)){if(!i)return;Object.defineProperty(e,n,{value:l.create()})}return e[n]}function s(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(){var e,t=(e=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):s(new Uint8Array(e),e):s(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",i=0;i<16;++i){var r=t[i];4!==i&&6!==i&&8!==i||(n+="-"),r<16&&(n+="0"),n+=r.toString(16).toLowerCase()}return n}}():WeakMap);function f(e,t,n){var i=p.get(e);if(M(i)){if(!n)return;i=new u,p.set(e,i)}var r=i.get(t);if(M(r)){if(!n)return;r=new u,i.set(t,r)}return r}function m(e,t,n){if(g(e,t,n))return!0;var i=O(t);return!E(i)&&m(e,i,n)}function g(e,t,n){var i=f(t,n,!1);return!M(i)&&!!i.has(e)}function v(e,t,n){if(g(e,t,n))return _(e,t,n);var i=O(t);return E(i)?void 0:v(e,i,n)}function _(e,t,n){var i=f(t,n,!1);if(!M(i))return i.get(e)}function y(e,t,n,i){f(n,i,!0).set(e,t)}function b(e,t){var n=w(e,t),i=O(e);if(null===i)return n;var r=b(i,t);if(r.length<=0)return n;if(n.length<=0)return r;for(var s=new d,a=[],o=0,l=n;o<l.length;o++){var c=l[o];s.has(c)||(s.add(c),a.push(c))}for(var h=0,u=r;h<u.length;h++)c=u[h],s.has(c)||(s.add(c),a.push(c));return a}function w(e,t){var n=[],i=f(e,t,!1);if(M(i))return n;for(var s=function(e){var t=L(e,r);if(!C(t))throw new TypeError;var n=t.call(e);if(!S(n))throw new TypeError;return n}(i.keys()),a=0;;){var o=I(s);if(!o)return n.length=a,n;var l=o.value;try{n[a]=l}catch(e){try{D(s)}finally{throw e}}a++}}function x(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function M(e){return void 0===e}function E(e){return null===e}function S(e){return"object"==typeof e?null!==e:"function"==typeof e}function T(e,t){switch(x(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",r=L(e,i);if(void 0!==r){var s=r.call(e,n);if(S(s))throw new TypeError;return s}return function(e,t){if("string"===t){var n=e.toString;if(C(n)&&!S(r=n.call(e)))return r;if(C(i=e.valueOf)&&!S(r=i.call(e)))return r}else{var i;if(C(i=e.valueOf)&&!S(r=i.call(e)))return r;var r,s=e.toString;if(C(s)&&!S(r=s.call(e)))return r}throw new TypeError}(e,"default"===n?"number":n)}function A(e){var t=T(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function R(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function C(e){return"function"==typeof e}function P(e){return"function"==typeof e}function L(e,t){var n=e[t];if(null!=n){if(!C(n))throw new TypeError;return n}}function I(e){var t=e.next();return!t.done&&t}function D(e){var t=e.return;t&&t.call(e)}function O(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,i=n&&Object.getPrototypeOf(n);if(null==i||i===Object.prototype)return t;var r=i.constructor;return"function"!=typeof r||r===e?t:r}function N(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,i){if(M(n)){if(!R(e))throw new TypeError;if(!P(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var i=(0,e[n])(t);if(!M(i)&&!E(i)){if(!P(i))throw new TypeError;t=i}}return t}(e,t)}if(!R(e))throw new TypeError;if(!S(t))throw new TypeError;if(!S(i)&&!M(i)&&!E(i))throw new TypeError;return E(i)&&(i=void 0),function(e,t,n,i){for(var r=e.length-1;r>=0;--r){var s=(0,e[r])(t,n,i);if(!M(s)&&!E(s)){if(!S(s))throw new TypeError;i=s}}return i}(e,t,n=A(n),i)})),e("metadata",(function(e,t){return function(n,i){if(!S(n))throw new TypeError;if(!M(i)&&!function(e){switch(x(e)){case 3:case 4:return!0;default:return!1}}(i))throw new TypeError;y(e,t,n,i)}})),e("defineMetadata",(function(e,t,n,i){if(!S(n))throw new TypeError;return M(i)||(i=A(i)),y(e,t,n,i)})),e("hasMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return M(n)||(n=A(n)),m(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return M(n)||(n=A(n)),g(e,t,n)})),e("getMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return M(n)||(n=A(n)),v(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return M(n)||(n=A(n)),_(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return M(t)||(t=A(t)),b(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return M(t)||(t=A(t)),w(e,t)})),e("deleteMetadata",(function(e,t,n){if(!S(t))throw new TypeError;M(n)||(n=A(n));var i=f(t,n,!1);if(M(i))return!1;if(!i.delete(e))return!1;if(i.size>0)return!0;var r=p.get(t);return r.delete(n),r.size>0||p.delete(t),!0}))}(r)}()}(i||(i={}))},3466:function(e){var t;e.exports=((t=function(){function e(e){return r.appendChild(e.dom),e}function n(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";i=e}var i=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",(function(e){e.preventDefault(),n(++i%r.children.length)}),!1);var s=(performance||Date).now(),a=s,o=0,l=e(new t.Panel("FPS","#0ff","#002")),c=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=e(new t.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:r,addPanel:e,showPanel:n,begin:function(){s=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(c.update(e-s,200),e>a+1e3&&(l.update(1e3*o/(e-a),100),a=e,o=0,h)){var t=performance.memory;h.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:r,setMode:n}}).Panel=function(e,t,n){var i=1/0,r=0,s=Math.round,a=s(window.devicePixelRatio||1),o=80*a,l=48*a,c=3*a,h=2*a,u=3*a,d=15*a,p=74*a,f=30*a,m=document.createElement("canvas");m.width=o,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,o,l),g.fillStyle=t,g.fillText(e,c,h),g.fillRect(u,d,p,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(u,d,p,f),{dom:m,update:function(l,v){i=Math.min(i,l),r=Math.max(r,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,o,d),g.fillStyle=t,g.fillText(s(l)+" "+e+" ("+s(i)+"-"+s(r)+")",c,h),g.drawImage(m,u+a,d,p-a,f,u,d,p-a,f),g.fillRect(u+p-a,d,a,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(u+p-a,d,a,s((1-l/v)*f))}}},t)},2212:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ACESFilmicToneMapping:()=>ne,AddEquation:()=>S,AddOperation:()=>J,AdditiveAnimationBlendMode:()=>qt,AdditiveBlending:()=>w,AlphaFormat:()=>Be,AlwaysDepth:()=>F,AlwaysStencilFunc:()=>En,AmbientLight:()=>Iu,AmbientLightProbe:()=>ed,AnimationClip:()=>Dh,AnimationLoader:()=>Vh,AnimationMixer:()=>Ld,AnimationObjectGroup:()=>Cd,AnimationUtils:()=>bh,ArcCurve:()=>Zh,ArrayCamera:()=>Yo,ArrowHelper:()=>wp,Audio:()=>ud,AudioAnalyser:()=>vd,AudioContext:()=>Ju,AudioListener:()=>hd,AudioLoader:()=>Ku,AxesHelper:()=>xp,AxisHelper:()=>bf,BackSide:()=>m,BasicDepthPacking:()=>sn,BasicShadowMap:()=>h,BinaryTextureLoader:()=>Sf,Bone:()=>Il,BooleanKeyframeTrack:()=>Th,BoundingBoxHelper:()=>wf,Box2:()=>Vd,Box3:()=>hi,Box3Helper:()=>gp,BoxBufferGeometry:()=>Es,BoxGeometry:()=>Es,BoxHelper:()=>mp,BufferAttribute:()=>zr,BufferGeometry:()=>rs,BufferGeometryLoader:()=>Hu,ByteType:()=>Se,Cache:()=>Nh,Camera:()=>Cs,CameraHelper:()=>dp,CanvasRenderer:()=>Af,CanvasTexture:()=>lc,CatmullRomCurve3:()=>tu,CineonToneMapping:()=>te,CircleBufferGeometry:()=>hc,CircleGeometry:()=>hc,ClampToEdgeWrapping:()=>de,Clock:()=>rd,Color:()=>Dr,ColorKeyframeTrack:()=>Ah,CompressedTexture:()=>oc,CompressedTextureLoader:()=>Fh,ConeBufferGeometry:()=>dc,ConeGeometry:()=>dc,CubeCamera:()=>Is,CubeReflectionMapping:()=>se,CubeRefractionMapping:()=>ae,CubeTexture:()=>Ds,CubeTextureLoader:()=>jh,CubeUVReflectionMapping:()=>ce,CubeUVRefractionMapping:()=>he,CubicBezierCurve:()=>su,CubicBezierCurve3:()=>au,CubicInterpolant:()=>xh,CullFaceBack:()=>o,CullFaceFront:()=>l,CullFaceFrontBack:()=>c,CullFaceNone:()=>a,Curve:()=>Yh,CurvePath:()=>pu,CustomBlending:()=>E,CustomToneMapping:()=>ie,CylinderBufferGeometry:()=>uc,CylinderGeometry:()=>uc,Cylindrical:()=>kd,DataTexture:()=>Dl,DataTexture2DArray:()=>ra,DataTexture3D:()=>sa,DataTextureLoader:()=>Wh,DataUtils:()=>Sp,DecrementStencilOp:()=>pn,DecrementWrapStencilOp:()=>mn,DefaultLoadingManager:()=>zh,DepthFormat:()=>Fe,DepthStencilFormat:()=>Ge,DepthTexture:()=>cc,DirectionalLight:()=>Lu,DirectionalLightHelper:()=>cp,DiscreteInterpolant:()=>Eh,DodecahedronBufferGeometry:()=>fc,DodecahedronGeometry:()=>fc,DoubleSide:()=>g,DstAlphaFactor:()=>B,DstColorFactor:()=>U,DynamicBufferAttribute:()=>hf,DynamicCopyUsage:()=>In,DynamicDrawUsage:()=>Tn,DynamicReadUsage:()=>Cn,EdgesGeometry:()=>yc,EdgesHelper:()=>xf,EllipseCurve:()=>Xh,EqualDepth:()=>W,EqualStencilFunc:()=>yn,EquirectangularReflectionMapping:()=>oe,EquirectangularRefractionMapping:()=>le,Euler:()=>Xi,EventDispatcher:()=>Bn,ExtrudeBufferGeometry:()=>Yc,ExtrudeGeometry:()=>Yc,FaceColors:()=>Kp,FileLoader:()=>Hh,FlatShading:()=>v,Float16BufferAttribute:()=>Wr,Float32Attribute:()=>_f,Float32BufferAttribute:()=>qr,Float64Attribute:()=>yf,Float64BufferAttribute:()=>Yr,FloatType:()=>Pe,Fog:()=>nl,FogExp2:()=>tl,Font:()=>Yu,FontLoader:()=>Zu,FrontSide:()=>f,Frustum:()=>zs,GLBufferAttribute:()=>Od,GLSL1:()=>On,GLSL3:()=>Nn,GammaEncoding:()=>Kt,GreaterDepth:()=>Y,GreaterEqualDepth:()=>q,GreaterEqualStencilFunc:()=>Mn,GreaterStencilFunc:()=>wn,GridHelper:()=>rp,Group:()=>Xo,HalfFloatType:()=>Le,HemisphereLight:()=>vu,HemisphereLightHelper:()=>ip,HemisphereLightProbe:()=>Qu,IcosahedronBufferGeometry:()=>Zc,IcosahedronGeometry:()=>Zc,ImageBitmapLoader:()=>Wu,ImageLoader:()=>Gh,ImageUtils:()=>Kn,ImmediateRenderObject:()=>Wd,IncrementStencilOp:()=>dn,IncrementWrapStencilOp:()=>fn,InstancedBufferAttribute:()=>ku,InstancedBufferGeometry:()=>Uu,InstancedInterleavedBuffer:()=>Dd,InstancedMesh:()=>Vl,Int16Attribute:()=>ff,Int16BufferAttribute:()=>Vr,Int32Attribute:()=>gf,Int32BufferAttribute:()=>Gr,Int8Attribute:()=>uf,Int8BufferAttribute:()=>Ur,IntType:()=>Re,InterleavedBuffer:()=>rl,InterleavedBufferAttribute:()=>al,Interpolant:()=>wh,InterpolateDiscrete:()=>kt,InterpolateLinear:()=>Ht,InterpolateSmooth:()=>Vt,InvertStencilOp:()=>gn,JSONLoader:()=>Rf,KeepStencilOp:()=>hn,KeyframeTrack:()=>Sh,LOD:()=>Sl,LatheBufferGeometry:()=>$c,LatheGeometry:()=>$c,Layers:()=>Zi,LensFlare:()=>Pf,LessDepth:()=>G,LessEqualDepth:()=>j,LessEqualStencilFunc:()=>bn,LessStencilFunc:()=>_n,Light:()=>gu,LightProbe:()=>Nu,Line:()=>Xl,Line3:()=>jd,LineBasicMaterial:()=>Fl,LineCurve:()=>ou,LineCurve3:()=>lu,LineDashedMaterial:()=>_h,LineLoop:()=>Kl,LinePieces:()=>$p,LineSegments:()=>Jl,LineStrip:()=>Zp,LinearEncoding:()=>$t,LinearFilter:()=>ye,LinearInterpolant:()=>Mh,LinearMipMapLinearFilter:()=>Me,LinearMipMapNearestFilter:()=>we,LinearMipmapLinearFilter:()=>xe,LinearMipmapNearestFilter:()=>be,LinearToneMapping:()=>Q,Loader:()=>Uh,LoaderUtils:()=>zu,LoadingManager:()=>Bh,LogLuvEncoding:()=>en,LoopOnce:()=>Bt,LoopPingPong:()=>Ut,LoopRepeat:()=>zt,LuminanceAlphaFormat:()=>He,LuminanceFormat:()=>ke,MOUSE:()=>r,Material:()=>Tr,MaterialLoader:()=>Bu,Math:()=>Xn,MathUtils:()=>Xn,Matrix3:()=>$n,Matrix4:()=>Ui,MaxEquation:()=>C,Mesh:()=>xs,MeshBasicMaterial:()=>Or,MeshDepthMaterial:()=>Vo,MeshDistanceMaterial:()=>Fo,MeshFaceMaterial:()=>ef,MeshLambertMaterial:()=>gh,MeshMatcapMaterial:()=>vh,MeshNormalMaterial:()=>mh,MeshPhongMaterial:()=>ph,MeshPhysicalMaterial:()=>dh,MeshStandardMaterial:()=>uh,MeshToonMaterial:()=>fh,MinEquation:()=>R,MirroredRepeatWrapping:()=>pe,MixOperation:()=>$,MultiMaterial:()=>tf,MultiplyBlending:()=>M,MultiplyOperation:()=>Z,NearestFilter:()=>fe,NearestMipMapLinearFilter:()=>_e,NearestMipMapNearestFilter:()=>ge,NearestMipmapLinearFilter:()=>ve,NearestMipmapNearestFilter:()=>me,NeverDepth:()=>V,NeverStencilFunc:()=>vn,NoBlending:()=>y,NoColors:()=>Jp,NoToneMapping:()=>K,NormalAnimationBlendMode:()=>Wt,NormalBlending:()=>b,NotEqualDepth:()=>X,NotEqualStencilFunc:()=>xn,NumberKeyframeTrack:()=>Rh,Object3D:()=>cr,ObjectLoader:()=>Vu,ObjectSpaceNormalMap:()=>ln,OctahedronBufferGeometry:()=>Jc,OctahedronGeometry:()=>Jc,OneFactor:()=>L,OneMinusDstAlphaFactor:()=>z,OneMinusDstColorFactor:()=>k,OneMinusSrcAlphaFactor:()=>N,OneMinusSrcColorFactor:()=>D,OrthographicCamera:()=>Cu,PCFShadowMap:()=>u,PCFSoftShadowMap:()=>d,PMREMGenerator:()=>Fp,ParametricBufferGeometry:()=>Kc,ParametricGeometry:()=>Kc,Particle:()=>rf,ParticleBasicMaterial:()=>of,ParticleSystem:()=>sf,ParticleSystemMaterial:()=>lf,Path:()=>fu,PerspectiveCamera:()=>Ps,Plane:()=>pr,PlaneBufferGeometry:()=>Hs,PlaneGeometry:()=>Hs,PlaneHelper:()=>vp,PointCloud:()=>nf,PointCloudMaterial:()=>af,PointLight:()=>Ru,PointLightHelper:()=>Qd,Points:()=>rc,PointsMaterial:()=>Ql,PolarGridHelper:()=>sp,PolyhedronBufferGeometry:()=>pc,PolyhedronGeometry:()=>pc,PositionalAudio:()=>gd,PropertyBinding:()=>Rd,PropertyMixer:()=>_d,QuadraticBezierCurve:()=>cu,QuadraticBezierCurve3:()=>hu,Quaternion:()=>ai,QuaternionKeyframeTrack:()=>Ph,QuaternionLinearInterpolant:()=>Ch,REVISION:()=>i,RGBADepthPacking:()=>an,RGBAFormat:()=>Ue,RGBAIntegerFormat:()=>Ze,RGBA_ASTC_10x10_Format:()=>_t,RGBA_ASTC_10x5_Format:()=>mt,RGBA_ASTC_10x6_Format:()=>gt,RGBA_ASTC_10x8_Format:()=>vt,RGBA_ASTC_12x10_Format:()=>yt,RGBA_ASTC_12x12_Format:()=>bt,RGBA_ASTC_4x4_Format:()=>ot,RGBA_ASTC_5x4_Format:()=>lt,RGBA_ASTC_5x5_Format:()=>ct,RGBA_ASTC_6x5_Format:()=>ht,RGBA_ASTC_6x6_Format:()=>ut,RGBA_ASTC_8x5_Format:()=>dt,RGBA_ASTC_8x6_Format:()=>pt,RGBA_ASTC_8x8_Format:()=>ft,RGBA_BPTC_Format:()=>wt,RGBA_ETC2_EAC_Format:()=>at,RGBA_PVRTC_2BPPV1_Format:()=>it,RGBA_PVRTC_4BPPV1_Format:()=>nt,RGBA_S3TC_DXT1_Format:()=>Je,RGBA_S3TC_DXT3_Format:()=>Ke,RGBA_S3TC_DXT5_Format:()=>Qe,RGBDEncoding:()=>rn,RGBEEncoding:()=>Qt,RGBEFormat:()=>Ve,RGBFormat:()=>ze,RGBIntegerFormat:()=>Xe,RGBM16Encoding:()=>nn,RGBM7Encoding:()=>tn,RGB_ETC1_Format:()=>rt,RGB_ETC2_Format:()=>st,RGB_PVRTC_2BPPV1_Format:()=>tt,RGB_PVRTC_4BPPV1_Format:()=>et,RGB_S3TC_DXT1_Format:()=>$e,RGFormat:()=>qe,RGIntegerFormat:()=>Ye,RawShaderMaterial:()=>hh,Ray:()=>zi,Raycaster:()=>Nd,RectAreaLight:()=>Du,RedFormat:()=>je,RedIntegerFormat:()=>We,ReinhardToneMapping:()=>ee,RepeatWrapping:()=>ue,ReplaceStencilOp:()=>un,ReverseSubtractEquation:()=>A,RingBufferGeometry:()=>Qc,RingGeometry:()=>Qc,SRGB8_ALPHA8_ASTC_10x10_Format:()=>Dt,SRGB8_ALPHA8_ASTC_10x5_Format:()=>Pt,SRGB8_ALPHA8_ASTC_10x6_Format:()=>Lt,SRGB8_ALPHA8_ASTC_10x8_Format:()=>It,SRGB8_ALPHA8_ASTC_12x10_Format:()=>Ot,SRGB8_ALPHA8_ASTC_12x12_Format:()=>Nt,SRGB8_ALPHA8_ASTC_4x4_Format:()=>xt,SRGB8_ALPHA8_ASTC_5x4_Format:()=>Mt,SRGB8_ALPHA8_ASTC_5x5_Format:()=>Et,SRGB8_ALPHA8_ASTC_6x5_Format:()=>St,SRGB8_ALPHA8_ASTC_6x6_Format:()=>Tt,SRGB8_ALPHA8_ASTC_8x5_Format:()=>At,SRGB8_ALPHA8_ASTC_8x6_Format:()=>Rt,SRGB8_ALPHA8_ASTC_8x8_Format:()=>Ct,Scene:()=>il,SceneUtils:()=>Cf,ShaderChunk:()=>Vs,ShaderLib:()=>Gs,ShaderMaterial:()=>Rs,ShadowMaterial:()=>ch,Shape:()=>mu,ShapeBufferGeometry:()=>eh,ShapeGeometry:()=>eh,ShapePath:()=>qu,ShapeUtils:()=>jc,ShortType:()=>Te,Skeleton:()=>Bl,SkeletonHelper:()=>Jd,SkinnedMesh:()=>Ll,SmoothShading:()=>_,Sphere:()=>Ci,SphereBufferGeometry:()=>th,SphereGeometry:()=>th,Spherical:()=>Ud,SphericalHarmonics3:()=>Ou,SplineCurve:()=>uu,SpotLight:()=>Mu,SpotLightHelper:()=>Yd,Sprite:()=>wl,SpriteMaterial:()=>ol,SrcAlphaFactor:()=>O,SrcAlphaSaturateFactor:()=>H,SrcColorFactor:()=>I,StaticCopyUsage:()=>Ln,StaticDrawUsage:()=>Sn,StaticReadUsage:()=>Rn,StereoCamera:()=>id,StreamCopyUsage:()=>Dn,StreamDrawUsage:()=>An,StreamReadUsage:()=>Pn,StringKeyframeTrack:()=>Lh,SubtractEquation:()=>T,SubtractiveBlending:()=>x,TOUCH:()=>s,TangentSpaceNormalMap:()=>on,TetrahedronBufferGeometry:()=>nh,TetrahedronGeometry:()=>nh,TextBufferGeometry:()=>ih,TextGeometry:()=>ih,Texture:()=>ei,TextureLoader:()=>qh,TorusBufferGeometry:()=>rh,TorusGeometry:()=>rh,TorusKnotBufferGeometry:()=>sh,TorusKnotGeometry:()=>sh,Triangle:()=>Er,TriangleFanDrawMode:()=>Zt,TriangleStripDrawMode:()=>Xt,TrianglesDrawMode:()=>Yt,TubeBufferGeometry:()=>ah,TubeGeometry:()=>ah,UVMapping:()=>re,Uint16Attribute:()=>mf,Uint16BufferAttribute:()=>Fr,Uint32Attribute:()=>vf,Uint32BufferAttribute:()=>jr,Uint8Attribute:()=>df,Uint8BufferAttribute:()=>kr,Uint8ClampedAttribute:()=>pf,Uint8ClampedBufferAttribute:()=>Hr,Uniform:()=>Id,UniformsLib:()=>Fs,UniformsUtils:()=>As,UnsignedByteType:()=>Ee,UnsignedInt248Type:()=>Ne,UnsignedIntType:()=>Ce,UnsignedShort4444Type:()=>Ie,UnsignedShort5551Type:()=>De,UnsignedShort565Type:()=>Oe,UnsignedShortType:()=>Ae,VSMShadowMap:()=>p,Vector2:()=>Zn,Vector3:()=>oi,Vector4:()=>ni,VectorKeyframeTrack:()=>Ih,Vertex:()=>cf,VertexColors:()=>Qp,VideoTexture:()=>ac,WebGL1Renderer:()=>el,WebGLCubeRenderTarget:()=>Os,WebGLMultipleRenderTargets:()=>ri,WebGLMultisampleRenderTarget:()=>si,WebGLRenderTarget:()=>ii,WebGLRenderTargetCube:()=>Tf,WebGLRenderer:()=>Qo,WebGLUtils:()=>qo,WireframeGeometry:()=>oh,WireframeHelper:()=>Mf,WrapAroundEnding:()=>jt,XHRLoader:()=>Ef,ZeroCurvatureEnding:()=>Ft,ZeroFactor:()=>P,ZeroSlopeEnding:()=>Gt,ZeroStencilOp:()=>cn,sRGBEncoding:()=>Jt});const i="129",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},a=0,o=1,l=2,c=3,h=0,u=1,d=2,p=3,f=0,m=1,g=2,v=1,_=2,y=0,b=1,w=2,x=3,M=4,E=5,S=100,T=101,A=102,R=103,C=104,P=200,L=201,I=202,D=203,O=204,N=205,B=206,z=207,U=208,k=209,H=210,V=0,F=1,G=2,j=3,W=4,q=5,Y=6,X=7,Z=0,$=1,J=2,K=0,Q=1,ee=2,te=3,ne=4,ie=5,re=300,se=301,ae=302,oe=303,le=304,ce=306,he=307,ue=1e3,de=1001,pe=1002,fe=1003,me=1004,ge=1004,ve=1005,_e=1005,ye=1006,be=1007,we=1007,xe=1008,Me=1008,Ee=1009,Se=1010,Te=1011,Ae=1012,Re=1013,Ce=1014,Pe=1015,Le=1016,Ie=1017,De=1018,Oe=1019,Ne=1020,Be=1021,ze=1022,Ue=1023,ke=1024,He=1025,Ve=Ue,Fe=1026,Ge=1027,je=1028,We=1029,qe=1030,Ye=1031,Xe=1032,Ze=1033,$e=33776,Je=33777,Ke=33778,Qe=33779,et=35840,tt=35841,nt=35842,it=35843,rt=36196,st=37492,at=37496,ot=37808,lt=37809,ct=37810,ht=37811,ut=37812,dt=37813,pt=37814,ft=37815,mt=37816,gt=37817,vt=37818,_t=37819,yt=37820,bt=37821,wt=36492,xt=37840,Mt=37841,Et=37842,St=37843,Tt=37844,At=37845,Rt=37846,Ct=37847,Pt=37848,Lt=37849,It=37850,Dt=37851,Ot=37852,Nt=37853,Bt=2200,zt=2201,Ut=2202,kt=2300,Ht=2301,Vt=2302,Ft=2400,Gt=2401,jt=2402,Wt=2500,qt=2501,Yt=0,Xt=1,Zt=2,$t=3e3,Jt=3001,Kt=3007,Qt=3002,en=3003,tn=3004,nn=3005,rn=3006,sn=3200,an=3201,on=0,ln=1,cn=0,hn=7680,un=7681,dn=7682,pn=7683,fn=34055,mn=34056,gn=5386,vn=512,_n=513,yn=514,bn=515,wn=516,xn=517,Mn=518,En=519,Sn=35044,Tn=35048,An=35040,Rn=35045,Cn=35049,Pn=35041,Ln=35046,In=35050,Dn=35042,On="100",Nn="300 es";class Bn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const zn=[];for(let e=0;e<256;e++)zn[e]=(e<16?"0":"")+e.toString(16);let Un=1234567;const kn=Math.PI/180,Hn=180/Math.PI;function Vn(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(zn[255&e]+zn[e>>8&255]+zn[e>>16&255]+zn[e>>24&255]+"-"+zn[255&t]+zn[t>>8&255]+"-"+zn[t>>16&15|64]+zn[t>>24&255]+"-"+zn[63&n|128]+zn[n>>8&255]+"-"+zn[n>>16&255]+zn[n>>24&255]+zn[255&i]+zn[i>>8&255]+zn[i>>16&255]+zn[i>>24&255]).toUpperCase()}function Fn(e,t,n){return Math.max(t,Math.min(n,e))}function Gn(e,t){return(e%t+t)%t}function jn(e,t,n){return(1-n)*e+n*t}function Wn(e){return 0==(e&e-1)&&0!==e}function qn(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Yn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Xn=Object.freeze({__proto__:null,DEG2RAD:kn,RAD2DEG:Hn,generateUUID:Vn,clamp:Fn,euclideanModulo:Gn,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:jn,damp:function(e,t,n,i){return jn(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(Gn(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Un=e%2147483647),Un=16807*Un%2147483647,(Un-1)/2147483646},degToRad:function(e){return e*kn},radToDeg:function(e){return e*Hn},isPowerOfTwo:Wn,ceilPowerOfTwo:qn,floorPowerOfTwo:Yn,setQuaternionFromProperEuler:function(e,t,n,i,r){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),c=s((t+i)/2),h=a((t+i)/2),u=s((t-i)/2),d=a((t-i)/2),p=s((i-t)/2),f=a((i-t)/2);switch(r){case"XYX":e.set(o*h,l*u,l*d,o*c);break;case"YZY":e.set(l*d,o*h,l*u,o*c);break;case"ZXZ":e.set(l*u,l*d,o*h,o*c);break;case"XZX":e.set(o*h,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*h,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}});class Zn{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Zn.prototype.isVector2=!0;class $n{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,s,a,o,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=a,c[3]=t,c[4]=r,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],h=n[7],u=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],_=i[4],y=i[7],b=i[2],w=i[5],x=i[8];return r[0]=s*f+a*v+o*b,r[3]=s*m+a*_+o*w,r[6]=s*g+a*y+o*x,r[1]=l*f+c*v+h*b,r[4]=l*m+c*_+h*w,r[7]=l*g+c*y+h*x,r[2]=u*f+d*v+p*b,r[5]=u*m+d*_+p*w,r[8]=u*g+d*y+p*x,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-n*r*c+n*a*o+i*r*l-i*s*o}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=c*s-a*l,u=a*o-c*r,d=l*r-s*o,p=t*h+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=h*f,e[1]=(i*l-c*n)*f,e[2]=(a*n-i*s)*f,e[3]=u*f,e[4]=(c*t-i*o)*f,e[5]=(i*r-a*t)*f,e[6]=d*f,e[7]=(n*o-l*t)*f,e[8]=(s*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+e,-i*l,i*o,-i*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],s=i[3],a=i[6],o=i[1],l=i[4],c=i[7];return i[0]=t*r+n*o,i[3]=t*s+n*l,i[6]=t*a+n*c,i[1]=-n*r+t*o,i[4]=-n*s+t*l,i[7]=-n*a+t*c,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let Jn;$n.prototype.isMatrix3=!0;class Kn{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Jn&&(Jn=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Jn.width=e.width,Jn.height=e.height;const n=Jn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Jn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let Qn=0;class ei extends Bn{constructor(e=ei.DEFAULT_IMAGE,t=ei.DEFAULT_MAPPING,n=de,i=de,r=ye,s=xe,a=Ue,o=Ee,l=1,c=$t){super(),Object.defineProperty(this,"id",{value:Qn++}),this.uuid=Vn(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Zn(0,0),this.repeat=new Zn(1,1),this.center=new Zn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new $n,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=Vn()),!t&&void 0===e.images[i.uuid]){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(ti(i[e].image)):t.push(ti(i[e]))}else t=ti(i);e.images[i.uuid]={uuid:i.uuid,url:t}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==re)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ue:e.x=e.x-Math.floor(e.x);break;case de:e.x=e.x<0?0:1;break;case pe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ue:e.y=e.y-Math.floor(e.y);break;case de:e.y=e.y<0?0:1;break;case pe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function ti(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Kn.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}ei.DEFAULT_IMAGE=void 0,ei.DEFAULT_MAPPING=re,ei.prototype.isTexture=!0;class ni{constructor(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const s=.01,a=.1,o=e.elements,l=o[0],c=o[4],h=o[8],u=o[1],d=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(c-u)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+u)<a&&Math.abs(h+f)<a&&Math.abs(p+m)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,v=(g+1)/2,_=(c+u)/4,y=(h+f)/4,b=(p+m)/4;return e>o&&e>v?e<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=_/n,r=y/n):o>v?o<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=_/i,r=b/i):v<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=y/r,i=b/r),this.set(n,i,r,t),this}let v=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(u-c)*(u-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(h-f)/v,this.z=(u-c)/v,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}ni.prototype.isVector4=!0;class ii extends Bn{constructor(e,t,n){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new ni(0,0,e,t),this.scissorTest=!1,this.viewport=new ni(0,0,e,t),n=n||{},this.texture=new ei(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:ye,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}ii.prototype.isWebGLRenderTarget=!0;class ri extends ii{constructor(e,t,n){super(e,t);const i=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=i.clone()}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}ri.prototype.isWebGLMultipleRenderTargets=!0;class si extends ii{constructor(e,t,n){super(e,t,n),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}si.prototype.isWebGLMultisampleRenderTarget=!0;class ai{constructor(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,r,s,a){let o=n[i+0],l=n[i+1],c=n[i+2],h=n[i+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===a)return e[t+0]=u,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(h!==f||o!==u||l!==d||c!==p){let e=1-a;const t=o*u+l*d+c*p+h*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,t*n);e=Math.sin(e*s)/r,a=Math.sin(a*s)/r}const r=a*n;if(o=o*e+u*r,l=l*e+d*r,c=c*e+p*r,h=h*e+f*r,e===1-a){const e=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=e,l*=e,c*=e,h*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,i,r,s){const a=n[i],o=n[i+1],l=n[i+2],c=n[i+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return e[t]=a*p+c*h+o*d-l*u,e[t+1]=o*p+c*u+l*h-a*d,e[t+2]=l*p+c*d+a*u-o*h,e[t+3]=c*p-a*h-o*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,i=e._y,r=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(i/2),h=a(r/2),u=o(n/2),d=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],h=t[10],u=n+a+h;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(s-i)*e}else if(n>a&&n>h){const e=2*Math.sqrt(1+n-a-h);this._w=(c-o)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(r+l)/e}else if(a>h){const e=2*Math.sqrt(1+a-n-h);this._w=(r-l)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+h-n-a);this._w=(s-i)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Fn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+s*a+i*l-r*o,this._y=i*c+s*o+r*a-n*l,this._z=r*c+s*l+n*o-i*a,this._w=s*c-n*a-i*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,s=this._w;let a=s*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=s*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ai.prototype.isQuaternion=!0;class oi{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ci.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(ci.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*i-a*n,c=o*n+a*t-r*i,h=o*i+r*n-s*t,u=-r*t-s*n-a*i;return this.x=l*o+u*-r+c*-a-h*-s,this.y=c*o+u*-s+h*-r-l*-a,this.z=h*o+u*-a+l*-s-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return li.copy(this).projectOnVector(e),this.sub(li)}reflect(e){return this.sub(li.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Fn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}oi.prototype.isVector3=!0;const li=new oi,ci=new ai;class hi{constructor(e=new oi(1/0,1/0,1/0),t=new oi(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){const l=e[o],c=e[o+1],h=e[o+2];l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>s&&(s=c),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,s,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){const l=e.getX(o),c=e.getY(o),h=e.getZ(o);l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>s&&(s=c),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=di.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new oi),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new oi),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),pi.copy(t.boundingBox),pi.applyMatrix4(e.matrixWorld),this.union(pi));const n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new oi),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,di),di.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(bi),wi.subVectors(this.max,bi),fi.subVectors(e.a,bi),mi.subVectors(e.b,bi),gi.subVectors(e.c,bi),vi.subVectors(mi,fi),_i.subVectors(gi,mi),yi.subVectors(fi,gi);let t=[0,-vi.z,vi.y,0,-_i.z,_i.y,0,-yi.z,yi.y,vi.z,0,-vi.x,_i.z,0,-_i.x,yi.z,0,-yi.x,-vi.y,vi.x,0,-_i.y,_i.x,0,-yi.y,yi.x,0];return!!Ei(t,fi,mi,gi,wi)&&(t=[1,0,0,0,1,0,0,0,1],!!Ei(t,fi,mi,gi,wi)&&(xi.crossVectors(vi,_i),t=[xi.x,xi.y,xi.z],Ei(t,fi,mi,gi,wi)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new oi),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return di.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(di).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(ui[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ui[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ui[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ui[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ui[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ui[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ui[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ui[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ui)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}hi.prototype.isBox3=!0;const ui=[new oi,new oi,new oi,new oi,new oi,new oi,new oi,new oi],di=new oi,pi=new hi,fi=new oi,mi=new oi,gi=new oi,vi=new oi,_i=new oi,yi=new oi,bi=new oi,wi=new oi,xi=new oi,Mi=new oi;function Ei(e,t,n,i,r){for(let s=0,a=e.length-3;s<=a;s+=3){Mi.fromArray(e,s);const a=r.x*Math.abs(Mi.x)+r.y*Math.abs(Mi.y)+r.z*Math.abs(Mi.z),o=t.dot(Mi),l=n.dot(Mi),c=i.dot(Mi);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const Si=new hi,Ti=new oi,Ai=new oi,Ri=new oi;class Ci{constructor(e=new oi,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Si.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new oi),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new hi),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Ri.subVectors(e,this.center);const t=Ri.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(Ri.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return Ai.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Ti.copy(e.center).add(Ai)),this.expandByPoint(Ti.copy(e.center).sub(Ai)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Pi=new oi,Li=new oi,Ii=new oi,Di=new oi,Oi=new oi,Ni=new oi,Bi=new oi;class zi{constructor(e=new oi,t=new oi(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new oi),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Pi)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new oi),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Pi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Pi.copy(this.direction).multiplyScalar(t).add(this.origin),Pi.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Li.copy(e).add(t).multiplyScalar(.5),Ii.copy(t).sub(e).normalize(),Di.copy(this.origin).sub(Li);const r=.5*e.distanceTo(t),s=-this.direction.dot(Ii),a=Di.dot(this.direction),o=-Di.dot(Ii),l=Di.lengthSq(),c=Math.abs(1-s*s);let h,u,d,p;if(c>0)if(h=s*o-a,u=s*a-o,p=r*c,h>=0)if(u>=-p)if(u<=p){const e=1/c;h*=e,u*=e,d=h*(h+s*u+2*a)+u*(s*h+u+2*o)+l}else u=r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u=-r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u<=-p?(h=Math.max(0,-(-s*r+a)),u=h>0?-r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+l):(h=Math.max(0,-(s*r+a)),u=h>0?r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;return n&&n.copy(this.direction).multiplyScalar(h).add(this.origin),i&&i.copy(Ii).multiplyScalar(u).add(Li),d}intersectSphere(e,t){Pi.subVectors(e.center,this.origin);const n=Pi.dot(this.direction),i=Pi.dot(Pi)-n*n,r=e.radius*e.radius;if(i>r)return null;const s=Math.sqrt(r-i),a=n-s,o=n+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(n=(e.min.x-u.x)*l,i=(e.max.x-u.x)*l):(n=(e.max.x-u.x)*l,i=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,s=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,s=(e.min.y-u.y)*c),n>s||r>i?null:((r>n||n!=n)&&(n=r),(s<i||i!=i)&&(i=s),h>=0?(a=(e.min.z-u.z)*h,o=(e.max.z-u.z)*h):(a=(e.max.z-u.z)*h,o=(e.min.z-u.z)*h),n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Pi)}intersectTriangle(e,t,n,i,r){Oi.subVectors(t,e),Ni.subVectors(n,e),Bi.crossVectors(Oi,Ni);let s,a=this.direction.dot(Bi);if(a>0){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}Di.subVectors(this.origin,e);const o=s*this.direction.dot(Ni.crossVectors(Di,Ni));if(o<0)return null;const l=s*this.direction.dot(Oi.cross(Di));if(l<0)return null;if(o+l>a)return null;const c=-s*Di.dot(Bi);return c<0?null:this.at(c/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ui{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,s,a,o,l,c,h,u,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ui).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/ki.setFromMatrixColumn(e,0).length(),r=1/ki.setFromMatrixColumn(e,1).length(),s=1/ki.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){const e=s*c,n=s*h,i=a*c,r=a*h;t[0]=o*c,t[4]=-o*h,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*o,t[2]=r-e*l,t[6]=i+n*l,t[10]=s*o}else if("YXZ"===e.order){const e=o*c,n=o*h,i=l*c,r=l*h;t[0]=e+r*a,t[4]=i*a-n,t[8]=s*l,t[1]=s*h,t[5]=s*c,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=s*o}else if("ZXY"===e.order){const e=o*c,n=o*h,i=l*c,r=l*h;t[0]=e-r*a,t[4]=-s*h,t[8]=i+n*a,t[1]=n+i*a,t[5]=s*c,t[9]=r-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){const e=s*c,n=s*h,i=a*c,r=a*h;t[0]=o*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=o*h,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){const e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=r-e*h,t[8]=i*h+n,t[1]=h,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*h+i,t[10]=e-r*h}else if("XZY"===e.order){const e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=-h,t[8]=l*c,t[1]=e*h+r,t[5]=s*c,t[9]=n*h-i,t[2]=i*h-n,t[6]=a*c,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Vi,e,Fi)}lookAt(e,t,n){const i=this.elements;return Wi.subVectors(e,t),0===Wi.lengthSq()&&(Wi.z=1),Wi.normalize(),Gi.crossVectors(n,Wi),0===Gi.lengthSq()&&(1===Math.abs(n.z)?Wi.x+=1e-4:Wi.z+=1e-4,Wi.normalize(),Gi.crossVectors(n,Wi)),Gi.normalize(),ji.crossVectors(Wi,Gi),i[0]=Gi.x,i[4]=ji.x,i[8]=Wi.x,i[1]=Gi.y,i[5]=ji.y,i[9]=Wi.y,i[2]=Gi.z,i[6]=ji.z,i[10]=Wi.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],h=n[5],u=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],_=n[7],y=n[11],b=n[15],w=i[0],x=i[4],M=i[8],E=i[12],S=i[1],T=i[5],A=i[9],R=i[13],C=i[2],P=i[6],L=i[10],I=i[14],D=i[3],O=i[7],N=i[11],B=i[15];return r[0]=s*w+a*S+o*C+l*D,r[4]=s*x+a*T+o*P+l*O,r[8]=s*M+a*A+o*L+l*N,r[12]=s*E+a*R+o*I+l*B,r[1]=c*w+h*S+u*C+d*D,r[5]=c*x+h*T+u*P+d*O,r[9]=c*M+h*A+u*L+d*N,r[13]=c*E+h*R+u*I+d*B,r[2]=p*w+f*S+m*C+g*D,r[6]=p*x+f*T+m*P+g*O,r[10]=p*M+f*A+m*L+g*N,r[14]=p*E+f*R+m*I+g*B,r[3]=v*w+_*S+y*C+b*D,r[7]=v*x+_*T+y*P+b*O,r[11]=v*M+_*A+y*L+b*N,r[15]=v*E+_*R+y*I+b*B,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+r*o*h-i*l*h-r*a*u+n*l*u+i*a*d-n*o*d)+e[7]*(+t*o*d-t*l*u+r*s*u-i*s*d+i*l*c-r*o*c)+e[11]*(+t*l*h-t*a*d-r*s*h+n*s*d+r*a*c-n*l*c)+e[15]*(-i*a*c-t*o*h+t*a*u+i*s*h-n*s*u+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=h*m*l-f*u*l+f*o*d-a*m*d-h*o*g+a*u*g,_=p*u*l-c*m*l-p*o*d+s*m*d+c*o*g-s*u*g,y=c*f*l-p*h*l+p*a*d-s*f*d-c*a*g+s*h*g,b=p*h*o-c*f*o-p*a*u+s*f*u+c*a*m-s*h*m,w=t*v+n*_+i*y+r*b;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const x=1/w;return e[0]=v*x,e[1]=(f*u*r-h*m*r-f*i*d+n*m*d+h*i*g-n*u*g)*x,e[2]=(a*m*r-f*o*r+f*i*l-n*m*l-a*i*g+n*o*g)*x,e[3]=(h*o*r-a*u*r-h*i*l+n*u*l+a*i*d-n*o*d)*x,e[4]=_*x,e[5]=(c*m*r-p*u*r+p*i*d-t*m*d-c*i*g+t*u*g)*x,e[6]=(p*o*r-s*m*r-p*i*l+t*m*l+s*i*g-t*o*g)*x,e[7]=(s*u*r-c*o*r+c*i*l-t*u*l-s*i*d+t*o*d)*x,e[8]=y*x,e[9]=(p*h*r-c*f*r-p*n*d+t*f*d+c*n*g-t*h*g)*x,e[10]=(s*f*r-p*a*r+p*n*l-t*f*l-s*n*g+t*a*g)*x,e[11]=(c*a*r-s*h*r-c*n*l+t*h*l+s*n*d-t*a*d)*x,e[12]=b*x,e[13]=(c*f*i-p*h*i+p*n*u-t*f*u-c*n*m+t*h*m)*x,e[14]=(p*a*i-s*f*i-p*n*o+t*f*o+s*n*m-t*a*m)*x,e[15]=(s*h*i-c*a*i+c*n*o-t*h*o-s*n*u+t*a*u)*x,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,a=e.y,o=e.z,l=r*s,c=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,c*a+n,c*o-i*s,0,l*o-i*a,c*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,s=t._y,a=t._z,o=t._w,l=r+r,c=s+s,h=a+a,u=r*l,d=r*c,p=r*h,f=s*c,m=s*h,g=a*h,v=o*l,_=o*c,y=o*h,b=n.x,w=n.y,x=n.z;return i[0]=(1-(f+g))*b,i[1]=(d+y)*b,i[2]=(p-_)*b,i[3]=0,i[4]=(d-y)*w,i[5]=(1-(u+g))*w,i[6]=(m+v)*w,i[7]=0,i[8]=(p+_)*x,i[9]=(m-v)*x,i[10]=(1-(u+f))*x,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=ki.set(i[0],i[1],i[2]).length();const s=ki.set(i[4],i[5],i[6]).length(),a=ki.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Hi.copy(this);const o=1/r,l=1/s,c=1/a;return Hi.elements[0]*=o,Hi.elements[1]*=o,Hi.elements[2]*=o,Hi.elements[4]*=l,Hi.elements[5]*=l,Hi.elements[6]*=l,Hi.elements[8]*=c,Hi.elements[9]*=c,Hi.elements[10]*=c,t.setFromRotationMatrix(Hi),n.x=r,n.y=s,n.z=a,this}makePerspective(e,t,n,i,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,o=2*r/(t-e),l=2*r/(n-i),c=(t+e)/(t-e),h=(n+i)/(n-i),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,s){const a=this.elements,o=1/(t-e),l=1/(n-i),c=1/(s-r),h=(t+e)*o,u=(n+i)*l,d=(s+r)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}Ui.prototype.isMatrix4=!0;const ki=new oi,Hi=new Ui,Vi=new oi(0,0,0),Fi=new oi(1,1,1),Gi=new oi,ji=new oi,Wi=new oi,qi=new Ui,Yi=new ai;class Xi{constructor(e=0,t=0,n=0,i=Xi.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,n){const i=e.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],c=i[9],h=i[2],u=i[6],d=i[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(Fn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Fn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(Fn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Fn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Fn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Fn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return qi.makeRotationFromQuaternion(e),this.setFromRotationMatrix(qi,t,n)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return Yi.setFromEuler(this),this.setFromQuaternion(Yi,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new oi(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Xi.prototype.isEuler=!0,Xi.DefaultOrder="XYZ",Xi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Zi{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let $i=0;const Ji=new oi,Ki=new ai,Qi=new Ui,er=new oi,tr=new oi,nr=new oi,ir=new ai,rr=new oi(1,0,0),sr=new oi(0,1,0),ar=new oi(0,0,1),or={type:"added"},lr={type:"removed"};class cr extends Bn{constructor(){super(),Object.defineProperty(this,"id",{value:$i++}),this.uuid=Vn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=cr.DefaultUp.clone();const e=new oi,t=new Xi,n=new ai,i=new oi(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ui},normalMatrix:{value:new $n}}),this.matrix=new Ui,this.matrixWorld=new Ui,this.matrixAutoUpdate=cr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Zi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ki.setFromAxisAngle(e,t),this.quaternion.multiply(Ki),this}rotateOnWorldAxis(e,t){return Ki.setFromAxisAngle(e,t),this.quaternion.premultiply(Ki),this}rotateX(e){return this.rotateOnAxis(rr,e)}rotateY(e){return this.rotateOnAxis(sr,e)}rotateZ(e){return this.rotateOnAxis(ar,e)}translateOnAxis(e,t){return Ji.copy(e).applyQuaternion(this.quaternion),this.position.add(Ji.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(rr,e)}translateY(e){return this.translateOnAxis(sr,e)}translateZ(e){return this.translateOnAxis(ar,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Qi.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?er.copy(e):er.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),tr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Qi.lookAt(tr,er,this.up):Qi.lookAt(er,tr,this.up),this.quaternion.setFromRotationMatrix(Qi),i&&(Qi.extractRotation(i.matrixWorld),Ki.setFromRotationMatrix(Qi),this.quaternion.premultiply(Ki.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(or)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(lr)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(lr)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Qi.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Qi.multiply(e.parent.matrixWorld)),e.applyMatrix4(Qi),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getWorldPosition(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new oi),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new ai),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tr,e,nr),e}getWorldScale(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new oi),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tr,ir,e),e}getWorldDirection(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new oi),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=s(e.geometries),i=s(e.materials),r=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),c=s(e.animations);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=i,n;function s(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}cr.DefaultUp=new oi(0,1,0),cr.DefaultMatrixAutoUpdate=!0,cr.prototype.isObject3D=!0;const hr=new oi,ur=new oi,dr=new $n;class pr{constructor(e=new oi(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=hr.subVectors(n,t).cross(ur.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new oi),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new oi);const n=e.delta(hr),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new oi),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||dr.getNormalMatrix(e),i=this.coplanarPoint(hr).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}pr.prototype.isPlane=!0;const fr=new oi,mr=new oi,gr=new oi,vr=new oi,_r=new oi,yr=new oi,br=new oi,wr=new oi,xr=new oi,Mr=new oi;class Er{constructor(e=new oi,t=new oi,n=new oi){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new oi),i.subVectors(n,t),fr.subVectors(e,t),i.cross(fr);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){fr.subVectors(i,t),mr.subVectors(n,t),gr.subVectors(e,t);const s=fr.dot(fr),a=fr.dot(mr),o=fr.dot(gr),l=mr.dot(mr),c=mr.dot(gr),h=s*l-a*a;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new oi),0===h)return r.set(-2,-1,-1);const u=1/h,d=(l*o-a*c)*u,p=(s*c-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,vr),vr.x>=0&&vr.y>=0&&vr.x+vr.y<=1}static getUV(e,t,n,i,r,s,a,o){return this.getBarycoord(e,t,n,i,vr),o.set(0,0),o.addScaledVector(r,vr.x),o.addScaledVector(s,vr.y),o.addScaledVector(a,vr.z),o}static isFrontFacing(e,t,n,i){return fr.subVectors(n,t),mr.subVectors(e,t),fr.cross(mr).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return fr.subVectors(this.c,this.b),mr.subVectors(this.a,this.b),.5*fr.cross(mr).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new oi),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Er.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new pr),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Er.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return Er.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Er.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Er.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new oi);const n=this.a,i=this.b,r=this.c;let s,a;_r.subVectors(i,n),yr.subVectors(r,n),wr.subVectors(e,n);const o=_r.dot(wr),l=yr.dot(wr);if(o<=0&&l<=0)return t.copy(n);xr.subVectors(e,i);const c=_r.dot(xr),h=yr.dot(xr);if(c>=0&&h<=c)return t.copy(i);const u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(n).addScaledVector(_r,s);Mr.subVectors(e,r);const d=_r.dot(Mr),p=yr.dot(Mr);if(p>=0&&d<=p)return t.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(n).addScaledVector(yr,a);const m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return br.subVectors(r,i),a=(h-c)/(h-c+(d-p)),t.copy(i).addScaledVector(br,a);const g=1/(m+f+u);return s=f*g,a=u*g,t.copy(n).addScaledVector(_r,s).addScaledVector(yr,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Sr=0;class Tr extends Bn{constructor(){super(),Object.defineProperty(this,"id",{value:Sr++}),this.uuid=Vn(),this.name="",this.type="Material",this.fog=!0,this.blending=b,this.side=f,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=O,this.blendDst=N,this.blendEquation=S,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=j,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=En,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hn,this.stencilZFail=hn,this.stencilZPass=hn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===v;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==b&&(n.blending=this.blending),this.side!==f&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}Tr.prototype.isMaterial=!0;const Ar={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Rr={h:0,s:0,l:0},Cr={h:0,s:0,l:0};function Pr(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Lr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ir(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Dr{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Gn(e,1),t=Fn(t,0,1),n=Fn(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Pr(r,i,e+1/3),this.g=Pr(r,i,e),this.b=Pr(r,i,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const i=n[1],r=n[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const n=parseFloat(e[1])/360,i=parseInt(e[2],10)/100,r=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,i,r)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Ar[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Lr(e.r),this.g=Lr(e.g),this.b=Lr(e.b),this}copyLinearToSRGB(e){return this.r=Ir(e.r),this.g=Ir(e.g),this.b=Ir(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,n=this.g,i=this.b,r=Math.max(t,n,i),s=Math.min(t,n,i);let a,o;const l=(s+r)/2;if(s===r)a=0,o=0;else{const e=r-s;switch(o=l<=.5?e/(r+s):e/(2-r-s),r){case t:a=(n-i)/e+(n<i?6:0);break;case n:a=(i-t)/e+2;break;case i:a=(t-n)/e+4}a/=6}return e.h=a,e.s=o,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(Rr),Rr.h+=e,Rr.s+=t,Rr.l+=n,this.setHSL(Rr.h,Rr.s,Rr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Rr),e.getHSL(Cr);const n=jn(Rr.h,Cr.h,t),i=jn(Rr.s,Cr.s,t),r=jn(Rr.l,Cr.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Dr.NAMES=Ar,Dr.prototype.isColor=!0,Dr.prototype.r=1,Dr.prototype.g=1,Dr.prototype.b=1;class Or extends Tr{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Dr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this}}Or.prototype.isMeshBasicMaterial=!0;const Nr=new oi,Br=new Zn;class zr{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=Sn,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new Dr),t[n++]=r.r,t[n++]=r.g,t[n++]=r.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new Zn),t[n++]=r.x,t[n++]=r.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new oi),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new ni),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z,t[n++]=r.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Br.fromBufferAttribute(this,t),Br.applyMatrix3(e),this.setXY(t,Br.x,Br.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Nr.fromBufferAttribute(this,t),Nr.applyMatrix3(e),this.setXYZ(t,Nr.x,Nr.y,Nr.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Nr.x=this.getX(t),Nr.y=this.getY(t),Nr.z=this.getZ(t),Nr.applyMatrix4(e),this.setXYZ(t,Nr.x,Nr.y,Nr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Nr.x=this.getX(t),Nr.y=this.getY(t),Nr.z=this.getZ(t),Nr.applyNormalMatrix(e),this.setXYZ(t,Nr.x,Nr.y,Nr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Nr.x=this.getX(t),Nr.y=this.getY(t),Nr.z=this.getZ(t),Nr.transformDirection(e),this.setXYZ(t,Nr.x,Nr.y,Nr.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Sn&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}zr.prototype.isBufferAttribute=!0;class Ur extends zr{constructor(e,t,n){super(new Int8Array(e),t,n)}}class kr extends zr{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class Hr extends zr{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Vr extends zr{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Fr extends zr{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Gr extends zr{constructor(e,t,n){super(new Int32Array(e),t,n)}}class jr extends zr{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Wr extends zr{constructor(e,t,n){super(new Uint16Array(e),t,n)}}Wr.prototype.isFloat16BufferAttribute=!0;class qr extends zr{constructor(e,t,n){super(new Float32Array(e),t,n)}}class Yr extends zr{constructor(e,t,n){super(new Float64Array(e),t,n)}}function Xr(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}const Zr={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function $r(e,t){return new Zr[e](t)}let Jr=0;const Kr=new Ui,Qr=new cr,es=new oi,ts=new hi,ns=new hi,is=new oi;class rs extends Bn{constructor(){super(),Object.defineProperty(this,"id",{value:Jr++}),this.uuid=Vn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Xr(e)>65535?jr:Fr)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new $n).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Kr.makeRotationFromQuaternion(e),this.applyMatrix4(Kr),this}rotateX(e){return Kr.makeRotationX(e),this.applyMatrix4(Kr),this}rotateY(e){return Kr.makeRotationY(e),this.applyMatrix4(Kr),this}rotateZ(e){return Kr.makeRotationZ(e),this.applyMatrix4(Kr),this}translate(e,t,n){return Kr.makeTranslation(e,t,n),this.applyMatrix4(Kr),this}scale(e,t,n){return Kr.makeScale(e,t,n),this.applyMatrix4(Kr),this}lookAt(e){return Qr.lookAt(e),Qr.updateMatrix(),this.applyMatrix4(Qr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(es).negate(),this.translate(es.x,es.y,es.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new qr(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new hi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new oi(-1/0,-1/0,-1/0),new oi(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];ts.setFromBufferAttribute(n),this.morphTargetsRelative?(is.addVectors(this.boundingBox.min,ts.min),this.boundingBox.expandByPoint(is),is.addVectors(this.boundingBox.max,ts.max),this.boundingBox.expandByPoint(is)):(this.boundingBox.expandByPoint(ts.min),this.boundingBox.expandByPoint(ts.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ci);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new oi,1/0);if(e){const n=this.boundingSphere.center;if(ts.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];ns.setFromBufferAttribute(n),this.morphTargetsRelative?(is.addVectors(ts.min,ns.min),ts.expandByPoint(is),is.addVectors(ts.max,ns.max),ts.expandByPoint(is)):(ts.expandByPoint(ns.min),ts.expandByPoint(ns.max))}ts.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)is.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(is));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],a=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)is.fromBufferAttribute(s,t),a&&(es.fromBufferAttribute(e,t),is.add(es)),i=Math.max(i,n.distanceToSquared(is))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,s=t.uv.array,a=i.length/3;void 0===t.tangent&&this.setAttribute("tangent",new zr(new Float32Array(4*a),4));const o=t.tangent.array,l=[],c=[];for(let e=0;e<a;e++)l[e]=new oi,c[e]=new oi;const h=new oi,u=new oi,d=new oi,p=new Zn,f=new Zn,m=new Zn,g=new oi,v=new oi;function _(e,t,n){h.fromArray(i,3*e),u.fromArray(i,3*t),d.fromArray(i,3*n),p.fromArray(s,2*e),f.fromArray(s,2*t),m.fromArray(s,2*n),u.sub(h),d.sub(h),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(v),c[t].add(v),c[n].add(v))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)_(n[e+0],n[e+1],n[e+2])}const b=new oi,w=new oi,x=new oi,M=new oi;function E(e){x.fromArray(r,3*e),M.copy(x);const t=l[e];b.copy(t),b.sub(x.multiplyScalar(x.dot(t))).normalize(),w.crossVectors(M,t);const n=w.dot(c[e])<0?-1:1;o[4*e]=b.x,o[4*e+1]=b.y,o[4*e+2]=b.z,o[4*e+3]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)E(n[e+0]),E(n[e+1]),E(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new zr(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new oi,r=new oi,s=new oi,a=new oi,o=new oi,l=new oi,c=new oi,h=new oi;if(e)for(let u=0,d=e.count;u<d;u+=3){const d=e.getX(u+0),p=e.getX(u+1),f=e.getX(u+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),a.add(c),o.add(c),l.add(c),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===e.attributes[i])continue;const r=n[i].array,s=e.attributes[i],a=s.array,o=s.itemSize*t,l=Math.min(a.length,r.length-o);for(let e=0,t=o;e<l;e++,t++)r[t]=a[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)is.fromBufferAttribute(e,t),is.normalize(),e.setXYZ(t,is.x,is.y,is.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,s=new n.constructor(t.length*i);let a=0,o=0;for(let e=0,r=t.length;e<r;e++){a=t[e]*i;for(let e=0;e<i;e++)s[o++]=n[a++]}return new zr(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new rs,n=this.index.array,i=this.attributes;for(const r in i){const s=e(i[r],n);t.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],a=r[i];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);s.push(i)}t.morphAttributes[i]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,n=s.length;e<n;e++){const n=s[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],s=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];s.push(i.toJSON(e.data))}s.length>0&&(i[t]=s,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new rs).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}rs.prototype.isBufferGeometry=!0;const ss=new Ui,as=new zi,os=new Ci,ls=new oi,cs=new oi,hs=new oi,us=new oi,ds=new oi,ps=new oi,fs=new oi,ms=new oi,gs=new oi,vs=new Zn,_s=new Zn,ys=new Zn,bs=new oi,ws=new oi;class xs extends cr{constructor(e=new rs,t=new Or){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),os.copy(n.boundingSphere),os.applyMatrix4(r),!1===e.ray.intersectsSphere(os))return;if(ss.copy(r).invert(),as.copy(e.ray).applyMatrix4(ss),null!==n.boundingBox&&!1===as.intersectsBox(n.boundingBox))return;let s;if(n.isBufferGeometry){const r=n.index,a=n.attributes.position,o=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,h=n.attributes.uv2,u=n.groups,d=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,p=u.length;n<p;n++){const p=u[n],f=i[p.materialIndex];for(let n=Math.max(p.start,d.start),i=Math.min(p.start+p.count,d.start+d.count);n<i;n+=3){const i=r.getX(n),u=r.getX(n+1),d=r.getX(n+2);s=Ms(this,f,e,as,a,o,l,c,h,i,u,d),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=p.materialIndex,t.push(s))}}else for(let n=Math.max(0,d.start),u=Math.min(r.count,d.start+d.count);n<u;n+=3){const u=r.getX(n),d=r.getX(n+1),p=r.getX(n+2);s=Ms(this,i,e,as,a,o,l,c,h,u,d,p),s&&(s.faceIndex=Math.floor(n/3),t.push(s))}else if(void 0!==a)if(Array.isArray(i))for(let n=0,r=u.length;n<r;n++){const r=u[n],p=i[r.materialIndex];for(let n=Math.max(r.start,d.start),i=Math.min(r.start+r.count,d.start+d.count);n<i;n+=3)s=Ms(this,p,e,as,a,o,l,c,h,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=r.materialIndex,t.push(s))}else for(let n=Math.max(0,d.start),r=Math.min(a.count,d.start+d.count);n<r;n+=3)s=Ms(this,i,e,as,a,o,l,c,h,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),t.push(s))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Ms(e,t,n,i,r,s,a,o,l,c,h,u){ls.fromBufferAttribute(r,c),cs.fromBufferAttribute(r,h),hs.fromBufferAttribute(r,u);const d=e.morphTargetInfluences;if(t.morphTargets&&s&&d){fs.set(0,0,0),ms.set(0,0,0),gs.set(0,0,0);for(let e=0,t=s.length;e<t;e++){const t=d[e],n=s[e];0!==t&&(us.fromBufferAttribute(n,c),ds.fromBufferAttribute(n,h),ps.fromBufferAttribute(n,u),a?(fs.addScaledVector(us,t),ms.addScaledVector(ds,t),gs.addScaledVector(ps,t)):(fs.addScaledVector(us.sub(ls),t),ms.addScaledVector(ds.sub(cs),t),gs.addScaledVector(ps.sub(hs),t)))}ls.add(fs),cs.add(ms),hs.add(gs)}e.isSkinnedMesh&&(e.boneTransform(c,ls),e.boneTransform(h,cs),e.boneTransform(u,hs));const p=function(e,t,n,i,r,s,a,o){let l;if(l=t.side===m?i.intersectTriangle(a,s,r,!0,o):i.intersectTriangle(r,s,a,t.side!==g,o),null===l)return null;ws.copy(o),ws.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(ws);return c<n.near||c>n.far?null:{distance:c,point:ws.clone(),object:e}}(e,t,n,i,ls,cs,hs,bs);if(p){o&&(vs.fromBufferAttribute(o,c),_s.fromBufferAttribute(o,h),ys.fromBufferAttribute(o,u),p.uv=Er.getUV(bs,ls,cs,hs,vs,_s,ys,new Zn)),l&&(vs.fromBufferAttribute(l,c),_s.fromBufferAttribute(l,h),ys.fromBufferAttribute(l,u),p.uv2=Er.getUV(bs,ls,cs,hs,vs,_s,ys,new Zn));const e={a:c,b:h,c:u,normal:new oi,materialIndex:0};Er.getNormal(ls,cs,hs,e.normal),p.face=e}return p}xs.prototype.isMesh=!0;class Es extends rs{constructor(e=1,t=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],h=[];let u=0,d=0;function p(e,t,n,i,r,s,p,f,m,g,v){const _=s/m,y=p/g,b=s/2,w=p/2,x=f/2,M=m+1,E=g+1;let S=0,T=0;const A=new oi;for(let s=0;s<E;s++){const a=s*y-w;for(let o=0;o<M;o++){const u=o*_-b;A[e]=u*i,A[t]=a*r,A[n]=x,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=f>0?1:-1,c.push(A.x,A.y,A.z),h.push(o/m),h.push(1-s/g),S+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=u+t+M*e,i=u+t+M*(e+1),r=u+(t+1)+M*(e+1),s=u+(t+1)+M*e;o.push(n,i,s),o.push(i,r,s),T+=6}a.addGroup(d,T,v),d+=T,u+=S}p("z","y","x",-1,-1,n,t,e,s,r,0),p("z","y","x",1,-1,n,t,-e,s,r,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new qr(l,3)),this.setAttribute("normal",new qr(c,3)),this.setAttribute("uv",new qr(h,2))}}function Ss(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function Ts(e){const t={};for(let n=0;n<e.length;n++){const i=Ss(e[n]);for(const e in i)t[e]=i[e]}return t}const As={clone:Ss,merge:Ts};class Rs extends Tr{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ss(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}Rs.prototype.isShaderMaterial=!0;class Cs extends cr{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Ui,this.projectionMatrix=new Ui,this.projectionMatrixInverse=new Ui}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new oi),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Cs.prototype.isCamera=!0;class Ps extends Cs{constructor(e=50,t=1,n=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Hn*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*kn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Hn*Math.atan(Math.tan(.5*kn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*kn*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,a=s.fullHeight;r+=s.offsetX*i/e,t-=s.offsetY*n/a,i*=s.width/e,n*=s.height/a}const a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Ps.prototype.isPerspectiveCamera=!0;const Ls=90;class Is extends cr{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new Ps(Ls,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new oi(1,0,0)),this.add(i);const r=new Ps(Ls,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new oi(-1,0,0)),this.add(r);const s=new Ps(Ls,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new oi(0,1,0)),this.add(s);const a=new Ps(Ls,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new oi(0,-1,0)),this.add(a);const o=new Ps(Ls,1,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new oi(0,0,1)),this.add(o);const l=new Ps(Ls,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new oi(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,s,a,o,l]=this.children,c=e.xr.enabled,h=e.getRenderTarget();e.xr.enabled=!1;const u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,o),n.texture.generateMipmaps=u,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(h),e.xr.enabled=c}}class Ds extends ei{constructor(e,t,n,i,r,s,a,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:se,n,i,r,s,a=void 0!==a?a:ze,o,l,c),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Ds.prototype.isCubeTexture=!0;class Os extends ii{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),t=t||{},this.texture=new Ds(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:ye,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Ue,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new Es(5,5,5),a=new Rs({name:"CubemapFromEquirect",uniforms:Ss(n),vertexShader:i,fragmentShader:r,side:m,blending:y});a.uniforms.tEquirect.value=t;const o=new xs(s,a),l=t.minFilter;return t.minFilter===xe&&(t.minFilter=ye),new Is(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(r)}}Os.prototype.isWebGLCubeRenderTarget=!0;const Ns=new Ci,Bs=new oi;class zs{constructor(e=new pr,t=new pr,n=new pr,i=new pr,r=new pr,s=new pr){this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],s=n[2],a=n[3],o=n[4],l=n[5],c=n[6],h=n[7],u=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],_=n[15];return t[0].setComponents(a-i,h-o,f-u,_-m).normalize(),t[1].setComponents(a+i,h+o,f+u,_+m).normalize(),t[2].setComponents(a+r,h+l,f+d,_+g).normalize(),t[3].setComponents(a-r,h-l,f-d,_-g).normalize(),t[4].setComponents(a-s,h-c,f-p,_-v).normalize(),t[5].setComponents(a+s,h+c,f+p,_+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Ns.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Ns)}intersectsSprite(e){return Ns.center.set(0,0,0),Ns.radius=.7071067811865476,Ns.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ns)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Bs.x=i.normal.x>0?e.max.x:e.min.x,Bs.y=i.normal.y>0?e.max.y:e.min.y,Bs.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Bs)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Us(){let e=null,t=!1,n=null,i=null;function r(t,s){n(t,s),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function ks(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=i.get(t);void 0===s?i.set(t,function(t,i){const r=t.array,s=t.usage,a=e.createBuffer();e.bindBuffer(i,a),e.bufferData(i,r,s),t.onUploadCallback();let o=5126;return r instanceof Float32Array?o=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?t.isFloat16BufferAttribute?n?o=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):o=5123:r instanceof Int16Array?o=5122:r instanceof Uint32Array?o=5125:r instanceof Int32Array?o=5124:r instanceof Int8Array?o=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(o=5121),{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):s.version<t.version&&(function(t,i,r){const s=i.array,a=i.updateRange;e.bindBuffer(r,t),-1===a.count?e.bufferSubData(r,0,s):(n?e.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):e.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1)}(s.buffer,t,r),s.version=t.version)}}}class Hs extends rs{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,s=t/2,a=Math.floor(n),o=Math.floor(i),l=a+1,c=o+1,h=e/a,u=t/o,d=[],p=[],f=[],m=[];for(let e=0;e<c;e++){const t=e*u-s;for(let n=0;n<l;n++){const i=n*h-r;p.push(i,-t,0),f.push(0,0,1),m.push(n/a),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<a;t++){const n=t+l*e,i=t+l*(e+1),r=t+1+l*(e+1),s=t+1+l*e;d.push(n,i,s),d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new qr(p,3)),this.setAttribute("normal",new qr(f,3)),this.setAttribute("uv",new qr(m,2))}}const Vs={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), rawDiffuseColor, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), rawDiffuseColor, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSNMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition.xyz / vWorldPosition.w;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\tfloat ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );\n\tvec3 f0 = vec3( pow( ior - 1.0, 2.0 ) / pow( ior + 1.0, 2.0 ) );\n\tvec3 f90 = vec3( 1.0 );\n\tvec3 f_transmission = totalTransmission * getIBLVolumeRefraction(\n\t\tnormal, v, viewDir, roughnessFactor, diffuseColor.rgb, f0, f90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance);\n\tdiffuseColor.rgb = mix( diffuseColor.rgb, f_transmission, totalTransmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec4 vWorldPosition;\n\tvec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {\n\t\tvec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length(vec3(modelMatrix[0].xyz));\n\t\tmodelScale.y = length(vec3(modelMatrix[1].xyz));\n\t\tmodelScale.z = length(vec3(modelMatrix[2].xyz));\n\t\treturn normalize(refractionVector) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness(float roughness, float ior) {\n\t\treturn roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);\n\t}\n\tvec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {\n\t\tfloat framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);\n\t\treturn texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;\n\t}\n\tvec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {\n\t\tif (attenuationDistance == 0.0) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;\n\t\t\tvec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec3 getIBLVolumeRefraction(vec3 n, vec3 v, vec3 viewDir, float perceptualRoughness, vec3 baseColor, vec3 f0, vec3 f90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec3 attenuationColor, float attenuationDistance) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);\n\t\tvec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);\n\t\tfloat NdotV = saturate(dot(n, viewDir));\n\t\tvec2 brdf = integrateSpecularBRDF(NdotV, perceptualRoughness);\n\t\tvec3 specularColor = f0 * brdf.x + f90 * brdf.y;\n\t\treturn (1.0 - specularColor) * attenuatedColor * baseColor;\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform vec3 attenuationColor;\n\tuniform float attenuationDistance;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef USE_TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t\tfloat thicknessFactor = thickness;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\tvec3 rawDiffuseColor = diffuseColor.rgb;\n\t#include <transmission_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#ifdef USE_TRANSMISSION\n\tvarying vec4 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition;\n#endif\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Fs={common:{diffuse:{value:new Dr(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new $n},uv2Transform:{value:new $n},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Zn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Dr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Dr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new $n}},sprite:{diffuse:{value:new Dr(16777215)},opacity:{value:1},center:{value:new Zn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new $n}}},Gs={basic:{uniforms:Ts([Fs.common,Fs.specularmap,Fs.envmap,Fs.aomap,Fs.lightmap,Fs.fog]),vertexShader:Vs.meshbasic_vert,fragmentShader:Vs.meshbasic_frag},lambert:{uniforms:Ts([Fs.common,Fs.specularmap,Fs.envmap,Fs.aomap,Fs.lightmap,Fs.emissivemap,Fs.fog,Fs.lights,{emissive:{value:new Dr(0)}}]),vertexShader:Vs.meshlambert_vert,fragmentShader:Vs.meshlambert_frag},phong:{uniforms:Ts([Fs.common,Fs.specularmap,Fs.envmap,Fs.aomap,Fs.lightmap,Fs.emissivemap,Fs.bumpmap,Fs.normalmap,Fs.displacementmap,Fs.fog,Fs.lights,{emissive:{value:new Dr(0)},specular:{value:new Dr(1118481)},shininess:{value:30}}]),vertexShader:Vs.meshphong_vert,fragmentShader:Vs.meshphong_frag},standard:{uniforms:Ts([Fs.common,Fs.envmap,Fs.aomap,Fs.lightmap,Fs.emissivemap,Fs.bumpmap,Fs.normalmap,Fs.displacementmap,Fs.roughnessmap,Fs.metalnessmap,Fs.fog,Fs.lights,{emissive:{value:new Dr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Vs.meshphysical_vert,fragmentShader:Vs.meshphysical_frag},toon:{uniforms:Ts([Fs.common,Fs.aomap,Fs.lightmap,Fs.emissivemap,Fs.bumpmap,Fs.normalmap,Fs.displacementmap,Fs.gradientmap,Fs.fog,Fs.lights,{emissive:{value:new Dr(0)}}]),vertexShader:Vs.meshtoon_vert,fragmentShader:Vs.meshtoon_frag},matcap:{uniforms:Ts([Fs.common,Fs.bumpmap,Fs.normalmap,Fs.displacementmap,Fs.fog,{matcap:{value:null}}]),vertexShader:Vs.meshmatcap_vert,fragmentShader:Vs.meshmatcap_frag},points:{uniforms:Ts([Fs.points,Fs.fog]),vertexShader:Vs.points_vert,fragmentShader:Vs.points_frag},dashed:{uniforms:Ts([Fs.common,Fs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Vs.linedashed_vert,fragmentShader:Vs.linedashed_frag},depth:{uniforms:Ts([Fs.common,Fs.displacementmap]),vertexShader:Vs.depth_vert,fragmentShader:Vs.depth_frag},normal:{uniforms:Ts([Fs.common,Fs.bumpmap,Fs.normalmap,Fs.displacementmap,{opacity:{value:1}}]),vertexShader:Vs.normal_vert,fragmentShader:Vs.normal_frag},sprite:{uniforms:Ts([Fs.sprite,Fs.fog]),vertexShader:Vs.sprite_vert,fragmentShader:Vs.sprite_frag},background:{uniforms:{uvTransform:{value:new $n},t2D:{value:null}},vertexShader:Vs.background_vert,fragmentShader:Vs.background_frag},cube:{uniforms:Ts([Fs.envmap,{opacity:{value:1}}]),vertexShader:Vs.cube_vert,fragmentShader:Vs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Vs.equirect_vert,fragmentShader:Vs.equirect_frag},distanceRGBA:{uniforms:Ts([Fs.common,Fs.displacementmap,{referencePosition:{value:new oi},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Vs.distanceRGBA_vert,fragmentShader:Vs.distanceRGBA_frag},shadow:{uniforms:Ts([Fs.lights,Fs.fog,{color:{value:new Dr(0)},opacity:{value:1}}]),vertexShader:Vs.shadow_vert,fragmentShader:Vs.shadow_frag}};function js(e,t,n,i,r){const s=new Dr(0);let a,o,l=0,c=null,h=0,u=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return s},setClearColor:function(e,t=1){s.set(e),l=t,d(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,d(s,l)},render:function(n,r){let p=!1,g=!0===r.isScene?r.background:null;g&&g.isTexture&&(g=t.get(g));const v=e.xr,_=v.getSession&&v.getSession();_&&"additive"===_.environmentBlendMode&&(g=null),null===g?d(s,l):g&&g.isColor&&(d(g,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===ce)?(void 0===o&&(o=new xs(new Es(1,1,1),new Rs({name:"BackgroundCubeMaterial",uniforms:Ss(Gs.cube.uniforms),vertexShader:Gs.cube.vertexShader,fragmentShader:Gs.cube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(o)),o.material.uniforms.envMap.value=g,o.material.uniforms.flipEnvMap.value=g.isCubeTexture&&g._needsFlipEnvMap?-1:1,c===g&&h===g.version&&u===e.toneMapping||(o.material.needsUpdate=!0,c=g,h=g.version,u=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null)):g&&g.isTexture&&(void 0===a&&(a=new xs(new Hs(2,2),new Rs({name:"BackgroundMaterial",uniforms:Ss(Gs.background.uniforms),vertexShader:Gs.background.vertexShader,fragmentShader:Gs.background.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),a.material.uniforms.uvTransform.value.copy(g.matrix),c===g&&h===g.version&&u===e.toneMapping||(a.material.needsUpdate=!0,c=g,h=g.version,u=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function Ws(e,t,n,i){const r=e.getParameter(34921),s=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||null!==s,o={},l=d(null);let c=l;function h(t){return i.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function u(t){return i.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function d(e){const t=[],n=[],i=[];for(let e=0;e<r;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function f(e){m(e,0)}function m(n,r){const s=c.newAttributes,a=c.enabledAttributes,o=c.attributeDivisors;s[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),o[n]!==r&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),o[n]=r)}function g(){const t=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function v(t,n,r,s,a,o){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,s,a,o):e.vertexAttribIPointer(t,n,r,a,o)}function _(){y(),c!==l&&(c=l,h(c.object))}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,u,_,y){let b=!1;if(a){const t=function(t,n,r){const a=!0===r.wireframe;let l=o[t.id];void 0===l&&(l={},o[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let h=c[a];return void 0===h&&(h=d(i.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[a]=h),h}(_,u,l);c!==t&&(c=t,h(c.object)),b=function(e,t){const n=c.attributes,i=e.attributes;let r=0;for(const e in i){const t=n[e],s=i[e];if(void 0===t)return!0;if(t.attribute!==s)return!0;if(t.data!==s.data)return!0;r++}return c.attributesNum!==r||c.index!==t}(_,y),b&&function(e,t){const n={},i=e.attributes;let r=0;for(const e in i){const t=i[e],s={};s.attribute=t,t.data&&(s.data=t.data),n[e]=s,r++}c.attributes=n,c.attributesNum=r,c.index=t}(_,y)}else{const e=!0===l.wireframe;c.geometry===_.id&&c.program===u.id&&c.wireframe===e||(c.geometry=_.id,c.program=u.id,c.wireframe=e,b=!0)}!0===r.isInstancedMesh&&(b=!0),null!==y&&n.update(y,34963),b&&(function(r,s,a,o){if(!1===i.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=o.attributes,c=a.getAttributes(),h=s.defaultAttributeValues;for(const t in c){const i=c[t];if(i>=0){const s=l[t];if(void 0!==s){const t=s.normalized,r=s.itemSize,a=n.get(s);if(void 0===a)continue;const l=a.buffer,c=a.type,h=a.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,a=n.stride,u=s.offset;n&&n.isInstancedInterleavedBuffer?(m(i,n.meshPerAttribute),void 0===o._maxInstanceCount&&(o._maxInstanceCount=n.meshPerAttribute*n.count)):f(i),e.bindBuffer(34962,l),v(i,r,c,t,a*h,u*h)}else s.isInstancedBufferAttribute?(m(i,s.meshPerAttribute),void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)):f(i),e.bindBuffer(34962,l),v(i,r,c,t,0,0)}else if("instanceMatrix"===t){const t=n.get(r.instanceMatrix);if(void 0===t)continue;const s=t.buffer,a=t.type;m(i+0,1),m(i+1,1),m(i+2,1),m(i+3,1),e.bindBuffer(34962,s),e.vertexAttribPointer(i+0,4,a,!1,64,0),e.vertexAttribPointer(i+1,4,a,!1,64,16),e.vertexAttribPointer(i+2,4,a,!1,64,32),e.vertexAttribPointer(i+3,4,a,!1,64,48)}else if("instanceColor"===t){const t=n.get(r.instanceColor);if(void 0===t)continue;const s=t.buffer,a=t.type;m(i,1),e.bindBuffer(34962,s),e.vertexAttribPointer(i,3,a,!1,12,0)}else if(void 0!==h){const n=h[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(i,n);break;case 3:e.vertexAttrib3fv(i,n);break;case 4:e.vertexAttrib4fv(i,n);break;default:e.vertexAttrib1fv(i,n)}}}}g()}(r,l,u,_),null!==y&&e.bindBuffer(34963,n.get(y).buffer))},reset:_,resetDefaultState:y,dispose:function(){_();for(const e in o){const t=o[e];for(const e in t){const n=t[e];for(const e in n)u(n[e].object),delete n[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;const t=o[e.id];for(const e in t){const n=t[e];for(const e in n)u(n[e].object),delete n[e];delete t[e]}delete o[e.id]},releaseStatesOfProgram:function(e){for(const t in o){const n=o[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)u(i[e].object),delete i[e];delete n[e.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function qs(e,t,n,i){const r=i.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,i){e.drawArrays(s,t,i),n.update(i,s,1)},this.renderInstances=function(i,a,o){if(0===o)return;let l,c;if(r)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,i,a,o),n.update(a,s,o)}}function Ys(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=s||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,h=e.getParameter(34930),u=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),_=u>0,y=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:_,floatFragmentTextures:y,floatVertexTextures:_&&y,maxSamples:s?e.getParameter(36183):0}}function Xs(e){const t=this;let n=null,i=0,r=!1,s=!1;const a=new pr,o=new $n,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function h(e,n,i,r){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const t=i+4*s,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=i;t!==s;++t,n+=4)a.copy(e[t]).applyMatrix4(r,o),a.normal.toArray(c,n),c[n+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,s){const a=0!==e.length||t||0!==i||r;return r=t,n=h(e,s,0),i=e.length,a},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1,c()},this.setState=function(t,a,o){const u=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!r||null===u||0===u.length||s&&!p)s?h(null):c();else{const e=s?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=h(u,a,t,o);for(let e=0;e!==t;++e)r[e]=n[e];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Zs(e){let t=new WeakMap;function n(e,t){return t===oe?e.mapping=se:t===le&&(e.mapping=ae),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(s===oe||s===le){if(t.has(r))return n(t.get(r).texture,r.mapping);{const s=r.image;if(s&&s.height>0){const a=e.getRenderTarget(),o=new Os(s.height/2);return o.fromEquirectangularTexture(e,r),t.set(r,o),e.setRenderTarget(a),r.addEventListener("dispose",i),n(o.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}function $s(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Js(e,t,n,i){const r={},s=new WeakMap;function a(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const e in o.attributes)t.remove(o.attributes[e]);o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(t.remove(l),s.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],i=e.index,r=e.attributes.position;let a=0;if(null!==i){const e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],s=e[t+2];n.push(i,r,r,s,s,i)}}else{const e=r.array;a=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}const o=new(Xr(n)>65535?jr:Fr)(n,1);o.version=a;const l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",a),r[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const i=e.morphAttributes;for(const e in i){const n=i[e];for(let e=0,i=n.length;e<i;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return s.get(e)}}}function Ks(e,t,n,i){const r=i.isWebGL2;let s,a,o;this.setMode=function(e){s=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(s,i,a,t*o),n.update(i,s,1)},this.renderInstances=function(i,l,c){if(0===c)return;let h,u;if(r)h=e,u="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,a,i*o,c),n.update(l,s,c)}}function Qs(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function ea(e,t){return e[0]-t[0]}function ta(e,t){return Math.abs(t[1])-Math.abs(e[1])}function na(e){const t={},n=new Float32Array(8),i=[];for(let e=0;e<8;e++)i[e]=[e,0];return{update:function(r,s,a,o){const l=r.morphTargetInfluences,c=void 0===l?0:l.length;let h=t[s.id];if(void 0===h){h=[];for(let e=0;e<c;e++)h[e]=[e,0];t[s.id]=h}for(let e=0;e<c;e++){const t=h[e];t[0]=e,t[1]=l[e]}h.sort(ta);for(let e=0;e<8;e++)e<c&&h[e][1]?(i[e][0]=h[e][0],i[e][1]=h[e][1]):(i[e][0]=Number.MAX_SAFE_INTEGER,i[e][1]=0);i.sort(ea);const u=a.morphTargets&&s.morphAttributes.position,d=a.morphNormals&&s.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=i[e],r=t[0],a=t[1];r!==Number.MAX_SAFE_INTEGER&&a?(u&&s.getAttribute("morphTarget"+e)!==u[r]&&s.setAttribute("morphTarget"+e,u[r]),d&&s.getAttribute("morphNormal"+e)!==d[r]&&s.setAttribute("morphNormal"+e,d[r]),n[e]=a,p+=a):(u&&!0===s.hasAttribute("morphTarget"+e)&&s.deleteAttribute("morphTarget"+e),d&&!0===s.hasAttribute("morphNormal"+e)&&s.deleteAttribute("morphNormal"+e),n[e]=0)}const f=s.morphTargetsRelative?1:1-p;o.getUniforms().setValue(e,"morphTargetBaseInfluence",f),o.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function ia(e,t,n,i){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const a=i.render.frame,o=e.geometry,l=t.get(e,o);return r.get(l)!==a&&(t.update(l),r.set(l,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",s)&&e.addEventListener("dispose",s),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}Gs.physical={uniforms:Ts([Gs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Zn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Dr(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Zn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Dr(0)}}]),vertexShader:Vs.meshphysical_vert,fragmentShader:Vs.meshphysical_frag};class ra extends ei{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=fe,this.minFilter=fe,this.wrapR=de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ra.prototype.isDataTexture2DArray=!0;class sa extends ei{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=fe,this.minFilter=fe,this.wrapR=de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}sa.prototype.isDataTexture3D=!0;const aa=new ei,oa=new ra,la=new sa,ca=new Ds,ha=[],ua=[],da=new Float32Array(16),pa=new Float32Array(9),fa=new Float32Array(4);function ma(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let s=ha[r];if(void 0===s&&(s=new Float32Array(r),ha[r]=s),0!==t){i.toArray(s,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(s,r)}return s}function ga(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function va(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function _a(e,t){let n=ua[t];void 0===n&&(n=new Int32Array(t),ua[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function ya(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function ba(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ga(n,t))return;e.uniform2fv(this.addr,t),va(n,t)}}function wa(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(ga(n,t))return;e.uniform3fv(this.addr,t),va(n,t)}}function xa(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ga(n,t))return;e.uniform4fv(this.addr,t),va(n,t)}}function Ma(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(ga(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),va(n,t)}else{if(ga(n,i))return;fa.set(i),e.uniformMatrix2fv(this.addr,!1,fa),va(n,i)}}function Ea(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(ga(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),va(n,t)}else{if(ga(n,i))return;pa.set(i),e.uniformMatrix3fv(this.addr,!1,pa),va(n,i)}}function Sa(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(ga(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),va(n,t)}else{if(ga(n,i))return;da.set(i),e.uniformMatrix4fv(this.addr,!1,da),va(n,i)}}function Ta(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Aa(e,t){const n=this.cache;ga(n,t)||(e.uniform2iv(this.addr,t),va(n,t))}function Ra(e,t){const n=this.cache;ga(n,t)||(e.uniform3iv(this.addr,t),va(n,t))}function Ca(e,t){const n=this.cache;ga(n,t)||(e.uniform4iv(this.addr,t),va(n,t))}function Pa(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function La(e,t){const n=this.cache;ga(n,t)||(e.uniform2uiv(this.addr,t),va(n,t))}function Ia(e,t){const n=this.cache;ga(n,t)||(e.uniform3uiv(this.addr,t),va(n,t))}function Da(e,t){const n=this.cache;ga(n,t)||(e.uniform4uiv(this.addr,t),va(n,t))}function Oa(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||aa,r)}function Na(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||la,r)}function Ba(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||ca,r)}function za(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||oa,r)}function Ua(e,t){e.uniform1fv(this.addr,t)}function ka(e,t){const n=ma(t,this.size,2);e.uniform2fv(this.addr,n)}function Ha(e,t){const n=ma(t,this.size,3);e.uniform3fv(this.addr,n)}function Va(e,t){const n=ma(t,this.size,4);e.uniform4fv(this.addr,n)}function Fa(e,t){const n=ma(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ga(e,t){const n=ma(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ja(e,t){const n=ma(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Wa(e,t){e.uniform1iv(this.addr,t)}function qa(e,t){e.uniform2iv(this.addr,t)}function Ya(e,t){e.uniform3iv(this.addr,t)}function Xa(e,t){e.uniform4iv(this.addr,t)}function Za(e,t){e.uniform1uiv(this.addr,t)}function $a(e,t){e.uniform2uiv(this.addr,t)}function Ja(e,t){e.uniform3uiv(this.addr,t)}function Ka(e,t){e.uniform4uiv(this.addr,t)}function Qa(e,t,n){const i=t.length,r=_a(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.safeSetTexture2D(t[e]||aa,r[e])}function eo(e,t,n){const i=t.length,r=_a(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.safeSetTextureCube(t[e]||ca,r[e])}function to(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return ya;case 35664:return ba;case 35665:return wa;case 35666:return xa;case 35674:return Ma;case 35675:return Ea;case 35676:return Sa;case 5124:case 35670:return Ta;case 35667:case 35671:return Aa;case 35668:case 35672:return Ra;case 35669:case 35673:return Ca;case 5125:return Pa;case 36294:return La;case 36295:return Ia;case 36296:return Da;case 35678:case 36198:case 36298:case 36306:case 35682:return Oa;case 35679:case 36299:case 36307:return Na;case 35680:case 36300:case 36308:case 36293:return Ba;case 36289:case 36303:case 36311:case 36292:return za}}(t.type)}function no(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ua;case 35664:return ka;case 35665:return Ha;case 35666:return Va;case 35674:return Fa;case 35675:return Ga;case 35676:return ja;case 5124:case 35670:return Wa;case 35667:case 35671:return qa;case 35668:case 35672:return Ya;case 35669:case 35673:return Xa;case 5125:return Za;case 36294:return $a;case 36295:return Ja;case 36296:return Ka;case 35678:case 36198:case 36298:case 36306:case 35682:return Qa;case 35680:case 36300:case 36308:case 36293:return eo}}(t.type)}function io(e){this.id=e,this.seq=[],this.map={}}no.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),va(t,e)},io.prototype.setValue=function(e,t,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(e,t[s.id],n)}};const ro=/(\w+)(\])?(\[|\.)?/g;function so(e,t){e.seq.push(t),e.map[t.id]=t}function ao(e,t,n){const i=e.name,r=i.length;for(ro.lastIndex=0;;){const s=ro.exec(i),a=ro.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){so(n,void 0===c?new to(o,e,t):new no(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new io(o),so(n,e)),n=e}}}function oo(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);ao(n,e.getUniformLocation(t,n.name),this)}}function lo(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}oo.prototype.setValue=function(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)},oo.prototype.setOptional=function(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)},oo.upload=function(e,t,n,i){for(let r=0,s=t.length;r!==s;++r){const s=t[r],a=n[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,i)}},oo.seqWithValue=function(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n};let co=0;function ho(e){switch(e){case $t:return["Linear","( value )"];case Jt:return["sRGB","( value )"];case Qt:return["RGBE","( value )"];case tn:return["RGBM","( value, 7.0 )"];case nn:return["RGBM","( value, 16.0 )"];case rn:return["RGBD","( value, 256.0 )"];case Kt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case en:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function uo(e,t,n){const i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function po(e,t){const n=ho(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function fo(e,t){const n=ho(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function mo(e,t){let n;switch(t){case Q:n="Linear";break;case ee:n="Reinhard";break;case te:n="OptimizedCineon";break;case ne:n="ACESFilmic";break;case ie:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function go(e){return""!==e}function vo(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function _o(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const yo=/^[ \t]*#include +<([\w\d./]+)>/gm;function bo(e){return e.replace(yo,wo)}function wo(e,t){const n=Vs[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return bo(n)}const xo=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Mo=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Eo(e){return e.replace(Mo,To).replace(xo,So)}function So(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),To(0,t,n,i)}function To(e,t,n,i){let r="";for(let e=parseInt(t);e<parseInt(n);e++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function Ao(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Ro(e,t,n,i){const r=e.getContext(),s=n.defines;let a=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===u?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===d?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===p&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case se:case ae:t="ENVMAP_TYPE_CUBE";break;case ce:case he:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),h=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case ae:case he:t="ENVMAP_MODE_REFRACTION"}return t}(n),f=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Z:t="ENVMAP_BLENDING_MULTIPLY";break;case $:t="ENVMAP_BLENDING_MIX";break;case J:t="ENVMAP_BLENDING_ADD"}return t}(n),m=e.gammaFactor>0?e.gammaFactor:1,g=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission>0)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(go).join("\n")}(n),v=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),_=r.createProgram();let y,b,w=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(y=[v].filter(go).join("\n"),y.length>0&&(y+="\n"),b=[g,v].filter(go).join("\n"),b.length>0&&(b+="\n")):(y=[Ao(n),"#define SHADER_NAME "+n.shaderName,v,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(go).join("\n"),b=[g,Ao(n),"#define SHADER_NAME "+n.shaderName,v,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+h:"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==K?"#define TONE_MAPPING":"",n.toneMapping!==K?Vs.tonemapping_pars_fragment:"",n.toneMapping!==K?mo("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Vs.encodings_pars_fragment,n.map?po("mapTexelToLinear",n.mapEncoding):"",n.matcap?po("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?po("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?po("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?po("lightMapTexelToLinear",n.lightMapEncoding):"",fo("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(go).join("\n")),a=bo(a),a=vo(a,n),a=_o(a,n),o=bo(o),o=vo(o,n),o=_o(o,n),a=Eo(a),o=Eo(o),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(w="#version 300 es\n",y=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+y,b=["#define varying in",n.glslVersion===Nn?"":"out highp vec4 pc_fragColor;",n.glslVersion===Nn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const x=w+b+o,M=lo(r,35633,w+y+a),E=lo(r,35632,x);if(r.attachShader(_,M),r.attachShader(_,E),void 0!==n.index0AttributeName?r.bindAttribLocation(_,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(_).trim(),t=r.getShaderInfoLog(M).trim(),n=r.getShaderInfoLog(E).trim();let i=!0,s=!0;if(!1===r.getProgramParameter(_,35714)){i=!1;const t=uo(r,M,"vertex"),n=uo(r,E,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(_,35715),"gl.getProgramInfoLog",e,t,n)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==n||(s=!1);s&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:y},fragmentShader:{log:n,prefix:b}})}let S,T;return r.deleteShader(M),r.deleteShader(E),this.getUniforms=function(){return void 0===S&&(S=new oo(r,_)),S},this.getAttributes=function(){return void 0===T&&(T=function(e,t){const n={},i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r).name;n[i]=e.getAttribLocation(t,i)}return n}(r,_)),T},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.name=n.shaderName,this.id=co++,this.cacheKey=t,this.usedTimes=1,this.program=_,this.vertexShader=M,this.fragmentShader=E,this}function Co(e,t,n,i,r,s){const a=[],o=i.isWebGL2,l=i.logarithmicDepthBuffer,c=i.floatVertexTextures,h=i.maxVertexUniforms,u=i.vertexTextures;let d=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function v(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=$t,t}return{getParameters:function(r,a,f,_,y){const b=_.fog,w=r.isMeshStandardMaterial?_.environment:null,x=t.get(r.envMap||w),M=p[r.type],E=y.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(c)return 1024;{const e=h,n=Math.floor((e-20)/4),i=Math.min(n,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}}(y):0;let S,T;if(null!==r.precision&&(d=i.getMaxPrecision(r.precision),d!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",d,"instead.")),M){const e=Gs[M];S=e.vertexShader,T=e.fragmentShader}else S=r.vertexShader,T=r.fragmentShader;const A=e.getRenderTarget();return{isWebGL2:o,shaderID:M,shaderName:r.type,vertexShader:S,fragmentShader:T,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:d,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:u,outputEncoding:null!==A?v(A.texture):e.outputEncoding,map:!!r.map,mapEncoding:v(r.map),matcap:!!r.matcap,matcapEncoding:v(r.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:v(x),envMapCubeUV:!!x&&(x.mapping===ce||x.mapping===he),lightMap:!!r.lightMap,lightMapEncoding:v(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:v(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===ln,tangentSpaceNormalMap:r.normalMapType===on,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmission:!!r.transmission,transmissionMap:!!r.transmissionMap,thicknessMap:!!r.thicknessMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&y.geometry&&y.geometry.attributes.color&&4===y.geometry.attributes.color.itemSize,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmission||r.transmissionMap||r.thicknessMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmission||r.transmissionMap||r.thicknessMap||!r.displacementMap),fog:!!b,useFog:r.fog,fogExp2:b&&b.isFogExp2,flatShading:!!r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===y.isSkinnedMesh&&E>0,maxBones:E,useVertexTexture:c,morphTargets:r.morphTargets,morphNormals:r.morphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:K,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===g,flipSided:r.side===m,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:o||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||n.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<f.length;e++)n.push(t[f[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=Gs[t];n=As.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=a.length;e<t;e++){const t=a[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new Ro(e,n,t,r),a.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=a.indexOf(e);a[t]=a[a.length-1],a.pop(),e.destroy()}},programs:a}}function Po(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Lo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Io(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Do(e){const t=[];let n=0;const i=[],r=[],s=[],a={id:-1};function o(i,r,s,o,l,c){let h=t[n];const u=e.get(s);return void 0===h?(h={id:i.id,object:i,geometry:r,material:s,program:u.program||a,groupOrder:o,renderOrder:i.renderOrder,z:l,group:c},t[n]=h):(h.id=i.id,h.object=i,h.geometry=r,h.material=s,h.program=u.program||a,h.groupOrder=o,h.renderOrder=i.renderOrder,h.z=l,h.group=c),n++,h}return{opaque:i,transmissive:r,transparent:s,init:function(){n=0,i.length=0,r.length=0,s.length=0},push:function(e,t,n,a,l,c){const h=o(e,t,n,a,l,c);n.transmission>0?r.push(h):!0===n.transparent?s.push(h):i.push(h)},unshift:function(e,t,n,a,l,c){const h=o(e,t,n,a,l,c);n.transmission>0?r.unshift(h):!0===n.transparent?s.unshift(h):i.unshift(h)},finish:function(){for(let e=n,i=t.length;e<i;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){i.length>1&&i.sort(e||Lo),r.length>1&&r.sort(t||Io),s.length>1&&s.sort(t||Io)}}}function Oo(e){let t=new WeakMap;return{get:function(n,i){let r;return!1===t.has(n)?(r=new Do(e),t.set(n,[r])):i>=t.get(n).length?(r=new Do(e),t.get(n).push(r)):r=t.get(n)[i],r},dispose:function(){t=new WeakMap}}}function No(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new oi,color:new Dr};break;case"SpotLight":n={position:new oi,direction:new oi,color:new Dr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new oi,color:new Dr,distance:0,decay:0};break;case"HemisphereLight":n={direction:new oi,skyColor:new Dr,groundColor:new Dr};break;case"RectAreaLight":n={color:new Dr,position:new oi,halfWidth:new oi,halfHeight:new oi}}return e[t.id]=n,n}}}let Bo=0;function zo(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Uo(e,t){const n=new No,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)r.probe.push(new oi);const s=new oi,a=new Ui,o=new Ui;return{setup:function(s){let a=0,o=0,l=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0;s.sort(zo);for(let e=0,t=s.length;e<t;e++){const t=s[e],v=t.color,_=t.intensity,y=t.distance,b=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=v.r*_,o+=v.g*_,l+=v.b*_;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],_);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[c]=n,r.directionalShadowMap[c]=b,r.directionalShadowMatrix[c]=t.shadow.matrix,f++}r.directional[c]=e,c++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(_),e.distance=y,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.spotShadow[u]=n,r.spotShadowMap[u]=b,r.spotShadowMatrix[u]=t.shadow.matrix,g++}r.spot[u]=e,u++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(v).multiplyScalar(_),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[d]=e,d++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[h]=n,r.pointShadowMap[h]=b,r.pointShadowMatrix[h]=t.shadow.matrix,m++}r.point[h]=e,h++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(_),e.groundColor.copy(t.groundColor).multiplyScalar(_),r.hemi[p]=e,p++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Fs.LTC_FLOAT_1,r.rectAreaLTC2=Fs.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Fs.LTC_HALF_1,r.rectAreaLTC2=Fs.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=o,r.ambient[2]=l;const v=r.hash;v.directionalLength===c&&v.pointLength===h&&v.spotLength===u&&v.rectAreaLength===d&&v.hemiLength===p&&v.numDirectionalShadows===f&&v.numPointShadows===m&&v.numSpotShadows===g||(r.directional.length=c,r.spot.length=u,r.rectArea.length=d,r.point.length=h,r.hemi.length=p,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=m,r.pointShadowMap.length=m,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=m,r.spotShadowMatrix.length=g,v.directionalLength=c,v.pointLength=h,v.spotLength=u,v.rectAreaLength=d,v.hemiLength=p,v.numDirectionalShadows=f,v.numPointShadows=m,v.numSpotShadows=g,r.version=Bo++)},setupView:function(e,t){let n=0,i=0,l=0,c=0,h=0;const u=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),n++}else if(d.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),o.identity(),a.copy(d.matrixWorld),a.premultiply(u),o.extractRotation(a),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(d.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),i++}else if(d.isHemisphereLight){const e=r.hemi[h];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(u),e.direction.normalize(),h++}}},state:r}}function ko(e,t){const n=new Uo(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(){n.setup(i)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function Ho(e,t){let n=new WeakMap;return{get:function(i,r=0){let s;return!1===n.has(i)?(s=new ko(e,t),n.set(i,[s])):r>=n.get(i).length?(s=new ko(e,t),n.get(i).push(s)):s=n.get(i)[r],s},dispose:function(){n=new WeakMap}}}class Vo extends Tr{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=sn,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Vo.prototype.isMeshDepthMaterial=!0;class Fo extends Tr{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new oi,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Go(e,t,n){let i=new zs;const r=new Zn,s=new Zn,a=new ni,o=[],l=[],c={},h=n.maxTextureSize,d={0:m,1:f,2:g},v=new Rs({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Zn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),_=v.clone();_.defines.HORIZONTAL_PASS=1;const b=new rs;b.setAttribute("position",new zr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new xs(b,v),x=this;function M(n,i){const r=t.update(w);v.uniforms.shadow_pass.value=n.map.texture,v.uniforms.resolution.value=n.mapSize,v.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,v,w,null),_.uniforms.shadow_pass.value=n.mapPass.texture,_.uniforms.resolution.value=n.mapSize,_.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,_,w,null)}function E(e){const t=e<<0;let n=o[t];return void 0===n&&(n=new Vo({depthPacking:an,morphTargets:e}),o[t]=n),n}function S(e){const t=e<<0;let n=l[t];return void 0===n&&(n=new Fo({morphTargets:e}),l[t]=n),n}function T(t,n,i,r,s,a,o){let l=null,h=E,u=t.customDepthMaterial;if(!0===r.isPointLight&&(h=S,u=t.customDistanceMaterial),void 0===u){let e=!1;!0===i.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0),l=h(e)}else l=u;if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){const e=l.uuid,t=i.uuid;let n=c[e];void 0===n&&(n={},c[e]=n);let r=n[t];void 0===r&&(r=l.clone(),n[t]=r),l=r}return l.visible=i.visible,l.wireframe=i.wireframe,l.side=o===p?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:d[i.side],l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=s,l.farDistance=a),l}function A(n,r,s,a,o){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===p)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=r[c.materialIndex];if(h&&h.visible){const t=T(n,i,h,a,s.near,s.far,o);e.renderBufferDirect(s,null,i,t,n,c)}}}else if(r.visible){const t=T(n,i,r,a,s.near,s.far,o);e.renderBufferDirect(s,null,i,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)A(l[e],r,s,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=u,this.render=function(t,n,o){if(!1===x.enabled)return;if(!1===x.autoUpdate&&!1===x.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),d=e.state;d.setBlending(y),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const f=u.getFrameExtents();if(r.multiply(f),s.copy(u.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/f.x),r.x=s.x*f.x,u.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/f.y),r.y=s.y*f.y,u.mapSize.y=s.y)),null===u.map&&!u.isPointLightShadow&&this.type===p){const e={minFilter:ye,magFilter:ye,format:Ue};u.map=new ii(r.x,r.y,e),u.map.texture.name=c.name+".shadowMap",u.mapPass=new ii(r.x,r.y,e),u.camera.updateProjectionMatrix()}if(null===u.map){const e={minFilter:fe,magFilter:fe,format:Ue};u.map=new ii(r.x,r.y,e),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();const m=u.getViewportCount();for(let e=0;e<m;e++){const t=u.getViewport(e);a.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),d.viewport(a),u.updateMatrices(c,e),i=u.getFrustum(),A(n,o,u.camera,c,this.type)}u.isPointLightShadow||this.type!==p||M(u,o),u.needsUpdate=!1}x.needsUpdate=!1,e.setRenderTarget(l,c,u)}}function jo(e,t,n){const i=n.isWebGL2,r=new function(){let t=!1;const n=new ni;let i=null;const r=new ni(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,s,a,o){!0===o&&(t*=a,i*=a,s*=a),n.set(t,i,s,a),!1===r.equals(n)&&(e.clearColor(t,i,s,a),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(e){e?_e(2929):ye(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case V:e.depthFunc(512);break;case F:e.depthFunc(519);break;case G:e.depthFunc(513);break;case j:e.depthFunc(515);break;case W:e.depthFunc(514);break;case q:e.depthFunc(518);break;case Y:e.depthFunc(516);break;case X:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},c=new function(){let t=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(e){t||(e?_e(2960):ye(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a){i===t&&r===n&&s===a||(e.stencilFunc(t,n,a),i=t,r=n,s=a)},setOp:function(t,n,i){a===t&&o===n&&l===i||(e.stencilOp(t,n,i),a=t,o=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null}}};let h={},u=null,d={},p=null,f=!1,v=null,_=null,Z=null,$=null,J=null,K=null,Q=null,ee=!1,te=null,ne=null,ie=null,re=null,se=null;const ae=e.getParameter(35661);let oe=!1,le=0;const ce=e.getParameter(7938);-1!==ce.indexOf("WebGL")?(le=parseFloat(/^WebGL (\d)/.exec(ce)[1]),oe=le>=1):-1!==ce.indexOf("OpenGL ES")&&(le=parseFloat(/^OpenGL ES (\d)/.exec(ce)[1]),oe=le>=2);let he=null,ue={};const de=e.getParameter(3088),pe=e.getParameter(2978),fe=(new ni).fromArray(de),me=(new ni).fromArray(pe);function ge(t,n,i){const r=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<i;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,r);return s}const ve={};function _e(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function ye(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}ve[3553]=ge(3553,3553,1),ve[34067]=ge(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),c.setClear(0),_e(2929),s.setFunc(j),Me(!1),Ee(o),_e(2884),xe(y);const be={[S]:32774,[T]:32778,[A]:32779};if(i)be[R]=32775,be[C]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(be[R]=e.MIN_EXT,be[C]=e.MAX_EXT)}const we={[P]:0,[L]:1,[I]:768,[O]:770,[H]:776,[U]:774,[B]:772,[D]:769,[N]:771,[k]:775,[z]:773};function xe(t,n,i,r,s,a,o,l){if(t!==y){if(!1===f&&(_e(3042),f=!0),t===E)s=s||n,a=a||i,o=o||r,n===_&&s===J||(e.blendEquationSeparate(be[n],be[s]),_=n,J=s),i===Z&&r===$&&a===K&&o===Q||(e.blendFuncSeparate(we[i],we[r],we[a],we[o]),Z=i,$=r,K=a,Q=o),v=t,ee=null;else if(t!==v||l!==ee){if(_===S&&J===S||(e.blendEquation(32774),_=S,J=S),l)switch(t){case b:e.blendFuncSeparate(1,771,1,771);break;case w:e.blendFunc(1,1);break;case x:e.blendFuncSeparate(0,0,769,771);break;case M:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case b:e.blendFuncSeparate(770,771,1,771);break;case w:e.blendFunc(770,1);break;case x:e.blendFunc(0,769);break;case M:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Z=null,$=null,K=null,Q=null,v=t,ee=l}}else!0===f&&(ye(3042),f=!1)}function Me(t){te!==t&&(t?e.frontFace(2304):e.frontFace(2305),te=t)}function Ee(t){t!==a?(_e(2884),t!==ne&&(t===o?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):ye(2884),ne=t}function Se(t,n,i){t?(_e(32823),re===n&&se===i||(e.polygonOffset(n,i),re=n,se=i)):ye(32823)}function Te(t){void 0===t&&(t=33984+ae-1),he!==t&&(e.activeTexture(t),he=t)}return{buffers:{color:r,depth:s,stencil:c},enable:_e,disable:ye,bindFramebuffer:function(t,n){return null===n&&null!==u&&(n=u),d[t]!==n&&(e.bindFramebuffer(t,n),d[t]=n,i&&(36009===t&&(d[36160]=n),36160===t&&(d[36009]=n)),!0)},bindXRFramebuffer:function(t){t!==u&&(e.bindFramebuffer(36160,t),u=t)},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:xe,setMaterial:function(e,t){e.side===g?ye(2884):_e(2884);let n=e.side===m;t&&(n=!n),Me(n),e.blending===b&&!1===e.transparent?xe(y):xe(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),r.setMask(e.colorWrite);const i=e.stencilWrite;c.setTest(i),i&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Se(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?_e(32926):ye(32926)},setFlipSided:Me,setCullFace:Ee,setLineWidth:function(t){t!==ie&&(oe&&e.lineWidth(t),ie=t)},setPolygonOffset:Se,setScissorTest:function(e){e?_e(3089):ye(3089)},activeTexture:Te,bindTexture:function(t,n){null===he&&Te();let i=ue[he];void 0===i&&(i={type:void 0,texture:void 0},ue[he]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||ve[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=ue[he];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===fe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),fe.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),h={},he=null,ue={},u=null,d={},p=null,f=!1,v=null,_=null,Z=null,$=null,J=null,K=null,Q=null,ee=!1,te=null,ne=null,ie=null,re=null,se=null,fe.set(0,0,e.canvas.width,e.canvas.height),me.set(0,0,e.canvas.width,e.canvas.height),r.reset(),s.reset(),c.reset()}}}function Wo(e,t,n,i,r,s,a){const o=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,d=new WeakMap;let p,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return f?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?Yn:Math.floor,s=i(r*e.width),a=i(r*e.height);void 0===p&&(p=m(s,a));const o=n?m(s,a):p;return o.width=s,o.height=a,o.getContext("2d").drawImage(e,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+a+")."),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return Wn(e.width)&&Wn(e.height)}function _(e,t){return e.generateMipmaps&&t&&e.minFilter!==fe&&e.minFilter!==ye}function y(t,n,r,s){e.generateMipmap(t),i.get(n).__maxMipLevel=Math.log2(Math.max(r,s))}function b(n,i,r){if(!1===o)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=i;return 6403===i&&(5126===r&&(s=33326),5131===r&&(s=33325),5121===r&&(s=33321)),6407===i&&(5126===r&&(s=34837),5131===r&&(s=34843),5121===r&&(s=32849)),6408===i&&(5126===r&&(s=34836),5131===r&&(s=34842),5121===r&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||t.get("EXT_color_buffer_float"),s}function w(e){return e===fe||e===me||e===ve?9728:9729}function x(t){const n=t.target;n.removeEventListener("dispose",x),function(t){const n=i.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),i.remove(t))}(n),n.isVideoTexture&&d.delete(n),a.memory.textures--}function M(t){const n=t.target;n.removeEventListener("dispose",M),function(t){const n=t.texture,r=i.get(t),s=i.get(n);if(t){if(void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),a.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&e.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),a.memory.textures--),i.remove(n[t])}i.remove(n),i.remove(t)}}(n)}let E=0;function S(e,t){const r=i.get(e);if(e.isVideoTexture&&function(e){const t=a.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(e),e.version>0&&r.__version!==e.version){const n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void L(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}function T(t,r){const a=i.get(t);t.version>0&&a.__version!==t.version?function(t,i,r){if(6!==i.image.length)return;P(t,i),n.activeTexture(33984+r),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const a=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),l=i.image[0]&&i.image[0].isDataTexture,h=[];for(let e=0;e<6;e++)h[e]=a||l?l?i.image[e].image:i.image[e]:g(i.image[e],!1,!0,c);const u=h[0],d=v(u)||o,p=s.convert(i.format),f=s.convert(i.type),m=b(i.internalFormat,p,f);let w;if(C(34067,i,d),a){for(let e=0;e<6;e++){w=h[e].mipmaps;for(let t=0;t<w.length;t++){const r=w[t];i.format!==Ue&&i.format!==ze?null!==p?n.compressedTexImage2D(34069+e,t,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+e,t,m,r.width,r.height,0,p,f,r.data)}}t.__maxMipLevel=w.length-1}else{w=i.mipmaps;for(let e=0;e<6;e++)if(l){n.texImage2D(34069+e,0,m,h[e].width,h[e].height,0,p,f,h[e].data);for(let t=0;t<w.length;t++){const i=w[t].image[e].image;n.texImage2D(34069+e,t+1,m,i.width,i.height,0,p,f,i.data)}}else{n.texImage2D(34069+e,0,m,p,f,h[e]);for(let t=0;t<w.length;t++){const i=w[t];n.texImage2D(34069+e,t+1,m,p,f,i.image[e])}}t.__maxMipLevel=w.length}_(i,d)&&y(34067,i,u.width,u.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}(a,t,r):(n.activeTexture(33984+r),n.bindTexture(34067,a.__webglTexture))}const A={[ue]:10497,[de]:33071,[pe]:33648},R={[fe]:9728,[me]:9984,[ve]:9986,[ye]:9729,[be]:9985,[xe]:9987};function C(n,s,a){if(a?(e.texParameteri(n,10242,A[s.wrapS]),e.texParameteri(n,10243,A[s.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,A[s.wrapR]),e.texParameteri(n,10240,R[s.magFilter]),e.texParameteri(n,10241,R[s.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),s.wrapS===de&&s.wrapT===de||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,w(s.magFilter)),e.texParameteri(n,10241,w(s.minFilter)),s.minFilter!==fe&&s.minFilter!==ye&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(s.type===Pe&&!1===t.has("OES_texture_float_linear"))return;if(!1===o&&s.type===Le&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function P(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",x),t.__webglTexture=e.createTexture(),a.memory.textures++)}function L(t,i,r){let a=3553;i.isDataTexture2DArray&&(a=35866),i.isDataTexture3D&&(a=32879),P(t,i),n.activeTexture(33984+r),n.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!o&&(e.wrapS!==de||e.wrapT!==de||e.minFilter!==fe&&e.minFilter!==ye)}(i)&&!1===v(i.image),c=g(i.image,l,!1,h),u=v(c)||o,d=s.convert(i.format);let p,f=s.convert(i.type),m=b(i.internalFormat,d,f);C(a,i,u);const w=i.mipmaps;if(i.isDepthTexture)m=6402,o?m=i.type===Pe?36012:i.type===Ce?33190:i.type===Ne?35056:33189:i.type===Pe&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===Fe&&6402===m&&i.type!==Ae&&i.type!==Ce&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Ae,f=s.convert(i.type)),i.format===Ge&&6402===m&&(m=34041,i.type!==Ne&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Ne,f=s.convert(i.type))),n.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(i.isDataTexture)if(w.length>0&&u){for(let e=0,t=w.length;e<t;e++)p=w[e],n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);i.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(let e=0,t=w.length;e<t;e++)p=w[e],i.format!==Ue&&i.format!==ze?null!==d?n.compressedTexImage2D(3553,e,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);t.__maxMipLevel=w.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(w.length>0&&u){for(let e=0,t=w.length;e<t;e++)p=w[e],n.texImage2D(3553,e,m,d,f,p);i.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,m,d,f,c),t.__maxMipLevel=0;_(i,u)&&y(a,i,c.width,c.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function I(t,r,a,o,l){const c=s.convert(a.format),h=s.convert(a.type),u=b(a.internalFormat,c,h);32879===l||35866===l?n.texImage3D(l,0,u,r.width,r.height,r.depth,0,c,h,null):n.texImage2D(l,0,u,r.width,r.height,0,c,h,null),n.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,l,i.get(a).__webglTexture,0),n.bindFramebuffer(36160,null)}function D(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===Pe?r=36012:t.type===Ce&&(r=33190));const i=O(n);e.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){const t=O(n);e.renderbufferStorageMultisample(36161,t,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,r=s.convert(t.format),a=s.convert(t.type),o=b(t.internalFormat,r,a);if(i){const t=O(n);e.renderbufferStorageMultisample(36161,t,o,n.width,n.height)}else e.renderbufferStorage(36161,o,n.width,n.height)}e.bindRenderbuffer(36161,null)}function O(e){return o&&e.isWebGLMultisampleRenderTarget?Math.min(u,e.samples):0}let N=!1,B=!1;this.allocateTextureUnit=function(){const e=E;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),E+=1,e},this.resetTextureUnits=function(){E=0},this.setTexture2D=S,this.setTexture2DArray=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?L(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?L(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=T,this.setupRenderTarget=function(t){const l=t.texture,c=i.get(t),h=i.get(l);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(h.__webglTexture=e.createTexture(),h.__version=l.version,a.memory.textures++);const u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=!0===t.isWebGLMultisampleRenderTarget,f=l.isDataTexture3D||l.isDataTexture2DArray,m=v(t)||o;if(!o||l.format!==ze||l.type!==Pe&&l.type!==Le||(l.format=Ue,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else if(c.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers){const n=t.texture;for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(p)if(o){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const i=s.convert(l.format),r=s.convert(l.type),a=b(l.internalFormat,i,r),o=O(t);e.renderbufferStorageMultisample(36161,o,a,t.width,t.height),n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),D(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){n.bindTexture(34067,h.__webglTexture),C(34067,l,m);for(let e=0;e<6;e++)I(c.__webglFramebuffer[e],t,l,36064,34069+e);_(l,m)&&y(34067,l,t.width,t.height),n.bindTexture(34067,null)}else if(d){const e=t.texture;for(let r=0,s=e.length;r<s;r++){const s=e[r],a=i.get(s);n.bindTexture(3553,a.__webglTexture),C(3553,s,m),I(c.__webglFramebuffer,t,s,36064+r,3553),_(s,m)&&y(3553,s,t.width,t.height)}n.bindTexture(3553,null)}else{let e=3553;f&&(o?e=l.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),n.bindTexture(e,h.__webglTexture),C(e,l,m),I(c.__webglFramebuffer,t,l,36064,e),_(l,m)&&y(3553,l,t.width,t.height),n.bindTexture(3553,null)}t.depthBuffer&&function(t){const r=i.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),S(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Fe)e.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==Ge)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),D(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),D(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}(t)},this.updateRenderTargetMipmap=function(e){const t=v(e)||o,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let s=0,a=r.length;s<a;s++){const a=r[s];if(_(a,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,r=i.get(a).__webglTexture;n.bindTexture(t,r),y(t,a,e.width,e.height),n.bindTexture(t,null)}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(o){const r=t.width,s=t.height;let a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024);const o=i.get(t);n.bindFramebuffer(36008,o.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,o.__webglFramebuffer),e.blitFramebuffer(0,0,r,s,0,0,r,s,a,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,o.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===N&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),N=!0),e=e.texture),S(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),B=!0),e=e.texture),T(e,t)}}function qo(e,t,n){const i=n.isWebGL2;return{convert:function(e){let n;if(e===Ee)return 5121;if(e===Ie)return 32819;if(e===De)return 32820;if(e===Oe)return 33635;if(e===Se)return 5120;if(e===Te)return 5122;if(e===Ae)return 5123;if(e===Re)return 5124;if(e===Ce)return 5125;if(e===Pe)return 5126;if(e===Le)return i?5131:(n=t.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(e===Be)return 6406;if(e===ze)return 6407;if(e===Ue)return 6408;if(e===ke)return 6409;if(e===He)return 6410;if(e===Fe)return 6402;if(e===Ge)return 34041;if(e===je)return 6403;if(e===We)return 36244;if(e===qe)return 33319;if(e===Ye)return 33320;if(e===Xe)return 36248;if(e===Ze)return 36249;if(e===$e||e===Je||e===Ke||e===Qe){if(n=t.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(e===$e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Je)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Ke)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Qe)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===et||e===tt||e===nt||e===it){if(n=t.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(e===et)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===tt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===nt)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===it)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===rt)return n=t.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===st||e===at)&&(n=t.get("WEBGL_compressed_texture_etc"),null!==n)){if(e===st)return n.COMPRESSED_RGB8_ETC2;if(e===at)return n.COMPRESSED_RGBA8_ETC2_EAC}return e===ot||e===lt||e===ct||e===ht||e===ut||e===dt||e===pt||e===ft||e===mt||e===gt||e===vt||e===_t||e===yt||e===bt||e===xt||e===Mt||e===Et||e===St||e===Tt||e===At||e===Rt||e===Ct||e===Pt||e===Lt||e===It||e===Dt||e===Ot||e===Nt?(n=t.get("WEBGL_compressed_texture_astc"),null!==n?e:null):e===wt?(n=t.get("EXT_texture_compression_bptc"),null!==n?e:null):e===Ne?i?34042:(n=t.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}Fo.prototype.isMeshDistanceMaterial=!0;class Yo extends Ps{constructor(e=[]){super(),this.cameras=e}}Yo.prototype.isArrayCamera=!0;class Xo extends cr{constructor(){super(),this.type="Group"}}Xo.prototype.isGroup=!0;const Zo={type:"move"};class $o{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Xo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Xo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new oi,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new oi),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Xo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new oi,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new oi),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==a&&(i=t.getPose(e.targetRaySpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Zo))),l&&e.hand){s=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n);if(void 0===l.joints[i.jointName]){const e=new Xo;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[i.jointName]=e,l.add(e)}const r=l.joints[i.jointName];null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class Jo extends Bn{constructor(e,t){super();const n=this,i=e.state;let r=null,s=1,a=null,o="local-floor",l=null;const c=[],h=new Map,u=new Ps;u.layers.enable(1),u.viewport=new ni;const d=new Ps;d.layers.enable(2),d.viewport=new ni;const p=[u,d],f=new Yo;f.layers.enable(1),f.layers.enable(2);let m=null,g=null;function v(e){const t=h.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function _(){h.forEach((function(e,t){e.disconnect(t)})),h.clear(),m=null,g=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),E.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function y(e){const t=r.inputSources;for(let e=0;e<c.length;e++)h.set(t[e],c[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=h.get(n);i&&(i.dispatchEvent({type:"disconnected",data:n}),h.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],i=h.get(n);i&&i.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=c[e];return void 0===t&&(t=new $o,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=c[e];return void 0===t&&(t=new $o,c[e]=t),t.getGripSpace()},this.getHand=function(e){let t=c[e];return void 0===t&&(t=new $o,c[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return r},this.setSession=async function(e){if(r=e,null!==r){r.addEventListener("select",v),r.addEventListener("selectstart",v),r.addEventListener("selectend",v),r.addEventListener("squeeze",v),r.addEventListener("squeezestart",v),r.addEventListener("squeezeend",v),r.addEventListener("end",_),r.addEventListener("inputsourceschange",y);const e=t.getContextAttributes();!0!==e.xrCompatible&&await t.makeXRCompatible();const i={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:s},l=new XRWebGLLayer(r,t,i);r.updateRenderState({baseLayer:l}),a=await r.requestReferenceSpace(o),E.setContext(r),E.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const b=new oi,w=new oi;function x(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;f.near=d.near=u.near=e.near,f.far=d.far=u.far=e.far,m===f.near&&g===f.far||(r.updateRenderState({depthNear:f.near,depthFar:f.far}),m=f.near,g=f.far);const t=e.parent,n=f.cameras;x(f,t);for(let e=0;e<n.length;e++)x(n[e],t);e.matrixWorld.copy(f.matrixWorld),e.matrix.copy(f.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const i=e.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){b.setFromMatrixPosition(t.matrixWorld),w.setFromMatrixPosition(n.matrixWorld);const i=b.distanceTo(w),r=t.projectionMatrix.elements,s=n.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*h,p=a*u,f=i/(-h+u),m=f*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=a+f,v=o+f,_=d-m,y=p+(i-m),x=l*o/v*g,M=c*o/v*g;e.projectionMatrix.makePerspective(_,y,x,M,g,v)}(f,u,d):f.projectionMatrix.copy(u.projectionMatrix)},this.getCamera=function(){return f};let M=null;const E=new Us;E.setAnimationLoop((function(e,t){if(l=t.getViewerPose(a),null!==l){const e=l.views,t=r.renderState.baseLayer;i.bindXRFramebuffer(t.framebuffer);let n=!1;e.length!==f.cameras.length&&(f.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i],s=t.getViewport(r),a=p[i];a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===i&&f.matrix.copy(a.matrix),!0===n&&f.cameras.push(a)}}const n=r.inputSources;for(let e=0;e<c.length;e++){const i=c[e],r=n[e];i.update(r,t,a)}M&&M(e,t)})),this.setAnimationLoop=function(e){M=e},this.dispose=function(){}}}function Ko(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const i=e.get(n).envMap;if(i){t.envMap.value=i,t.flipEnvMap.value=i.isCubeTexture&&i._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;const r=e.get(i).__maxMipLevel;void 0!==r&&(t.maxMipLevel.value=r)}let r,s;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(r=n.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uv2Transform.value.copy(s.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===m&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===m&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,r,s,a){i.isMeshBasicMaterial?t(e,i):i.isMeshLambertMaterial?(t(e,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,i)):i.isMeshToonMaterial?(t(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshPhongMaterial?(t(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshStandardMaterial?(t(e,i),i.isMeshPhysicalMaterial?function(e,t,i){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===m&&e.clearcoatNormalScale.value.negate()),e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),t.transmission>0&&(e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)}(e,i,a):n(e,i)):i.isMeshMatcapMaterial?(t(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDepthMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDistanceMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?(t(e,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,s):i.isSpriteMaterial?function(e,t){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Qo(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,o=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let u=null,d=null;const p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=$t,this.physicallyCorrectLights=!1,this.toneMapping=K,this.toneMappingExposure=1;const m=this;let g=!1,v=0,_=0,y=null,b=-1,w=null;const x=new ni,M=new ni;let E=null,S=t.width,T=t.height,A=1,R=null,C=null;const P=new ni(0,0,S,T),L=new ni(0,0,S,T);let I=!1;const D=[],O=new zs;let N=!1,B=!1,z=null;const U=new Ui,k=new oi,H={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function V(){return null===y?A:1}let F,G,j,W,q,Y,X,Z,$,J,Q,ee,te,ne,ie,re,se,ae,oe,le,ce,he,ue=n;function pe(e,n){for(let i=0;i<e.length;i++){const r=e[i],s=t.getContext(r,n);if(null!==s)return s}return null}try{const e={alpha:i,depth:r,stencil:s,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(t.addEventListener("webglcontextlost",ve,!1),t.addEventListener("webglcontextrestored",_e,!1),null===ue){const t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),ue=pe(t,e),null===ue)throw pe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ue.getShaderPrecisionFormat&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function me(){F=new $s(ue),G=new Ys(ue,F,e),F.init(G),ce=new qo(ue,F,G),j=new jo(ue,F,G),D[0]=1029,W=new Qs(ue),q=new Po,Y=new Wo(ue,F,j,q,G,ce,W),X=new Zs(m),Z=new ks(ue,G),he=new Ws(ue,F,Z,G),$=new Js(ue,Z,W,he),J=new ia(ue,$,Z,W),ae=new na(ue),ie=new Xs(q),Q=new Co(m,X,F,G,he,ie),ee=new Ko(q),te=new Oo(q),ne=new Ho(F,G),se=new js(m,X,j,J,o),re=new Go(m,J,G),oe=new qs(ue,F,W,G),le=new Ks(ue,F,W,G),W.programs=Q.programs,m.capabilities=G,m.extensions=F,m.properties=q,m.renderLists=te,m.shadowMap=re,m.state=j,m.info=W}me();const ge=new Jo(m,ue);function ve(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function _e(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const e=W.autoReset,t=re.enabled,n=re.autoUpdate,i=re.needsUpdate,r=re.type;me(),W.autoReset=e,re.enabled=t,re.autoUpdate=n,re.needsUpdate=i,re.type=r}function ye(e){const t=e.target;t.removeEventListener("dispose",ye),function(e){(function(e){const t=q.get(e).programs;void 0!==t&&t.forEach((function(e){Q.releaseProgram(e)}))})(e),q.remove(e)}(t)}this.xr=ge,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){const e=F.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=F.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return A},this.setPixelRatio=function(e){void 0!==e&&(A=e,this.setSize(S,T,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Zn),e.set(S,T)},this.setSize=function(e,n,i){ge.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(S=e,T=n,t.width=Math.floor(e*A),t.height=Math.floor(n*A),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Zn),e.set(S*A,T*A).floor()},this.setDrawingBufferSize=function(e,n,i){S=e,T=n,A=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new ni),e.copy(x)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,n,i){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,i),j.viewport(x.copy(P).multiplyScalar(A).floor())},this.getScissor=function(e){return e.copy(L)},this.setScissor=function(e,t,n,i){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,n,i),j.scissor(M.copy(L).multiplyScalar(A).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(e){j.setScissorTest(I=e)},this.setOpaqueSort=function(e){R=e},this.setTransparentSort=function(e){C=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new Dr),e.copy(se.getClearColor())},this.setClearColor=function(){se.setClearColor.apply(se,arguments)},this.getClearAlpha=function(){return se.getClearAlpha()},this.setClearAlpha=function(){se.setClearAlpha.apply(se,arguments)},this.clear=function(e,t,n){let i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),ue.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ve,!1),t.removeEventListener("webglcontextrestored",_e,!1),te.dispose(),ne.dispose(),q.dispose(),X.dispose(),J.dispose(),he.dispose(),ge.dispose(),ge.removeEventListener("sessionstart",we),ge.removeEventListener("sessionend",Me),z&&(z.dispose(),z=null),Se.stop()},this.renderBufferImmediate=function(e,t){he.initAttributes();const n=q.get(e);e.hasPositions&&!n.position&&(n.position=ue.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=ue.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=ue.createBuffer()),e.hasColors&&!n.color&&(n.color=ue.createBuffer());const i=t.getAttributes();e.hasPositions&&(ue.bindBuffer(34962,n.position),ue.bufferData(34962,e.positionArray,35048),he.enableAttribute(i.position),ue.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(ue.bindBuffer(34962,n.normal),ue.bufferData(34962,e.normalArray,35048),he.enableAttribute(i.normal),ue.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(ue.bindBuffer(34962,n.uv),ue.bufferData(34962,e.uvArray,35048),he.enableAttribute(i.uv),ue.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(ue.bindBuffer(34962,n.color),ue.bufferData(34962,e.colorArray,35048),he.enableAttribute(i.color),ue.vertexAttribPointer(i.color,3,5126,!1,0,0)),he.disableUnusedAttributes(),ue.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,r,s){null===t&&(t=H);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=De(e,t,i,r);j.setMaterial(i,a);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,u=1;!0===i.wireframe&&(l=$.getWireframeAttribute(n),u=2),(i.morphTargets||i.morphNormals)&&ae.update(r,n,i,o),he.setup(r,i,o,n,l);let d=oe;null!==l&&(h=Z.get(l),d=le,d.setIndex(h));const p=null!==l?l.count:c.count,f=n.drawRange.start*u,m=n.drawRange.count*u,g=null!==s?s.start*u:0,v=null!==s?s.count*u:1/0,_=Math.max(f,g),y=Math.min(p,f+m,g+v)-1,b=Math.max(0,y-_+1);if(0!==b){if(r.isMesh)!0===i.wireframe?(j.setLineWidth(i.wireframeLinewidth*V()),d.setMode(1)):d.setMode(4);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),j.setLineWidth(e*V()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(_,b,r.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(_,b,e)}else d.render(_,b)}},this.compile=function(e,t){d=ne.get(e),d.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++)Ce(n[i],e,t);else Ce(n,e,t)}))};let be=null;function we(){Se.stop()}function Me(){Se.start()}const Se=new Us;function Te(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||O.intersectsSprite(e)){i&&k.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);const t=J.update(e),r=e.material;r.visible&&u.push(e,t,r,n,k.z,null)}}else if(e.isImmediateRenderObject)i&&k.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U),u.push(e,null,e.material,n,k.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==W.render.frame&&(e.skeleton.update(),e.skeleton.frame=W.render.frame),!e.frustumCulled||O.intersectsObject(e))){i&&k.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);const t=J.update(e),r=e.material;if(Array.isArray(r)){const i=t.groups;for(let s=0,a=i.length;s<a;s++){const a=i[s],o=r[a.materialIndex];o&&o.visible&&u.push(e,t,o,n,k.z,a)}}else r.visible&&u.push(e,t,r,n,k.z,null)}const r=e.children;for(let e=0,s=r.length;e<s;e++)Te(r[e],t,n,i)}function Ae(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],a=s.object,o=s.geometry,l=null===i?s.material:i,c=s.group;if(n.isArrayCamera){const e=n.cameras;for(let n=0,i=e.length;n<i;n++){const i=e[n];a.layers.test(i.layers)&&(j.viewport(x.copy(i.viewport)),d.setupLightsView(i),Re(a,t,i,o,l,c))}}else Re(a,t,n,o,l,c)}}function Re(e,t,n,i,r,s){if(e.onBeforeRender(m,t,n,i,r,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const i=De(n,t,r,e);j.setMaterial(r),he.reset(),function(e,t){e.render((function(e){m.renderBufferImmediate(e,t)}))}(e,i)}else m.renderBufferDirect(n,t,i,r,e,s);e.onAfterRender(m,t,n,i,r,s)}function Ce(e,t,n){!0!==t.isScene&&(t=H);const i=q.get(e),r=d.state.lights,s=d.state.shadowsArray,a=r.state.version,o=Q.getParameters(e,r.state,s,t,n),l=Q.getProgramCacheKey(o);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=X.get(e.envMap||i.environment),void 0===c&&(e.addEventListener("dispose",ye),c=new Map,i.programs=c);let h=c.get(l);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===a)return Ie(e,o),h}else o.uniforms=Q.getUniforms(e),e.onBuild(o,m),e.onBeforeCompile(o,m),h=Q.acquireProgram(o,l),c.set(l,h),i.uniforms=o.uniforms;const u=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(u.clippingPlanes=ie.uniform),Ie(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=h.getUniforms(),f=oo.seqWithValue(p.seq,u);return i.currentProgram=h,i.uniformsList=f,h}function Ie(e,t){const n=q.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas}function De(e,t,n,i){!0!==t.isScene&&(t=H),Y.resetTextureUnits();const r=t.fog,s=n.isMeshStandardMaterial?t.environment:null,a=null===y?m.outputEncoding:y.texture.encoding,o=X.get(n.envMap||s),l=!0===n.vertexColors&&i.geometry&&i.geometry.attributes.color&&4===i.geometry.attributes.color.itemSize,c=q.get(n),h=d.state.lights;if(!0===N&&(!0===B||e!==w)){const t=e===w&&n.id===b;ie.setState(n,e,t)}let u=!1;n.version===c.__version?c.needsLights&&c.lightsStateVersion!==h.state.version||c.outputEncoding!==a||i.isInstancedMesh&&!1===c.instancing?u=!0:i.isInstancedMesh||!0!==c.instancing?i.isSkinnedMesh&&!1===c.skinning?u=!0:i.isSkinnedMesh||!0!==c.skinning?c.envMap!==o||n.fog&&c.fog!==r?u=!0:void 0===c.numClippingPlanes||c.numClippingPlanes===ie.numPlanes&&c.numIntersection===ie.numIntersection?c.vertexAlphas!==l&&(u=!0):u=!0:u=!0:u=!0:(u=!0,c.__version=n.version);let p=c.currentProgram;!0===u&&(p=Ce(n,t,i));let f=!1,g=!1,v=!1;const _=p.getUniforms(),x=c.uniforms;if(j.useProgram(p.program)&&(f=!0,g=!0,v=!0),n.id!==b&&(b=n.id,g=!0),f||w!==e){if(_.setValue(ue,"projectionMatrix",e.projectionMatrix),G.logarithmicDepthBuffer&&_.setValue(ue,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),w!==e&&(w=e,g=!0,v=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=_.map.cameraPosition;void 0!==t&&t.setValue(ue,k.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&_.setValue(ue,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||i.isSkinnedMesh)&&_.setValue(ue,"viewMatrix",e.matrixWorldInverse)}if(i.isSkinnedMesh){_.setOptional(ue,i,"bindMatrix"),_.setOptional(ue,i,"bindMatrixInverse");const e=i.skeleton;e&&(G.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),_.setValue(ue,"boneTexture",e.boneTexture,Y),_.setValue(ue,"boneTextureSize",e.boneTextureSize)):_.setOptional(ue,e,"boneMatrices"))}var M,E;return(g||c.receiveShadow!==i.receiveShadow)&&(c.receiveShadow=i.receiveShadow,_.setValue(ue,"receiveShadow",i.receiveShadow)),g&&(_.setValue(ue,"toneMappingExposure",m.toneMappingExposure),c.needsLights&&(E=v,(M=x).ambientLightColor.needsUpdate=E,M.lightProbe.needsUpdate=E,M.directionalLights.needsUpdate=E,M.directionalLightShadows.needsUpdate=E,M.pointLights.needsUpdate=E,M.pointLightShadows.needsUpdate=E,M.spotLights.needsUpdate=E,M.spotLightShadows.needsUpdate=E,M.rectAreaLights.needsUpdate=E,M.hemisphereLights.needsUpdate=E),r&&n.fog&&ee.refreshFogUniforms(x,r),ee.refreshMaterialUniforms(x,n,A,T,z),oo.upload(ue,c.uniformsList,x,Y)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(oo.upload(ue,c.uniformsList,x,Y),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&_.setValue(ue,"center",i.center),_.setValue(ue,"modelViewMatrix",i.modelViewMatrix),_.setValue(ue,"normalMatrix",i.normalMatrix),_.setValue(ue,"modelMatrix",i.matrixWorld),p}Se.setAnimationLoop((function(e){be&&be(e)})),"undefined"!=typeof window&&Se.setContext(window),this.setAnimationLoop=function(e){be=e,ge.setAnimationLoop(e),null===e?Se.stop():Se.start()},ge.addEventListener("sessionstart",we),ge.addEventListener("sessionend",Me),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ge.enabled&&!0===ge.isPresenting&&(!0===ge.cameraAutoUpdate&&ge.updateCamera(t),t=ge.getCamera()),!0===e.isScene&&e.onBeforeRender(m,e,t,y),d=ne.get(e,f.length),d.init(),f.push(d),U.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),O.setFromProjectionMatrix(U),B=this.localClippingEnabled,N=ie.init(this.clippingPlanes,B,t),u=te.get(e,p.length),u.init(),p.push(u),Te(e,t,0,m.sortObjects),u.finish(),!0===m.sortObjects&&u.sort(R,C),!0===N&&ie.beginShadows();const n=d.state.shadowsArray;re.render(n,e,t),d.setupLights(),d.setupLightsView(t),!0===N&&ie.endShadows(),!0===this.info.autoReset&&this.info.reset(),se.render(u,e);const i=u.opaque,r=u.transmissive,s=u.transparent;i.length>0&&Ae(i,e,t),r.length>0&&function(e,t,n,i){null===z&&(z=new ii(1024,1024,{generateMipmaps:!0,minFilter:xe,magFilter:fe,wrapS:de,wrapT:de}));const r=m.getRenderTarget();m.setRenderTarget(z),m.clear(),Ae(e,n,i),Y.updateRenderTargetMipmap(z),m.setRenderTarget(r),Ae(t,n,i)}(i,r,e,t),s.length>0&&Ae(s,e,t),null!==y&&(Y.updateRenderTargetMipmap(y),Y.updateMultisampleRenderTarget(y)),!0===e.isScene&&e.onAfterRender(m,e,t),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),he.resetDefaultState(),b=-1,w=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return y},this.setRenderTarget=function(e,t=0,n=0){y=e,v=t,_=n,e&&void 0===q.get(e).__webglFramebuffer&&Y.setupRenderTarget(e);let i=null,r=!1,s=!1;if(e){const n=e.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(s=!0);const a=q.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=a[t],r=!0):i=e.isWebGLMultisampleRenderTarget?q.get(e).__webglMultisampledFramebuffer:a,x.copy(e.viewport),M.copy(e.scissor),E=e.scissorTest}else x.copy(P).multiplyScalar(A).floor(),M.copy(L).multiplyScalar(A).floor(),E=I;if(j.bindFramebuffer(36160,i)&&G.drawBuffers){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const n=e.texture;if(D.length!==n.length||36064!==D[0]){for(let e=0,t=n.length;e<t;e++)D[e]=36064+e;D.length=n.length,t=!0}}else 1===D.length&&36064===D[0]||(D[0]=36064,D.length=1,t=!0);else 1===D.length&&1029===D[0]||(D[0]=1029,D.length=1,t=!0);t&&(G.isWebGL2?ue.drawBuffers(D):F.get("WEBGL_draw_buffers").drawBuffersWEBGL(D))}if(j.viewport(x),j.scissor(M),j.setScissorTest(E),r){const i=q.get(e.texture);ue.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,n)}else if(s){const i=q.get(e.texture),r=t||0;ue.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}},this.readRenderTargetPixels=function(e,t,n,i,r,s,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){j.bindFramebuffer(36160,o);try{const a=e.texture,o=a.format,l=a.type;if(o!==Ue&&ce.convert(o)!==ue.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Le&&(F.has("EXT_color_buffer_half_float")||G.isWebGL2&&F.has("EXT_color_buffer_float"));if(!(l===Ee||ce.convert(l)===ue.getParameter(35738)||l===Pe&&(G.isWebGL2||F.has("OES_texture_float")||F.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ue.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&ue.readPixels(t,n,i,r,ce.convert(o),ce.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==y?q.get(y).__webglFramebuffer:null;j.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),s=Math.floor(t.image.height*i);let a=ce.convert(t.format);G.isWebGL2&&(6407===a&&(a=32849),6408===a&&(a=32856)),Y.setTexture2D(t,0),ue.copyTexImage2D(3553,n,a,e.x,e.y,r,s,0),j.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const r=t.image.width,s=t.image.height,a=ce.convert(n.format),o=ce.convert(n.type);Y.setTexture2D(n,0),ue.pixelStorei(37440,n.flipY),ue.pixelStorei(37441,n.premultiplyAlpha),ue.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?ue.texSubImage2D(3553,i,e.x,e.y,r,s,a,o,t.image.data):t.isCompressedTexture?ue.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):ue.texSubImage2D(3553,i,e.x,e.y,a,o,t.image),0===i&&n.generateMipmaps&&ue.generateMipmap(3553),j.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,r=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const{width:s,height:a,data:o}=n.image,l=ce.convert(i.format),c=ce.convert(i.type);let h;if(i.isDataTexture3D)Y.setTexture3D(i,0),h=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Y.setTexture2DArray(i,0),h=35866}ue.pixelStorei(37440,i.flipY),ue.pixelStorei(37441,i.premultiplyAlpha),ue.pixelStorei(3317,i.unpackAlignment);const u=ue.getParameter(3314),d=ue.getParameter(32878),p=ue.getParameter(3316),f=ue.getParameter(3315),g=ue.getParameter(32877);ue.pixelStorei(3314,s),ue.pixelStorei(32878,a),ue.pixelStorei(3316,e.min.x),ue.pixelStorei(3315,e.min.y),ue.pixelStorei(32877,e.min.z),ue.texSubImage3D(h,r,t.x,t.y,t.z,e.max.x-e.min.x+1,e.max.y-e.min.y+1,e.max.z-e.min.z+1,l,c,o),ue.pixelStorei(3314,u),ue.pixelStorei(32878,d),ue.pixelStorei(3316,p),ue.pixelStorei(3315,f),ue.pixelStorei(32877,g),0===r&&i.generateMipmaps&&ue.generateMipmap(h),j.unbindTexture()},this.initTexture=function(e){Y.setTexture2D(e,0),j.unbindTexture()},this.resetState=function(){v=0,_=0,y=null,j.reset(),he.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class el extends Qo{}el.prototype.isWebGL1Renderer=!0;class tl{constructor(e,t=25e-5){this.name="",this.color=new Dr(e),this.density=t}clone(){return new tl(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}tl.prototype.isFogExp2=!0;class nl{constructor(e,t=1,n=1e3){this.name="",this.color=new Dr(e),this.near=t,this.far=n}clone(){return new nl(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}nl.prototype.isFog=!0;class il extends cr{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}il.prototype.isScene=!0;class rl{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Sn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Vn()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Vn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Vn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}rl.prototype.isInterleavedBuffer=!0;const sl=new oi;class al{constructor(e,t,n,i){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)sl.x=this.getX(t),sl.y=this.getY(t),sl.z=this.getZ(t),sl.applyMatrix4(e),this.setXYZ(t,sl.x,sl.y,sl.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)sl.x=this.getX(t),sl.y=this.getY(t),sl.z=this.getZ(t),sl.applyNormalMatrix(e),this.setXYZ(t,sl.x,sl.y,sl.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)sl.x=this.getX(t),sl.y=this.getY(t),sl.z=this.getZ(t),sl.transformDirection(e),this.setXYZ(t,sl.x,sl.y,sl.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new zr(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new al(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}al.prototype.isInterleavedBufferAttribute=!0;class ol extends Tr{constructor(e){super(),this.type="SpriteMaterial",this.color=new Dr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let ll;ol.prototype.isSpriteMaterial=!0;const cl=new oi,hl=new oi,ul=new oi,dl=new Zn,pl=new Zn,fl=new Ui,ml=new oi,gl=new oi,vl=new oi,_l=new Zn,yl=new Zn,bl=new Zn;class wl extends cr{constructor(e){if(super(),this.type="Sprite",void 0===ll){ll=new rs;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new rl(e,5);ll.setIndex([0,1,2,0,2,3]),ll.setAttribute("position",new al(t,3,0,!1)),ll.setAttribute("uv",new al(t,2,3,!1))}this.geometry=ll,this.material=void 0!==e?e:new ol,this.center=new Zn(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),hl.setFromMatrixScale(this.matrixWorld),fl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ul.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&hl.multiplyScalar(-ul.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;xl(ml.set(-.5,-.5,0),ul,s,hl,i,r),xl(gl.set(.5,-.5,0),ul,s,hl,i,r),xl(vl.set(.5,.5,0),ul,s,hl,i,r),_l.set(0,0),yl.set(1,0),bl.set(1,1);let a=e.ray.intersectTriangle(ml,gl,vl,!1,cl);if(null===a&&(xl(gl.set(-.5,.5,0),ul,s,hl,i,r),yl.set(0,1),a=e.ray.intersectTriangle(ml,vl,gl,!1,cl),null===a))return;const o=e.ray.origin.distanceTo(cl);o<e.near||o>e.far||t.push({distance:o,point:cl.clone(),uv:Er.getUV(cl,ml,gl,vl,_l,yl,bl,new Zn),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function xl(e,t,n,i,r,s){dl.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(pl.x=s*dl.x-r*dl.y,pl.y=r*dl.x+s*dl.y):pl.copy(dl),e.copy(t),e.x+=pl.x,e.y+=pl.y,e.applyMatrix4(fl)}wl.prototype.isSprite=!0;const Ml=new oi,El=new oi;class Sl extends cr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Ml.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Ml);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Ml.setFromMatrixPosition(e.matrixWorld),El.setFromMatrixPosition(this.matrixWorld);const n=Ml.distanceTo(El)/e.zoom;let i,r;for(t[0].object.visible=!0,i=1,r=t.length;i<r&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,i=n.length;e<i;e++){const i=n[e];t.object.levels.push({object:i.object.uuid,distance:i.distance})}return t}}const Tl=new oi,Al=new ni,Rl=new ni,Cl=new oi,Pl=new Ui;class Ll extends xs{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ui,this.bindMatrixInverse=new Ui}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ni,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;Al.fromBufferAttribute(i.attributes.skinIndex,e),Rl.fromBufferAttribute(i.attributes.skinWeight,e),Tl.fromBufferAttribute(i.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const i=Rl.getComponent(e);if(0!==i){const r=Al.getComponent(e);Pl.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(Cl.copy(Tl).applyMatrix4(Pl),i)}}return t.applyMatrix4(this.bindMatrixInverse)}}Ll.prototype.isSkinnedMesh=!0;class Il extends cr{constructor(){super(),this.type="Bone"}}Il.prototype.isBone=!0;class Dl extends ei{constructor(e,t,n,i,r,s,a,o,l,c,h,u){super(null,s,a,o,l,c,i,r,h,u),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:fe,this.minFilter=void 0!==c?c:fe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Dl.prototype.isDataTexture=!0;const Ol=new Ui,Nl=new Ui;class Bl{constructor(e=[],t=[]){this.uuid=Vn(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Ui)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Ui;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=e.length;i<r;i++){const r=e[i]?e[i].matrixWorld:Nl;Ol.multiplyMatrices(r,t[i]),Ol.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new Bl(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=qn(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Dl(t,e,e,Ue,Pe);return this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new Il),this.bones.push(r),this.boneInverses.push((new Ui).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const s=n[i];e.boneInverses.push(s.toArray())}return e}}const zl=new Ui,Ul=new Ui,kl=[],Hl=new xs;class Vl extends xs{constructor(e,t,n){super(e,t),this.instanceMatrix=new zr(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Hl.geometry=this.geometry,Hl.material=this.material,void 0!==Hl.material)for(let r=0;r<i;r++){this.getMatrixAt(r,zl),Ul.multiplyMatrices(n,zl),Hl.matrixWorld=Ul,Hl.raycast(e,kl);for(let e=0,n=kl.length;e<n;e++){const n=kl[e];n.instanceId=r,n.object=this,t.push(n)}kl.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new zr(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Vl.prototype.isInstancedMesh=!0;class Fl extends Tr{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Dr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}Fl.prototype.isLineBasicMaterial=!0;const Gl=new oi,jl=new oi,Wl=new Ui,ql=new zi,Yl=new Ci;class Xl extends cr{constructor(e=new rs,t=new Fl){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)Gl.fromBufferAttribute(t,e-1),jl.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Gl.distanceTo(jl);e.setAttribute("lineDistance",new qr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Yl.copy(n.boundingSphere),Yl.applyMatrix4(i),Yl.radius+=r,!1===e.ray.intersectsSphere(Yl))return;Wl.copy(i).invert(),ql.copy(e.ray).applyMatrix4(Wl);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new oi,c=new oi,h=new oi,u=new oi,d=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position;if(null!==i)for(let n=Math.max(0,s.start),a=Math.min(i.count,s.start+s.count)-1;n<a;n+=d){const s=i.getX(n),a=i.getX(n+1);if(l.fromBufferAttribute(r,s),c.fromBufferAttribute(r,a),ql.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(u);d<e.near||d>e.far||t.push({distance:d,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,s.start),i=Math.min(r.count,s.start+s.count)-1;n<i;n+=d){if(l.fromBufferAttribute(r,n),c.fromBufferAttribute(r,n+1),ql.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Xl.prototype.isLine=!0;const Zl=new oi,$l=new oi;class Jl extends Xl{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)Zl.fromBufferAttribute(t,e),$l.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Zl.distanceTo($l);e.setAttribute("lineDistance",new qr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Jl.prototype.isLineSegments=!0;class Kl extends Xl{constructor(e,t){super(e,t),this.type="LineLoop"}}Kl.prototype.isLineLoop=!0;class Ql extends Tr{constructor(e){super(),this.type="PointsMaterial",this.color=new Dr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}Ql.prototype.isPointsMaterial=!0;const ec=new Ui,tc=new zi,nc=new Ci,ic=new oi;class rc extends cr{constructor(e=new rs,t=new Ql){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),nc.copy(n.boundingSphere),nc.applyMatrix4(i),nc.radius+=r,!1===e.ray.intersectsSphere(nc))return;ec.copy(i).invert(),tc.copy(e.ray).applyMatrix4(ec);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(n.isBufferGeometry){const r=n.index,a=n.attributes.position;if(null!==r)for(let n=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);n<l;n++){const s=r.getX(n);ic.fromBufferAttribute(a,s),sc(ic,s,o,i,e,t,this)}else for(let n=Math.max(0,s.start),r=Math.min(a.count,s.start+s.count);n<r;n++)ic.fromBufferAttribute(a,n),sc(ic,n,o,i,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function sc(e,t,n,i,r,s,a){const o=tc.distanceSqToPoint(e);if(o<n){const n=new oi;tc.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,object:a})}}rc.prototype.isPoints=!0;class ac extends ei{constructor(e,t,n,i,r,s,a,o,l){super(e,t,n,i,r,s,a,o,l),this.format=void 0!==a?a:ze,this.minFilter=void 0!==s?s:ye,this.magFilter=void 0!==r?r:ye,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}ac.prototype.isVideoTexture=!0;class oc extends ei{constructor(e,t,n,i,r,s,a,o,l,c,h,u){super(null,s,a,o,l,c,i,r,h,u),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}oc.prototype.isCompressedTexture=!0;class lc extends ei{constructor(e,t,n,i,r,s,a,o,l){super(e,t,n,i,r,s,a,o,l),this.needsUpdate=!0}}lc.prototype.isCanvasTexture=!0;class cc extends ei{constructor(e,t,n,i,r,s,a,o,l,c){if((c=void 0!==c?c:Fe)!==Fe&&c!==Ge)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Fe&&(n=Ae),void 0===n&&c===Ge&&(n=Ne),super(null,i,r,s,a,o,c,n,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:fe,this.minFilter=void 0!==o?o:fe,this.flipY=!1,this.generateMipmaps=!1}}cc.prototype.isDepthTexture=!0;class hc extends rs{constructor(e=1,t=8,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],s=[],a=[],o=[],l=new oi,c=new Zn;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let r=0,h=3;r<=t;r++,h+=3){const u=n+r/t*i;l.x=e*Math.cos(u),l.y=e*Math.sin(u),s.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(s[h]/e+1)/2,c.y=(s[h+1]/e+1)/2,o.push(c.x,c.y)}for(let e=1;e<=t;e++)r.push(e,e+1,0);this.setIndex(r),this.setAttribute("position",new qr(s,3)),this.setAttribute("normal",new qr(a,3)),this.setAttribute("uv",new qr(o,2))}}class uc extends rs{constructor(e=1,t=1,n=1,i=8,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],h=[],u=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const r=p,s=new Zn,f=new oi;let v=0;const _=!0===n?e:t,y=!0===n?1:-1;for(let e=1;e<=i;e++)h.push(0,m*y,0),u.push(0,y,0),d.push(.5,.5),p++;const b=p;for(let e=0;e<=i;e++){const t=e/i*o+a,n=Math.cos(t),r=Math.sin(t);f.x=_*r,f.y=m*y,f.z=_*n,h.push(f.x,f.y,f.z),u.push(0,y,0),s.x=.5*n+.5,s.y=.5*r*y+.5,d.push(s.x,s.y),p++}for(let e=0;e<i;e++){const t=r+e,i=b+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const s=new oi,v=new oi;let _=0;const y=(t-e)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,_=g*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*o+a,l=Math.sin(r),f=Math.cos(r);v.x=_*l,v.y=-g*n+m,v.z=_*f,h.push(v.x,v.y,v.z),s.set(l,y,f).normalize(),u.push(s.x,s.y,s.z),d.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<i;e++)for(let t=0;t<r;t++){const n=f[t][e],i=f[t+1][e],r=f[t+1][e+1],s=f[t][e+1];c.push(n,i,s),c.push(i,r,s),_+=6}l.addGroup(g,_,0),g+=_}(),!1===s&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new qr(h,3)),this.setAttribute("normal",new qr(u,3)),this.setAttribute("uv",new qr(d,2))}}class dc extends uc{constructor(e=1,t=1,n=8,i=1,r=!1,s=0,a=2*Math.PI){super(0,e,t,n,i,r,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a}}}class pc extends rs{constructor(e,t,n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],s=[];function a(e,t,n,i){const r=i+1,s=[];for(let i=0;i<=r;i++){s[i]=[];const a=e.clone().lerp(n,i/r),o=t.clone().lerp(n,i/r),l=r-i;for(let e=0;e<=l;e++)s[i][e]=0===e&&i===r?a:a.clone().lerp(o,e/l)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){const n=Math.floor(t/2);t%2==0?(o(s[e][n+1]),o(s[e+1][n]),o(s[e][n])):(o(s[e][n+1]),o(s[e+1][n+1]),o(s[e+1][n]))}}function o(e){r.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=i/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new oi,i=new oi,r=new oi;for(let s=0;s<t.length;s+=3)l(t[s+0],n),l(t[s+1],i),l(t[s+2],r),a(n,i,r,e)}(i),function(e){const t=new oi;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new oi;for(let n=0;n<r.length;n+=3){e.x=r[n+0],e.y=r[n+1],e.z=r[n+2];const i=h(e)/2/Math.PI+.5,a=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);s.push(i,1-a)}var t;(function(){const e=new oi,t=new oi,n=new oi,i=new oi,a=new Zn,o=new Zn,l=new Zn;for(let u=0,d=0;u<r.length;u+=9,d+=6){e.set(r[u+0],r[u+1],r[u+2]),t.set(r[u+3],r[u+4],r[u+5]),n.set(r[u+6],r[u+7],r[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),i.copy(e).add(t).add(n).divideScalar(3);const p=h(i);c(a,d+0,e,p),c(o,d+2,t,p),c(l,d+4,n,p)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],n=s[e+2],i=s[e+4],r=Math.max(t,n,i),a=Math.min(t,n,i);r>.9&&a<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),i<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new qr(r,3)),this.setAttribute("normal",new qr(r.slice(),3)),this.setAttribute("uv",new qr(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}}class fc extends pc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}}const mc=new oi,gc=new oi,vc=new oi,_c=new Er;class yc extends rs{constructor(e,t){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,!0===e.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const n=Math.pow(10,4),i=Math.cos(kn*t),r=e.getIndex(),s=e.getAttribute("position"),a=r?r.count:s.count,o=[0,0,0],l=["a","b","c"],c=new Array(3),h={},u=[];for(let e=0;e<a;e+=3){r?(o[0]=r.getX(e),o[1]=r.getX(e+1),o[2]=r.getX(e+2)):(o[0]=e,o[1]=e+1,o[2]=e+2);const{a:t,b:a,c:d}=_c;if(t.fromBufferAttribute(s,o[0]),a.fromBufferAttribute(s,o[1]),d.fromBufferAttribute(s,o[2]),_c.getNormal(vc),c[0]=`${Math.round(t.x*n)},${Math.round(t.y*n)},${Math.round(t.z*n)}`,c[1]=`${Math.round(a.x*n)},${Math.round(a.y*n)},${Math.round(a.z*n)}`,c[2]=`${Math.round(d.x*n)},${Math.round(d.y*n)},${Math.round(d.z*n)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=c[e],r=c[t],s=_c[l[e]],a=_c[l[t]],d=`${n}_${r}`,p=`${r}_${n}`;p in h&&h[p]?(vc.dot(h[p].normal)<=i&&(u.push(s.x,s.y,s.z),u.push(a.x,a.y,a.z)),h[p]=null):d in h||(h[d]={index0:o[e],index1:o[t],normal:vc.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:n}=h[e];mc.fromBufferAttribute(s,t),gc.fromBufferAttribute(s,n),u.push(mc.x,mc.y,mc.z),u.push(gc.x,gc.y,gc.z)}this.setAttribute("position",new qr(u,3))}}function bc(e,t,n,i,r){let s,a;if(r===function(e,t,n,i){let r=0;for(let s=t,a=n-i;s<n;s+=i)r+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return r}(e,t,n,i)>0)for(s=t;s<n;s+=i)a=Vc(s,e[s],e[s+1],a);else for(s=n-i;s>=t;s-=i)a=Vc(s,e[s],e[s+1],a);return a&&Nc(a,a.next)&&(Fc(a),a=a.next),a}function wc(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!Nc(i,i.next)&&0!==Oc(i.prev,i,i.next))i=i.next;else{if(Fc(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function xc(e,t,n,i,r,s,a){if(!e)return;!a&&s&&function(e,t,n,i){let r=e;do{null===r.z&&(r.z=Pc(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,s,a,o,l,c=1;do{for(n=e,e=null,s=null,a=0;n;){for(a++,i=n,o=0,t=0;t<c&&(o++,i=i.nextZ,i);t++);for(l=c;o>0||l>0&&i;)0!==o&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(a>1)}(r)}(e,i,r,s);let o,l,c=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,s?Ec(e,i,r,s):Mc(e))t.push(o.i/n),t.push(e.i/n),t.push(l.i/n),Fc(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?xc(e=Sc(wc(e),t,n),t,n,i,r,s,2):2===a&&Tc(e,t,n,i,r,s):xc(wc(e),t,n,i,r,s,1);break}}function Mc(e){const t=e.prev,n=e,i=e.next;if(Oc(t,n,i)>=0)return!1;let r=e.next.next;for(;r!==e.prev;){if(Ic(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Oc(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Ec(e,t,n,i){const r=e.prev,s=e,a=e.next;if(Oc(r,s,a)>=0)return!1;const o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,l=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,c=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,h=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,u=Pc(o,l,t,n,i),d=Pc(c,h,t,n,i);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=u&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&Ic(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&Oc(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&Ic(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&Oc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==e.prev&&p!==e.next&&Ic(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&Oc(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&Ic(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&Oc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Sc(e,t,n){let i=e;do{const r=i.prev,s=i.next.next;!Nc(r,s)&&Bc(r,i,i.next,s)&&kc(r,s)&&kc(s,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(s.i/n),Fc(i),Fc(i.next),i=e=s),i=i.next}while(i!==e);return wc(i)}function Tc(e,t,n,i,r,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Dc(a,e)){let o=Hc(a,e);return a=wc(a,a.next),o=wc(o,o.next),xc(a,t,n,i,r,s),void xc(o,t,n,i,r,s)}e=e.next}a=a.next}while(a!==e)}function Ac(e,t){return e.x-t.x}function Rc(e,t){if(t=function(e,t){let n=t;const i=e.x,r=e.y;let s,a=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const e=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>a){if(a=e,e===i){if(r===n.y)return n;if(r===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!s)return null;if(i===a)return s;const o=s,l=s.x,c=s.y;let h,u=1/0;n=s;do{i>=n.x&&n.x>=l&&i!==n.x&&Ic(r<c?i:a,r,l,c,r<c?a:i,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(i-n.x),kc(n,e)&&(h<u||h===u&&(n.x>s.x||n.x===s.x&&Cc(s,n)))&&(s=n,u=h)),n=n.next}while(n!==o);return s}(e,t)){const n=Hc(t,e);wc(t,t.next),wc(n,n.next)}}function Cc(e,t){return Oc(e.prev,e,t.prev)<0&&Oc(t.next,e,e.next)<0}function Pc(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Lc(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ic(e,t,n,i,r,s,a,o){return(r-a)*(t-o)-(e-a)*(s-o)>=0&&(e-a)*(i-o)-(n-a)*(t-o)>=0&&(n-a)*(s-o)-(r-a)*(i-o)>=0}function Dc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Bc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(kc(e,t)&&kc(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Oc(e.prev,e,t.prev)||Oc(e,t.prev,t))||Nc(e,t)&&Oc(e.prev,e,e.next)>0&&Oc(t.prev,t,t.next)>0)}function Oc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Nc(e,t){return e.x===t.x&&e.y===t.y}function Bc(e,t,n,i){const r=Uc(Oc(e,t,n)),s=Uc(Oc(e,t,i)),a=Uc(Oc(n,i,e)),o=Uc(Oc(n,i,t));return r!==s&&a!==o||!(0!==r||!zc(e,n,t))||!(0!==s||!zc(e,i,t))||!(0!==a||!zc(n,e,i))||!(0!==o||!zc(n,t,i))}function zc(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Uc(e){return e>0?1:e<0?-1:0}function kc(e,t){return Oc(e.prev,e,e.next)<0?Oc(e,t,e.next)>=0&&Oc(e,e.prev,t)>=0:Oc(e,t,e.prev)<0||Oc(e,e.next,t)<0}function Hc(e,t){const n=new Gc(e.i,e.x,e.y),i=new Gc(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Vc(e,t,n,i){const r=new Gc(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Fc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Gc(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class jc{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return jc.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];Wc(e),qc(n,e);let s=e.length;t.forEach(Wc);for(let e=0;e<t.length;e++)i.push(s),s+=t[e].length,qc(n,t[e]);const a=function(e,t,n){n=n||2;const i=t&&t.length,r=i?t[0]*n:e.length;let s=bc(e,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,h,u,d,p;if(i&&(s=function(e,t,n,i){const r=[];let s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*i,l=s<a-1?t[s+1]*i:e.length,c=bc(e,o,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Lc(c));for(r.sort(Ac),s=0;s<r.length;s++)Rc(r[s],n),n=wc(n,n.next);return n}(e,t,s,n)),e.length>80*n){o=c=e[0],l=h=e[1];for(let t=n;t<r;t+=n)u=e[t],d=e[t+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-o,h-l),p=0!==p?1/p:0}return xc(s,a,n,o,l,p),a}(n,i);for(let e=0;e<a.length;e+=3)r.push(a.slice(e,e+3));return r}}function Wc(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function qc(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Yc extends rs{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let t=0,n=e.length;t<n;t++)s(e[t]);function s(e){const s=[],a=void 0!==t.curveSegments?t.curveSegments:12,o=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:6,u=void 0!==t.bevelSize?t.bevelSize:h-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Xc;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let g,v,_,y,b,w=!1;f&&(g=f.getSpacedPoints(o),w=!0,c=!1,v=f.computeFrenetFrames(o,!1),_=new oi,y=new oi,b=new oi),c||(p=0,h=0,u=0,d=0);const x=e.extractPoints(a);let M=x.shape;const E=x.holes;if(!jc.isClockWise(M)){M=M.reverse();for(let e=0,t=E.length;e<t;e++){const t=E[e];jc.isClockWise(t)&&(E[e]=t.reverse())}}const S=jc.triangulateShape(M,E),T=M;for(let e=0,t=E.length;e<t;e++){const t=E[e];M=M.concat(t)}function A(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const R=M.length,C=S.length;function P(e,t,n){let i,r,s;const a=e.x-t.x,o=e.y-t.y,l=n.x-e.x,c=n.y-e.y,h=a*a+o*o,u=a*c-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=t.x-o/u,f=t.y+a/u,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(a*c-o*l);i=p+a*m-e.x,r=f+o*m-e.y;const g=i*i+r*r;if(g<=2)return new Zn(i,r);s=Math.sqrt(g/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(i=-o,r=a,s=Math.sqrt(h)):(i=a,r=o,s=Math.sqrt(h/2))}return new Zn(i/s,r/s)}const L=[];for(let e=0,t=T.length,n=t-1,i=e+1;e<t;e++,n++,i++)n===t&&(n=0),i===t&&(i=0),L[e]=P(T[e],T[n],T[i]);const I=[];let D,O=L.concat();for(let e=0,t=E.length;e<t;e++){const t=E[e];D=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),D[e]=P(t[e],t[i],t[r]);I.push(D),O=O.concat(D)}for(let e=0;e<p;e++){const t=e/p,n=h*Math.cos(t*Math.PI/2),i=u*Math.sin(t*Math.PI/2)+d;for(let e=0,t=T.length;e<t;e++){const t=A(T[e],L[e],i);z(t.x,t.y,-n)}for(let e=0,t=E.length;e<t;e++){const t=E[e];D=I[e];for(let e=0,r=t.length;e<r;e++){const r=A(t[e],D[e],i);z(r.x,r.y,-n)}}}const N=u+d;for(let e=0;e<R;e++){const t=c?A(M[e],O[e],N):M[e];w?(y.copy(v.normals[0]).multiplyScalar(t.x),_.copy(v.binormals[0]).multiplyScalar(t.y),b.copy(g[0]).add(y).add(_),z(b.x,b.y,b.z)):z(t.x,t.y,0)}for(let e=1;e<=o;e++)for(let t=0;t<R;t++){const n=c?A(M[t],O[t],N):M[t];w?(y.copy(v.normals[e]).multiplyScalar(n.x),_.copy(v.binormals[e]).multiplyScalar(n.y),b.copy(g[e]).add(y).add(_),z(b.x,b.y,b.z)):z(n.x,n.y,l/o*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=h*Math.cos(t*Math.PI/2),i=u*Math.sin(t*Math.PI/2)+d;for(let e=0,t=T.length;e<t;e++){const t=A(T[e],L[e],i);z(t.x,t.y,l+n)}for(let e=0,t=E.length;e<t;e++){const t=E[e];D=I[e];for(let e=0,r=t.length;e<r;e++){const r=A(t[e],D[e],i);w?z(r.x,r.y+g[o-1].y,g[o-1].x+n):z(r.x,r.y,l+n)}}}function B(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=o+2*p;e<n;e++){const n=R*e,s=R*(e+1);k(t+i+n,t+r+n,t+r+s,t+i+s)}}}function z(e,t,n){s.push(e),s.push(t),s.push(n)}function U(e,t,r){H(e),H(t),H(r);const s=i.length/3,a=m.generateTopUV(n,i,s-3,s-2,s-1);V(a[0]),V(a[1]),V(a[2])}function k(e,t,r,s){H(e),H(t),H(s),H(t),H(r),H(s);const a=i.length/3,o=m.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);V(o[0]),V(o[1]),V(o[3]),V(o[1]),V(o[2]),V(o[3])}function H(e){i.push(s[3*e+0]),i.push(s[3*e+1]),i.push(s[3*e+2])}function V(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(c){let e=0,t=R*e;for(let e=0;e<C;e++){const n=S[e];U(n[2]+t,n[1]+t,n[0]+t)}e=o+2*p,t=R*e;for(let e=0;e<C;e++){const n=S[e];U(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<C;e++){const t=S[e];U(t[2],t[1],t[0])}for(let e=0;e<C;e++){const t=S[e];U(t[0]+R*o,t[1]+R*o,t[2]+R*o)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;B(T,t),t+=T.length;for(let e=0,n=E.length;e<n;e++){const n=E[e];B(n,t),t+=n.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new qr(i,3)),this.setAttribute("uv",new qr(r,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,i=e.length;t<i;t++){const i=e[t];n.shapes.push(i.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}}const Xc={generateTopUV:function(e,t,n,i,r){const s=t[3*n],a=t[3*n+1],o=t[3*i],l=t[3*i+1],c=t[3*r],h=t[3*r+1];return[new Zn(s,a),new Zn(o,l),new Zn(c,h)]},generateSideWallUV:function(e,t,n,i,r,s){const a=t[3*n],o=t[3*n+1],l=t[3*n+2],c=t[3*i],h=t[3*i+1],u=t[3*i+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*s],g=t[3*s+1],v=t[3*s+2];return Math.abs(o-h)<Math.abs(a-c)?[new Zn(a,1-l),new Zn(c,1-u),new Zn(d,1-f),new Zn(m,1-v)]:[new Zn(o,1-l),new Zn(h,1-u),new Zn(p,1-f),new Zn(g,1-v)]}};class Zc extends pc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}}class $c extends rs{constructor(e,t=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=Fn(i,0,2*Math.PI);const r=[],s=[],a=[],o=1/t,l=new oi,c=new Zn;for(let r=0;r<=t;r++){const h=n+r*o*i,u=Math.sin(h),d=Math.cos(h);for(let n=0;n<=e.length-1;n++)l.x=e[n].x*u,l.y=e[n].y,l.z=e[n].x*d,s.push(l.x,l.y,l.z),c.x=r/t,c.y=n/(e.length-1),a.push(c.x,c.y)}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const i=t+n*e.length,s=i,a=i+e.length,o=i+e.length+1,l=i+1;r.push(s,a,l),r.push(a,o,l)}if(this.setIndex(r),this.setAttribute("position",new qr(s,3)),this.setAttribute("uv",new qr(a,2)),this.computeVertexNormals(),i===2*Math.PI){const n=this.attributes.normal.array,i=new oi,r=new oi,s=new oi,a=t*e.length*3;for(let t=0,o=0;t<e.length;t++,o+=3)i.x=n[o+0],i.y=n[o+1],i.z=n[o+2],r.x=n[a+o+0],r.y=n[a+o+1],r.z=n[a+o+2],s.addVectors(i,r).normalize(),n[o+0]=n[a+o+0]=s.x,n[o+1]=n[a+o+1]=s.y,n[o+2]=n[a+o+2]=s.z}}}class Jc extends pc{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}}class Kc extends rs{constructor(e,t,n){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};const i=[],r=[],s=[],a=[],o=1e-5,l=new oi,c=new oi,h=new oi,u=new oi,d=new oi;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=t+1;for(let i=0;i<=n;i++){const p=i/n;for(let n=0;n<=t;n++){const i=n/t;e(i,p,c),r.push(c.x,c.y,c.z),i-o>=0?(e(i-o,p,h),u.subVectors(c,h)):(e(i+o,p,h),u.subVectors(h,c)),p-o>=0?(e(i,p-o,h),d.subVectors(c,h)):(e(i,p+o,h),d.subVectors(h,c)),l.crossVectors(u,d).normalize(),s.push(l.x,l.y,l.z),a.push(i,p)}}for(let e=0;e<n;e++)for(let n=0;n<t;n++){const t=e*p+n,r=e*p+n+1,s=(e+1)*p+n+1,a=(e+1)*p+n;i.push(t,r,a),i.push(r,s,a)}this.setIndex(i),this.setAttribute("position",new qr(r,3)),this.setAttribute("normal",new qr(s,3)),this.setAttribute("uv",new qr(a,2))}}class Qc extends rs{constructor(e=.5,t=1,n=8,i=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n);const a=[],o=[],l=[],c=[];let h=e;const u=(t-e)/(i=Math.max(1,i)),d=new oi,p=new Zn;for(let e=0;e<=i;e++){for(let e=0;e<=n;e++){const i=r+e/n*s;d.x=h*Math.cos(i),d.y=h*Math.sin(i),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}h+=u}for(let e=0;e<i;e++){const t=e*(n+1);for(let e=0;e<n;e++){const i=e+t,r=i,s=i+n+1,o=i+n+2,l=i+1;a.push(r,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new qr(o,3)),this.setAttribute("normal",new qr(l,3)),this.setAttribute("uv",new qr(c,2))}}class eh extends rs{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(a,o,t),a+=o,o=0;function l(e){const a=i.length/3,l=e.extractPoints(t);let c=l.shape;const h=l.holes;!1===jc.isClockWise(c)&&(c=c.reverse());for(let e=0,t=h.length;e<t;e++){const t=h[e];!0===jc.isClockWise(t)&&(h[e]=t.reverse())}const u=jc.triangulateShape(c,h);for(let e=0,t=h.length;e<t;e++){const t=h[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];i.push(t.x,t.y,0),r.push(0,0,1),s.push(t.x,t.y)}for(let e=0,t=u.length;e<t;e++){const t=u[e],i=t[0]+a,r=t[1]+a,s=t[2]+a;n.push(i,r,s),o+=3}}this.setIndex(n),this.setAttribute("position",new qr(i,3)),this.setAttribute("normal",new qr(r,3)),this.setAttribute("uv",new qr(s,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class th extends rs{constructor(e=1,t=8,n=6,i=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let l=0;const c=[],h=new oi,u=new oi,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let _=0;0==d&&0==s?_=.5/t:d==n&&o==Math.PI&&(_=-.5/t);for(let n=0;n<=t;n++){const o=n/t;h.x=-e*Math.cos(i+o*r)*Math.sin(s+v*a),h.y=e*Math.cos(s+v*a),h.z=e*Math.sin(i+o*r)*Math.sin(s+v*a),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(o+_,1-v),g.push(l++)}c.push(g)}for(let e=0;e<n;e++)for(let i=0;i<t;i++){const t=c[e][i+1],r=c[e][i],a=c[e+1][i],l=c[e+1][i+1];(0!==e||s>0)&&d.push(t,r,l),(e!==n-1||o<Math.PI)&&d.push(r,a,l)}this.setIndex(d),this.setAttribute("position",new qr(p,3)),this.setAttribute("normal",new qr(f,3)),this.setAttribute("uv",new qr(m,2))}}class nh extends pc{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}}class ih extends Yc{constructor(e,t={}){const n=t.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new rs;const i=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(i,t),this.type="TextGeometry"}}class rh extends rs{constructor(e=1,t=.4,n=8,i=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],o=[],l=[],c=new oi,h=new oi,u=new oi;for(let s=0;s<=n;s++)for(let d=0;d<=i;d++){const p=d/i*r,f=s/n*Math.PI*2;h.x=(e+t*Math.cos(f))*Math.cos(p),h.y=(e+t*Math.cos(f))*Math.sin(p),h.z=t*Math.sin(f),a.push(h.x,h.y,h.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(d/i),l.push(s/n)}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*e+t-1,r=(i+1)*(e-1)+t-1,a=(i+1)*(e-1)+t,o=(i+1)*e+t;s.push(n,r,o),s.push(r,a,o)}this.setIndex(s),this.setAttribute("position",new qr(a,3)),this.setAttribute("normal",new qr(o,3)),this.setAttribute("uv",new qr(l,2))}}class sh extends rs{constructor(e=1,t=.4,n=64,i=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],l=[],c=[],h=new oi,u=new oi,d=new oi,p=new oi,f=new oi,m=new oi,g=new oi;for(let a=0;a<=n;++a){const _=a/n*r*Math.PI*2;v(_,r,s,e,d),v(_+.01,r,s,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=i;++e){const r=e/i*Math.PI*2,s=-t*Math.cos(r),p=t*Math.sin(r);h.x=d.x+(s*g.x+p*f.x),h.y=d.y+(s*g.y+p*f.y),h.z=d.z+(s*g.z+p*f.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(a/n),c.push(e/i)}}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),s=(i+1)*e+t,o=(i+1)*(e-1)+t;a.push(n,r,o),a.push(r,s,o)}function v(e,t,n,i,r){const s=Math.cos(e),a=Math.sin(e),o=n/t*e,l=Math.cos(o);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new qr(o,3)),this.setAttribute("normal",new qr(l,3)),this.setAttribute("uv",new qr(c,2))}}class ah extends rs{constructor(e,t=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const s=e.computeFrenetFrames(t,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new oi,o=new oi,l=new Zn;let c=new oi;const h=[],u=[],d=[],p=[];function f(r){c=e.getPointAt(r/t,c);const l=s.normals[r],d=s.binormals[r];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,r=Math.sin(t),s=-Math.cos(t);o.x=s*l.x+r*d.x,o.y=s*l.y+r*d.y,o.z=s*l.z+r*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=c.x+n*o.x,a.y=c.y+n*o.y,a.z=c.z+n*o.z,h.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)l.x=e/t,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),s=(i+1)*e+t,a=(i+1)*(e-1)+t;p.push(n,r,a),p.push(r,s,a)}}()}(),this.setIndex(p),this.setAttribute("position",new qr(h,3)),this.setAttribute("normal",new qr(u,3)),this.setAttribute("uv",new qr(d,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}}class oh extends rs{constructor(e){if(super(),this.type="WireframeGeometry",!0===e.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const t=[],n=[0,0],i={},r=new oi;if(null!==e.index){const s=e.attributes.position,a=e.index;let o=e.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,t=o.length;e<t;++e){const t=o[e],r=t.start;for(let e=r,s=r+t.count;e<s;e+=3)for(let t=0;t<3;t++){const r=a.getX(e+t),s=a.getX(e+(t+1)%3);n[0]=Math.min(r,s),n[1]=Math.max(r,s);const o=n[0]+","+n[1];void 0===i[o]&&(i[o]={index1:n[0],index2:n[1]})}}for(const e in i){const n=i[e];r.fromBufferAttribute(s,n.index1),t.push(r.x,r.y,r.z),r.fromBufferAttribute(s,n.index2),t.push(r.x,r.y,r.z)}}else{const n=e.attributes.position;for(let e=0,i=n.count/3;e<i;e++)for(let i=0;i<3;i++){const s=3*e+i;r.fromBufferAttribute(n,s),t.push(r.x,r.y,r.z);const a=3*e+(i+1)%3;r.fromBufferAttribute(n,a),t.push(r.x,r.y,r.z)}}this.setAttribute("position",new qr(t,3))}}var lh=Object.freeze({__proto__:null,BoxGeometry:Es,BoxBufferGeometry:Es,CircleGeometry:hc,CircleBufferGeometry:hc,ConeGeometry:dc,ConeBufferGeometry:dc,CylinderGeometry:uc,CylinderBufferGeometry:uc,DodecahedronGeometry:fc,DodecahedronBufferGeometry:fc,EdgesGeometry:yc,ExtrudeGeometry:Yc,ExtrudeBufferGeometry:Yc,IcosahedronGeometry:Zc,IcosahedronBufferGeometry:Zc,LatheGeometry:$c,LatheBufferGeometry:$c,OctahedronGeometry:Jc,OctahedronBufferGeometry:Jc,ParametricGeometry:Kc,ParametricBufferGeometry:Kc,PlaneGeometry:Hs,PlaneBufferGeometry:Hs,PolyhedronGeometry:pc,PolyhedronBufferGeometry:pc,RingGeometry:Qc,RingBufferGeometry:Qc,ShapeGeometry:eh,ShapeBufferGeometry:eh,SphereGeometry:th,SphereBufferGeometry:th,TetrahedronGeometry:nh,TetrahedronBufferGeometry:nh,TextGeometry:ih,TextBufferGeometry:ih,TorusGeometry:rh,TorusBufferGeometry:rh,TorusKnotGeometry:sh,TorusKnotBufferGeometry:sh,TubeGeometry:ah,TubeBufferGeometry:ah,WireframeGeometry:oh});class ch extends Tr{constructor(e){super(),this.type="ShadowMaterial",this.color=new Dr(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}ch.prototype.isShadowMaterial=!0;class hh extends Rs{constructor(e){super(e),this.type="RawShaderMaterial"}}hh.prototype.isRawShaderMaterial=!0;class uh extends Tr{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Dr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Dr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=on,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}}uh.prototype.isMeshStandardMaterial=!0;class dh extends uh{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Zn(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Fn(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Dr(1,1,1),this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Dr).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this}}dh.prototype.isMeshPhysicalMaterial=!0;class ph extends Tr{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Dr(16777215),this.specular=new Dr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Dr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=on,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}ph.prototype.isMeshPhongMaterial=!0;class fh extends Tr{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Dr(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Dr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=on,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}fh.prototype.isMeshToonMaterial=!0;class mh extends Tr{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=on,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}mh.prototype.isMeshNormalMaterial=!0;class gh extends Tr{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Dr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Dr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}gh.prototype.isMeshLambertMaterial=!0;class vh extends Tr{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Dr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=on,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}vh.prototype.isMeshMatcapMaterial=!0;class _h extends Fl{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}_h.prototype.isLineDashedMaterial=!0;var yh=Object.freeze({__proto__:null,ShadowMaterial:ch,SpriteMaterial:ol,RawShaderMaterial:hh,ShaderMaterial:Rs,PointsMaterial:Ql,MeshPhysicalMaterial:dh,MeshStandardMaterial:uh,MeshPhongMaterial:ph,MeshToonMaterial:fh,MeshNormalMaterial:mh,MeshLambertMaterial:gh,MeshDepthMaterial:Vo,MeshDistanceMaterial:Fo,MeshBasicMaterial:Or,MeshMatcapMaterial:vh,LineDashedMaterial:_h,LineBasicMaterial:Fl,Material:Tr});const bh={arraySlice:function(e,t,n){return bh.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const i=e.length,r=new e.constructor(i);for(let s=0,a=0;a!==i;++s){const i=n[s]*t;for(let n=0;n!==t;++n)r[a++]=e[i+n]}return r},flattenJSON:function(e,t,n,i){let r=1,s=e[0];for(;void 0!==s&&void 0===s[i];)s=e[r++];if(void 0===s)return;let a=s[i];if(void 0!==a)if(Array.isArray(a))do{a=s[i],void 0!==a&&(t.push(s.time),n.push.apply(n,a)),s=e[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[i],void 0!==a&&(t.push(s.time),a.toArray(n,n.length)),s=e[r++]}while(void 0!==s);else do{a=s[i],void 0!==a&&(t.push(s.time),n.push(a)),s=e[r++]}while(void 0!==s)},subclip:function(e,t,n,i,r=30){const s=e.clone();s.name=t;const a=[];for(let e=0;e<s.tracks.length;++e){const t=s.tracks[e],o=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const s=t.times[e]*r;if(!(s<n||s>=i)){l.push(t.times[e]);for(let n=0;n<o;++n)c.push(t.values[e*o+n])}}0!==l.length&&(t.times=bh.convertArray(l,t.times.constructor),t.values=bh.convertArray(c,t.values.constructor),a.push(t))}s.tracks=a;let o=1/0;for(let e=0;e<s.tracks.length;++e)o>s.tracks[e].times[0]&&(o=s.tracks[e].times[0]);for(let e=0;e<s.tracks.length;++e)s.tracks[e].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,n=e,i=30){i<=0&&(i=30);const r=n.tracks.length,s=t/i;for(let t=0;t<r;++t){const i=n.tracks[t],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const a=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===r}));if(void 0===a)continue;let o=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=i.times.length-1;let d;if(s<=i.times[0]){const e=o,t=l-o;d=bh.arraySlice(i.values,e,t)}else if(s>=i.times[u]){const e=u*l+o,t=e+l-o;d=bh.arraySlice(i.values,e,t)}else{const e=i.createInterpolant(),t=o,n=l-o;e.evaluate(s),d=bh.arraySlice(e.resultBuffer,t,n)}"quaternion"===r&&(new ai).fromArray(d).normalize().conjugate().toArray(d);const p=a.times.length;for(let e=0;e<p;++e){const t=e*h+c;if("quaternion"===r)ai.multiplyQuaternionsFlat(a.values,t,d,0,a.values,t);else{const e=h-2*c;for(let n=0;n<e;++n)a.values[t+n]-=d[n]}}}return e.blendMode=qt,e}};class wh{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let s=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===s)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(e>=r)break e;{const a=t[1];e<a&&(n=2,r=a);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===s)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0}}for(;n<s;){const i=n+s>>>1;e<t[i]?s=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}wh.prototype.beforeStart_=wh.prototype.copySampleValue_,wh.prototype.afterEnd_=wh.prototype.copySampleValue_;class xh extends wh{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ft,endingEnd:Ft}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,s=e+1,a=i[r],o=i[s];if(void 0===a)switch(this.getSettings_().endingStart){case Gt:r=e,a=2*t-n;break;case jt:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case Gt:s=e,o=2*n-t;break;case jt:s=1,o=n+i[1]-i[0];break;default:s=e-1,o=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,_=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f;for(let e=0;e!==a;++e)r[e]=g*s[c+e]+v*s[l+e]+_*s[o+e]+y*s[h+e];return r}}class Mh extends wh{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(n-t)/(i-t),h=1-c;for(let e=0;e!==a;++e)r[e]=s[l+e]*h+s[o+e]*c;return r}}class Eh extends wh{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Sh{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=bh.convertArray(t,this.TimeBufferType),this.values=bh.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:bh.convertArray(e.times,Array),values:bh.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Eh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Mh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new xh(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case kt:t=this.InterpolantFactoryMethodDiscrete;break;case Ht:t=this.InterpolantFactoryMethodLinear;break;case Vt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return kt;case this.InterpolantFactoryMethodLinear:return Ht;case this.InterpolantFactoryMethodSmooth:return Vt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=bh.arraySlice(n,r,s),this.values=bh.arraySlice(this.values,r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==r;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,s),e=!1;break}s=i}if(void 0!==i&&bh.isTypedArray(i))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=bh.arraySlice(this.times),t=bh.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===Vt,r=e.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(i)r=!0;else{const e=a*n,i=e-n,s=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[i+a]||n!==t[s+a]){r=!0;break}}}if(r){if(a!==s){e[s]=e[a];const i=a*n,r=s*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*n,i=s*n,a=0;a!==n;++a)t[i+a]=t[e+a];++s}return s!==e.length?(this.times=bh.arraySlice(e,0,s),this.values=bh.arraySlice(t,0,s*n)):(this.times=e,this.values=t),this}clone(){const e=bh.arraySlice(this.times,0),t=bh.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Sh.prototype.TimeBufferType=Float32Array,Sh.prototype.ValueBufferType=Float32Array,Sh.prototype.DefaultInterpolation=Ht;class Th extends Sh{}Th.prototype.ValueTypeName="bool",Th.prototype.ValueBufferType=Array,Th.prototype.DefaultInterpolation=kt,Th.prototype.InterpolantFactoryMethodLinear=void 0,Th.prototype.InterpolantFactoryMethodSmooth=void 0;class Ah extends Sh{}Ah.prototype.ValueTypeName="color";class Rh extends Sh{}Rh.prototype.ValueTypeName="number";class Ch extends wh{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-t)/(i-t);let l=e*a;for(let e=l+a;l!==e;l+=4)ai.slerpFlat(r,0,s,l-a,s,l,o);return r}}class Ph extends Sh{InterpolantFactoryMethodLinear(e){return new Ch(this.times,this.values,this.getValueSize(),e)}}Ph.prototype.ValueTypeName="quaternion",Ph.prototype.DefaultInterpolation=Ht,Ph.prototype.InterpolantFactoryMethodSmooth=void 0;class Lh extends Sh{}Lh.prototype.ValueTypeName="string",Lh.prototype.ValueBufferType=Array,Lh.prototype.DefaultInterpolation=kt,Lh.prototype.InterpolantFactoryMethodLinear=void 0,Lh.prototype.InterpolantFactoryMethodSmooth=void 0;class Ih extends Sh{}Ih.prototype.ValueTypeName="vector";class Dh{constructor(e,t=-1,n,i=Wt){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Vn(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let e=0,r=n.length;e!==r;++e)t.push(Oh(n[e]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,i=n.length;e!==i;++e)t.push(Sh.toJSON(n[e]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,s=[];for(let e=0;e<r;e++){let a=[],o=[];a.push((e+r-1)%r,e,(e+1)%r),o.push(0,1,0);const l=bh.getKeyframeOrder(a);a=bh.sortedArray(a,1,l),o=bh.sortedArray(o,1,l),i||0!==a[0]||(a.push(r),o.push(o[0])),s.push(new Rh(".morphTargetInfluences["+t[e].name+"]",a,o).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],s=n.name.match(r);if(s&&s.length>1){const e=s[1];let t=i[e];t||(i[e]=t=[]),t.push(n)}}const s=[];for(const e in i)s.push(this.CreateFromMorphTargetSequence(e,i[e],t,n));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const s=[],a=[];bh.flattenJSON(n,s,a,i),0!==s.length&&r.push(new e(t,s,a))}},i=[],r=e.name||"default",s=e.fps||30,a=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const r=l[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let n=0;n<r[t].morphTargets.length;n++)e[r[t].morphTargets[n]]=-1;for(const n in e){const e=[],s=[];for(let i=0;i!==r[t].morphTargets.length;++i){const i=r[t];e.push(i.time),s.push(i.morphTarget===n?1:0)}i.push(new Rh(".morphTargetInfluence["+n+"]",e,s))}o=e.length*(s||1)}else{const s=".bones["+t[e].name+"]";n(Ih,s+".position",r,"pos",i),n(Ph,s+".quaternion",r,"rot",i),n(Ih,s+".scale",r,"scl",i)}}return 0===i.length?null:new this(r,o,i,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Oh(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Rh;case"vector":case"vector2":case"vector3":case"vector4":return Ih;case"color":return Ah;case"quaternion":return Ph;case"bool":case"boolean":return Th;case"string":return Lh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];bh.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Nh={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Bh{constructor(e,t,n){const i=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===s&&void 0!==i.onStart&&i.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const zh=new Bh;class Uh{constructor(e){this.manager=void 0!==e?e:zh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const kh={};class Hh extends Uh{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Nh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;if(void 0!==kh[e])return void kh[e].push({onLoad:t,onProgress:n,onError:i});const a=e.match(/^data:(.*?)(;base64)?,(.*)$/);let o;if(a){const n=a[1],s=!!a[2];let o=a[3];o=decodeURIComponent(o),s&&(o=atob(o));try{let i;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const e=new Uint8Array(o.length);for(let t=0;t<o.length;t++)e[t]=o.charCodeAt(t);i="blob"===s?new Blob([e.buffer],{type:n}):e.buffer;break;case"document":const t=new DOMParser;i=t.parseFromString(o,n);break;case"json":i=JSON.parse(o);break;default:i=o}setTimeout((function(){t&&t(i),r.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}),0)}}else{kh[e]=[],kh[e].push({onLoad:t,onProgress:n,onError:i}),o=new XMLHttpRequest,o.open("GET",e,!0),o.addEventListener("load",(function(t){const n=this.response,i=kh[e];if(delete kh[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Nh.add(e,n);for(let e=0,t=i.length;e<t;e++){const t=i[e];t.onLoad&&t.onLoad(n)}r.manager.itemEnd(e)}else{for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}}),!1),o.addEventListener("progress",(function(t){const n=kh[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onProgress&&i.onProgress(t)}}),!1),o.addEventListener("error",(function(t){const n=kh[e];delete kh[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),o.addEventListener("abort",(function(t){const n=kh[e];delete kh[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(o.responseType=this.responseType),void 0!==this.withCredentials&&(o.withCredentials=this.withCredentials),o.overrideMimeType&&o.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)o.setRequestHeader(e,this.requestHeader[e]);o.send(null)}return r.manager.itemStart(e),o}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Vh extends Uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new Hh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=Dh.parse(e[n]);t.push(i)}return t}}class Fh extends Uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=[],a=new oc,o=new Hh(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function c(c){o.load(e[c],(function(e){const n=r.parse(e,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=ye),a.image=s,a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,i)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)c(t);else o.load(e,(function(e){const n=r.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){s[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)s[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),s[t].format=n.format,s[t].width=n.width,s[t].height=n.height}a.image=s}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=ye),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,i);return a}}class Gh extends Uh{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Nh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function o(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),Nh.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class jh extends Uh{constructor(e){super(e)}load(e,t,n,i){const r=new Ds,s=new Gh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(n){s.load(e[n],(function(e){r.images[n]=e,a++,6===a&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(let t=0;t<e.length;++t)o(t);return r}}class Wh extends Uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new Dl,a=new Hh(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,(function(e){const n=r.parse(e);n&&(void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:de,s.wrapT=void 0!==n.wrapT?n.wrapT:de,s.magFilter=void 0!==n.magFilter?n.magFilter:ye,s.minFilter=void 0!==n.minFilter?n.minFilter:ye,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=xe),1===n.mipmapCount&&(s.minFilter=ye),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,t&&t(s,n))}),n,i),s}}class qh extends Uh{constructor(e){super(e)}load(e,t,n,i){const r=new ei,s=new Gh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(n){r.image=n;const i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=i?ze:Ue,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class Yh{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let s;s=t||e*n[r-1];let a,o=0,l=r-1;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),a=n[i]-s,a<0)o=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const c=n[i];return(i+(s-c)/(n[i+1]-c))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),a=this.getPoint(r),o=t||(s.isVector2?new Zn:new oi);return o.copy(a).sub(s).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new oi,i=[],r=[],s=[],a=new oi,o=new Ui;for(let t=0;t<=e;t++){const n=t/e;i[t]=this.getTangentAt(n,new oi),i[t].normalize()}r[0]=new oi,s[0]=new oi;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),u<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),s[t]=s[t-1].clone(),a.crossVectors(i[t-1],i[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(Fn(i[t-1].dot(i[t]),-1,1));r[t].applyMatrix4(o.makeRotationAxis(a,e))}s[t].crossVectors(i[t],r[t])}if(!0===t){let t=Math.acos(Fn(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(o.makeRotationAxis(i[n],t*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Xh extends Yh{constructor(e=0,t=0,n=1,i=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){const n=t||new Zn,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const a=this.aStartAngle+e*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=o-this.aX,i=l-this.aY;o=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Xh.prototype.isEllipseCurve=!0;class Zh extends Xh{constructor(e,t,n,i,r,s){super(e,t,n,n,i,r,s),this.type="ArcCurve"}}function $h(){let e=0,t=0,n=0,i=0;function r(r,s,a,o){e=r,t=a,n=-3*r+3*s-2*a-o,i=2*r-2*s+a+o}return{initCatmullRom:function(e,t,n,i,s){r(t,n,s*(n-e),s*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,s,a,o){let l=(t-e)/s-(n-e)/(s+a)+(n-t)/a,c=(n-t)/a-(i-t)/(a+o)+(i-n)/o;l*=a,c*=a,r(t,n,l,c)},calc:function(r){const s=r*r;return e+t*r+n*s+i*(s*r)}}}Zh.prototype.isArcCurve=!0;const Jh=new oi,Kh=new $h,Qh=new $h,eu=new $h;class tu extends Yh{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new oi){const n=t,i=this.points,r=i.length,s=(r-(this.closed?0:1))*e;let a,o,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?a=i[(l-1)%r]:(Jh.subVectors(i[0],i[1]).add(i[0]),a=Jh);const h=i[l%r],u=i[(l+1)%r];if(this.closed||l+2<r?o=i[(l+2)%r]:(Jh.subVectors(i[r-1],i[r-2]).add(i[r-1]),o=Jh),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(h),e),n=Math.pow(h.distanceToSquared(u),e),i=Math.pow(u.distanceToSquared(o),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),Kh.initNonuniformCatmullRom(a.x,h.x,u.x,o.x,t,n,i),Qh.initNonuniformCatmullRom(a.y,h.y,u.y,o.y,t,n,i),eu.initNonuniformCatmullRom(a.z,h.z,u.z,o.z,t,n,i)}else"catmullrom"===this.curveType&&(Kh.initCatmullRom(a.x,h.x,u.x,o.x,this.tension),Qh.initCatmullRom(a.y,h.y,u.y,o.y,this.tension),eu.initCatmullRom(a.z,h.z,u.z,o.z,this.tension));return n.set(Kh.calc(c),Qh.calc(c),eu.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new oi).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function nu(e,t,n,i,r){const s=.5*(i-t),a=.5*(r-n),o=e*e;return(2*n-2*i+s+a)*(e*o)+(-3*n+3*i-2*s-a)*o+s*e+n}function iu(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function ru(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}tu.prototype.isCatmullRomCurve3=!0;class su extends Yh{constructor(e=new Zn,t=new Zn,n=new Zn,i=new Zn){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Zn){const n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(ru(e,i.x,r.x,s.x,a.x),ru(e,i.y,r.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}su.prototype.isCubicBezierCurve=!0;class au extends Yh{constructor(e=new oi,t=new oi,n=new oi,i=new oi){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new oi){const n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(ru(e,i.x,r.x,s.x,a.x),ru(e,i.y,r.y,s.y,a.y),ru(e,i.z,r.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}au.prototype.isCubicBezierCurve3=!0;class ou extends Yh{constructor(e=new Zn,t=new Zn){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Zn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Zn;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}ou.prototype.isLineCurve=!0;class lu extends Yh{constructor(e=new oi,t=new oi){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new oi){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class cu extends Yh{constructor(e=new Zn,t=new Zn,n=new Zn){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Zn){const n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(iu(e,i.x,r.x,s.x),iu(e,i.y,r.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}cu.prototype.isQuadraticBezierCurve=!0;class hu extends Yh{constructor(e=new oi,t=new oi,n=new oi){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new oi){const n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(iu(e,i.x,r.x,s.x),iu(e,i.y,r.y,s.y),iu(e,i.z,r.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}hu.prototype.isQuadraticBezierCurve3=!0;class uu extends Yh{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Zn){const n=t,i=this.points,r=(i.length-1)*e,s=Math.floor(r),a=r-s,o=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],h=i[s>i.length-3?i.length-1:s+2];return n.set(nu(a,o.x,l.x,c.x,h.x),nu(a,o.y,l.y,c.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Zn).fromArray(n))}return this}}uu.prototype.isSplineCurve=!0;var du=Object.freeze({__proto__:null,ArcCurve:Zh,CatmullRomCurve3:tu,CubicBezierCurve:su,CubicBezierCurve3:au,EllipseCurve:Xh,LineCurve:ou,LineCurve3:lu,QuadraticBezierCurve:cu,QuadraticBezierCurve3:hu,SplineCurve:uu});class pu extends Yh{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new ou(t,e))}getPoint(e){const t=e*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=t){const e=n[i]-t,r=this.curves[i],s=r.getLength(),a=0===s?0:1-e/s;return r.getPointAt(a)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],a=s&&s.isEllipseCurve?2*e:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let e=0;e<o.length;e++){const i=o[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new du[n.type]).fromJSON(n))}return this}}class fu extends pu{constructor(e){super(),this.type="Path",this.currentPoint=new Zn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new ou(this.currentPoint.clone(),new Zn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new cu(this.currentPoint.clone(),new Zn(e,t),new Zn(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,s){const a=new su(this.currentPoint.clone(),new Zn(e,t),new Zn(n,i),new Zn(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new uu(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,n,i,r,s),this}absarc(e,t,n,i,r,s){return this.absellipse(e,t,n,n,i,r,s),this}ellipse(e,t,n,i,r,s,a,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,s,a,o),this}absellipse(e,t,n,i,r,s,a,o){const l=new Xh(e,t,n,i,r,s,a,o);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class mu extends fu{constructor(e){super(e),this.uuid=Vn(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new fu).fromJSON(n))}return this}}class gu extends cr{constructor(e,t=1){super(),this.type="Light",this.color=new Dr(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}gu.prototype.isLight=!0;class vu extends gu{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.groundColor=new Dr(t)}copy(e){return gu.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}vu.prototype.isHemisphereLight=!0;const _u=new Ui,yu=new oi,bu=new oi;class wu{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Zn(512,512),this.map=null,this.mapPass=null,this.matrix=new Ui,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new zs,this._frameExtents=new Zn(1,1),this._viewportCount=1,this._viewports=[new ni(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;yu.setFromMatrixPosition(e.matrixWorld),t.position.copy(yu),bu.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(bu),t.updateMatrixWorld(),_u.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_u),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class xu extends wu{constructor(){super(new Ps(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*Hn*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}xu.prototype.isSpotLightShadow=!0;class Mu extends gu{constructor(e,t,n=0,i=Math.PI/3,r=0,s=1){super(e,t),this.type="SpotLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.target=new cr,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.shadow=new xu}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Mu.prototype.isSpotLight=!0;const Eu=new Ui,Su=new oi,Tu=new oi;class Au extends wu{constructor(){super(new Ps(90,1,.5,500)),this._frameExtents=new Zn(4,2),this._viewportCount=6,this._viewports=[new ni(2,1,1,1),new ni(0,1,1,1),new ni(3,1,1,1),new ni(1,1,1,1),new ni(3,0,1,1),new ni(1,0,1,1)],this._cubeDirections=[new oi(1,0,0),new oi(-1,0,0),new oi(0,0,1),new oi(0,0,-1),new oi(0,1,0),new oi(0,-1,0)],this._cubeUps=[new oi(0,1,0),new oi(0,1,0),new oi(0,1,0),new oi(0,1,0),new oi(0,0,1),new oi(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Su.setFromMatrixPosition(e.matrixWorld),n.position.copy(Su),Tu.copy(n.position),Tu.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Tu),n.updateMatrixWorld(),i.makeTranslation(-Su.x,-Su.y,-Su.z),Eu.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Eu)}}Au.prototype.isPointLightShadow=!0;class Ru extends gu{constructor(e,t,n=0,i=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Au}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}Ru.prototype.isPointLight=!0;class Cu extends Cs{constructor(e=-1,t=1,n=1,i=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,s=n+e,a=i+t,o=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}Cu.prototype.isOrthographicCamera=!0;class Pu extends wu{constructor(){super(new Cu(-5,5,5,-5,.5,500))}}Pu.prototype.isDirectionalLightShadow=!0;class Lu extends gu{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.target=new cr,this.shadow=new Pu}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Lu.prototype.isDirectionalLight=!0;class Iu extends gu{constructor(e,t){super(e,t),this.type="AmbientLight"}}Iu.prototype.isAmbientLight=!0;class Du extends gu{constructor(e,t,n=10,i=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=i}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}Du.prototype.isRectAreaLight=!0;class Ou{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new oi)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*i),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],n*i*1.092548),t.addScaledVector(s[5],i*r*1.092548),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],n*r*1.092548),t.addScaledVector(s[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*i),t.addScaledVector(s[2],1.023328*r),t.addScaledVector(s[3],1.023328*n),t.addScaledVector(s[4],.858086*n*i),t.addScaledVector(s[5],.858086*i*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],.858086*n*r),t.addScaledVector(s[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}Ou.prototype.isSphericalHarmonics3=!0;class Nu extends gu{constructor(e=new Ou,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Nu.prototype.isLightProbe=!0;class Bu extends Uh{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,s=new Hh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=new yh[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=(new Dr).setHex(e.sheen)),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.morphTargets&&(i.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(i.morphNormals=e.morphNormals),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.vertexTangents&&(i.vertexTangents=e.vertexTangents),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const r=e.uniforms[t];switch(i.uniforms[t]={},r.type){case"t":i.uniforms[t].value=n(r.value);break;case"c":i.uniforms[t].value=(new Dr).setHex(r.value);break;case"v2":i.uniforms[t].value=(new Zn).fromArray(r.value);break;case"v3":i.uniforms[t].value=(new oi).fromArray(r.value);break;case"v4":i.uniforms[t].value=(new ni).fromArray(r.value);break;case"m3":i.uniforms[t].value=(new $n).fromArray(r.value);break;case"m4":i.uniforms[t].value=(new Ui).fromArray(r.value);break;default:i.uniforms[t].value=r.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)i.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new Zn).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Zn).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),i}setTextures(e){return this.textures=e,this}}class zu{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}class Uu extends rs{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}Uu.prototype.isInstancedBufferGeometry=!0;class ku extends zr{constructor(e,t,n,i){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=i||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}ku.prototype.isInstancedBufferAttribute=!0;class Hu extends Uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new Hh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const r=e.interleavedBuffers[i],s=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers[t],r=new Uint32Array(i).buffer;return n[t]=r,r}(e,r.buffer),a=$r(r.type,s),o=new rl(a,r.stride);return o.uuid=r.uuid,t[i]=o,o}const r=e.isInstancedBufferGeometry?new Uu:new rs,s=e.data.index;if(void 0!==s){const e=$r(s.type,s.array);r.setIndex(new zr(e,1))}const a=e.data.attributes;for(const t in a){const n=a[t];let s;if(n.isInterleavedBufferAttribute){const t=i(e.data,n.data);s=new al(t,n.itemSize,n.offset,n.normalized)}else{const e=$r(n.type,n.array);s=new(n.isInstancedBufferAttribute?ku:zr)(e,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),void 0!==n.usage&&s.setUsage(n.usage),void 0!==n.updateRange&&(s.updateRange.offset=n.updateRange.offset,s.updateRange.count=n.updateRange.count),r.setAttribute(t,s)}const o=e.data.morphAttributes;if(o)for(const t in o){const n=o[t],s=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];let a;if(r.isInterleavedBufferAttribute){const t=i(e.data,r.data);a=new al(t,r.itemSize,r.offset,r.normalized)}else{const e=$r(r.type,r.array);a=new zr(e,r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),s.push(a)}r.morphAttributes[t]=s}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];r.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new oi;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new Ci(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class Vu extends Uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=""===this.path?zu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const a=new Hh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){let s=null;try{s=JSON.parse(n)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const a=s.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(s,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,i)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,r,o,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in s)if(s[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new mu).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(let t=0,r=e.length;t<r;t++){const r=(new Bl).fromJSON(e[t],i);n[r.uuid]=r}return n}parseGeometries(e,t){const n={};let i;if(void 0!==e){const r=new Hu;for(let s=0,a=e.length;s<a;s++){let a;const o=e[s];switch(o.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new lh[o.type](o.width,o.height,o.widthSegments,o.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":a=new lh[o.type](o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new lh[o.type](o.radius,o.segments,o.thetaStart,o.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new lh[o.type](o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new lh[o.type](o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new lh[o.type](o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new lh[o.type](o.radius,o.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new lh[o.type](o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new lh[o.type](o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new lh[o.type](o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new lh[o.type]((new du[o.path.type]).fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new lh[o.type](o.points,o.segments,o.phiStart,o.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new lh[o.type](o.vertices,o.indices,o.radius,o.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":i=[];for(let e=0,n=o.shapes.length;e<n;e++){const n=t[o.shapes[e]];i.push(n)}a=new lh[o.type](i,o.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":i=[];for(let e=0,n=o.shapes.length;e<n;e++){const n=t[o.shapes[e]];i.push(n)}const e=o.options.extrudePath;void 0!==e&&(o.options.extrudePath=(new du[e.type]).fromJSON(e)),a=new lh[o.type](i,o.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(o);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+o.type+'"');continue}a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),!0===a.isBufferGeometry&&void 0!==o.userData&&(a.userData=o.userData),n[o.uuid]=a}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const r=new Bu;r.setTextures(t);for(let t=0,s=e.length;t<s;t++){const s=e[t];if("MultiMaterial"===s.type){const e=[];for(let t=0;t<s.materials.length;t++){const i=s.materials[t];void 0===n[i.uuid]&&(n[i.uuid]=r.parse(i)),e.push(n[i.uuid])}i[s.uuid]=e}else void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],r=Dh.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function s(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),r.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:$r(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Bh(t);r=new Gh(n),r.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],r=n.url;if(Array.isArray(r)){i[n.uuid]=[];for(let e=0,t=r.length;e<t;e++){const t=s(r[e]);null!==t&&(t instanceof HTMLImageElement?i[n.uuid].push(t):i[n.uuid].push(new Dl(t.data,t.width,t.height)))}}else{const e=s(n.url);null!==e&&(i[n.uuid]=e)}}}return i}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let r=0,s=e.length;r<s;r++){const s=e[r];let a;void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const o=t[s.image];Array.isArray(o)?(a=new Ds(o),6===o.length&&(a.needsUpdate=!0)):(a=o&&o.data?new Dl(o.data,o.width,o.height):new ei(o),o&&(a.needsUpdate=!0)),a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=n(s.mapping,Fu)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=n(s.wrap[0],Gu),a.wrapT=n(s.wrap[1],Gu)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=n(s.minFilter,ju)),void 0!==s.magFilter&&(a.magFilter=n(s.magFilter,ju)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),i[s.uuid]=a}return i}parseObject(e,t,n,i){let r,s,a;function o(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(n[r])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":r=new il,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new Dr(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new nl(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new tl(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new Ps(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new Cu(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new Iu(e.color,e.intensity);break;case"DirectionalLight":r=new Lu(e.color,e.intensity);break;case"PointLight":r=new Ru(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new Du(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Mu(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new vu(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=(new Nu).fromJSON(e);break;case"SkinnedMesh":s=o(e.geometry),a=l(e.material),r=new Ll(s,a),void 0!==e.bindMode&&(r.bindMode=e.bindMode),void 0!==e.bindMatrix&&r.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(r.skeleton=e.skeleton);break;case"Mesh":s=o(e.geometry),a=l(e.material),r=new xs(s,a);break;case"InstancedMesh":s=o(e.geometry),a=l(e.material);const t=e.count,n=e.instanceMatrix,i=e.instanceColor;r=new Vl(s,a,t),r.instanceMatrix=new zr(new Float32Array(n.array),16),void 0!==i&&(r.instanceColor=new zr(new Float32Array(i.array),i.itemSize));break;case"LOD":r=new Sl;break;case"Line":r=new Xl(o(e.geometry),l(e.material));break;case"LineLoop":r=new Kl(o(e.geometry),l(e.material));break;case"LineSegments":r=new Jl(o(e.geometry),l(e.material));break;case"PointCloud":case"Points":r=new rc(o(e.geometry),l(e.material));break;case"Sprite":r=new wl(l(e.material));break;case"Group":r=new Xo;break;case"Bone":r=new Il;break;default:r=new cr}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(r.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children){const s=e.children;for(let e=0;e<s.length;e++)r.add(this.parseObject(s[e],t,n,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];r.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=r.getObjectByProperty("uuid",n.object);void 0!==i&&r.addLevel(i,n.distance)}}return r}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const Fu={UVMapping:re,CubeReflectionMapping:se,CubeRefractionMapping:ae,EquirectangularReflectionMapping:oe,EquirectangularRefractionMapping:le,CubeUVReflectionMapping:ce,CubeUVRefractionMapping:he},Gu={RepeatWrapping:ue,ClampToEdgeWrapping:de,MirroredRepeatWrapping:pe},ju={NearestFilter:fe,NearestMipmapNearestFilter:me,NearestMipmapLinearFilter:ve,LinearFilter:ye,LinearMipmapNearestFilter:be,LinearMipmapLinearFilter:xe};class Wu extends Uh{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Nh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){Nh.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}Wu.prototype.isImageBitmapLoader=!0;class qu{constructor(){this.type="ShapePath",this.color=new Dr,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new fu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,s){return this.currentPath.bezierCurveTo(e,t,n,i,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=new mu;r.curves=i.curves,t.push(r)}return t}function i(e,t){const n=t.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=t[r],a=t[s],o=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[s],o=-o,a=t[r],l=-l),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-o*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return i}const r=jc.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===t)return n(s);let a,o,l;const c=[];if(1===s.length)return o=s[0],l=new mu,l.curves=o.curves,c.push(l),c;let h=!r(s[0].getPoints());h=e?!h:h;const u=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let t=0,n=s.length;t<n;t++)o=s[t],p=o.getPoints(),a=r(p),a=e?!a:a,a?(!h&&d[g]&&g++,d[g]={s:new mu,p},d[g].s.curves=o.curves,h&&g++,m[g]=[]):m[g].push({h:o,p:p[0]});if(!d[0])return n(s);if(d.length>1){let e=!1;const t=[];for(let e=0,t=d.length;e<t;e++)u[e]=[];for(let n=0,r=d.length;n<r;n++){const r=m[n];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<d.length;r++)i(a.p,d[r].p)&&(n!==r&&t.push({froms:n,tos:r,hole:s}),o?(o=!1,u[r].push(a)):e=!0);o&&u[n].push(a)}}t.length>0&&(e||(m=u))}for(let e=0,t=d.length;e<t;e++){l=d[e].s,c.push(l),f=m[e];for(let e=0,t=f.length;e<t;e++)l.holes.push(f[e].h)}return c}}class Yu{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){const n=[],i=function(e,t,n){const i=Array.from(e),r=t/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,a=[];let o=0,l=0;for(let e=0;e<i.length;e++){const t=i[e];if("\n"===t)o=0,l-=s;else{const e=Xu(t,r,o,l,n);o+=e.offsetX,a.push(e.path)}}return a}(e,t,this.data);for(let e=0,t=i.length;e<t;e++)Array.prototype.push.apply(n,i[e].toShapes());return n}}function Xu(e,t,n,i,r){const s=r.glyphs[e]||r.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".");const a=new qu;let o,l,c,h,u,d,p,f;if(s.o){const e=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let r=0,s=e.length;r<s;)switch(e[r++]){case"m":o=e[r++]*t+n,l=e[r++]*t+i,a.moveTo(o,l);break;case"l":o=e[r++]*t+n,l=e[r++]*t+i,a.lineTo(o,l);break;case"q":c=e[r++]*t+n,h=e[r++]*t+i,u=e[r++]*t+n,d=e[r++]*t+i,a.quadraticCurveTo(u,d,c,h);break;case"b":c=e[r++]*t+n,h=e[r++]*t+i,u=e[r++]*t+n,d=e[r++]*t+i,p=e[r++]*t+n,f=e[r++]*t+i,a.bezierCurveTo(u,d,p,f,c,h)}}return{offsetX:s.ha*t,path:a}}Yu.prototype.isFont=!0;class Zu extends Uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new Hh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(e){let n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}const i=r.parse(n);t&&t(i)}),n,i)}parse(e){return new Yu(e)}}let $u;const Ju={getContext:function(){return void 0===$u&&($u=new(window.AudioContext||window.webkitAudioContext)),$u},setContext:function(e){$u=e}};class Ku extends Uh{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new Hh(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{const e=n.slice(0);Ju.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}}class Qu extends Nu{constructor(e,t,n=1){super(void 0,n);const i=(new Dr).set(e),r=(new Dr).set(t),s=new oi(i.r,i.g,i.b),a=new oi(r.r,r.g,r.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(l)}}Qu.prototype.isHemisphereLightProbe=!0;class ed extends Nu{constructor(e,t=1){super(void 0,t);const n=(new Dr).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}ed.prototype.isAmbientLightProbe=!0;const td=new Ui,nd=new Ui;class id{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ps,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ps,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),i=t.eyeSep/2,r=i*t.near/t.focus,s=t.near*Math.tan(kn*t.fov*.5)/t.zoom;let a,o;nd.elements[12]=-i,td.elements[12]=i,a=-s*t.aspect+r,o=s*t.aspect+r,n.elements[0]=2*t.near/(o-a),n.elements[8]=(o+a)/(o-a),this.cameraL.projectionMatrix.copy(n),a=-s*t.aspect-r,o=s*t.aspect-r,n.elements[0]=2*t.near/(o-a),n.elements[8]=(o+a)/(o-a),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(nd),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(td)}}class rd{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=sd(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=sd();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function sd(){return("undefined"==typeof performance?Date:performance).now()}const ad=new oi,od=new ai,ld=new oi,cd=new oi;class hd extends cr{constructor(){super(),this.type="AudioListener",this.context=Ju.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new rd}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ad,od,ld),cd.set(0,0,-1).applyQuaternion(od),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(ad.x,e),t.positionY.linearRampToValueAtTime(ad.y,e),t.positionZ.linearRampToValueAtTime(ad.z,e),t.forwardX.linearRampToValueAtTime(cd.x,e),t.forwardY.linearRampToValueAtTime(cd.y,e),t.forwardZ.linearRampToValueAtTime(cd.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(ad.x,ad.y,ad.z),t.setOrientation(cd.x,cd.y,cd.z,n.x,n.y,n.z)}}class ud extends cr{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const dd=new oi,pd=new ai,fd=new oi,md=new oi;class gd extends ud{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(dd,pd,fd),md.set(0,0,1).applyQuaternion(pd);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(dd.x,e),t.positionY.linearRampToValueAtTime(dd.y,e),t.positionZ.linearRampToValueAtTime(dd.z,e),t.orientationX.linearRampToValueAtTime(md.x,e),t.orientationY.linearRampToValueAtTime(md.y,e),t.orientationZ.linearRampToValueAtTime(md.z,e)}else t.setPosition(dd.x,dd.y,dd.z),t.setOrientation(md.x,md.y,md.z)}}class vd{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class _d{constructor(e,t,n){let i,r,s;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==i;++e)n[r+e]=n[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let e=t,r=t+t;e!==r;++e)if(n[e]!==n[e+t]){a.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let e=n,r=i;e!==r;++e)t[e]=t[i+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)e[t+i]=e[n+i]}_slerp(e,t,n,i){ai.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const s=this._workIndex*r;ai.multiplyQuaternionsFlat(e,s,e,t,e,n),ai.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,n,i,r){const s=1-i;for(let a=0;a!==r;++a){const r=t+a;e[r]=e[r]*s+e[n+a]*i}}_lerpAdditive(e,t,n,i,r){for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]+e[n+s]*i}}}const yd=new RegExp("[\\[\\]\\.:\\/]","g"),bd="[^\\[\\]\\.:\\/]",wd="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",xd=/((?:WC+[\/:])*)/.source.replace("WC",bd),Md=/(WCOD+)?/.source.replace("WCOD",wd),Ed=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",bd),Sd=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",bd),Td=new RegExp("^"+xd+Md+Ed+Sd+"$"),Ad=["material","materials","bones"];class Rd{constructor(e,t,n){this.path=t,this.parsedPath=n||Rd.parseTrackName(t),this.node=Rd.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Rd.Composite(e,t,n):new Rd(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(yd,"")}static parseTrackName(e){const t=Td.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==Ad.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const s=n(r.children);if(s)return s}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Rd.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const s=e[i];if(void 0===s){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Rd.Composite=class{constructor(e,t,n){const i=n||Rd.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Rd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Rd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Rd.prototype.GetterByBindingType=[Rd.prototype._getValue_direct,Rd.prototype._getValue_array,Rd.prototype._getValue_arrayElement,Rd.prototype._getValue_toArray],Rd.prototype.SetterByBindingTypeAndVersioning=[[Rd.prototype._setValue_direct,Rd.prototype._setValue_direct_setNeedsUpdate,Rd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Rd.prototype._setValue_array,Rd.prototype._setValue_array_setNeedsUpdate,Rd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Rd.prototype._setValue_arrayElement,Rd.prototype._setValue_arrayElement_setNeedsUpdate,Rd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Rd.prototype._setValue_fromArray,Rd.prototype._setValue_fromArray_setNeedsUpdate,Rd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Cd{constructor(){this.uuid=Vn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length;let a,o=e.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=t[u];if(void 0===d){d=o++,t[u]=d,e.push(h);for(let e=0,t=s;e!==t;++e)r[e].push(new Rd(h,n[e],i[e]))}else if(d<l){a=e[d];const o=--l,c=e[o];t[c.uuid]=d,e[d]=c,t[u]=o,e[o]=h;for(let e=0,t=s;e!==t;++e){const t=r[e],s=t[o];let a=t[d];t[d]=s,void 0===a&&(a=new Rd(h,n[e],i[e])),t[o]=a}}else e[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=t[o];if(void 0!==l&&l>=r){const s=r++,c=e[s];t[c.uuid]=l,e[l]=c,t[o]=s,e[s]=a;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[s],r=t[l];t[l]=i,t[s]=r}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,s=e.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<r){const a=--r,o=e[a],c=--s,h=e[c];t[o.uuid]=l,e[l]=o,t[h.uuid]=a,e[a]=h,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[a],r=t[c];t[l]=i,t[a]=r,t.pop()}}else{const r=--s,a=e[r];r>0&&(t[a.uuid]=l),e[l]=a,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(void 0!==i)return r[i];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);i=r.length,n[e]=i,s.push(e),a.push(t),r.push(h);for(let n=c,i=o.length;n!==i;++n){const i=o[n];h[n]=new Rd(i,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];t[e[a]]=n,s[n]=o,s.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}}Cd.prototype.isAnimationObjectGroup=!0;class Pd{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,s=r.length,a=new Array(s),o={endingStart:Ft,endingEnd:Ft};for(let e=0;e!==s;++e){const t=r[e].createInterpolant(null);a[e]=t,t.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=zt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,r=i/n,s=n/i;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+n,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);const s=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case qt:for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(s),t[n].accumulateAdditive(a);break;case Wt:default:for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(s),t[n].accumulate(i,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const s=n===Ut;if(0===e)return-1===r?i:s&&1==(1&r)?t-i:i;if(n===Bt){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1==(1&r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=Gt,i.endingEnd=Gt):(i.endingStart=e?this.zeroSlopeAtStart?Gt:Ft:jt,i.endingEnd=t?this.zeroSlopeAtEnd?Gt:Ft:jt)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=t,a[1]=r+e,o[1]=n,this}}class Ld extends Bn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,s=e._propertyBindings,a=e._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let e=0;e!==r;++e){const r=i[e],l=r.name;let h=c[l];if(void 0!==h)s[e]=h;else{if(h=s[e],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,o,l));continue}const i=t&&t._propertyBindings[e].binding.parsedPath;h=new _d(Rd.create(n,l,i),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,o,l),s[e]=h}a[e].resultBuffer=h.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[t];void 0===s&&(s={},i[t]=s),s[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[r],0===Object.keys(a).length&&delete s[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Mh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let s="string"==typeof e?Dh.findByName(i,e):e;const a=null!==s?s.uuid:e,o=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:Wt),void 0!==o){const e=o.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new Pd(this,s,t,n);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"==typeof e?Dh.findByName(n,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let a=0;a!==n;++a)t[a]._update(i,e,r,s);const a=this._bindings,o=this._nActiveBindings;for(let e=0;e!==o;++e)a[e].apply(s);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,s=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const i=n[e].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const e in i){const t=i[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}Ld.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Id{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Id(void 0===this.value.clone?this.value:this.value.clone())}}class Dd extends rl{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}Dd.prototype.isInstancedInterleavedBuffer=!0;class Od{constructor(e,t,n,i,r){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}Od.prototype.isGLBufferAttribute=!0;class Nd{constructor(e,t,n=0,i=1/0){this.ray=new zi(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new Zi,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!1,n=[]){return zd(e,this,n,t),n.sort(Bd),n}intersectObjects(e,t=!1,n=[]){for(let i=0,r=e.length;i<r;i++)zd(e[i],this,n,t);return n.sort(Bd),n}}function Bd(e,t){return e.distance-t.distance}function zd(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)zd(i[e],t,n,!0)}}class Ud{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Fn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class kd{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const Hd=new Zn;class Vd{constructor(e=new Zn(1/0,1/0),t=new Zn(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Hd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Zn),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Zn),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Zn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Zn),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Hd.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Vd.prototype.isBox2=!0;const Fd=new oi,Gd=new oi;class jd{constructor(e=new oi,t=new oi){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new oi),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new oi),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new oi),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Fd.subVectors(e,this.start),Gd.subVectors(this.end,this.start);const n=Gd.dot(Gd);let i=Gd.dot(Fd)/n;return t&&(i=Fn(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new oi),this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class Wd extends cr{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}Wd.prototype.isImmediateRenderObject=!0;const qd=new oi;class Yd extends cr{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new rs,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const r=e/n*Math.PI*2,s=t/n*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new qr(i,3));const r=new Fl({fog:!1,toneMapped:!1});this.cone=new Jl(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),qd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(qd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Xd=new oi,Zd=new Ui,$d=new Ui;class Jd extends Jl{constructor(e){const t=Kd(e),n=new rs,i=[],r=[],s=new Dr(0,0,1),a=new Dr(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new qr(i,3)),n.setAttribute("color",new qr(r,3)),super(n,new Fl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");$d.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const r=t[e];r.parent&&r.parent.isBone&&(Zd.multiplyMatrices($d,r.matrixWorld),Xd.setFromMatrixPosition(Zd),i.setXYZ(n,Xd.x,Xd.y,Xd.z),Zd.multiplyMatrices($d,r.parent.matrixWorld),Xd.setFromMatrixPosition(Zd),i.setXYZ(n+1,Xd.x,Xd.y,Xd.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function Kd(e){const t=[];e&&e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,Kd(e.children[n]));return t}class Qd extends xs{constructor(e,t,n){super(new th(t,4,2),new Or({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const ep=new oi,tp=new Dr,np=new Dr;class ip extends cr{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new Jc(t);i.rotateY(.5*Math.PI),this.material=new Or({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),s=new Float32Array(3*r.count);i.setAttribute("color",new zr(s,3)),this.add(new xs(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");tp.copy(this.light.color),np.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?tp:np;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(ep.setFromMatrixPosition(this.light.matrixWorld).negate())}}class rp extends Jl{constructor(e=10,t=10,n=4473924,i=8947848){n=new Dr(n),i=new Dr(i);const r=t/2,s=e/t,a=e/2,o=[],l=[];for(let e=0,c=0,h=-a;e<=t;e++,h+=s){o.push(-a,0,h,a,0,h),o.push(h,0,-a,h,0,a);const t=e===r?n:i;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new rs;c.setAttribute("position",new qr(o,3)),c.setAttribute("color",new qr(l,3)),super(c,new Fl({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class sp extends Jl{constructor(e=10,t=16,n=8,i=64,r=4473924,s=8947848){r=new Dr(r),s=new Dr(s);const a=[],o=[];for(let n=0;n<=t;n++){const i=n/t*(2*Math.PI),l=Math.sin(i)*e,c=Math.cos(i)*e;a.push(0,0,0),a.push(l,0,c);const h=1&n?r:s;o.push(h.r,h.g,h.b),o.push(h.r,h.g,h.b)}for(let t=0;t<=n;t++){const l=1&t?r:s,c=e-e/n*t;for(let e=0;e<i;e++){let t=e/i*(2*Math.PI),n=Math.sin(t)*c,r=Math.cos(t)*c;a.push(n,0,r),o.push(l.r,l.g,l.b),t=(e+1)/i*(2*Math.PI),n=Math.sin(t)*c,r=Math.cos(t)*c,a.push(n,0,r),o.push(l.r,l.g,l.b)}}const l=new rs;l.setAttribute("position",new qr(a,3)),l.setAttribute("color",new qr(o,3)),super(l,new Fl({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const ap=new oi,op=new oi,lp=new oi;class cp extends cr{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let i=new rs;i.setAttribute("position",new qr([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Fl({fog:!1,toneMapped:!1});this.lightPlane=new Xl(i,r),this.add(this.lightPlane),i=new rs,i.setAttribute("position",new qr([0,0,0,0,0,1],3)),this.targetLine=new Xl(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){ap.setFromMatrixPosition(this.light.matrixWorld),op.setFromMatrixPosition(this.light.target.matrixWorld),lp.subVectors(op,ap),this.lightPlane.lookAt(op),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(op),this.targetLine.scale.z=lp.length()}}const hp=new oi,up=new Cs;class dp extends Jl{constructor(e){const t=new rs,n=new Fl({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={},a=new Dr(16755200),o=new Dr(16711680),l=new Dr(43775),c=new Dr(16777215),h=new Dr(3355443);function u(e,t,n){d(e,n),d(t,n)}function d(e,t){i.push(0,0,0),r.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(i.length/3-1)}u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",c),u("p","c",h),u("cn1","cn2",h),u("cn3","cn4",h),u("cf1","cf2",h),u("cf3","cf4",h),t.setAttribute("position",new qr(i,3)),t.setAttribute("color",new qr(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const e=this.geometry,t=this.pointMap;up.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),pp("c",t,e,up,0,0,-1),pp("t",t,e,up,0,0,1),pp("n1",t,e,up,-1,-1,-1),pp("n2",t,e,up,1,-1,-1),pp("n3",t,e,up,-1,1,-1),pp("n4",t,e,up,1,1,-1),pp("f1",t,e,up,-1,-1,1),pp("f2",t,e,up,1,-1,1),pp("f3",t,e,up,-1,1,1),pp("f4",t,e,up,1,1,1),pp("u1",t,e,up,.7,1.1,-1),pp("u2",t,e,up,-.7,1.1,-1),pp("u3",t,e,up,0,2,-1),pp("cf1",t,e,up,-1,0,1),pp("cf2",t,e,up,1,0,1),pp("cf3",t,e,up,0,-1,1),pp("cf4",t,e,up,0,1,1),pp("cn1",t,e,up,-1,0,-1),pp("cn2",t,e,up,1,0,-1),pp("cn3",t,e,up,0,-1,-1),pp("cn4",t,e,up,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function pp(e,t,n,i,r,s,a){hp.set(r,s,a).unproject(i);const o=t[e];if(void 0!==o){const e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],hp.x,hp.y,hp.z)}}const fp=new hi;class mp extends Jl{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new rs;r.setIndex(new zr(n,1)),r.setAttribute("position",new zr(i,3)),super(r,new Fl({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&fp.setFromObject(this.object),fp.isEmpty())return;const t=fp.min,n=fp.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Jl.prototype.copy.call(this,e),this.object=e.object,this}}class gp extends Jl{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new rs;i.setIndex(new zr(n,1)),i.setAttribute("position",new qr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Fl({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class vp extends Xl{constructor(e,t=1,n=16776960){const i=n,r=new rs;r.setAttribute("position",new qr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new Fl({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const s=new rs;s.setAttribute("position",new qr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new xs(s,new Or({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?m:f,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const _p=new oi;let yp,bp;class wp extends cr{constructor(e=new oi(0,0,1),t=new oi(0,0,0),n=1,i=16776960,r=.2*n,s=.2*r){super(),this.type="ArrowHelper",void 0===yp&&(yp=new rs,yp.setAttribute("position",new qr([0,0,0,0,1,0],3)),bp=new uc(0,.5,1,5,1),bp.translate(0,-.5,0)),this.position.copy(t),this.line=new Xl(yp,new Fl({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new xs(bp,new Or({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{_p.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(_p,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class xp extends Jl{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new rs;n.setAttribute("position",new qr(t,3)),n.setAttribute("color",new qr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new Fl({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Mp=new Float32Array(1),Ep=new Int32Array(Mp.buffer);class Sp{static toHalfFloat(e){Mp[0]=e;const t=Ep[0];let n=t>>16&32768,i=t>>12&2047;const r=t>>23&255;return r<103?n:r>142?(n|=31744,n|=(255==r?0:1)&&8388607&t,n):r<113?(i|=2048,n|=(i>>114-r)+(i>>113-r&1),n):(n|=r-112<<10|i>>1,n+=1&i,n)}}const Tp=Math.pow(2,8),Ap=[.125,.215,.35,.446,.526,.582],Rp=5+Ap.length,Cp={[$t]:0,[Jt]:1,[Qt]:2,[tn]:3,[nn]:4,[rn]:5,[Kt]:6},Pp=new Or({side:m,depthWrite:!1,depthTest:!1}),Lp=new xs(new Es,Pp),Ip=new Cu,{_lodPlanes:Dp,_sizeLods:Op,_sigmas:Np}=jp(),Bp=new Dr;let zp=null;const Up=(1+Math.sqrt(5))/2,kp=1/Up,Hp=[new oi(1,1,1),new oi(-1,1,1),new oi(1,1,-1),new oi(-1,1,-1),new oi(0,Up,kp),new oi(0,Up,-kp),new oi(kp,0,Up),new oi(-kp,0,Up),new oi(Up,kp,0),new oi(-Up,kp,0)];function Vp(e){const t=Math.max(e.r,e.g,e.b),n=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);return e.multiplyScalar(Math.pow(2,-n)),(n+128)/255}class Fp{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(20),n=new oi(0,1,0);return new hh({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:Cp[$t]},outputEncoding:{value:Cp[$t]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:y,depthTest:!1,depthWrite:!1})}(),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){zp=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Xp(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Yp(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<Dp.length;e++)Dp[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(zp),e.scissorTest=!1,qp(e,0,0,e.width,e.height)}_fromTexture(e){zp=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:fe,minFilter:fe,generateMipmaps:!1,type:Ee,format:Ve,encoding:Gp(e)?e.encoding:Qt,depthBuffer:!1},n=Wp(t);return n.depthBuffer=!e,this._pingPongRenderTarget=Wp(t),n}_compileMaterial(e){const t=new xs(Dp[0],e);this._renderer.compile(t,Ip)}_sceneToCubeUV(e,t,n,i){const r=new Ps(90,1,t,n),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.outputEncoding,h=o.toneMapping;o.getClearColor(Bp),o.toneMapping=K,o.outputEncoding=$t,o.autoClear=!1;let u=!1;const d=e.background;if(d){if(d.isColor){Pp.color.copy(d).convertSRGBToLinear(),e.background=null;const t=Vp(Pp.color);Pp.opacity=t,u=!0}}else{Pp.color.copy(Bp).convertSRGBToLinear();const e=Vp(Pp.color);Pp.opacity=e,u=!0}for(let t=0;t<6;t++){const n=t%3;0==n?(r.up.set(0,s[t],0),r.lookAt(a[t],0,0)):1==n?(r.up.set(0,0,s[t]),r.lookAt(0,a[t],0)):(r.up.set(0,s[t],0),r.lookAt(0,0,a[t])),qp(i,n*Tp,t>2?Tp:0,Tp,Tp),o.setRenderTarget(i),u&&o.render(Lp,r),o.render(e,r)}o.toneMapping=h,o.outputEncoding=c,o.autoClear=l}_textureToCubeUV(e,t){const n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Xp()):null==this._equirectShader&&(this._equirectShader=Yp());const i=e.isCubeTexture?this._cubemapShader:this._equirectShader,r=new xs(Dp[0],i),s=i.uniforms;s.envMap.value=e,e.isCubeTexture||s.texelSize.value.set(1/e.image.width,1/e.image.height),s.inputEncoding.value=Cp[e.encoding],s.outputEncoding.value=Cp[t.texture.encoding],qp(t,0,0,3*Tp,2*Tp),n.setRenderTarget(t),n.render(r,Ip)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<Rp;t++){const n=Math.sqrt(Np[t]*Np[t]-Np[t-1]*Np[t-1]),i=Hp[(t-1)%Hp.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",r),this._halfBlur(s,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new xs(Dp[i],l),h=l.uniforms,u=Op[n]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0==e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;h.envMap.value=e.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a),h.dTheta.value=d,h.mipInt.value=8-n,h.inputEncoding.value=Cp[e.texture.encoding],h.outputEncoding.value=Cp[e.texture.encoding];const v=Op[i];qp(t,3*Math.max(0,Tp-2*v),(0===i?0:2*Tp)+2*v*(i>4?i-8+4:0),3*v,2*v),o.setRenderTarget(t),o.render(c,Ip)}}function Gp(e){return void 0!==e&&e.type===Ee&&(e.encoding===$t||e.encoding===Jt||e.encoding===Kt)}function jp(){const e=[],t=[],n=[];let i=8;for(let r=0;r<Rp;r++){const s=Math.pow(2,i);t.push(s);let a=1/s;r>4?a=Ap[r-8+4-1]:0==r&&(a=0),n.push(a);const o=1/(s-1),l=-o/2,c=1+o/2,h=[l,l,c,l,c,c,l,l,c,c,l,c],u=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*u),v=new Float32Array(f*d*u),_=new Float32Array(m*d*u);for(let e=0;e<u;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(i,p*d*e),v.set(h,f*d*e);const r=[e,e,e,e,e,e];_.set(r,m*d*e)}const y=new rs;y.setAttribute("position",new zr(g,p)),y.setAttribute("uv",new zr(v,f)),y.setAttribute("faceIndex",new zr(_,m)),e.push(y),i>4&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function Wp(e){const t=new ii(3*Tp,3*Tp,e);return t.texture.mapping=ce,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function qp(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function Yp(){const e=new Zn(1,1);return new hh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Cp[$t]},outputEncoding:{value:Cp[$t]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:y,depthTest:!1,depthWrite:!1})}function Xp(){return new hh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Cp[$t]},outputEncoding:{value:Cp[$t]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:y,depthTest:!1,depthWrite:!1})}const Zp=0,$p=1,Jp=0,Kp=1,Qp=2;function ef(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function tf(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function nf(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new rc(e,t)}function rf(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new wl(e)}function sf(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new rc(e,t)}function af(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Ql(e)}function of(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Ql(e)}function lf(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Ql(e)}function cf(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new oi(e,t,n)}function hf(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new zr(e,t).setUsage(Tn)}function uf(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Ur(e,t)}function df(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new kr(e,t)}function pf(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Hr(e,t)}function ff(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Vr(e,t)}function mf(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Fr(e,t)}function gf(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Gr(e,t)}function vf(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new jr(e,t)}function _f(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new qr(e,t)}function yf(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Yr(e,t)}function bf(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new xp(e)}function wf(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new mp(e,t)}function xf(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Jl(new yc(e.geometry),new Fl({color:void 0!==t?t:16777215}))}function Mf(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Jl(new oh(e.geometry),new Fl({color:void 0!==t?t:16777215}))}function Ef(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Hh(e)}function Sf(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Wh(e)}function Tf(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Os(e,n)}function Af(){console.error("THREE.CanvasRenderer has been removed")}function Rf(){console.error("THREE.JSONLoader has been removed.")}Yh.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Yh.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},fu.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},rp.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Jd.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Uh.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),zu.extractUrlBase(e)},Uh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Vd.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},Vd.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Vd.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Vd.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},hi.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},hi.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},hi.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},hi.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},hi.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Ci.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},zs.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},jd.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},$n.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},$n.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},$n.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},$n.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},$n.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},$n.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Ui.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Ui.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Ui.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new oi).setFromMatrixColumn(this,3)},Ui.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Ui.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Ui.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Ui.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Ui.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Ui.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Ui.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Ui.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Ui.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Ui.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Ui.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Ui.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Ui.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Ui.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Ui.prototype.makeFrustum=function(e,t,n,i,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,s)},Ui.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},pr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},ai.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},ai.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},zi.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},zi.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},zi.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Er.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Er.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Er.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Er.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Er.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Er.barycoordFromPoint=function(e,t,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Er.getBarycoord(e,t,n,i,r)},Er.normal=function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Er.getNormal(e,t,n,i)},mu.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},mu.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Yc(this,e)},mu.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new eh(this,e)},Zn.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Zn.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Zn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},oi.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},oi.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},oi.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},oi.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},oi.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},oi.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},oi.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},oi.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},oi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ni.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},ni.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},cr.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},cr.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},cr.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},cr.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},cr.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(cr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),xs.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(xs.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Yt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Ll.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Ps.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(gu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(zr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Tn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Tn)}}}),zr.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Tn:Sn),this},zr.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},zr.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},rs.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},rs.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new zr(arguments[1],arguments[2])))},rs.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},rs.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},rs.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},rs.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},rs.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(rs.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),rl.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Tn:Sn),this},rl.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Yc.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Yc.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Yc.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},il.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Id.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Tr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Dr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===v}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Rs.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Qo.prototype.clearTarget=function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},Qo.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},Qo.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Qo.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Qo.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Qo.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Qo.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Qo.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Qo.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Qo.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Qo.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Qo.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Qo.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Qo.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Qo.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},Qo.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Qo.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Qo.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Qo.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Qo.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Qo.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Qo.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Qo.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Qo.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Qo.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Qo.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Jt:$t}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Go.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ii.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),ud.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new Ku).load(e,(function(e){t.setBuffer(e)})),this},vd.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Is.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Is.prototype.clear=function(e,t,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,i)},Kn.crossOrigin=void 0,Kn.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new qh;r.setCrossOrigin(this.crossOrigin);const s=r.load(e,n,void 0,i);return t&&(s.mapping=t),s},Kn.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new jh;r.setCrossOrigin(this.crossOrigin);const s=r.load(e,n,void 0,i);return t&&(s.mapping=t),s},Kn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Kn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Cf={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function Pf(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i)},1647:(e,t,n)=>{"use strict";n.r(t),n.d(t,{EffectComposer:()=>c,FullScreenQuad:()=>p,Pass:()=>h});var i=n(2212),r=n(8546),s=n(740);class a extends s.w{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof i.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=i.UniformsUtils.clone(e.uniforms),this.material=new i.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new s.T(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class o extends s.w{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),r=e.state;let s,a;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0),this.inverse?(s=0,a=1):(s=1,a=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,s,4294967295),r.buffers.stencil.setClear(a),r.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}}class l extends s.w{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class c{constructor(e,t){if(this.renderer=e,void 0===t){const n={minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:i.RGBAFormat},r=e.getSize(new i.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,(t=new i.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===r.C&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===a&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new a(r.C),this.clock=new i.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let t=0,i=this.passes.length;t<i;t++){const i=this.passes[t];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),i.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==o&&(i instanceof o?n=!0:i instanceof l&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new i.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}class h{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const u=new i.OrthographicCamera(-1,1,1,-1,0,1),d=new i.BufferGeometry;d.setAttribute("position",new i.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),d.setAttribute("uv",new i.Float32BufferAttribute([0,2,0,0,2,0],2));class p{constructor(e){this._mesh=new i.Mesh(d,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,u)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}},740:(e,t,n)=>{"use strict";n.d(t,{w:()=>r,T:()=>o});var i=n(2212);class r{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const s=new i.OrthographicCamera(-1,1,1,-1,0,1),a=new i.BufferGeometry;a.setAttribute("position",new i.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),a.setAttribute("uv",new i.Float32BufferAttribute([0,2,0,0,2,0],2));class o{constructor(e){this._mesh=new i.Mesh(a,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,s)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}},6426:(e,t,n)=>{"use strict";n.r(t),n.d(t,{RenderPass:()=>s});var i=n(2212),r=n(740);class s extends r.w{constructor(e,t,n,r,s){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==s?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new i.Color}render(e,t,n){const i=e.autoClear;let r,s;e.autoClear=!1,void 0!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=s),e.autoClear=i}}},3114:(e,t,n)=>{"use strict";n.r(t),n.d(t,{SAOPass:()=>u});var i=n(2212),r=n(740);const s={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new i.Vector2(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new i.Matrix4},cameraInverseProjectionMatrix:{value:new i.Matrix4},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tvarying vec2 vUv;\n\n\t\t#if DIFFUSE_TEXTURE == 1\n\t\tuniform sampler2D tDiffuse;\n\t\t#endif\n\n\t\tuniform sampler2D tDepth;\n\n\t\t#if NORMAL_TEXTURE == 1\n\t\tuniform sampler2D tNormal;\n\t\t#endif\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float scale;\n\t\tuniform float intensity;\n\t\tuniform float bias;\n\t\tuniform float kernelRadius;\n\t\tuniform float minResolution;\n\t\tuniform vec2 size;\n\t\tuniform float randomSeed;\n\n\t\t// RGBA depth\n\n\t\t#include <packing>\n\n\t\tvec4 getDefaultColor( const in vec2 screenPosition ) {\n\t\t\t#if DIFFUSE_TEXTURE == 1\n\t\t\treturn texture2D( tDiffuse, vUv );\n\t\t\t#else\n\t\t\treturn vec4( 1.0 );\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n\t\t\t#else\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#endif\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {\n\t\t\t#if NORMAL_TEXTURE == 1\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\t\t\t#else\n\t\t\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );\n\t\t\t#endif\n\t\t}\n\n\t\tfloat scaleDividedByCameraFar;\n\t\tfloat minResolutionMultipliedByCameraFar;\n\n\t\tfloat getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {\n\t\t\tvec3 viewDelta = sampleViewPosition - centerViewPosition;\n\t\t\tfloat viewDistance = length( viewDelta );\n\t\t\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;\n\n\t\t\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );\n\t\t}\n\n\t\t// moving costly divides into consts\n\t\tconst float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\n\t\tconst float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\n\n\t\tfloat getAmbientOcclusion( const in vec3 centerViewPosition ) {\n\t\t\t// precompute some variables require in getOcclusion.\n\t\t\tscaleDividedByCameraFar = scale / cameraFar;\n\t\t\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;\n\t\t\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );\n\n\t\t\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/\n\t\t\tfloat angle = rand( vUv + randomSeed ) * PI2;\n\t\t\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;\n\t\t\tvec2 radiusStep = radius;\n\n\t\t\tfloat occlusionSum = 0.0;\n\t\t\tfloat weightSum = 0.0;\n\n\t\t\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {\n\t\t\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;\n\t\t\t\tradius += radiusStep;\n\t\t\t\tangle += ANGLE_STEP;\n\n\t\t\t\tfloat sampleDepth = getDepth( sampleUv );\n\t\t\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfloat sampleViewZ = getViewZ( sampleDepth );\n\t\t\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );\n\t\t\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );\n\t\t\t\tweightSum += 1.0;\n\t\t\t}\n\n\t\t\tif( weightSum == 0.0 ) discard;\n\n\t\t\treturn occlusionSum * ( intensity / weightSum );\n\t\t}\n\n\t\tvoid main() {\n\t\t\tfloat centerDepth = getDepth( vUv );\n\t\t\tif( centerDepth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat centerViewZ = getViewZ( centerDepth );\n\t\t\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );\n\n\t\t\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );\n\n\t\t\tgl_FragColor = getDefaultColor( vUv );\n\t\t\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;\n\t\t}"},a={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new i.Vector2(512,512)},sampleUvOffsets:{value:[new i.Vector2(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:"\n\n\t\t#include <common>\n\n\t\tuniform vec2 size;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 vInvSize;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tvInvSize = 1.0 / size;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\t\t#include <packing>\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform float depthCutoff;\n\n\t\tuniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];\n\t\tuniform float sampleWeights[ KERNEL_RADIUS + 1 ];\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 vInvSize;\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n\t\t\t#else\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#endif\n\t\t}\n\n\t\tvoid main() {\n\t\t\tfloat depth = getDepth( vUv );\n\t\t\tif( depth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat centerViewZ = -getViewZ( depth );\n\t\t\tbool rBreak = false, lBreak = false;\n\n\t\t\tfloat weightSum = sampleWeights[0];\n\t\t\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;\n\n\t\t\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\n\n\t\t\t\tfloat sampleWeight = sampleWeights[i];\n\t\t\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;\n\n\t\t\t\tvec2 sampleUv = vUv + sampleUvOffset;\n\t\t\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );\n\n\t\t\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;\n\n\t\t\t\tif( ! rBreak ) {\n\t\t\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n\t\t\t\t\tweightSum += sampleWeight;\n\t\t\t\t}\n\n\t\t\t\tsampleUv = vUv - sampleUvOffset;\n\t\t\t\tviewZ = -getViewZ( getDepth( sampleUv ) );\n\n\t\t\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;\n\n\t\t\t\tif( ! lBreak ) {\n\t\t\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n\t\t\t\t\tweightSum += sampleWeight;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = diffuseSum / weightSum;\n\t\t}"},o={createSampleWeights:function(e,t){const n=[];for(let i=0;i<=e;i++)n.push(l(i,t));return n},createSampleOffsets:function(e,t){const n=[];for(let i=0;i<=e;i++)n.push(t.clone().multiplyScalar(i));return n},configure:function(e,t,n,i){e.defines.KERNEL_RADIUS=t,e.uniforms.sampleUvOffsets.value=o.createSampleOffsets(t,i),e.uniforms.sampleWeights.value=o.createSampleWeights(t,n),e.needsUpdate=!0}};function l(e,t){return Math.exp(-e*e/(t*t*2))/(Math.sqrt(2*Math.PI)*t)}var c=n(8546);const h={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );\n\t\t\tgl_FragColor = vec4( vec3( depth ), opacity );\n\n\t\t}"};class u extends r.w{constructor(e,t,n,o,l){if(super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=void 0!==n&&n,this.supportsNormalTexture=void 0!==o&&o,this.originalClearColor=new i.Color,this._oldClearColor=new i.Color,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=void 0!==l?new i.Vector2(l.x,l.y):new i.Vector2(256,256),this.saoRenderTarget=new i.WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:i.RGBAFormat}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new i.WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:i.NearestFilter,magFilter:i.NearestFilter,format:i.RGBAFormat}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension){const e=new i.DepthTexture;e.type=i.UnsignedShortType,this.beautyRenderTarget.depthTexture=e,this.beautyRenderTarget.depthBuffer=!0}this.depthMaterial=new i.MeshDepthMaterial,this.depthMaterial.depthPacking=i.RGBADepthPacking,this.depthMaterial.blending=i.NoBlending,this.normalMaterial=new i.MeshNormalMaterial,this.normalMaterial.blending=i.NoBlending,void 0===s&&console.error("THREE.SAOPass relies on SAOShader"),this.saoMaterial=new i.ShaderMaterial({defines:Object.assign({},s.defines),fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:i.UniformsUtils.clone(s.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?n:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=i.NoBlending,void 0===a&&console.error("THREE.SAOPass relies on DepthLimitedBlurShader"),this.vBlurMaterial=new i.ShaderMaterial({uniforms:i.UniformsUtils.clone(a.uniforms),defines:Object.assign({},a.defines),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?n:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=i.NoBlending,this.hBlurMaterial=new i.ShaderMaterial({uniforms:i.UniformsUtils.clone(a.uniforms),defines:Object.assign({},a.defines),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?n:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=i.NoBlending,void 0===c.C&&console.error("THREE.SAOPass relies on CopyShader"),this.materialCopy=new i.ShaderMaterial({uniforms:i.UniformsUtils.clone(c.C.uniforms),vertexShader:c.C.vertexShader,fragmentShader:c.C.fragmentShader,blending:i.NoBlending}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=i.CustomBlending,this.materialCopy.blendSrc=i.DstColorFactor,this.materialCopy.blendDst=i.ZeroFactor,this.materialCopy.blendEquation=i.AddEquation,this.materialCopy.blendSrcAlpha=i.DstAlphaFactor,this.materialCopy.blendDstAlpha=i.ZeroFactor,this.materialCopy.blendEquationAlpha=i.AddEquation,void 0===h&&console.error("THREE.SAOPass relies on UnpackDepthRGBAShader"),this.depthCopy=new i.ShaderMaterial({uniforms:i.UniformsUtils.clone(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:i.NoBlending}),this.fsQuad=new r.T(null)}render(e,t,n){if(this.renderToScreen&&(this.materialCopy.blending=i.NoBlending,this.materialCopy.uniforms.tDiffuse.value=n.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),1===this.params.output)return;e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const r=e.autoClear;e.autoClear=!1,e.setRenderTarget(this.depthRenderTarget),e.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;const s=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=s,this.hBlurMaterial.uniforms.depthCutoff.value=s,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(o.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new i.Vector2(0,1)),o.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new i.Vector2(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),e.setClearColor(0),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(e,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));let a=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,a=this.depthCopy):4===this.params.output?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),0===this.params.output?a.blending=i.CustomBlending:a.blending=i.NoBlending,this.renderPass(e,a,this.renderToScreen?null:n),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=r}renderPass(e,t,n,i,r){e.getClearColor(this.originalClearColor);const s=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(n),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(r||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}renderOverride(e,t,n,i,r){e.getClearColor(this.originalClearColor);const s=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(n),e.autoClear=!1,i=t.clearColor||i,r=t.clearAlpha||r,null!=i&&(e.setClearColor(i),e.setClearAlpha(r||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}setSize(e,t){this.beautyRenderTarget.setSize(e,t),this.saoRenderTarget.setSize(e,t),this.blurIntermediateRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.depthRenderTarget.setSize(e,t),this.saoMaterial.uniforms.size.value.set(e,t),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,t),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,t),this.hBlurMaterial.needsUpdate=!0}}u.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4}},3919:(e,t,n)=>{"use strict";n.r(t),n.d(t,{SSAARenderPass:()=>a});var i=n(2212),r=n(740),s=n(8546);class a extends r.w{constructor(e,t,n,a){super(),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==n?n:0,this.clearAlpha=void 0!==a?a:0,this._oldClearColor=new i.Color,void 0===s.C&&console.error("THREE.SSAARenderPass relies on CopyShader");const o=s.C;this.copyUniforms=i.UniformsUtils.clone(o.uniforms),this.copyMaterial=new i.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:i.AdditiveBlending,depthTest:!1,depthWrite:!1}),this.fsQuad=new r.T(this.copyMaterial)}dispose(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)}setSize(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)}render(e,t,n){this.sampleRenderTarget||(this.sampleRenderTarget=new i.WebGLRenderTarget(n.width,n.height,{minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:i.RGBAFormat}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");const r=o[Math.max(0,Math.min(this.sampleLevel,5))],s=e.autoClear;e.autoClear=!1,e.getClearColor(this._oldClearColor);const a=e.getClearAlpha(),l=1/r.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;const c={fullWidth:n.width,fullHeight:n.height,offsetX:0,offsetY:0,width:n.width,height:n.height},h=Object.assign({},this.camera.view);h.enabled&&Object.assign(c,h);for(let n=0;n<r.length;n++){const i=r[n];this.camera.setViewOffset&&this.camera.setViewOffset(c.fullWidth,c.fullHeight,c.offsetX+.0625*i[0],c.offsetY+.0625*i[1],c.width,c.height);let s=l;this.unbiased&&(s+=.03125*((n+.5)/r.length-.5)),this.copyUniforms.opacity.value=s,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:t),0===n&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e)}this.camera.setViewOffset&&h.enabled?this.camera.setViewOffset(h.fullWidth,h.fullHeight,h.offsetX,h.offsetY,h.width,h.height):this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=s,e.setClearColor(this._oldClearColor,a)}}const o=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]]},8546:(e,t,n)=>{"use strict";n.d(t,{C:()=>i});var i={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"}},2899:(e,t,n)=>{"use strict";var i;n.r(t),n.d(t,{Lifecycle:()=>r,autoInjectable:()=>L,container:()=>P,delay:()=>g,inject:()=>I,injectAll:()=>B,injectAllWithTransform:()=>z,injectWithTransform:()=>U,injectable:()=>D,instanceCachingFactory:()=>H,isClassProvider:()=>p,isFactoryProvider:()=>f,isNormalToken:()=>v,isTokenProvider:()=>b,isValueProvider:()=>w,predicateAwareClassFactory:()=>V,registry:()=>O,scoped:()=>k,singleton:()=>N}),function(e){e[e.Transient=0]="Transient",e[e.Singleton=1]="Singleton",e[e.ResolutionScoped=2]="ResolutionScoped",e[e.ContainerScoped=3]="ContainerScoped"}(i||(i={}));const r=i;var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function a(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,s=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return a}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}var h="injectionTokens";function u(e){var t=Reflect.getMetadata("design:paramtypes",e)||[],n=Reflect.getOwnMetadata(h,e)||{};return Object.keys(n).forEach((function(e){t[+e]=n[e]})),t}function d(e,t){return function(n,i,r){var s=Reflect.getOwnMetadata(h,n)||{};s[r]=t?{token:e,transform:t.transformToken,transformArgs:t.args||[]}:e,Reflect.defineMetadata(h,s,n)}}function p(e){return!!e.useClass}function f(e){return!!e.useFactory}var m=function(){function e(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return e.prototype.createProxy=function(e){var t,n=this,i=!1;return new Proxy({},this.createHandler((function(){return i||(t=e(n.wrap()),i=!0),t})))},e.prototype.createHandler=function(e){var t={};return this.reflectMethods.forEach((function(n){t[n]=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];t[0]=e();var r=Reflect[n];return r.apply(void 0,c(t))}})),t},e}();function g(e){if(void 0===e)throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new m(e)}function v(e){return"string"==typeof e||"symbol"==typeof e}function _(e){return"object"==typeof e&&"token"in e&&"multiple"in e}function y(e){return"object"==typeof e&&"token"in e&&"transform"in e}function b(e){return!!e.useToken}function w(e){return null!=e.useValue}const x=function(){function e(){this._registryMap=new Map}return e.prototype.entries=function(){return this._registryMap.entries()},e.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},e.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},e.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},e.prototype.setAll=function(e,t){this._registryMap.set(e,t)},e.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},e.prototype.clear=function(){this._registryMap.clear()},e.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},e}(),M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(x),E=function(){this.scopedResolutions=new Map};function S(e,t,n){var i,r,s,a,o=l(e.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1];return i="Cannot inject the dependency "+(a=t,null===(s=void 0===o?null:o)?"at position #"+a:'"'+s.split(",")[a].trim()+'" at position #'+a)+' of "'+e.name+'" constructor. Reason:',void 0===r&&(r="    "),c([i],n.message.split("\n").map((function(e){return r+e}))).join("\n")}var T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(x),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(x);const R=function(){this.preResolution=new T,this.postResolution=new A};var C=new Map,P=new(function(){function e(e){this.parent=e,this._registry=new M,this.interceptors=new R}return e.prototype.register=function(e,t,n){var i;if(void 0===n&&(n={lifecycle:r.Transient}),i=function(e){return p(e)||w(e)||b(e)||f(e)}(t)?t:{useClass:t},b(i))for(var s=[e],a=i;null!=a;){var o=a.useToken;if(s.includes(o))throw new Error("Token registration cycle detected! "+c(s,[o]).join(" -> "));s.push(o);var l=this._registry.get(o);a=l&&b(l.provider)?l.provider:null}if((n.lifecycle===r.Singleton||n.lifecycle==r.ContainerScoped||n.lifecycle==r.ResolutionScoped)&&(w(i)||f(i)))throw new Error('Cannot use lifecycle "'+r[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:i,options:n}),this},e.prototype.registerType=function(e,t){return v(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},e.prototype.registerInstance=function(e,t){return this.register(e,{useValue:t})},e.prototype.registerSingleton=function(e,t){if(v(e)){if(v(t))return this.register(e,{useToken:t},{lifecycle:r.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:r.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!v(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:r.Singleton})},e.prototype.resolve=function(e,t){void 0===t&&(t=new E);var n=this.getRegistration(e);if(!n&&v(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"Single"),n){var i=this.resolveRegistration(n,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(function(e){return"function"==typeof e||e instanceof m}(e))return i=this.construct(e,t),this.executePostResolutionInterceptor(e,i,"Single"),i;throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},e.prototype.executePreResolutionInterceptor=function(e,t){var n,i;if(this.interceptors.preResolution.has(e)){var r=[];try{for(var s=o(this.interceptors.preResolution.getAll(e)),a=s.next();!a.done;a=s.next()){var l=a.value;"Once"!=l.options.frequency&&r.push(l),l.callback(e,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,r)}},e.prototype.executePostResolutionInterceptor=function(e,t,n){var i,r;if(this.interceptors.postResolution.has(e)){var s=[];try{for(var a=o(this.interceptors.postResolution.getAll(e)),l=a.next();!l.done;l=a.next()){var c=l.value;"Once"!=c.options.frequency&&s.push(c),c.callback(e,t,n)}}catch(e){i={error:e}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}this.interceptors.postResolution.setAll(e,s)}},e.prototype.resolveRegistration=function(e,t){if(e.options.lifecycle===r.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n,i=e.options.lifecycle===r.Singleton,s=e.options.lifecycle===r.ContainerScoped,a=i||s;return n=w(e.provider)?e.provider.useValue:b(e.provider)?a?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):p(e.provider)?a?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):f(e.provider)?e.provider.useFactory(this):this.construct(e.provider,t),e.options.lifecycle===r.ResolutionScoped&&t.scopedResolutions.set(e,n),n},e.prototype.resolveAll=function(e,t){var n=this;void 0===t&&(t=new E);var i=this.getAllRegistrations(e);if(!i&&v(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"All"),i){var r=i.map((function(e){return n.resolveRegistration(e,t)}));return this.executePostResolutionInterceptor(e,r,"All"),r}var s=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,s,"All"),s},e.prototype.isRegistered=function(e,t){return void 0===t&&(t=!1),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},e.prototype.reset=function(){this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},e.prototype.clearInstances=function(){var e,t;try{for(var n=o(this._registry.entries()),i=n.next();!i.done;i=n.next()){var r=l(i.value,2),s=r[0],a=r[1];this._registry.setAll(s,a.filter((function(e){return!w(e.provider)})).map((function(e){return e.instance=void 0,e})))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.createChildContainer=function(){var t,n,i=new e(this);try{for(var s=o(this._registry.entries()),a=s.next();!a.done;a=s.next()){var c=l(a.value,2),h=c[0],u=c[1];u.some((function(e){return e.options.lifecycle===r.ContainerScoped}))&&i._registry.setAll(h,u.map((function(e){return e.options.lifecycle===r.ContainerScoped?{provider:e.provider,options:e.options}:e})))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return i},e.prototype.beforeResolution=function(e,t,n){void 0===n&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},e.prototype.afterResolution=function(e,t,n){void 0===n&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},e.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},e.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},e.prototype.construct=function(e,t){var n=this;if(e instanceof m)return e.createProxy((function(e){return n.resolve(e,t)}));var i=C.get(e);if(!i||0===i.length){if(0===e.length)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var r=i.map(this.resolveParams(t,e));return new(e.bind.apply(e,c([void 0],r)))},e.prototype.resolveParams=function(e,t){var n=this;return function(i,r){var s,a,o;try{return _(i)?y(i)?i.multiple?(s=n.resolve(i.transform)).transform.apply(s,c([n.resolveAll(i.token)],i.transformArgs)):(a=n.resolve(i.transform)).transform.apply(a,c([n.resolve(i.token,e)],i.transformArgs)):i.multiple?n.resolveAll(i.token):n.resolve(i.token,e):y(i)?(o=n.resolve(i.transform,e)).transform.apply(o,c([n.resolve(i.token,e)],i.transformArgs)):n.resolve(i,e)}catch(e){throw new Error(S(t,r,e))}}},e}());const L=function(){return function(e){var t=u(e);return function(n){function i(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return n.apply(this,c(i.concat(t.slice(i.length).map((function(t,n){var r,s,a;try{return _(t)?y(t)?t.multiple?(r=P.resolve(t.transform)).transform.apply(r,c([P.resolveAll(t.token)],t.transformArgs)):(s=P.resolve(t.transform)).transform.apply(s,c([P.resolve(t.token)],t.transformArgs)):t.multiple?P.resolveAll(t.token):P.resolve(t.token):y(t)?(a=P.resolve(t.transform)).transform.apply(a,c([P.resolve(t.token)],t.transformArgs)):P.resolve(t)}catch(t){var o=n+i.length;throw new Error(S(e,o,t))}})))))||this}return a(i,n),i}(e)}},I=function(e){return d(e)},D=function(){return function(e){C.set(e,u(e))}},O=function(e){return void 0===e&&(e=[]),function(t){return e.forEach((function(e){var t=e.token,n=e.options,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["token","options"]);return P.register(t,i,n)})),t}},N=function(){return function(e){D()(e),P.registerSingleton(e)}},B=function(e){return d({token:e,multiple:!0})},z=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r={token:e,multiple:!0,transform:t,transformArgs:n};return d(r)},U=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return d(e,{transformToken:t,args:n})};function k(e,t){return function(n){D()(n),P.register(t||n,n,{lifecycle:e})}}function H(e){var t;return function(n){return null==t&&(t=e(n)),t}}function V(e,t,n,i){var r,s;return void 0===i&&(i=!0),function(a){var o=e(a);return i&&s===o||(r=(s=o)?a.resolve(t):a.resolve(n)),r}}if("undefined"==typeof Reflect||!Reflect.getMetadata)throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.")},1614:(e,t,n)=>{"use strict";var i;n.r(t),n.d(t,{NIL:()=>P,parse:()=>g,stringify:()=>h,v1:()=>m,v3:()=>S,v4:()=>T,v5:()=>C,validate:()=>o,version:()=>L});var r=new Uint8Array(16);function s(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)}const a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,o=function(e){return"string"==typeof e&&a.test(e)};for(var l=[],c=0;c<256;++c)l.push((c+256).toString(16).substr(1));const h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase();if(!o(n))throw TypeError("Stringified UUID is invalid");return n};var u,d,p=0,f=0;const m=function(e,t,n){var i=t&&n||0,r=t||new Array(16),a=(e=e||{}).node||u,o=void 0!==e.clockseq?e.clockseq:d;if(null==a||null==o){var l=e.random||(e.rng||s)();null==a&&(a=u=[1|l[0],l[1],l[2],l[3],l[4],l[5]]),null==o&&(o=d=16383&(l[6]<<8|l[7]))}var c=void 0!==e.msecs?e.msecs:Date.now(),m=void 0!==e.nsecs?e.nsecs:f+1,g=c-p+(m-f)/1e4;if(g<0&&void 0===e.clockseq&&(o=o+1&16383),(g<0||c>p)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=c,f=m,d=o;var v=(1e4*(268435455&(c+=122192928e5))+m)%4294967296;r[i++]=v>>>24&255,r[i++]=v>>>16&255,r[i++]=v>>>8&255,r[i++]=255&v;var _=c/4294967296*1e4&268435455;r[i++]=_>>>8&255,r[i++]=255&_,r[i++]=_>>>24&15|16,r[i++]=_>>>16&255,r[i++]=o>>>8|128,r[i++]=255&o;for(var y=0;y<6;++y)r[i+y]=a[y];return t||h(r)},g=function(e){if(!o(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function v(e,t,n){function i(e,i,r,s){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof i&&(i=g(i)),16!==i.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var a=new Uint8Array(16+e.length);if(a.set(i),a.set(e,i.length),(a=n(a))[6]=15&a[6]|t,a[8]=63&a[8]|128,r){s=s||0;for(var o=0;o<16;++o)r[s+o]=a[o];return r}return h(a)}try{i.name=e}catch(e){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i}function _(e){return 14+(e+64>>>9<<4)+1}function y(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function b(e,t,n,i,r,s){return y((a=y(y(t,e),y(i,s)))<<(o=r)|a>>>32-o,n);var a,o}function w(e,t,n,i,r,s,a){return b(t&n|~t&i,e,t,r,s,a)}function x(e,t,n,i,r,s,a){return b(t&i|n&~i,e,t,r,s,a)}function M(e,t,n,i,r,s,a){return b(t^n^i,e,t,r,s,a)}function E(e,t,n,i,r,s,a){return b(n^(t|~i),e,t,r,s,a)}const S=v("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,i="0123456789abcdef",r=0;r<n;r+=8){var s=e[r>>5]>>>r%32&255,a=parseInt(i.charAt(s>>>4&15)+i.charAt(15&s),16);t.push(a)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[_(t)-1]=t;for(var n=1732584193,i=-271733879,r=-1732584194,s=271733878,a=0;a<e.length;a+=16){var o=n,l=i,c=r,h=s;n=w(n,i,r,s,e[a],7,-680876936),s=w(s,n,i,r,e[a+1],12,-389564586),r=w(r,s,n,i,e[a+2],17,606105819),i=w(i,r,s,n,e[a+3],22,-1044525330),n=w(n,i,r,s,e[a+4],7,-176418897),s=w(s,n,i,r,e[a+5],12,1200080426),r=w(r,s,n,i,e[a+6],17,-1473231341),i=w(i,r,s,n,e[a+7],22,-45705983),n=w(n,i,r,s,e[a+8],7,1770035416),s=w(s,n,i,r,e[a+9],12,-1958414417),r=w(r,s,n,i,e[a+10],17,-42063),i=w(i,r,s,n,e[a+11],22,-1990404162),n=w(n,i,r,s,e[a+12],7,1804603682),s=w(s,n,i,r,e[a+13],12,-40341101),r=w(r,s,n,i,e[a+14],17,-1502002290),n=x(n,i=w(i,r,s,n,e[a+15],22,1236535329),r,s,e[a+1],5,-165796510),s=x(s,n,i,r,e[a+6],9,-1069501632),r=x(r,s,n,i,e[a+11],14,643717713),i=x(i,r,s,n,e[a],20,-373897302),n=x(n,i,r,s,e[a+5],5,-701558691),s=x(s,n,i,r,e[a+10],9,38016083),r=x(r,s,n,i,e[a+15],14,-660478335),i=x(i,r,s,n,e[a+4],20,-405537848),n=x(n,i,r,s,e[a+9],5,568446438),s=x(s,n,i,r,e[a+14],9,-1019803690),r=x(r,s,n,i,e[a+3],14,-187363961),i=x(i,r,s,n,e[a+8],20,1163531501),n=x(n,i,r,s,e[a+13],5,-1444681467),s=x(s,n,i,r,e[a+2],9,-51403784),r=x(r,s,n,i,e[a+7],14,1735328473),n=M(n,i=x(i,r,s,n,e[a+12],20,-1926607734),r,s,e[a+5],4,-378558),s=M(s,n,i,r,e[a+8],11,-2022574463),r=M(r,s,n,i,e[a+11],16,1839030562),i=M(i,r,s,n,e[a+14],23,-35309556),n=M(n,i,r,s,e[a+1],4,-1530992060),s=M(s,n,i,r,e[a+4],11,1272893353),r=M(r,s,n,i,e[a+7],16,-155497632),i=M(i,r,s,n,e[a+10],23,-1094730640),n=M(n,i,r,s,e[a+13],4,681279174),s=M(s,n,i,r,e[a],11,-358537222),r=M(r,s,n,i,e[a+3],16,-722521979),i=M(i,r,s,n,e[a+6],23,76029189),n=M(n,i,r,s,e[a+9],4,-640364487),s=M(s,n,i,r,e[a+12],11,-421815835),r=M(r,s,n,i,e[a+15],16,530742520),n=E(n,i=M(i,r,s,n,e[a+2],23,-995338651),r,s,e[a],6,-198630844),s=E(s,n,i,r,e[a+7],10,1126891415),r=E(r,s,n,i,e[a+14],15,-1416354905),i=E(i,r,s,n,e[a+5],21,-57434055),n=E(n,i,r,s,e[a+12],6,1700485571),s=E(s,n,i,r,e[a+3],10,-1894986606),r=E(r,s,n,i,e[a+10],15,-1051523),i=E(i,r,s,n,e[a+1],21,-2054922799),n=E(n,i,r,s,e[a+8],6,1873313359),s=E(s,n,i,r,e[a+15],10,-30611744),r=E(r,s,n,i,e[a+6],15,-1560198380),i=E(i,r,s,n,e[a+13],21,1309151649),n=E(n,i,r,s,e[a+4],6,-145523070),s=E(s,n,i,r,e[a+11],10,-1120210379),r=E(r,s,n,i,e[a+2],15,718787259),i=E(i,r,s,n,e[a+9],21,-343485551),n=y(n,o),i=y(i,l),r=y(r,c),s=y(s,h)}return[n,i,r,s]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(_(t)),i=0;i<t;i+=8)n[i>>5]|=(255&e[i/8])<<i%32;return n}(e),8*e.length))})),T=function(e,t,n){var i=(e=e||{}).random||(e.rng||s)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=i[r];return t}return h(i)};function A(e,t,n,i){switch(e){case 0:return t&n^~t&i;case 1:return t^n^i;case 2:return t&n^t&i^n&i;case 3:return t^n^i}}function R(e,t){return e<<t|e>>>32-t}const C=v("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var i=unescape(encodeURIComponent(e));e=[];for(var r=0;r<i.length;++r)e.push(i.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var s=e.length/4+2,a=Math.ceil(s/16),o=new Array(a),l=0;l<a;++l){for(var c=new Uint32Array(16),h=0;h<16;++h)c[h]=e[64*l+4*h]<<24|e[64*l+4*h+1]<<16|e[64*l+4*h+2]<<8|e[64*l+4*h+3];o[l]=c}o[a-1][14]=8*(e.length-1)/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=8*(e.length-1)&4294967295;for(var u=0;u<a;++u){for(var d=new Uint32Array(80),p=0;p<16;++p)d[p]=o[u][p];for(var f=16;f<80;++f)d[f]=R(d[f-3]^d[f-8]^d[f-14]^d[f-16],1);for(var m=n[0],g=n[1],v=n[2],_=n[3],y=n[4],b=0;b<80;++b){var w=Math.floor(b/20),x=R(m,5)+A(w,g,v,_)+y+t[w]+d[b]>>>0;y=_,_=v,v=R(g,30)>>>0,g=m,m=x}n[0]=n[0]+m>>>0,n[1]=n[1]+g>>>0,n[2]=n[2]+v>>>0,n[3]=n[3]+_>>>0,n[4]=n[4]+y>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),P="00000000-0000-0000-0000-000000000000",L=function(e){if(!o(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";n(8660);var e,t,i=n(3256);t=function(){return function(e,t){var n,i,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}(this,(function(e){switch(e.label){case 0:return[4,i.hi.createAndInitializeSession({ticket:"d7275c4a686c2df9ba75ca6c7e05dc674ae60912c1aa75e478f273dab718cd20b2a269073e03b5810daaf461c82ad990b176d3071776ec0f80fa034bb1e2bc6ee6c99fc82764ad55157bcba7dd1856b18eb0390e2b83c201be16e51de33c356fc6ad73cb3100eeecd3fc48ea5405e7f1c2272088d7-ff5d231fc13c2098c7ed85e51331760e",modelViewUrl:"https://sdeuc1.eu-central-1.shapediver.com",id:"mySession"})];case 1:return e.sent(),[4,i.hi.createAndInitializeViewer({canvas:document.getElementById("canvas"),id:"myViewer"})];case 2:return e.sent(),[2]}}))},new((e=void 0)||(e=Promise))((function(n,i){function r(e){try{a(t.next(e))}catch(e){i(e)}}function s(e){try{a(t.throw(e))}catch(e){i(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e((function(e){e(i)}))).then(r,s)}a((t=t.apply(void 0,[])).next())}))})()})();